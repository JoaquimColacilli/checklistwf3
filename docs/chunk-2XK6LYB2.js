import{a as ie}from"./chunk-GCE7TE5F.js";import"./chunk-IWCTQMW2.js";import{U as q,X as H,_ as M,aa as J,ba as K,n as k,na as b,p as E,pa as Q,qa as U,ta as X,va as Y,wa as Z,xa as ee,ya as te}from"./chunk-2XORILJT.js";import"./chunk-TC6LVV5X.js";import"./chunk-ICTHBN6B.js";import{Bb as z,Cb as W,Fb as R,Ia as l,Ja as I,Qb as j,_a as x,ab as _,cb as P,eb as n,ec as O,fb as r,fc as $,gb as D,ic as B,ja as T,jb as C,lb as u,mb as c,nb as L,sa as p,sb as N,ta as g,tb as o,ub as S,vb as h,wb as G,xb as A,yb as F,zb as V}from"./chunk-NOL2URQB.js";import{a as y,b as w,f}from"./chunk-XBB5NZD7.js";var re=()=>[5,10,15,20];function ae(s,m){if(s&1&&(n(0,"div",40),o(1),r()),s&2){let a=c().$implicit;l(),h(" ",a.valor," ")}}function oe(s,m){if(s&1){let a=C();n(0,"input",41),V("ngModelChange",function(t){p(a);let i=c().$implicit;return F(i.valor,t)||(i.valor=t),g(t)}),u("blur",function(){p(a);let t=c().index,i=c(2);return g(i.guardarCampo(t))}),r()}if(s&2){let a=c().$implicit;A("ngModel",a.valor)}}function se(s,m){if(s&1){let a=C();n(0,"tr",33)(1,"td",27),o(2),r(),n(3,"td",34),x(4,ae,2,1,"div",35)(5,oe,1,1,"ng-template",null,0,R),r(),n(7,"td",27)(8,"button",36),u("click",function(){let t=p(a).index,i=c(2);return g(i.editarCampo(t))}),D(9,"i",37),o(10," Editar "),r(),n(11,"button",38),u("click",function(){let t=p(a).index,i=c(2);return g(i.confirmarEliminar(t))}),n(12,"i",39),u("click",function(){let t=p(a).index,i=c(2);return g(i.confirmarEliminar(t))}),r(),o(13," Eliminar "),r()()()}if(s&2){let a=m.$implicit,e=m.index,t=N(6);l(2),h(" ",e+1," "),l(2),_("ngIf",!a.editando)("ngIfElse",t),l(8),L("id","icono-",e,"")}}function le(s,m){if(s&1){let a=C();n(0,"div",20)(1,"div",21)(2,"div",22)(3,"h2",23),o(4," Editar Checklist "),r(),n(5,"table",24)(6,"thead",25)(7,"tr")(8,"th",26),o(9," ID "),r(),n(10,"th",27),o(11," Campo "),r(),n(12,"th",28),o(13," Acciones "),r()()(),n(14,"tbody"),x(15,se,14,5,"tr",29),n(16,"tr")(17,"td",30)(18,"button",4),u("click",function(){p(a);let t=c();return g(t.agregarCampo())}),o(19," Agregar Campo "),r()()()()(),n(20,"div",31)(21,"button",32),u("click",function(){p(a);let t=c();return g(t.cerrarModal())}),o(22," Cancelar "),r(),n(23,"button",4),u("click",function(){p(a);let t=c();return g(t.guardarCambios())}),o(24,"Guardar"),r()()()()()}if(s&2){let a=c();l(15),_("ngForOf",a.campos)}}function ce(s,m){if(s&1){let a=C();n(0,"app-nuevo-despliegue",42),u("cerrar",function(){p(a);let t=c();return g(t.cerrarModalNuevoDespliegue())})("guardar",function(t){p(a);let i=c();return g(i.guardarNuevoDespliegue(t,"WF3"))})("editar",function(t){p(a);let i=c();return g(i.editarNuevoDespliegue(t,"WF3"))}),r()}if(s&2){let a=c();_("campos",a.campos)("despliegue",a.esNuevoDespliegue?null:a.despliegueSeleccionado)("ambiente",a.ambiente)}}function de(s,m){if(s&1){let a=C();n(0,"div",20)(1,"div",47)(2,"h2",48),o(3," Confirmar eliminaci\xF3n "),r(),n(4,"p",49),o(5," \xBFEst\xE1 seguro de eliminar el despliegue "),n(6,"strong"),o(7),r(),o(8," de "),n(9,"strong"),o(10),r(),o(11,"? "),r(),n(12,"div",50)(13,"button",3),u("click",function(){p(a);let t=c(2);return g(t.showConfirmDeleteModal=!1)}),o(14," Cancelar "),r(),n(15,"button",4),u("click",function(){p(a);let t=c().index,i=c();return g(i.eliminarDespliegue(t,"WF3"))}),o(16," Eliminar "),r()()()()}if(s&2){let a=c(2);l(7),S(a.deploymentToDelete.tag),l(3),S(a.deploymentToDelete.microservicio)}}function me(s,m){if(s&1){let a=C();n(0,"tr",43)(1,"td",27),o(2),r(),n(3,"td",27),o(4),r(),n(5,"td",27),o(6),r(),n(7,"td",27),o(8),r(),n(9,"td",27),o(10),r(),n(11,"td",27),o(12),r(),n(13,"td",27)(14,"button",44),u("click",function(){let t=p(a).index,i=c();return g(i.editarDespliegue(t))}),D(15,"i",37),r(),n(16,"button",45),u("click",function(){let t=p(a).index,i=c();return g(i.confirmDeleteDeployment(t))}),D(17,"i",46),r()(),x(18,de,17,2,"div",5),r()}if(s&2){let a=m.$implicit,e=m.index,t=c();l(2),h(" ",e+1+(t.currentPage-1)*t.itemsPerPage," "),l(2),h(" ",a.responsable," "),l(2),h(" ",a.tag," "),l(2),h(" ",a.microservicio," "),l(2),h(" ",a.auditor," "),l(2),h(" ",a.fecha," "),l(6),_("ngIf",t.showConfirmDeleteModal)}}function ue(s,m){if(s&1&&(n(0,"option",51),o(1),r()),s&2){let a=m.$implicit;_("value",a),l(),h(" ",a," ")}}var ve=(()=>{let m=class m{constructor(e){this.cdr=e,this.modalAbierto=!1,this.modalNuevoDespliegueAbierto=!1,this.campos=[],this.datosGuardados=[],this.pagedDatosGuardados=[],this.despliegueSeleccionado=null,this.esNuevoDespliegue=!0,this.deploymentToDelete={auditor:null,checkList:null,fecha:null,id:null,microservicio:null,responsable:null,tag:null},this.showConfirmDeleteModal=!1,this.ambiente="WF3",this.itemsPerPage=5,this.currentPage=1,this.totalPages=1}ngOnInit(){return f(this,null,function*(){yield this.cargarDespliegues(this.ambiente),yield this.cargarDatos(this.ambiente)})}cargarDatos(e){return f(this,null,function*(){let t=E(k(b,"checklists"),`checklistActas_${e}`),i=yield q(t);if(i.exists()){let d=i.data();d&&"campos"in d&&Array.isArray(d.campos)?(this.campos=d.campos,this.cdr.markForCheck()):console.log("La estructura de datos en Firestore es incorrecta o no contiene campos.")}else console.log("No se encontraron datos en Firestore.")})}cargarDespliegues(e){return f(this,null,function*(){let t=k(b,`nuevosDespliegues_${e}`),i=yield H(t);this.datosGuardados=i.docs.map(d=>y({id:d.id},d.data())),this.totalPages=Math.ceil(this.datosGuardados.length/this.itemsPerPage),this.actualizarPagina(),this.cdr.markForCheck()})}actualizarPagina(){let e=(this.currentPage-1)*this.itemsPerPage,t=e+this.itemsPerPage;this.pagedDatosGuardados=this.datosGuardados.slice(e,t)}cambiarItemsPorPagina(){this.totalPages=Math.ceil(this.datosGuardados.length/this.itemsPerPage),this.currentPage=1,this.actualizarPagina()}paginaAnterior(){this.currentPage>1&&(this.currentPage--,this.actualizarPagina())}paginaSiguiente(){this.currentPage<this.totalPages&&(this.currentPage++,this.actualizarPagina())}abrirModal(){this.modalAbierto=!0}cerrarModal(){this.modalAbierto=!1}agregarCampo(){this.campos.push({valor:"",editando:!0,responsableChecked:!1})}confirmarEliminar(e){if(this.campos[e]?.confirmarEliminar)this.eliminarCampo(e);else if(this.campos[e]){this.campos[e].confirmarEliminar=!0;let t=document.getElementById("icono-"+e);t&&t.classList.add("text-red-500"),setTimeout(()=>{t&&t.classList.remove("text-red-500"),this.campos[e]&&(this.campos[e].confirmarEliminar=!1)},3e3)}}guardarCampo(e){this.campos[e].valor.trim()!==""&&(this.campos[e].editando=!1,this.actualizarCampoEnFirestore("WF3"))}actualizarCampoEnFirestore(e){return f(this,null,function*(){let t=E(k(b,"checklists"),`checklistActas_${e}`);try{yield M(t,{campos:this.campos,ambiente:e}),console.log("Cambios guardados en Firestore.")}catch(i){console.error("Error guardando los cambios en Firestore:",i)}})}editarCampo(e){this.campos[e].editando=!0}eliminarCampo(e){this.campos.splice(e,1),this.actualizarCampoEnFirestore("WF3")}guardarCambios(){return f(this,null,function*(){this.campos=this.campos.map((e,t)=>w(y({},e),{id:t+1})),this.cerrarModal(),yield this.actualizarCampoEnFirestore("WF3")})}todosResponsablesMarcados(){return this.campos.every(e=>e.responsableChecked)}checkResponsableStatus(){this.cdr.markForCheck()}abrirNuevoDespliegueModal(){this.modalNuevoDespliegueAbierto=!0,this.despliegueSeleccionado=null,this.esNuevoDespliegue=!0}cerrarModalNuevoDespliegue(){this.modalNuevoDespliegueAbierto=!1}guardarNuevoDespliegue(e,t){return f(this,null,function*(){console.log(e);try{let i=k(b,`nuevosDespliegues_${t}`),d=yield K(i,w(y({},e),{ambiente:t}));console.log("Nuevo despliegue guardado con ID: ",d.id),this.datosGuardados.push(w(y({},e),{id:d.id})),this.totalPages=Math.ceil(this.datosGuardados.length/this.itemsPerPage),this.actualizarPagina(),this.cdr.markForCheck(),this.cerrarModalNuevoDespliegue()}catch(i){console.error("Error guardando el nuevo despliegue en Firestore:",i)}})}editarNuevoDespliegue(e,t){return f(this,null,function*(){try{let i=E(b,`nuevosDespliegues_${t}`,e.id);yield M(i,e),console.log("Despliegue editado con ID: ",e.id);let d=this.datosGuardados.findIndex(v=>v.id===e.id);d>-1&&(this.datosGuardados[d]=e),this.actualizarPagina(),this.cdr.markForCheck(),this.cerrarModalNuevoDespliegue()}catch(i){console.error("Error editando el despliegue en Firestore:",i)}})}eliminarDespliegue(e,t){return f(this,null,function*(){try{let i=this.deploymentToDelete.id,d=E(b,`nuevosDespliegues_${t}`,i);yield J(d),this.datosGuardados=this.datosGuardados.filter((v,ne)=>ne!==e),this.totalPages=Math.ceil(this.datosGuardados.length/this.itemsPerPage),this.actualizarPagina(),console.log("Despliegue eliminado con ID: ",i),this.showConfirmDeleteModal=!1,this.cdr.markForCheck()}catch(i){console.error("Error eliminando el despliegue en Firestore:",i)}})}confirmDeleteDeployment(e){this.deploymentToDelete=this.datosGuardados[e],console.log(this.deploymentToDelete.id),this.showConfirmDeleteModal=!0}editarDespliegue(e){let t=this.datosGuardados[e];console.log(t),this.despliegueSeleccionado=t,this.esNuevoDespliegue=!1,console.log(this.despliegueSeleccionado),this.modalNuevoDespliegueAbierto=!0}};m.\u0275fac=function(t){return new(t||m)(I(j))},m.\u0275cmp=T({type:m,selectors:[["app-check-list-actas"]],standalone:!0,features:[z],decls:42,vars:14,consts:[["mostrarValor",""],[1,"font-bold","text-lg","lg:text-3xl","mb-4"],[1,"flex","justify-end","mb-4"],[1,"btn-primary","mr-2",3,"click"],[1,"btn-primary",3,"click"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",4,"ngIf"],[3,"campos","despliegue","ambiente","cerrar","guardar","editar",4,"ngIf"],[1,"overflow-x-auto","mt-4"],[1,"w-full","table-auto","bg-gray-800","rounded-lg","overflow-hidden"],[1,"bg-gray-700","text-white"],[1,"px-4","py-2"],["class","hover:bg-gray-700 transition-colors",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","mt-4","px-4","py-2","bg-gray-900","rounded-md"],[1,"flex","items-center"],["for","itemsPerPage",1,"text-gray-300","mr-2"],["id","itemsPerPage",1,"rounded-md","text-gray-900","bg-gray-200","border","border-gray-400","focus:outline-none","focus:ring-2","focus:ring-indigo-600",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-2"],[1,"btn-secondary",3,"click","disabled"],[1,"text-gray-300"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-50","z-50"],[1,"bg-gray-900","rounded-lg","w-1/3","max-h-[80%]","max-w-[80%]","overflow-auto","px-3","py-2","scrollbar-thin","scrollbar-thumb-gray-700","scrollbar-track-gray-900","scrollbar-thumb-rounded-full","scrollbar-track-rounded-full"],[1,"modal-content"],[1,"text-2xl","font-bold","text-center","text-white","mb-4"],[1,"w-full","table-auto","bg-gray-800","rounded-lg"],[1,"bg-gray-700","text-white","rounded-t-lg"],[1,"px-4","py-2","border-b","border-gray-700","text-center","rounded-tl-lg"],[1,"px-4","py-2","border-b","border-gray-700","text-center"],[1,"px-4","py-2","border-b","border-gray-700","text-center","rounded-tr-lg"],["class","hover:bg-gray-700 transition-colors","style","height: 50px",4,"ngFor","ngForOf"],["colspan","3",1,"px-4","py-2","text-center"],[1,"flex","justify-end","mt-4"],[1,"btn-primary","mr-1",3,"click"],[1,"hover:bg-gray-700","transition-colors",2,"height","50px"],[1,"px-4","py-2","border-b","border-gray-700","boxPerso"],["class","w-full h-full flex items-center justify-center",4,"ngIf","ngIfElse"],[1,"btn-secondary","mr-2","transition-transform","duration-300","ease-in-out","hover:scale-105",3,"click"],[1,"fas","fa-edit"],[1,"btn-danger","transition-transform","duration-300","ease-in-out","hover:scale-105",3,"click"],[1,"fas","fa-trash-alt",3,"click","id"],[1,"w-full","h-full","flex","items-center","justify-center"],[1,"w-full","rounded-md","text-gray-900","bg-gray-200","border","border-gray-400","focus:outline-none","focus:ring-2","focus:ring-indigo-600",3,"ngModelChange","blur","ngModel"],[3,"cerrar","guardar","editar","campos","despliegue","ambiente"],[1,"hover:bg-gray-700","transition-colors"],[1,"btn-secondary","transition-transform","duration-300","ease-in-out","hover:scale-105","mr-2",3,"click"],[1,"btn-secondary","transition-transform","duration-300","ease-in-out","hover:scale-105",3,"click"],[1,"fas","fa-trash"],[1,"bg-gray-900","rounded-lg","p-4","max-w-sm"],[1,"text-lg","font-bold","text-center","text-white","mb-3"],[1,"text-gray-300","mb-4","text-center","justify-center"],[1,"flex","justify-end"],[3,"value"]],template:function(t,i){t&1&&(n(0,"h1",1),o(1,"WF3 - Actas Digitales"),r(),n(2,"div",2)(3,"button",3),u("click",function(){return i.abrirNuevoDespliegueModal()}),o(4," Nuevo Despliegue "),r(),n(5,"button",4),u("click",function(){return i.abrirModal()}),o(6,"Editar Checklist"),r()(),x(7,le,25,1,"div",5)(8,ce,1,3,"app-nuevo-despliegue",6),n(9,"div",7)(10,"table",8)(11,"thead")(12,"tr",9)(13,"th",10),o(14,"ID"),r(),n(15,"th",10),o(16,"Responsable"),r(),n(17,"th",10),o(18,"Tag"),r(),n(19,"th",10),o(20,"Microservicio"),r(),n(21,"th",10),o(22,"Auditor"),r(),n(23,"th",10),o(24,"Fecha"),r(),n(25,"th",10),o(26,"Acciones"),r()()(),n(27,"tbody"),x(28,me,19,7,"tr",11),r()()(),n(29,"div",12)(30,"div",13)(31,"label",14),o(32,"Items por p\xE1gina:"),r(),n(33,"select",15),V("ngModelChange",function(v){return F(i.itemsPerPage,v)||(i.itemsPerPage=v),v}),u("change",function(){return i.cambiarItemsPorPagina()}),x(34,ue,2,2,"option",16),r()(),n(35,"div",17)(36,"button",18),u("click",function(){return i.paginaAnterior()}),o(37," Anterior "),r(),n(38,"span",19),o(39),r(),n(40,"button",18),u("click",function(){return i.paginaSiguiente()}),o(41," Siguiente "),r()()()),t&2&&(l(7),_("ngIf",i.modalAbierto),l(),_("ngIf",i.modalNuevoDespliegueAbierto),l(20),_("ngForOf",i.pagedDatosGuardados),l(5),A("ngModel",i.itemsPerPage),l(),_("ngForOf",W(13,re)),l(2),P("opacity-50",i.currentPage===1),_("disabled",i.currentPage===1),l(3),G("P\xE1gina ",i.currentPage," de ",i.totalPages,""),l(),P("opacity-50",i.currentPage===i.totalPages),_("disabled",i.currentPage===i.totalPages))},dependencies:[B,O,$,te,Z,ee,Q,Y,U,X,ie],changeDetection:0});let s=m;return s})();export{ve as default};
