import{$ as oh,F as Xo,R as vt,S as rh,V as Wt,W as ih,_ as sh,ba as ah,ca as uh,da as ch,ga as Mr,h as Zl,k as th,l as kr,t as Yo,u as eh,v as nh}from"./chunk-TC6LVV5X.js";import{Ab as Qe,Ja as ot,Jb as Jl,Pa as Nr,Qb as Yl,Sb as Xl,Va as Ht,Vb as Jo,Z as Qi,_ as $e,aa as Qo,ca as wn,cb as Wo,f as Kl,ka as Ho,la as Ft,lb as En,m as $l,r as Ql,ra as Wl,ua as Pr,x as Hl,ya as Rr,za as xr}from"./chunk-NOL2URQB.js";import{a as qt,b as Qt,e as $o,f as D}from"./chunk-XBB5NZD7.js";var lh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},hh={};var Ee,Zo;(function(){var r;function t(w,p){function _(){}_.prototype=p.prototype,w.D=p.prototype,w.prototype=new _,w.prototype.constructor=w,w.C=function(E,I,A){for(var y=Array(arguments.length-2),se=2;se<arguments.length;se++)y[se-2]=arguments[se];return p.prototype[I].apply(E,y)}}function e(){this.blockSize=-1}function n(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}t(n,e),n.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(w,p,_){_||(_=0);var E=Array(16);if(typeof p=="string")for(var I=0;16>I;++I)E[I]=p.charCodeAt(_++)|p.charCodeAt(_++)<<8|p.charCodeAt(_++)<<16|p.charCodeAt(_++)<<24;else for(I=0;16>I;++I)E[I]=p[_++]|p[_++]<<8|p[_++]<<16|p[_++]<<24;p=w.g[0],_=w.g[1],I=w.g[2];var A=w.g[3],y=p+(A^_&(I^A))+E[0]+3614090360&4294967295;p=_+(y<<7&4294967295|y>>>25),y=A+(I^p&(_^I))+E[1]+3905402710&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(_^A&(p^_))+E[2]+606105819&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(p^I&(A^p))+E[3]+3250441966&4294967295,_=I+(y<<22&4294967295|y>>>10),y=p+(A^_&(I^A))+E[4]+4118548399&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(I^p&(_^I))+E[5]+1200080426&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(_^A&(p^_))+E[6]+2821735955&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(p^I&(A^p))+E[7]+4249261313&4294967295,_=I+(y<<22&4294967295|y>>>10),y=p+(A^_&(I^A))+E[8]+1770035416&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(I^p&(_^I))+E[9]+2336552879&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(_^A&(p^_))+E[10]+4294925233&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(p^I&(A^p))+E[11]+2304563134&4294967295,_=I+(y<<22&4294967295|y>>>10),y=p+(A^_&(I^A))+E[12]+1804603682&4294967295,p=_+(y<<7&4294967295|y>>>25),y=A+(I^p&(_^I))+E[13]+4254626195&4294967295,A=p+(y<<12&4294967295|y>>>20),y=I+(_^A&(p^_))+E[14]+2792965006&4294967295,I=A+(y<<17&4294967295|y>>>15),y=_+(p^I&(A^p))+E[15]+1236535329&4294967295,_=I+(y<<22&4294967295|y>>>10),y=p+(I^A&(_^I))+E[1]+4129170786&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(p^_))+E[6]+3225465664&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^_&(A^p))+E[11]+643717713&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(I^A))+E[0]+3921069994&4294967295,_=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(_^I))+E[5]+3593408605&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(p^_))+E[10]+38016083&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^_&(A^p))+E[15]+3634488961&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(I^A))+E[4]+3889429448&4294967295,_=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(_^I))+E[9]+568446438&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(p^_))+E[14]+3275163606&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^_&(A^p))+E[3]+4107603335&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(I^A))+E[8]+1163531501&4294967295,_=I+(y<<20&4294967295|y>>>12),y=p+(I^A&(_^I))+E[13]+2850285829&4294967295,p=_+(y<<5&4294967295|y>>>27),y=A+(_^I&(p^_))+E[2]+4243563512&4294967295,A=p+(y<<9&4294967295|y>>>23),y=I+(p^_&(A^p))+E[7]+1735328473&4294967295,I=A+(y<<14&4294967295|y>>>18),y=_+(A^p&(I^A))+E[12]+2368359562&4294967295,_=I+(y<<20&4294967295|y>>>12),y=p+(_^I^A)+E[5]+4294588738&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^I)+E[8]+2272392833&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^_)+E[11]+1839030562&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^p)+E[14]+4259657740&4294967295,_=I+(y<<23&4294967295|y>>>9),y=p+(_^I^A)+E[1]+2763975236&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^I)+E[4]+1272893353&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^_)+E[7]+4139469664&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^p)+E[10]+3200236656&4294967295,_=I+(y<<23&4294967295|y>>>9),y=p+(_^I^A)+E[13]+681279174&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^I)+E[0]+3936430074&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^_)+E[3]+3572445317&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^p)+E[6]+76029189&4294967295,_=I+(y<<23&4294967295|y>>>9),y=p+(_^I^A)+E[9]+3654602809&4294967295,p=_+(y<<4&4294967295|y>>>28),y=A+(p^_^I)+E[12]+3873151461&4294967295,A=p+(y<<11&4294967295|y>>>21),y=I+(A^p^_)+E[15]+530742520&4294967295,I=A+(y<<16&4294967295|y>>>16),y=_+(I^A^p)+E[2]+3299628645&4294967295,_=I+(y<<23&4294967295|y>>>9),y=p+(I^(_|~A))+E[0]+4096336452&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~I))+E[7]+1126891415&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~_))+E[14]+2878612391&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~p))+E[5]+4237533241&4294967295,_=I+(y<<21&4294967295|y>>>11),y=p+(I^(_|~A))+E[12]+1700485571&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~I))+E[3]+2399980690&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~_))+E[10]+4293915773&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~p))+E[1]+2240044497&4294967295,_=I+(y<<21&4294967295|y>>>11),y=p+(I^(_|~A))+E[8]+1873313359&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~I))+E[15]+4264355552&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~_))+E[6]+2734768916&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~p))+E[13]+1309151649&4294967295,_=I+(y<<21&4294967295|y>>>11),y=p+(I^(_|~A))+E[4]+4149444226&4294967295,p=_+(y<<6&4294967295|y>>>26),y=A+(_^(p|~I))+E[11]+3174756917&4294967295,A=p+(y<<10&4294967295|y>>>22),y=I+(p^(A|~_))+E[2]+718787259&4294967295,I=A+(y<<15&4294967295|y>>>17),y=_+(A^(I|~p))+E[9]+3951481745&4294967295,w.g[0]=w.g[0]+p&4294967295,w.g[1]=w.g[1]+(I+(y<<21&4294967295|y>>>11))&4294967295,w.g[2]=w.g[2]+I&4294967295,w.g[3]=w.g[3]+A&4294967295}n.prototype.u=function(w,p){p===void 0&&(p=w.length);for(var _=p-this.blockSize,E=this.B,I=this.h,A=0;A<p;){if(I==0)for(;A<=_;)i(this,w,A),A+=this.blockSize;if(typeof w=="string"){for(;A<p;)if(E[I++]=w.charCodeAt(A++),I==this.blockSize){i(this,E),I=0;break}}else for(;A<p;)if(E[I++]=w[A++],I==this.blockSize){i(this,E),I=0;break}}this.h=I,this.o+=p},n.prototype.v=function(){var w=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);w[0]=128;for(var p=1;p<w.length-8;++p)w[p]=0;var _=8*this.o;for(p=w.length-8;p<w.length;++p)w[p]=_&255,_/=256;for(this.u(w),w=Array(16),p=_=0;4>p;++p)for(var E=0;32>E;E+=8)w[_++]=this.g[p]>>>E&255;return w};function s(w,p){var _=u;return Object.prototype.hasOwnProperty.call(_,w)?_[w]:_[w]=p(w)}function a(w,p){this.h=p;for(var _=[],E=!0,I=w.length-1;0<=I;I--){var A=w[I]|0;E&&A==p||(_[I]=A,E=!1)}this.g=_}var u={};function l(w){return-128<=w&&128>w?s(w,function(p){return new a([p|0],0>p?-1:0)}):new a([w|0],0>w?-1:0)}function d(w){if(isNaN(w)||!isFinite(w))return g;if(0>w)return x(d(-w));for(var p=[],_=1,E=0;w>=_;E++)p[E]=w/_|0,_*=4294967296;return new a(p,0)}function f(w,p){if(w.length==0)throw Error("number format error: empty string");if(p=p||10,2>p||36<p)throw Error("radix out of range: "+p);if(w.charAt(0)=="-")return x(f(w.substring(1),p));if(0<=w.indexOf("-"))throw Error('number format error: interior "-" character');for(var _=d(Math.pow(p,8)),E=g,I=0;I<w.length;I+=8){var A=Math.min(8,w.length-I),y=parseInt(w.substring(I,I+A),p);8>A?(A=d(Math.pow(p,A)),E=E.j(A).add(d(y))):(E=E.j(_),E=E.add(d(y)))}return E}var g=l(0),v=l(1),C=l(16777216);r=a.prototype,r.m=function(){if(k(this))return-x(this).m();for(var w=0,p=1,_=0;_<this.g.length;_++){var E=this.i(_);w+=(0<=E?E:4294967296+E)*p,p*=4294967296}return w},r.toString=function(w){if(w=w||10,2>w||36<w)throw Error("radix out of range: "+w);if(N(this))return"0";if(k(this))return"-"+x(this).toString(w);for(var p=d(Math.pow(w,6)),_=this,E="";;){var I=H(_,p).g;_=G(_,I.j(p));var A=((0<_.g.length?_.g[0]:_.h)>>>0).toString(w);if(_=I,N(_))return A+E;for(;6>A.length;)A="0"+A;E=A+E}},r.i=function(w){return 0>w?0:w<this.g.length?this.g[w]:this.h};function N(w){if(w.h!=0)return!1;for(var p=0;p<w.g.length;p++)if(w.g[p]!=0)return!1;return!0}function k(w){return w.h==-1}r.l=function(w){return w=G(this,w),k(w)?-1:N(w)?0:1};function x(w){for(var p=w.g.length,_=[],E=0;E<p;E++)_[E]=~w.g[E];return new a(_,~w.h).add(v)}r.abs=function(){return k(this)?x(this):this},r.add=function(w){for(var p=Math.max(this.g.length,w.g.length),_=[],E=0,I=0;I<=p;I++){var A=E+(this.i(I)&65535)+(w.i(I)&65535),y=(A>>>16)+(this.i(I)>>>16)+(w.i(I)>>>16);E=y>>>16,A&=65535,y&=65535,_[I]=y<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function G(w,p){return w.add(x(p))}r.j=function(w){if(N(this)||N(w))return g;if(k(this))return k(w)?x(this).j(x(w)):x(x(this).j(w));if(k(w))return x(this.j(x(w)));if(0>this.l(C)&&0>w.l(C))return d(this.m()*w.m());for(var p=this.g.length+w.g.length,_=[],E=0;E<2*p;E++)_[E]=0;for(E=0;E<this.g.length;E++)for(var I=0;I<w.g.length;I++){var A=this.i(E)>>>16,y=this.i(E)&65535,se=w.i(I)>>>16,hr=w.i(I)&65535;_[2*E+2*I]+=y*hr,j(_,2*E+2*I),_[2*E+2*I+1]+=A*hr,j(_,2*E+2*I+1),_[2*E+2*I+1]+=y*se,j(_,2*E+2*I+1),_[2*E+2*I+2]+=A*se,j(_,2*E+2*I+2)}for(E=0;E<p;E++)_[E]=_[2*E+1]<<16|_[2*E];for(E=p;E<2*p;E++)_[E]=0;return new a(_,0)};function j(w,p){for(;(w[p]&65535)!=w[p];)w[p+1]+=w[p]>>>16,w[p]&=65535,p++}function q(w,p){this.g=w,this.h=p}function H(w,p){if(N(p))throw Error("division by zero");if(N(w))return new q(g,g);if(k(w))return p=H(x(w),p),new q(x(p.g),x(p.h));if(k(p))return p=H(w,x(p)),new q(x(p.g),p.h);if(30<w.g.length){if(k(w)||k(p))throw Error("slowDivide_ only works with positive integers.");for(var _=v,E=p;0>=E.l(w);)_=Z(_),E=Z(E);var I=$(_,1),A=$(E,1);for(E=$(E,2),_=$(_,2);!N(E);){var y=A.add(E);0>=y.l(w)&&(I=I.add(_),A=y),E=$(E,1),_=$(_,1)}return p=G(w,I.j(p)),new q(I,p)}for(I=g;0<=w.l(p);){for(_=Math.max(1,Math.floor(w.m()/p.m())),E=Math.ceil(Math.log(_)/Math.LN2),E=48>=E?1:Math.pow(2,E-48),A=d(_),y=A.j(p);k(y)||0<y.l(w);)_-=E,A=d(_),y=A.j(p);N(A)&&(A=v),I=I.add(A),w=G(w,y)}return new q(I,w)}r.A=function(w){return H(this,w).h},r.and=function(w){for(var p=Math.max(this.g.length,w.g.length),_=[],E=0;E<p;E++)_[E]=this.i(E)&w.i(E);return new a(_,this.h&w.h)},r.or=function(w){for(var p=Math.max(this.g.length,w.g.length),_=[],E=0;E<p;E++)_[E]=this.i(E)|w.i(E);return new a(_,this.h|w.h)},r.xor=function(w){for(var p=Math.max(this.g.length,w.g.length),_=[],E=0;E<p;E++)_[E]=this.i(E)^w.i(E);return new a(_,this.h^w.h)};function Z(w){for(var p=w.g.length+1,_=[],E=0;E<p;E++)_[E]=w.i(E)<<1|w.i(E-1)>>>31;return new a(_,w.h)}function $(w,p){var _=p>>5;p%=32;for(var E=w.g.length-_,I=[],A=0;A<E;A++)I[A]=0<p?w.i(A+_)>>>p|w.i(A+_+1)<<32-p:w.i(A+_);return new a(I,w.h)}n.prototype.digest=n.prototype.v,n.prototype.reset=n.prototype.s,n.prototype.update=n.prototype.u,Zo=hh.Md5=n,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=f,Ee=hh.Integer=a}).apply(typeof lh<"u"?lh:typeof self<"u"?self:typeof window<"u"?window:{});var Hi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ue={};var ta,ea,In,na,Fr,Wi,ra,ia,sa;(function(){var r,t=typeof Object.defineProperties=="function"?Object.defineProperty:function(o,c,h){return o==Array.prototype||o==Object.prototype||(o[c]=h.value),o};function e(o){o=[typeof globalThis=="object"&&globalThis,o,typeof window=="object"&&window,typeof self=="object"&&self,typeof Hi=="object"&&Hi];for(var c=0;c<o.length;++c){var h=o[c];if(h&&h.Math==Math)return h}throw Error("Cannot find global object")}var n=e(this);function i(o,c){if(c)t:{var h=n;o=o.split(".");for(var m=0;m<o.length-1;m++){var T=o[m];if(!(T in h))break t;h=h[T]}o=o[o.length-1],m=h[o],c=c(m),c!=m&&c!=null&&t(h,o,{configurable:!0,writable:!0,value:c})}}function s(o,c){o instanceof String&&(o+="");var h=0,m=!1,T={next:function(){if(!m&&h<o.length){var V=h++;return{value:c(V,o[V]),done:!1}}return m=!0,{done:!0,value:void 0}}};return T[Symbol.iterator]=function(){return T},T}i("Array.prototype.values",function(o){return o||function(){return s(this,function(c,h){return h})}});var a=a||{},u=this||self;function l(o){var c=typeof o;return c=c!="object"?c:o?Array.isArray(o)?"array":c:"null",c=="array"||c=="object"&&typeof o.length=="number"}function d(o){var c=typeof o;return c=="object"&&o!=null||c=="function"}function f(o,c,h){return o.call.apply(o.bind,arguments)}function g(o,c,h){if(!o)throw Error();if(2<arguments.length){var m=Array.prototype.slice.call(arguments,2);return function(){var T=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(T,m),o.apply(c,T)}}return function(){return o.apply(c,arguments)}}function v(o,c,h){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?f:g,v.apply(null,arguments)}function C(o,c){var h=Array.prototype.slice.call(arguments,1);return function(){var m=h.slice();return m.push.apply(m,arguments),o.apply(this,m)}}function N(o,c){function h(){}h.prototype=c.prototype,o.aa=c.prototype,o.prototype=new h,o.prototype.constructor=o,o.Qb=function(m,T,V){for(var M=Array(arguments.length-2),et=2;et<arguments.length;et++)M[et-2]=arguments[et];return c.prototype[T].apply(m,M)}}function k(o){let c=o.length;if(0<c){let h=Array(c);for(let m=0;m<c;m++)h[m]=o[m];return h}return[]}function x(o,c){for(let h=1;h<arguments.length;h++){let m=arguments[h];if(l(m)){let T=o.length||0,V=m.length||0;o.length=T+V;for(let M=0;M<V;M++)o[T+M]=m[M]}else o.push(m)}}class G{constructor(c,h){this.i=c,this.j=h,this.h=0,this.g=null}get(){let c;return 0<this.h?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function j(o){return/^[\s\xa0]*$/.test(o)}function q(){var o=u.navigator;return o&&(o=o.userAgent)?o:""}function H(o){return H[" "](o),o}H[" "]=function(){};var Z=q().indexOf("Gecko")!=-1&&!(q().toLowerCase().indexOf("webkit")!=-1&&q().indexOf("Edge")==-1)&&!(q().indexOf("Trident")!=-1||q().indexOf("MSIE")!=-1)&&q().indexOf("Edge")==-1;function $(o,c,h){for(let m in o)c.call(h,o[m],m,o)}function w(o,c){for(let h in o)c.call(void 0,o[h],h,o)}function p(o){let c={};for(let h in o)c[h]=o[h];return c}let _="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(o,c){let h,m;for(let T=1;T<arguments.length;T++){m=arguments[T];for(h in m)o[h]=m[h];for(let V=0;V<_.length;V++)h=_[V],Object.prototype.hasOwnProperty.call(m,h)&&(o[h]=m[h])}}function I(o){var c=1;o=o.split(":");let h=[];for(;0<c&&o.length;)h.push(o.shift()),c--;return o.length&&h.push(o.join(":")),h}function A(o){u.setTimeout(()=>{throw o},0)}function y(){var o=Eo;let c=null;return o.g&&(c=o.g,o.g=o.g.next,o.g||(o.h=null),c.next=null),c}class se{constructor(){this.h=this.g=null}add(c,h){let m=hr.get();m.set(c,h),this.h?this.h.next=m:this.g=m,this.h=m}}var hr=new G(()=>new Vm,o=>o.reset());class Vm{constructor(){this.next=this.g=this.h=null}set(c,h){this.h=c,this.g=h,this.next=null}reset(){this.next=this.g=this.h=null}}let dr,fr=!1,Eo=new se,zc=()=>{let o=u.Promise.resolve(void 0);dr=()=>{o.then(Sm)}};var Sm=()=>{for(var o;o=y();){try{o.h.call(o.g)}catch(h){A(h)}var c=hr;c.j(o),100>c.h&&(c.h++,o.next=c.g,c.g=o)}fr=!1};function ye(){this.s=this.s,this.C=this.C}ye.prototype.s=!1,ye.prototype.ma=function(){this.s||(this.s=!0,this.N())},ye.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ct(o,c){this.type=o,this.g=this.target=c,this.defaultPrevented=!1}Ct.prototype.h=function(){this.defaultPrevented=!0};var Dm=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var o=!1,c=Object.defineProperty({},"passive",{get:function(){o=!0}});try{let h=()=>{};u.addEventListener("test",h,c),u.removeEventListener("test",h,c)}catch{}return o}();function mr(o,c){if(Ct.call(this,o?o.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,o){var h=this.type=o.type,m=o.changedTouches&&o.changedTouches.length?o.changedTouches[0]:null;if(this.target=o.target||o.srcElement,this.g=c,c=o.relatedTarget){if(Z){t:{try{H(c.nodeName);var T=!0;break t}catch{}T=!1}T||(c=null)}}else h=="mouseover"?c=o.fromElement:h=="mouseout"&&(c=o.toElement);this.relatedTarget=c,m?(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0):(this.clientX=o.clientX!==void 0?o.clientX:o.pageX,this.clientY=o.clientY!==void 0?o.clientY:o.pageY,this.screenX=o.screenX||0,this.screenY=o.screenY||0),this.button=o.button,this.key=o.key||"",this.ctrlKey=o.ctrlKey,this.altKey=o.altKey,this.shiftKey=o.shiftKey,this.metaKey=o.metaKey,this.pointerId=o.pointerId||0,this.pointerType=typeof o.pointerType=="string"?o.pointerType:Pm[o.pointerType]||"",this.state=o.state,this.i=o,o.defaultPrevented&&mr.aa.h.call(this)}}N(mr,Ct);var Pm={2:"touch",3:"pen",4:"mouse"};mr.prototype.h=function(){mr.aa.h.call(this);var o=this.i;o.preventDefault?o.preventDefault():o.returnValue=!1};var gr="closure_listenable_"+(1e6*Math.random()|0),Rm=0;function xm(o,c,h,m,T){this.listener=o,this.proxy=null,this.src=c,this.type=h,this.capture=!!m,this.ha=T,this.key=++Rm,this.da=this.fa=!1}function Pi(o){o.da=!0,o.listener=null,o.proxy=null,o.src=null,o.ha=null}function Ri(o){this.src=o,this.g={},this.h=0}Ri.prototype.add=function(o,c,h,m,T){var V=o.toString();o=this.g[V],o||(o=this.g[V]=[],this.h++);var M=To(o,c,m,T);return-1<M?(c=o[M],h||(c.fa=!1)):(c=new xm(c,this.src,V,!!m,T),c.fa=h,o.push(c)),c};function Io(o,c){var h=c.type;if(h in o.g){var m=o.g[h],T=Array.prototype.indexOf.call(m,c,void 0),V;(V=0<=T)&&Array.prototype.splice.call(m,T,1),V&&(Pi(c),o.g[h].length==0&&(delete o.g[h],o.h--))}}function To(o,c,h,m){for(var T=0;T<o.length;++T){var V=o[T];if(!V.da&&V.listener==c&&V.capture==!!h&&V.ha==m)return T}return-1}var Ao="closure_lm_"+(1e6*Math.random()|0),bo={};function Kc(o,c,h,m,T){if(m&&m.once)return Qc(o,c,h,m,T);if(Array.isArray(c)){for(var V=0;V<c.length;V++)Kc(o,c[V],h,m,T);return null}return h=Do(h),o&&o[gr]?o.K(c,h,d(m)?!!m.capture:!!m,T):$c(o,c,h,!1,m,T)}function $c(o,c,h,m,T,V){if(!c)throw Error("Invalid event type");var M=d(T)?!!T.capture:!!T,et=Vo(o);if(et||(o[Ao]=et=new Ri(o)),h=et.add(c,h,m,M,V),h.proxy)return h;if(m=Nm(),h.proxy=m,m.src=o,m.listener=h,o.addEventListener)Dm||(T=M),T===void 0&&(T=!1),o.addEventListener(c.toString(),m,T);else if(o.attachEvent)o.attachEvent(Wc(c.toString()),m);else if(o.addListener&&o.removeListener)o.addListener(m);else throw Error("addEventListener and attachEvent are unavailable.");return h}function Nm(){function o(h){return c.call(o.src,o.listener,h)}let c=km;return o}function Qc(o,c,h,m,T){if(Array.isArray(c)){for(var V=0;V<c.length;V++)Qc(o,c[V],h,m,T);return null}return h=Do(h),o&&o[gr]?o.L(c,h,d(m)?!!m.capture:!!m,T):$c(o,c,h,!0,m,T)}function Hc(o,c,h,m,T){if(Array.isArray(c))for(var V=0;V<c.length;V++)Hc(o,c[V],h,m,T);else m=d(m)?!!m.capture:!!m,h=Do(h),o&&o[gr]?(o=o.i,c=String(c).toString(),c in o.g&&(V=o.g[c],h=To(V,h,m,T),-1<h&&(Pi(V[h]),Array.prototype.splice.call(V,h,1),V.length==0&&(delete o.g[c],o.h--)))):o&&(o=Vo(o))&&(c=o.g[c.toString()],o=-1,c&&(o=To(c,h,m,T)),(h=-1<o?c[o]:null)&&Co(h))}function Co(o){if(typeof o!="number"&&o&&!o.da){var c=o.src;if(c&&c[gr])Io(c.i,o);else{var h=o.type,m=o.proxy;c.removeEventListener?c.removeEventListener(h,m,o.capture):c.detachEvent?c.detachEvent(Wc(h),m):c.addListener&&c.removeListener&&c.removeListener(m),(h=Vo(c))?(Io(h,o),h.h==0&&(h.src=null,c[Ao]=null)):Pi(o)}}}function Wc(o){return o in bo?bo[o]:bo[o]="on"+o}function km(o,c){if(o.da)o=!0;else{c=new mr(c,this);var h=o.listener,m=o.ha||o.src;o.fa&&Co(o),o=h.call(m,c)}return o}function Vo(o){return o=o[Ao],o instanceof Ri?o:null}var So="__closure_events_fn_"+(1e9*Math.random()>>>0);function Do(o){return typeof o=="function"?o:(o[So]||(o[So]=function(c){return o.handleEvent(c)}),o[So])}function Vt(){ye.call(this),this.i=new Ri(this),this.M=this,this.F=null}N(Vt,ye),Vt.prototype[gr]=!0,Vt.prototype.removeEventListener=function(o,c,h,m){Hc(this,o,c,h,m)};function xt(o,c){var h,m=o.F;if(m)for(h=[];m;m=m.F)h.push(m);if(o=o.M,m=c.type||c,typeof c=="string")c=new Ct(c,o);else if(c instanceof Ct)c.target=c.target||o;else{var T=c;c=new Ct(m,o),E(c,T)}if(T=!0,h)for(var V=h.length-1;0<=V;V--){var M=c.g=h[V];T=xi(M,m,!0,c)&&T}if(M=c.g=o,T=xi(M,m,!0,c)&&T,T=xi(M,m,!1,c)&&T,h)for(V=0;V<h.length;V++)M=c.g=h[V],T=xi(M,m,!1,c)&&T}Vt.prototype.N=function(){if(Vt.aa.N.call(this),this.i){var o=this.i,c;for(c in o.g){for(var h=o.g[c],m=0;m<h.length;m++)Pi(h[m]);delete o.g[c],o.h--}}this.F=null},Vt.prototype.K=function(o,c,h,m){return this.i.add(String(o),c,!1,h,m)},Vt.prototype.L=function(o,c,h,m){return this.i.add(String(o),c,!0,h,m)};function xi(o,c,h,m){if(c=o.i.g[String(c)],!c)return!0;c=c.concat();for(var T=!0,V=0;V<c.length;++V){var M=c[V];if(M&&!M.da&&M.capture==h){var et=M.listener,Tt=M.ha||M.src;M.fa&&Io(o.i,M),T=et.call(Tt,m)!==!1&&T}}return T&&!m.defaultPrevented}function Jc(o,c,h){if(typeof o=="function")h&&(o=v(o,h));else if(o&&typeof o.handleEvent=="function")o=v(o.handleEvent,o);else throw Error("Invalid listener argument");return 2147483647<Number(c)?-1:u.setTimeout(o,c||0)}function Yc(o){o.g=Jc(()=>{o.g=null,o.i&&(o.i=!1,Yc(o))},o.l);let c=o.h;o.h=null,o.m.apply(null,c)}class Mm extends ye{constructor(c,h){super(),this.m=c,this.l=h,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Yc(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function pr(o){ye.call(this),this.h=o,this.g={}}N(pr,ye);var Xc=[];function Zc(o){$(o.g,function(c,h){this.g.hasOwnProperty(h)&&Co(c)},o),o.g={}}pr.prototype.N=function(){pr.aa.N.call(this),Zc(this)},pr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Po=u.JSON.stringify,Fm=u.JSON.parse,Om=class{stringify(o){return u.JSON.stringify(o,void 0)}parse(o){return u.JSON.parse(o,void 0)}};function Ro(){}Ro.prototype.h=null;function tl(o){return o.h||(o.h=o.i())}function el(){}var yr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function xo(){Ct.call(this,"d")}N(xo,Ct);function No(){Ct.call(this,"c")}N(No,Ct);var Ge={},nl=null;function Ni(){return nl=nl||new Vt}Ge.La="serverreachability";function rl(o){Ct.call(this,Ge.La,o)}N(rl,Ct);function _r(o){let c=Ni();xt(c,new rl(c))}Ge.STAT_EVENT="statevent";function il(o,c){Ct.call(this,Ge.STAT_EVENT,o),this.stat=c}N(il,Ct);function Nt(o){let c=Ni();xt(c,new il(c,o))}Ge.Ma="timingevent";function sl(o,c){Ct.call(this,Ge.Ma,o),this.size=c}N(sl,Ct);function vr(o,c){if(typeof o!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){o()},c)}function wr(){this.g=!0}wr.prototype.xa=function(){this.g=!1};function Lm(o,c,h,m,T,V){o.info(function(){if(o.g)if(V)for(var M="",et=V.split("&"),Tt=0;Tt<et.length;Tt++){var Y=et[Tt].split("=");if(1<Y.length){var St=Y[0];Y=Y[1];var Dt=St.split("_");M=2<=Dt.length&&Dt[1]=="type"?M+(St+"="+Y+"&"):M+(St+"=redacted&")}}else M=null;else M=V;return"XMLHTTP REQ ("+m+") [attempt "+T+"]: "+c+`
`+h+`
`+M})}function Um(o,c,h,m,T,V,M){o.info(function(){return"XMLHTTP RESP ("+m+") [ attempt "+T+"]: "+c+`
`+h+`
`+V+" "+M})}function pn(o,c,h,m){o.info(function(){return"XMLHTTP TEXT ("+c+"): "+qm(o,h)+(m?" "+m:"")})}function Bm(o,c){o.info(function(){return"TIMEOUT: "+c})}wr.prototype.info=function(){};function qm(o,c){if(!o.g)return c;if(!c)return null;try{var h=JSON.parse(c);if(h){for(o=0;o<h.length;o++)if(Array.isArray(h[o])){var m=h[o];if(!(2>m.length)){var T=m[1];if(Array.isArray(T)&&!(1>T.length)){var V=T[0];if(V!="noop"&&V!="stop"&&V!="close")for(var M=1;M<T.length;M++)T[M]=""}}}}return Po(h)}catch{return c}}var ki={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},ol={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},ko;function Mi(){}N(Mi,Ro),Mi.prototype.g=function(){return new XMLHttpRequest},Mi.prototype.i=function(){return{}},ko=new Mi;function _e(o,c,h,m){this.j=o,this.i=c,this.l=h,this.R=m||1,this.U=new pr(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new al}function al(){this.i=null,this.g="",this.h=!1}var ul={},Mo={};function Fo(o,c,h){o.L=1,o.v=Ui(oe(c)),o.m=h,o.P=!0,cl(o,null)}function cl(o,c){o.F=Date.now(),Fi(o),o.A=oe(o.v);var h=o.A,m=o.R;Array.isArray(m)||(m=[String(m)]),Tl(h.i,"t",m),o.C=0,h=o.j.J,o.h=new al,o.g=ql(o.j,h?c:null,!o.m),0<o.O&&(o.M=new Mm(v(o.Y,o,o.g),o.O)),c=o.U,h=o.g,m=o.ca;var T="readystatechange";Array.isArray(T)||(T&&(Xc[0]=T.toString()),T=Xc);for(var V=0;V<T.length;V++){var M=Kc(h,T[V],m||c.handleEvent,!1,c.h||c);if(!M)break;c.g[M.key]=M}c=o.H?p(o.H):{},o.m?(o.u||(o.u="POST"),c["Content-Type"]="application/x-www-form-urlencoded",o.g.ea(o.A,o.u,o.m,c)):(o.u="GET",o.g.ea(o.A,o.u,null,c)),_r(),Lm(o.i,o.u,o.A,o.l,o.R,o.m)}_e.prototype.ca=function(o){o=o.target;let c=this.M;c&&ae(o)==3?c.j():this.Y(o)},_e.prototype.Y=function(o){try{if(o==this.g)t:{let Dt=ae(this.g);var c=this.g.Ba();let vn=this.g.Z();if(!(3>Dt)&&(Dt!=3||this.g&&(this.h.h||this.g.oa()||Pl(this.g)))){this.J||Dt!=4||c==7||(c==8||0>=vn?_r(3):_r(2)),Oo(this);var h=this.g.Z();this.X=h;e:if(ll(this)){var m=Pl(this.g);o="";var T=m.length,V=ae(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){je(this),Er(this);var M="";break e}this.h.i=new u.TextDecoder}for(c=0;c<T;c++)this.h.h=!0,o+=this.h.i.decode(m[c],{stream:!(V&&c==T-1)});m.length=0,this.h.g+=o,this.C=0,M=this.h.g}else M=this.g.oa();if(this.o=h==200,Um(this.i,this.u,this.A,this.l,this.R,Dt,h),this.o){if(this.T&&!this.K){e:{if(this.g){var et,Tt=this.g;if((et=Tt.g?Tt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!j(et)){var Y=et;break e}}Y=null}if(h=Y)pn(this.i,this.l,h,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Lo(this,h);else{this.o=!1,this.s=3,Nt(12),je(this),Er(this);break t}}if(this.P){h=!0;let zt;for(;!this.J&&this.C<M.length;)if(zt=Gm(this,M),zt==Mo){Dt==4&&(this.s=4,Nt(14),h=!1),pn(this.i,this.l,null,"[Incomplete Response]");break}else if(zt==ul){this.s=4,Nt(15),pn(this.i,this.l,M,"[Invalid Chunk]"),h=!1;break}else pn(this.i,this.l,zt,null),Lo(this,zt);if(ll(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Dt!=4||M.length!=0||this.h.h||(this.s=1,Nt(16),h=!1),this.o=this.o&&h,!h)pn(this.i,this.l,M,"[Invalid Chunked Response]"),je(this),Er(this);else if(0<M.length&&!this.W){this.W=!0;var St=this.j;St.g==this&&St.ba&&!St.M&&(St.j.info("Great, no buffering proxy detected. Bytes received: "+M.length),zo(St),St.M=!0,Nt(11))}}else pn(this.i,this.l,M,null),Lo(this,M);Dt==4&&je(this),this.o&&!this.J&&(Dt==4?Ol(this.j,this):(this.o=!1,Fi(this)))}else sg(this.g),h==400&&0<M.indexOf("Unknown SID")?(this.s=3,Nt(12)):(this.s=0,Nt(13)),je(this),Er(this)}}}catch{}finally{}};function ll(o){return o.g?o.u=="GET"&&o.L!=2&&o.j.Ca:!1}function Gm(o,c){var h=o.C,m=c.indexOf(`
`,h);return m==-1?Mo:(h=Number(c.substring(h,m)),isNaN(h)?ul:(m+=1,m+h>c.length?Mo:(c=c.slice(m,m+h),o.C=m+h,c)))}_e.prototype.cancel=function(){this.J=!0,je(this)};function Fi(o){o.S=Date.now()+o.I,hl(o,o.I)}function hl(o,c){if(o.B!=null)throw Error("WatchDog timer not null");o.B=vr(v(o.ba,o),c)}function Oo(o){o.B&&(u.clearTimeout(o.B),o.B=null)}_e.prototype.ba=function(){this.B=null;let o=Date.now();0<=o-this.S?(Bm(this.i,this.A),this.L!=2&&(_r(),Nt(17)),je(this),this.s=2,Er(this)):hl(this,this.S-o)};function Er(o){o.j.G==0||o.J||Ol(o.j,o)}function je(o){Oo(o);var c=o.M;c&&typeof c.ma=="function"&&c.ma(),o.M=null,Zc(o.U),o.g&&(c=o.g,o.g=null,c.abort(),c.ma())}function Lo(o,c){try{var h=o.j;if(h.G!=0&&(h.g==o||Uo(h.h,o))){if(!o.K&&Uo(h.h,o)&&h.G==3){try{var m=h.Da.g.parse(c)}catch{m=null}if(Array.isArray(m)&&m.length==3){var T=m;if(T[0]==0){t:if(!h.u){if(h.g)if(h.g.F+3e3<o.F)zi(h),Gi(h);else break t;jo(h),Nt(18)}}else h.za=T[1],0<h.za-h.T&&37500>T[2]&&h.F&&h.v==0&&!h.C&&(h.C=vr(v(h.Za,h),6e3));if(1>=ml(h.h)&&h.ca){try{h.ca()}catch{}h.ca=void 0}}else Ke(h,11)}else if((o.K||h.g==o)&&zi(h),!j(c))for(T=h.Da.g.parse(c),c=0;c<T.length;c++){let Y=T[c];if(h.T=Y[0],Y=Y[1],h.G==2)if(Y[0]=="c"){h.K=Y[1],h.ia=Y[2];let St=Y[3];St!=null&&(h.la=St,h.j.info("VER="+h.la));let Dt=Y[4];Dt!=null&&(h.Aa=Dt,h.j.info("SVER="+h.Aa));let vn=Y[5];vn!=null&&typeof vn=="number"&&0<vn&&(m=1.5*vn,h.L=m,h.j.info("backChannelRequestTimeoutMs_="+m)),m=h;let zt=o.g;if(zt){let $i=zt.g?zt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if($i){var V=m.h;V.g||$i.indexOf("spdy")==-1&&$i.indexOf("quic")==-1&&$i.indexOf("h2")==-1||(V.j=V.l,V.g=new Set,V.h&&(Bo(V,V.h),V.h=null))}if(m.D){let Ko=zt.g?zt.g.getResponseHeader("X-HTTP-Session-Id"):null;Ko&&(m.ya=Ko,rt(m.I,m.D,Ko))}}h.G=3,h.l&&h.l.ua(),h.ba&&(h.R=Date.now()-o.F,h.j.info("Handshake RTT: "+h.R+"ms")),m=h;var M=o;if(m.qa=Bl(m,m.J?m.ia:null,m.W),M.K){gl(m.h,M);var et=M,Tt=m.L;Tt&&(et.I=Tt),et.B&&(Oo(et),Fi(et)),m.g=M}else Ml(m);0<h.i.length&&ji(h)}else Y[0]!="stop"&&Y[0]!="close"||Ke(h,7);else h.G==3&&(Y[0]=="stop"||Y[0]=="close"?Y[0]=="stop"?Ke(h,7):Go(h):Y[0]!="noop"&&h.l&&h.l.ta(Y),h.v=0)}}_r(4)}catch{}}var jm=class{constructor(o,c){this.g=o,this.map=c}};function dl(o){this.l=o||10,u.PerformanceNavigationTiming?(o=u.performance.getEntriesByType("navigation"),o=0<o.length&&(o[0].nextHopProtocol=="hq"||o[0].nextHopProtocol=="h2")):o=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=o?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function fl(o){return o.h?!0:o.g?o.g.size>=o.j:!1}function ml(o){return o.h?1:o.g?o.g.size:0}function Uo(o,c){return o.h?o.h==c:o.g?o.g.has(c):!1}function Bo(o,c){o.g?o.g.add(c):o.h=c}function gl(o,c){o.h&&o.h==c?o.h=null:o.g&&o.g.has(c)&&o.g.delete(c)}dl.prototype.cancel=function(){if(this.i=pl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let o of this.g.values())o.cancel();this.g.clear()}};function pl(o){if(o.h!=null)return o.i.concat(o.h.D);if(o.g!=null&&o.g.size!==0){let c=o.i;for(let h of o.g.values())c=c.concat(h.D);return c}return k(o.i)}function zm(o){if(o.V&&typeof o.V=="function")return o.V();if(typeof Map<"u"&&o instanceof Map||typeof Set<"u"&&o instanceof Set)return Array.from(o.values());if(typeof o=="string")return o.split("");if(l(o)){for(var c=[],h=o.length,m=0;m<h;m++)c.push(o[m]);return c}c=[],h=0;for(m in o)c[h++]=o[m];return c}function Km(o){if(o.na&&typeof o.na=="function")return o.na();if(!o.V||typeof o.V!="function"){if(typeof Map<"u"&&o instanceof Map)return Array.from(o.keys());if(!(typeof Set<"u"&&o instanceof Set)){if(l(o)||typeof o=="string"){var c=[];o=o.length;for(var h=0;h<o;h++)c.push(h);return c}c=[],h=0;for(let m in o)c[h++]=m;return c}}}function yl(o,c){if(o.forEach&&typeof o.forEach=="function")o.forEach(c,void 0);else if(l(o)||typeof o=="string")Array.prototype.forEach.call(o,c,void 0);else for(var h=Km(o),m=zm(o),T=m.length,V=0;V<T;V++)c.call(void 0,m[V],h&&h[V],o)}var _l=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $m(o,c){if(o){o=o.split("&");for(var h=0;h<o.length;h++){var m=o[h].indexOf("="),T=null;if(0<=m){var V=o[h].substring(0,m);T=o[h].substring(m+1)}else V=o[h];c(V,T?decodeURIComponent(T.replace(/\+/g," ")):"")}}}function ze(o){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,o instanceof ze){this.h=o.h,Oi(this,o.j),this.o=o.o,this.g=o.g,Li(this,o.s),this.l=o.l;var c=o.i,h=new Ar;h.i=c.i,c.g&&(h.g=new Map(c.g),h.h=c.h),vl(this,h),this.m=o.m}else o&&(c=String(o).match(_l))?(this.h=!1,Oi(this,c[1]||"",!0),this.o=Ir(c[2]||""),this.g=Ir(c[3]||"",!0),Li(this,c[4]),this.l=Ir(c[5]||"",!0),vl(this,c[6]||"",!0),this.m=Ir(c[7]||"")):(this.h=!1,this.i=new Ar(null,this.h))}ze.prototype.toString=function(){var o=[],c=this.j;c&&o.push(Tr(c,wl,!0),":");var h=this.g;return(h||c=="file")&&(o.push("//"),(c=this.o)&&o.push(Tr(c,wl,!0),"@"),o.push(encodeURIComponent(String(h)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h=this.s,h!=null&&o.push(":",String(h))),(h=this.l)&&(this.g&&h.charAt(0)!="/"&&o.push("/"),o.push(Tr(h,h.charAt(0)=="/"?Wm:Hm,!0))),(h=this.i.toString())&&o.push("?",h),(h=this.m)&&o.push("#",Tr(h,Ym)),o.join("")};function oe(o){return new ze(o)}function Oi(o,c,h){o.j=h?Ir(c,!0):c,o.j&&(o.j=o.j.replace(/:$/,""))}function Li(o,c){if(c){if(c=Number(c),isNaN(c)||0>c)throw Error("Bad port number "+c);o.s=c}else o.s=null}function vl(o,c,h){c instanceof Ar?(o.i=c,Xm(o.i,o.h)):(h||(c=Tr(c,Jm)),o.i=new Ar(c,o.h))}function rt(o,c,h){o.i.set(c,h)}function Ui(o){return rt(o,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),o}function Ir(o,c){return o?c?decodeURI(o.replace(/%25/g,"%2525")):decodeURIComponent(o):""}function Tr(o,c,h){return typeof o=="string"?(o=encodeURI(o).replace(c,Qm),h&&(o=o.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),o):null}function Qm(o){return o=o.charCodeAt(0),"%"+(o>>4&15).toString(16)+(o&15).toString(16)}var wl=/[#\/\?@]/g,Hm=/[#\?:]/g,Wm=/[#\?]/g,Jm=/[#\?@]/g,Ym=/#/g;function Ar(o,c){this.h=this.g=null,this.i=o||null,this.j=!!c}function ve(o){o.g||(o.g=new Map,o.h=0,o.i&&$m(o.i,function(c,h){o.add(decodeURIComponent(c.replace(/\+/g," ")),h)}))}r=Ar.prototype,r.add=function(o,c){ve(this),this.i=null,o=yn(this,o);var h=this.g.get(o);return h||this.g.set(o,h=[]),h.push(c),this.h+=1,this};function El(o,c){ve(o),c=yn(o,c),o.g.has(c)&&(o.i=null,o.h-=o.g.get(c).length,o.g.delete(c))}function Il(o,c){return ve(o),c=yn(o,c),o.g.has(c)}r.forEach=function(o,c){ve(this),this.g.forEach(function(h,m){h.forEach(function(T){o.call(c,T,m,this)},this)},this)},r.na=function(){ve(this);let o=Array.from(this.g.values()),c=Array.from(this.g.keys()),h=[];for(let m=0;m<c.length;m++){let T=o[m];for(let V=0;V<T.length;V++)h.push(c[m])}return h},r.V=function(o){ve(this);let c=[];if(typeof o=="string")Il(this,o)&&(c=c.concat(this.g.get(yn(this,o))));else{o=Array.from(this.g.values());for(let h=0;h<o.length;h++)c=c.concat(o[h])}return c},r.set=function(o,c){return ve(this),this.i=null,o=yn(this,o),Il(this,o)&&(this.h-=this.g.get(o).length),this.g.set(o,[c]),this.h+=1,this},r.get=function(o,c){return o?(o=this.V(o),0<o.length?String(o[0]):c):c};function Tl(o,c,h){El(o,c),0<h.length&&(o.i=null,o.g.set(yn(o,c),k(h)),o.h+=h.length)}r.toString=function(){if(this.i)return this.i;if(!this.g)return"";let o=[],c=Array.from(this.g.keys());for(var h=0;h<c.length;h++){var m=c[h];let V=encodeURIComponent(String(m)),M=this.V(m);for(m=0;m<M.length;m++){var T=V;M[m]!==""&&(T+="="+encodeURIComponent(String(M[m]))),o.push(T)}}return this.i=o.join("&")};function yn(o,c){return c=String(c),o.j&&(c=c.toLowerCase()),c}function Xm(o,c){c&&!o.j&&(ve(o),o.i=null,o.g.forEach(function(h,m){var T=m.toLowerCase();m!=T&&(El(this,m),Tl(this,T,h))},o)),o.j=c}function Zm(o,c){let h=new wr;if(u.Image){let m=new Image;m.onload=C(we,h,"TestLoadImage: loaded",!0,c,m),m.onerror=C(we,h,"TestLoadImage: error",!1,c,m),m.onabort=C(we,h,"TestLoadImage: abort",!1,c,m),m.ontimeout=C(we,h,"TestLoadImage: timeout",!1,c,m),u.setTimeout(function(){m.ontimeout&&m.ontimeout()},1e4),m.src=o}else c(!1)}function tg(o,c){let h=new wr,m=new AbortController,T=setTimeout(()=>{m.abort(),we(h,"TestPingServer: timeout",!1,c)},1e4);fetch(o,{signal:m.signal}).then(V=>{clearTimeout(T),V.ok?we(h,"TestPingServer: ok",!0,c):we(h,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(T),we(h,"TestPingServer: error",!1,c)})}function we(o,c,h,m,T){try{T&&(T.onload=null,T.onerror=null,T.onabort=null,T.ontimeout=null),m(h)}catch{}}function eg(){this.g=new Om}function ng(o,c,h){let m=h||"";try{yl(o,function(T,V){let M=T;d(T)&&(M=Po(T)),c.push(m+V+"="+encodeURIComponent(M))})}catch(T){throw c.push(m+"type="+encodeURIComponent("_badmap")),T}}function br(o){this.l=o.Ub||null,this.j=o.eb||!1}N(br,Ro),br.prototype.g=function(){return new Bi(this.l,this.j)},br.prototype.i=function(o){return function(){return o}}({});function Bi(o,c){Vt.call(this),this.D=o,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}N(Bi,Vt),r=Bi.prototype,r.open=function(o,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=o,this.A=c,this.readyState=1,Vr(this)},r.send=function(o){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let c={headers:this.u,method:this.B,credentials:this.m,cache:void 0};o&&(c.body=o),(this.D||u).fetch(new Request(this.A,c)).then(this.Sa.bind(this),this.ga.bind(this))},r.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Cr(this)),this.readyState=0},r.Sa=function(o){if(this.g&&(this.l=o,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=o.headers,this.readyState=2,Vr(this)),this.g&&(this.readyState=3,Vr(this),this.g)))if(this.responseType==="arraybuffer")o.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in o){if(this.j=o.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Al(this)}else o.text().then(this.Ra.bind(this),this.ga.bind(this))};function Al(o){o.j.read().then(o.Pa.bind(o)).catch(o.ga.bind(o))}r.Pa=function(o){if(this.g){if(this.o&&o.value)this.response.push(o.value);else if(!this.o){var c=o.value?o.value:new Uint8Array(0);(c=this.v.decode(c,{stream:!o.done}))&&(this.response=this.responseText+=c)}o.done?Cr(this):Vr(this),this.readyState==3&&Al(this)}},r.Ra=function(o){this.g&&(this.response=this.responseText=o,Cr(this))},r.Qa=function(o){this.g&&(this.response=o,Cr(this))},r.ga=function(){this.g&&Cr(this)};function Cr(o){o.readyState=4,o.l=null,o.j=null,o.v=null,Vr(o)}r.setRequestHeader=function(o,c){this.u.append(o,c)},r.getResponseHeader=function(o){return this.h&&this.h.get(o.toLowerCase())||""},r.getAllResponseHeaders=function(){if(!this.h)return"";let o=[],c=this.h.entries();for(var h=c.next();!h.done;)h=h.value,o.push(h[0]+": "+h[1]),h=c.next();return o.join(`\r
`)};function Vr(o){o.onreadystatechange&&o.onreadystatechange.call(o)}Object.defineProperty(Bi.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(o){this.m=o?"include":"same-origin"}});function bl(o){let c="";return $(o,function(h,m){c+=m,c+=":",c+=h,c+=`\r
`}),c}function qo(o,c,h){t:{for(m in h){var m=!1;break t}m=!0}m||(h=bl(h),typeof o=="string"?h!=null&&encodeURIComponent(String(h)):rt(o,c,h))}function at(o){Vt.call(this),this.headers=new Map,this.o=o||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}N(at,Vt);var rg=/^https?$/i,ig=["POST","PUT"];r=at.prototype,r.Ha=function(o){this.J=o},r.ea=function(o,c,h,m){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+o);c=c?c.toUpperCase():"GET",this.D=o,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():ko.g(),this.v=this.o?tl(this.o):tl(ko),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(c,String(o),!0),this.B=!1}catch(V){Cl(this,V);return}if(o=h||"",h=new Map(this.headers),m)if(Object.getPrototypeOf(m)===Object.prototype)for(var T in m)h.set(T,m[T]);else if(typeof m.keys=="function"&&typeof m.get=="function")for(let V of m.keys())h.set(V,m.get(V));else throw Error("Unknown input type for opt_headers: "+String(m));m=Array.from(h.keys()).find(V=>V.toLowerCase()=="content-type"),T=u.FormData&&o instanceof u.FormData,!(0<=Array.prototype.indexOf.call(ig,c,void 0))||m||T||h.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[V,M]of h)this.g.setRequestHeader(V,M);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Dl(this),this.u=!0,this.g.send(o),this.u=!1}catch(V){Cl(this,V)}};function Cl(o,c){o.h=!1,o.g&&(o.j=!0,o.g.abort(),o.j=!1),o.l=c,o.m=5,Vl(o),qi(o)}function Vl(o){o.A||(o.A=!0,xt(o,"complete"),xt(o,"error"))}r.abort=function(o){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=o||7,xt(this,"complete"),xt(this,"abort"),qi(this))},r.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),qi(this,!0)),at.aa.N.call(this)},r.Ea=function(){this.s||(this.B||this.u||this.j?Sl(this):this.bb())},r.bb=function(){Sl(this)};function Sl(o){if(o.h&&typeof a<"u"&&(!o.v[1]||ae(o)!=4||o.Z()!=2)){if(o.u&&ae(o)==4)Jc(o.Ea,0,o);else if(xt(o,"readystatechange"),ae(o)==4){o.h=!1;try{let M=o.Z();t:switch(M){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var h;if(!(h=c)){var m;if(m=M===0){var T=String(o.D).match(_l)[1]||null;!T&&u.self&&u.self.location&&(T=u.self.location.protocol.slice(0,-1)),m=!rg.test(T?T.toLowerCase():"")}h=m}if(h)xt(o,"complete"),xt(o,"success");else{o.m=6;try{var V=2<ae(o)?o.g.statusText:""}catch{V=""}o.l=V+" ["+o.Z()+"]",Vl(o)}}finally{qi(o)}}}}function qi(o,c){if(o.g){Dl(o);let h=o.g,m=o.v[0]?()=>{}:null;o.g=null,o.v=null,c||xt(o,"ready");try{h.onreadystatechange=m}catch{}}}function Dl(o){o.I&&(u.clearTimeout(o.I),o.I=null)}r.isActive=function(){return!!this.g};function ae(o){return o.g?o.g.readyState:0}r.Z=function(){try{return 2<ae(this)?this.g.status:-1}catch{return-1}},r.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},r.Oa=function(o){if(this.g){var c=this.g.responseText;return o&&c.indexOf(o)==0&&(c=c.substring(o.length)),Fm(c)}};function Pl(o){try{if(!o.g)return null;if("response"in o.g)return o.g.response;switch(o.H){case"":case"text":return o.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in o.g)return o.g.mozResponseArrayBuffer}return null}catch{return null}}function sg(o){let c={};o=(o.g&&2<=ae(o)&&o.g.getAllResponseHeaders()||"").split(`\r
`);for(let m=0;m<o.length;m++){if(j(o[m]))continue;var h=I(o[m]);let T=h[0];if(h=h[1],typeof h!="string")continue;h=h.trim();let V=c[T]||[];c[T]=V,V.push(h)}w(c,function(m){return m.join(", ")})}r.Ba=function(){return this.m},r.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Sr(o,c,h){return h&&h.internalChannelParams&&h.internalChannelParams[o]||c}function Rl(o){this.Aa=0,this.i=[],this.j=new wr,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Sr("failFast",!1,o),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Sr("baseRetryDelayMs",5e3,o),this.cb=Sr("retryDelaySeedMs",1e4,o),this.Wa=Sr("forwardChannelMaxRetries",2,o),this.wa=Sr("forwardChannelRequestTimeoutMs",2e4,o),this.pa=o&&o.xmlHttpFactory||void 0,this.Xa=o&&o.Tb||void 0,this.Ca=o&&o.useFetchStreams||!1,this.L=void 0,this.J=o&&o.supportsCrossDomainXhr||!1,this.K="",this.h=new dl(o&&o.concurrentRequestLimit),this.Da=new eg,this.P=o&&o.fastHandshake||!1,this.O=o&&o.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=o&&o.Rb||!1,o&&o.xa&&this.j.xa(),o&&o.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&o&&o.detectBufferingProxy||!1,this.ja=void 0,o&&o.longPollingTimeout&&0<o.longPollingTimeout&&(this.ja=o.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}r=Rl.prototype,r.la=8,r.G=1,r.connect=function(o,c,h,m){Nt(0),this.W=o,this.H=c||{},h&&m!==void 0&&(this.H.OSID=h,this.H.OAID=m),this.F=this.X,this.I=Bl(this,null,this.W),ji(this)};function Go(o){if(xl(o),o.G==3){var c=o.U++,h=oe(o.I);if(rt(h,"SID",o.K),rt(h,"RID",c),rt(h,"TYPE","terminate"),Dr(o,h),c=new _e(o,o.j,c),c.L=2,c.v=Ui(oe(h)),h=!1,u.navigator&&u.navigator.sendBeacon)try{h=u.navigator.sendBeacon(c.v.toString(),"")}catch{}!h&&u.Image&&(new Image().src=c.v,h=!0),h||(c.g=ql(c.j,null),c.g.ea(c.v)),c.F=Date.now(),Fi(c)}Ul(o)}function Gi(o){o.g&&(zo(o),o.g.cancel(),o.g=null)}function xl(o){Gi(o),o.u&&(u.clearTimeout(o.u),o.u=null),zi(o),o.h.cancel(),o.s&&(typeof o.s=="number"&&u.clearTimeout(o.s),o.s=null)}function ji(o){if(!fl(o.h)&&!o.s){o.s=!0;var c=o.Ga;dr||zc(),fr||(dr(),fr=!0),Eo.add(c,o),o.B=0}}function og(o,c){return ml(o.h)>=o.h.j-(o.s?1:0)?!1:o.s?(o.i=c.D.concat(o.i),!0):o.G==1||o.G==2||o.B>=(o.Va?0:o.Wa)?!1:(o.s=vr(v(o.Ga,o,c),Ll(o,o.B)),o.B++,!0)}r.Ga=function(o){if(this.s)if(this.s=null,this.G==1){if(!o){this.U=Math.floor(1e5*Math.random()),o=this.U++;let T=new _e(this,this.j,o),V=this.o;if(this.S&&(V?(V=p(V),E(V,this.S)):V=this.S),this.m!==null||this.O||(T.H=V,V=null),this.P)t:{for(var c=0,h=0;h<this.i.length;h++){e:{var m=this.i[h];if("__data__"in m.map&&(m=m.map.__data__,typeof m=="string")){m=m.length;break e}m=void 0}if(m===void 0)break;if(c+=m,4096<c){c=h;break t}if(c===4096||h===this.i.length-1){c=h+1;break t}}c=1e3}else c=1e3;c=kl(this,T,c),h=oe(this.I),rt(h,"RID",o),rt(h,"CVER",22),this.D&&rt(h,"X-HTTP-Session-Id",this.D),Dr(this,h),V&&(this.O?c="headers="+encodeURIComponent(String(bl(V)))+"&"+c:this.m&&qo(h,this.m,V)),Bo(this.h,T),this.Ua&&rt(h,"TYPE","init"),this.P?(rt(h,"$req",c),rt(h,"SID","null"),T.T=!0,Fo(T,h,null)):Fo(T,h,c),this.G=2}}else this.G==3&&(o?Nl(this,o):this.i.length==0||fl(this.h)||Nl(this))};function Nl(o,c){var h;c?h=c.l:h=o.U++;let m=oe(o.I);rt(m,"SID",o.K),rt(m,"RID",h),rt(m,"AID",o.T),Dr(o,m),o.m&&o.o&&qo(m,o.m,o.o),h=new _e(o,o.j,h,o.B+1),o.m===null&&(h.H=o.o),c&&(o.i=c.D.concat(o.i)),c=kl(o,h,1e3),h.I=Math.round(.5*o.wa)+Math.round(.5*o.wa*Math.random()),Bo(o.h,h),Fo(h,m,c)}function Dr(o,c){o.H&&$(o.H,function(h,m){rt(c,m,h)}),o.l&&yl({},function(h,m){rt(c,m,h)})}function kl(o,c,h){h=Math.min(o.i.length,h);var m=o.l?v(o.l.Na,o.l,o):null;t:{var T=o.i;let V=-1;for(;;){let M=["count="+h];V==-1?0<h?(V=T[0].g,M.push("ofs="+V)):V=0:M.push("ofs="+V);let et=!0;for(let Tt=0;Tt<h;Tt++){let Y=T[Tt].g,St=T[Tt].map;if(Y-=V,0>Y)V=Math.max(0,T[Tt].g-100),et=!1;else try{ng(St,M,"req"+Y+"_")}catch{m&&m(St)}}if(et){m=M.join("&");break t}}}return o=o.i.splice(0,h),c.D=o,m}function Ml(o){if(!o.g&&!o.u){o.Y=1;var c=o.Fa;dr||zc(),fr||(dr(),fr=!0),Eo.add(c,o),o.v=0}}function jo(o){return o.g||o.u||3<=o.v?!1:(o.Y++,o.u=vr(v(o.Fa,o),Ll(o,o.v)),o.v++,!0)}r.Fa=function(){if(this.u=null,Fl(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var o=2*this.R;this.j.info("BP detection timer enabled: "+o),this.A=vr(v(this.ab,this),o)}},r.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Nt(10),Gi(this),Fl(this))};function zo(o){o.A!=null&&(u.clearTimeout(o.A),o.A=null)}function Fl(o){o.g=new _e(o,o.j,"rpc",o.Y),o.m===null&&(o.g.H=o.o),o.g.O=0;var c=oe(o.qa);rt(c,"RID","rpc"),rt(c,"SID",o.K),rt(c,"AID",o.T),rt(c,"CI",o.F?"0":"1"),!o.F&&o.ja&&rt(c,"TO",o.ja),rt(c,"TYPE","xmlhttp"),Dr(o,c),o.m&&o.o&&qo(c,o.m,o.o),o.L&&(o.g.I=o.L);var h=o.g;o=o.ia,h.L=1,h.v=Ui(oe(c)),h.m=null,h.P=!0,cl(h,o)}r.Za=function(){this.C!=null&&(this.C=null,Gi(this),jo(this),Nt(19))};function zi(o){o.C!=null&&(u.clearTimeout(o.C),o.C=null)}function Ol(o,c){var h=null;if(o.g==c){zi(o),zo(o),o.g=null;var m=2}else if(Uo(o.h,c))h=c.D,gl(o.h,c),m=1;else return;if(o.G!=0){if(c.o)if(m==1){h=c.m?c.m.length:0,c=Date.now()-c.F;var T=o.B;m=Ni(),xt(m,new sl(m,h)),ji(o)}else Ml(o);else if(T=c.s,T==3||T==0&&0<c.X||!(m==1&&og(o,c)||m==2&&jo(o)))switch(h&&0<h.length&&(c=o.h,c.i=c.i.concat(h)),T){case 1:Ke(o,5);break;case 4:Ke(o,10);break;case 3:Ke(o,6);break;default:Ke(o,2)}}}function Ll(o,c){let h=o.Ta+Math.floor(Math.random()*o.cb);return o.isActive()||(h*=2),h*c}function Ke(o,c){if(o.j.info("Error code "+c),c==2){var h=v(o.fb,o),m=o.Xa;let T=!m;m=new ze(m||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Oi(m,"https"),Ui(m),T?Zm(m.toString(),h):tg(m.toString(),h)}else Nt(2);o.G=0,o.l&&o.l.sa(c),Ul(o),xl(o)}r.fb=function(o){o?(this.j.info("Successfully pinged google.com"),Nt(2)):(this.j.info("Failed to ping google.com"),Nt(1))};function Ul(o){if(o.G=0,o.ka=[],o.l){let c=pl(o.h);(c.length!=0||o.i.length!=0)&&(x(o.ka,c),x(o.ka,o.i),o.h.i.length=0,k(o.i),o.i.length=0),o.l.ra()}}function Bl(o,c,h){var m=h instanceof ze?oe(h):new ze(h);if(m.g!="")c&&(m.g=c+"."+m.g),Li(m,m.s);else{var T=u.location;m=T.protocol,c=c?c+"."+T.hostname:T.hostname,T=+T.port;var V=new ze(null);m&&Oi(V,m),c&&(V.g=c),T&&Li(V,T),h&&(V.l=h),m=V}return h=o.D,c=o.ya,h&&c&&rt(m,h,c),rt(m,"VER",o.la),Dr(o,m),m}function ql(o,c,h){if(c&&!o.J)throw Error("Can't create secondary domain capable XhrIo object.");return c=o.Ca&&!o.pa?new at(new br({eb:h})):new at(o.pa),c.Ha(o.J),c}r.isActive=function(){return!!this.l&&this.l.isActive(this)};function Gl(){}r=Gl.prototype,r.ua=function(){},r.ta=function(){},r.sa=function(){},r.ra=function(){},r.isActive=function(){return!0},r.Na=function(){};function Ki(){}Ki.prototype.g=function(o,c){return new Lt(o,c)};function Lt(o,c){Vt.call(this),this.g=new Rl(c),this.l=o,this.h=c&&c.messageUrlParams||null,o=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(o?o["X-Client-Protocol"]="webchannel":o={"X-Client-Protocol":"webchannel"}),this.g.o=o,o=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(o?o["X-WebChannel-Content-Type"]=c.messageContentType:o={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.va&&(o?o["X-WebChannel-Client-Profile"]=c.va:o={"X-WebChannel-Client-Profile":c.va}),this.g.S=o,(o=c&&c.Sb)&&!j(o)&&(this.g.m=o),this.v=c&&c.supportsCrossDomainXhr||!1,this.u=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!j(c)&&(this.g.D=c,o=this.h,o!==null&&c in o&&(o=this.h,c in o&&delete o[c])),this.j=new _n(this)}N(Lt,Vt),Lt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Lt.prototype.close=function(){Go(this.g)},Lt.prototype.o=function(o){var c=this.g;if(typeof o=="string"){var h={};h.__data__=o,o=h}else this.u&&(h={},h.__data__=Po(o),o=h);c.i.push(new jm(c.Ya++,o)),c.G==3&&ji(c)},Lt.prototype.N=function(){this.g.l=null,delete this.j,Go(this.g),delete this.g,Lt.aa.N.call(this)};function jl(o){xo.call(this),o.__headers__&&(this.headers=o.__headers__,this.statusCode=o.__status__,delete o.__headers__,delete o.__status__);var c=o.__sm__;if(c){t:{for(let h in c){o=h;break t}o=void 0}(this.i=o)&&(o=this.i,c=c!==null&&o in c?c[o]:void 0),this.data=c}else this.data=o}N(jl,xo);function zl(){No.call(this),this.status=1}N(zl,No);function _n(o){this.g=o}N(_n,Gl),_n.prototype.ua=function(){xt(this.g,"a")},_n.prototype.ta=function(o){xt(this.g,new jl(o))},_n.prototype.sa=function(o){xt(this.g,new zl)},_n.prototype.ra=function(){xt(this.g,"b")},Ki.prototype.createWebChannel=Ki.prototype.g,Lt.prototype.send=Lt.prototype.o,Lt.prototype.open=Lt.prototype.m,Lt.prototype.close=Lt.prototype.close,sa=ue.createWebChannelTransport=function(){return new Ki},ia=ue.getStatEventTarget=function(){return Ni()},ra=ue.Event=Ge,Wi=ue.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},ki.NO_ERROR=0,ki.TIMEOUT=8,ki.HTTP_ERROR=6,Fr=ue.ErrorCode=ki,ol.COMPLETE="complete",na=ue.EventType=ol,el.EventType=yr,yr.OPEN="a",yr.CLOSE="b",yr.ERROR="c",yr.MESSAGE="d",Vt.prototype.listen=Vt.prototype.K,In=ue.WebChannel=el,ea=ue.FetchXmlHttpFactory=br,at.prototype.listenOnce=at.prototype.L,at.prototype.getLastError=at.prototype.Ka,at.prototype.getLastErrorCode=at.prototype.Ba,at.prototype.getStatus=at.prototype.Z,at.prototype.getResponseJson=at.prototype.Oa,at.prototype.getResponseText=at.prototype.oa,at.prototype.send=at.prototype.ea,at.prototype.setWithCredentials=at.prototype.Ha,ta=ue.XhrIo=at}).apply(typeof Hi<"u"?Hi:typeof self<"u"?self:typeof window<"u"?window:{});var dh="@firebase/firestore";var pt=class{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}};pt.UNAUTHENTICATED=new pt(null),pt.GOOGLE_CREDENTIALS=new pt("google-credentials-uid"),pt.FIRST_PARTY=new pt("first-party-uid"),pt.MOCK_USER=new pt("mock-user");var er="10.12.1";var Ve=new ih("@firebase/firestore");function Vn(){return Ve.logLevel}function a_(r){Ve.setLogLevel(r)}function P(r,...t){if(Ve.logLevel<=Wt.DEBUG){let e=t.map(uc);Ve.debug(`Firestore (${er}): ${r}`,...e)}}function lt(r,...t){if(Ve.logLevel<=Wt.ERROR){let e=t.map(uc);Ve.error(`Firestore (${er}): ${r}`,...e)}}function ee(r,...t){if(Ve.logLevel<=Wt.WARN){let e=t.map(uc);Ve.warn(`Firestore (${er}): ${r}`,...e)}}function uc(r){if(typeof r=="string")return r;try{return function(e){return JSON.stringify(e)}(r)}catch{return r}}function L(r="Unexpected state"){let t=`FIRESTORE (${er}) INTERNAL ASSERTION FAILED: `+r;throw lt(t),new Error(t)}function U(r,t){r||L()}function u_(r,t){r||L()}function F(r,t){return r}var S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},R=class extends nh{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var yt=class{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}};var os=class{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}},la=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(pt.UNAUTHENTICATED))}shutdown(){}},ha=class{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}},da=class{constructor(t){this.t=t,this.currentUser=pt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i,i=l=>this.i!==n?(n=this.i,e(l)):Promise.resolve(),s=new yt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new yt,t.enqueueRetryable(()=>i(this.currentUser))};let a=()=>{let l=s;t.enqueueRetryable(()=>D(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},u=l=>{P("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.o),a()};this.t.onInit(l=>u(l)),setTimeout(()=>{if(!this.auth){let l=this.t.getImmediate({optional:!0});l?u(l):(P("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new yt)}},0),a()}getToken(){let t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(n=>this.i!==t?(P("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):n?(U(typeof n.accessToken=="string"),new os(n.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let t=this.auth&&this.auth.getUid();return U(t===null||typeof t=="string"),new pt(t)}},fa=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=pt.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},ma=class{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new fa(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable(()=>e(pt.FIRST_PARTY))}shutdown(){}invalidateToken(){}},ga=class{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},pa=class{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){let n=s=>{s.error!=null&&P("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let a=s.token!==this.R;return this.R=s.token,P("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(s.token):Promise.resolve()};this.o=s=>{t.enqueueRetryable(()=>n(s))};let i=s=>{P("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):P("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(e=>e?(U(typeof e.token=="string"),this.R=e.token,new ga(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function ag(r){let t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(r);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let n=0;n<r;n++)e[n]=Math.floor(256*Math.random());return e}var as=class{static newId(){let t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";for(;n.length<20;){let i=ag(40);for(let s=0;s<i.length;++s)n.length<20&&i[s]<e&&(n+=t.charAt(i[s]%t.length))}return n}};function z(r,t){return r<t?-1:r>t?1:0}function On(r,t,e){return r.length===t.length&&r.every((n,i)=>e(n,t[i]))}function fd(r){return r+"\0"}var ht=class r{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new R(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new R(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new R(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new R(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return r.fromMillis(Date.now())}static fromDate(t){return r.fromMillis(t.getTime())}static fromMillis(t){let e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new r(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?z(this.nanoseconds,t.nanoseconds):z(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var B=class r{constructor(t){this.timestamp=t}static fromTimestamp(t){return new r(t)}static min(){return new r(new ht(0,0))}static max(){return new r(new ht(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var us=class r{constructor(t,e,n){e===void 0?e=0:e>t.length&&L(),n===void 0?n=t.length-e:n>t.length-e&&L(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return r.comparator(this,t)===0}child(t){let e=this.segments.slice(this.offset,this.limit());return t instanceof r?t.forEach(n=>{e.push(n)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){let n=Math.min(t.length,e.length);for(let i=0;i<n;i++){let s=t.get(i),a=e.get(i);if(s<a)return-1;if(s>a)return 1}return t.length<e.length?-1:t.length>e.length?1:0}},J=class r extends us{construct(t,e,n){return new r(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){let e=[];for(let n of t){if(n.indexOf("//")>=0)throw new R(S.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(i=>i.length>0))}return new r(e)}static emptyPath(){return new r([])}},ug=/^[_a-zA-Z][_a-zA-Z0-9]*$/,wt=class r extends us{construct(t,e,n){return new r(t,e,n)}static isValidIdentifier(t){return ug.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),r.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new r(["__name__"])}static fromServerFormat(t){let e=[],n="",i=0,s=()=>{if(n.length===0)throw new R(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""},a=!1;for(;i<t.length;){let u=t[i];if(u==="\\"){if(i+1===t.length)throw new R(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);let l=t[i+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new R(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=l,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(n+=u,i++):(s(),i++)}if(s(),a)throw new R(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new r(e)}static emptyPath(){return new r([])}};var O=class r{constructor(t){this.path=t}static fromPath(t){return new r(J.fromString(t))}static fromName(t){return new r(J.fromString(t).popFirst(5))}static empty(){return new r(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&J.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return J.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new r(new J(t.slice()))}};var Ln=class{constructor(t,e,n,i){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=i}};function ya(r){return r.fields.find(t=>t.kind===2)}function We(r){return r.fields.filter(t=>t.kind!==2)}Ln.UNKNOWN_ID=-1;var Nn=class{constructor(t,e){this.fieldPath=t,this.kind=e}};var Hr=class r{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new r(0,jt.min())}};function md(r,t){let e=r.toTimestamp().seconds,n=r.toTimestamp().nanoseconds+1,i=B.fromTimestamp(n===1e9?new ht(e+1,0):new ht(e,n));return new jt(i,O.empty(),t)}function gd(r){return new jt(r.readTime,r.key,-1)}var jt=class r{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new r(B.min(),O.empty(),-1)}static max(){return new r(B.max(),O.empty(),-1)}};function cc(r,t){let e=r.readTime.compareTo(t.readTime);return e!==0?e:(e=O.comparator(r.documentKey,t.documentKey),e!==0?e:z(r.largestBatchId,t.largestBatchId))}var pd="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",cs=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}};function Ue(r){return D(this,null,function*(){if(r.code!==S.FAILED_PRECONDITION||r.message!==pd)throw r;P("LocalStore","Unexpectedly lost primary lease")})}var b=class r{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new r((n,i)=>{this.nextCallback=s=>{this.wrapSuccess(t,s).next(n,i)},this.catchCallback=s=>{this.wrapFailure(e,s).next(n,i)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{let e=t();return e instanceof r?e:r.resolve(e)}catch(e){return r.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):r.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):r.reject(e)}static resolve(t){return new r((e,n)=>{e(t)})}static reject(t){return new r((e,n)=>{n(t)})}static waitFor(t){return new r((e,n)=>{let i=0,s=0,a=!1;t.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&e()},l=>n(l))}),a=!0,s===i&&e()})}static or(t){let e=r.resolve(!1);for(let n of t)e=e.next(i=>i?r.resolve(i):n());return e}static forEach(t,e){let n=[];return t.forEach((i,s)=>{n.push(e.call(this,i,s))}),this.waitFor(n)}static mapArray(t,e){return new r((n,i)=>{let s=t.length,a=new Array(s),u=0;for(let l=0;l<s;l++){let d=l;e(t[d]).next(f=>{a[d]=f,++u,u===s&&n(a)},f=>i(f))}})}static doWhile(t,e){return new r((n,i)=>{let s=()=>{t()===!0?e().next(()=>{s()},i):n()};s()})}};var ls=class r{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new yt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new en(t,e.error)):this.V.resolve()},this.transaction.onerror=n=>{let i=lc(n.target.error);this.V.reject(new en(t,i))}}static open(t,e,n,i){try{return new r(e,t.transaction(i,n))}catch(s){throw new en(e,s)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(P("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let t=this.transaction;this.aborted||typeof t.commit!="function"||t.commit()}store(t){let e=this.transaction.objectStore(t);return new va(e)}},Se=class r{constructor(t,e,n){this.name=t,this.version=e,this.p=n,r.S(kr())===12.2&&lt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return P("SimpleDb","Removing database:",t),Je(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!eh())return!1;if(r.C())return!0;let t=kr(),e=r.S(t),n=0<e&&e<10,i=yd(t),s=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return typeof process<"u"&&((t=process.__PRIVATE_env)===null||t===void 0?void 0:t.v)==="YES"}static F(t,e){return t.store(e)}static S(t){let e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}M(t){return D(this,null,function*(){return this.db||(P("SimpleDb","Opening database:",this.name),this.db=yield new Promise((e,n)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let a=s.target.result;e(a)},i.onblocked=()=>{n(new en(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let a=s.target.error;a.name==="VersionError"?n(new R(S.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?n(new R(S.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):n(new en(t,a))},i.onupgradeneeded=s=>{P("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{P("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=e=>this.N(e)),this.db})}L(t){this.N=t,this.db&&(this.db.onversionchange=e=>t(e))}runTransaction(t,e,n,i){return D(this,null,function*(){let s=e==="readonly",a=0;for(;;){++a;try{this.db=yield this.M(t);let u=ls.open(this.db,t,s?"readonly":"readwrite",n),l=i(u).next(d=>(u.g(),d)).catch(d=>(u.abort(d),b.reject(d))).toPromise();return l.catch(()=>{}),yield u.m,l}catch(u){let l=u,d=l.name!=="FirebaseError"&&a<3;if(P("SimpleDb","Transaction failed with error:",l.message,"Retrying:",d),this.close(),!d)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}};function yd(r){let t=r.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}var _a=class{constructor(t){this.B=t,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(t){this.B=t}done(){this.k=!0}$(t){this.q=t}delete(){return Je(this.B.delete())}},en=class extends R{constructor(t,e){super(S.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}};function Be(r){return r.name==="IndexedDbTransactionError"}var va=class{constructor(t){this.store=t}put(t,e){let n;return e!==void 0?(P("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(P("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Je(n)}add(t){return P("SimpleDb","ADD",this.store.name,t,t),Je(this.store.add(t))}get(t){return Je(this.store.get(t)).next(e=>(e===void 0&&(e=null),P("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return P("SimpleDb","DELETE",this.store.name,t),Je(this.store.delete(t))}count(){return P("SimpleDb","COUNT",this.store.name),Je(this.store.count())}U(t,e){let n=this.options(t,e),i=n.index?this.store.index(n.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(n.range);return new b((a,u)=>{s.onerror=l=>{u(l.target.error)},s.onsuccess=l=>{a(l.target.result)}})}{let s=this.cursor(n),a=[];return this.W(s,(u,l)=>{a.push(l)}).next(()=>a)}}G(t,e){let n=this.store.getAll(t,e===null?void 0:e);return new b((i,s)=>{n.onerror=a=>{s(a.target.error)},n.onsuccess=a=>{i(a.target.result)}})}j(t,e){P("SimpleDb","DELETE ALL",this.store.name);let n=this.options(t,e);n.H=!1;let i=this.cursor(n);return this.W(i,(s,a,u)=>u.delete())}J(t,e){let n;e?n=t:(n={},e=t);let i=this.cursor(n);return this.W(i,e)}Y(t){let e=this.cursor({});return new b((n,i)=>{e.onerror=s=>{let a=lc(s.target.error);i(a)},e.onsuccess=s=>{let a=s.target.result;a?t(a.primaryKey,a.value).next(u=>{u?a.continue():n()}):n()}})}W(t,e){let n=[];return new b((i,s)=>{t.onerror=a=>{s(a.target.error)},t.onsuccess=a=>{let u=a.target.result;if(!u)return void i();let l=new _a(u),d=e(u.primaryKey,u.value,l);if(d instanceof b){let f=d.catch(g=>(l.done(),b.reject(g)));n.push(f)}l.isDone?i():l.K===null?u.continue():u.continue(l.K)}}).next(()=>b.waitFor(n))}options(t,e){let n;return t!==void 0&&(typeof t=="string"?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){let n=this.store.index(t.index);return t.H?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}};function Je(r){return new b((t,e)=>{r.onsuccess=n=>{let i=n.target.result;t(i)},r.onerror=n=>{let i=lc(n.target.error);e(i)}})}var fh=!1;function lc(r){let t=Se.S(kr());if(t>=12.2&&t<13){let e="An internal error was encountered in the Indexed Database server";if(r.message.indexOf(e)>=0){let n=new R("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return fh||(fh=!0,setTimeout(()=>{throw n},0)),n}}return r}var wa=class{constructor(t,e){this.asyncQueue=t,this.Z=e,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(t){P("IndexBackfiller",`Scheduled in ${t}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",t,()=>D(this,null,function*(){this.task=null;try{P("IndexBackfiller",`Documents written: ${yield this.Z.ee()}`)}catch(e){Be(e)?P("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",e):yield Ue(e)}yield this.X(6e4)}))}},Ea=class{constructor(t,e){this.localStore=t,this.persistence=e}ee(t=50){return D(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",e=>this.te(e,t))})}te(t,e){let n=new Set,i=e,s=!0;return b.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(t).next(a=>{if(a!==null&&!n.has(a))return P("IndexBackfiller",`Processing collection: ${a}`),this.ne(t,a,i).next(u=>{i-=u,n.add(a)});s=!1})).next(()=>e-i)}ne(t,e,n){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(t,e).next(i=>this.localStore.localDocuments.getNextDocuments(t,e,i,n).next(s=>{let a=s.changes;return this.localStore.indexManager.updateIndexEntries(t,a).next(()=>this.re(i,s)).next(u=>(P("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(t,e,u))).next(()=>a.size)}))}re(t,e){let n=t;return e.changes.forEach((i,s)=>{let a=gd(s);cc(a,n)>0&&(n=a)}),new jt(n.readTime,n.documentKey,Math.max(e.batchId,t.largestBatchId))}};var Ut=(()=>{class r{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ie(i),this.se=i=>n.writeSequenceNumber(i))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.se&&this.se(e),e}}return r.oe=-1,r})();function yi(r){return r==null}function Wr(r){return r===0&&1/r==-1/0}function _d(r){return typeof r=="number"&&Number.isInteger(r)&&!Wr(r)&&r<=Number.MAX_SAFE_INTEGER&&r>=Number.MIN_SAFE_INTEGER}function kt(r){let t="";for(let e=0;e<r.length;e++)t.length>0&&(t=mh(t)),t=cg(r.get(e),t);return mh(t)}function cg(r,t){let e=t,n=r.length;for(let i=0;i<n;i++){let s=r.charAt(i);switch(s){case"\0":e+="";break;case"":e+="";break;default:e+=s}}return e}function mh(r){return r+""}function Jt(r){let t=r.length;if(U(t>=2),t===2)return U(r.charAt(0)===""&&r.charAt(1)===""),J.emptyPath();let e=t-2,n=[],i="";for(let s=0;s<t;){let a=r.indexOf("",s);switch((a<0||a>e)&&L(),r.charAt(a+1)){case"":let u=r.substring(s,a),l;i.length===0?l=u:(i+=u,l=i,i=""),n.push(l);break;case"":i+=r.substring(s,a),i+="\0";break;case"":i+=r.substring(s,a+1);break;default:L()}s=a+2}return new J(n)}var gh=["userId","batchId"];function ts(r,t){return[r,kt(t)]}function vd(r,t,e){return[r,kt(t),e]}var lg={},hg=["prefixPath","collectionGroup","readTime","documentId"],dg=["prefixPath","collectionGroup","documentId"],fg=["collectionGroup","readTime","prefixPath","documentId"],mg=["canonicalId","targetId"],gg=["targetId","path"],pg=["path","targetId"],yg=["collectionId","parent"],_g=["indexId","uid"],vg=["uid","sequenceNumber"],wg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Eg=["indexId","uid","orderedDocumentKey"],Ig=["userId","collectionPath","documentId"],Tg=["userId","collectionPath","largestBatchId"],Ag=["userId","collectionGroup","largestBatchId"],wd=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],bg=[...wd,"documentOverlays"],Ed=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Id=Ed,Td=[...Id,"indexConfiguration","indexState","indexEntries"],Cg=Td;var Jr=class extends cs{constructor(t,e){super(),this._e=t,this.currentSequenceNumber=e}};function It(r,t){let e=F(r);return Se.F(e._e,t)}function ph(r){let t=0;for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t++;return t}function fn(r,t){for(let e in r)Object.prototype.hasOwnProperty.call(r,e)&&t(e,r[e])}function Ad(r){for(let t in r)if(Object.prototype.hasOwnProperty.call(r,t))return!1;return!0}var it=class r{constructor(t,e){this.comparator=t,this.root=e||Xt.EMPTY}insert(t,e){return new r(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Xt.BLACK,null,null))}remove(t){return new r(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Xt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){let n=this.comparator(t,e.key);if(n===0)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){let i=this.comparator(t,n.key);if(i===0)return e+n.left.size;i<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){let t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new xn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new xn(this.root,t,this.comparator,!1)}getReverseIterator(){return new xn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new xn(this.root,t,this.comparator,!0)}},xn=class{constructor(t,e,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&i&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(s===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}},Xt=class r{constructor(t,e,n,i,s){this.key=t,this.value=e,this.color=n??r.RED,this.left=i??r.EMPTY,this.right=s??r.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,i,s){return new r(t??this.key,e??this.value,n??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let i=this,s=n(t,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(t,e,n),null):s===0?i.copy(null,e,null,null,null):i.copy(null,null,null,null,i.right.insert(t,e,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return r.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,i=this;if(e(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,e),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),e(t,i.key)===0){if(i.right.isEmpty())return r.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,e))}return i.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,r.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,r.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}};Xt.EMPTY=null,Xt.RED=!0,Xt.BLACK=!1;Xt.EMPTY=new class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(t,e,n,i,s){return this}insert(t,e,n){return new Xt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var nt=class r{constructor(t){this.comparator=t,this.data=new it(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){let n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){let i=n.getNext();if(this.comparator(i.key,t[1])>=0)return;e(i.key)}}forEachWhile(t,e){let n;for(n=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){let e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new hs(this.data.getIterator())}getIteratorFrom(t){return new hs(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(n=>{e=e.add(n)}),e}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let t=[];return this.forEach(e=>{t.push(e)}),t}toString(){let t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){let e=new r(this.comparator);return e.data=t,e}},hs=class{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function Tn(r){return r.hasNext()?r.getNext():void 0}var Bt=class r{constructor(t){this.fields=t,t.sort(wt.comparator)}static empty(){return new r([])}unionWith(t){let e=new nt(wt.comparator);for(let n of this.fields)e=e.add(n);for(let n of t)e=e.add(n);return new r(e.toArray())}covers(t){for(let e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return On(this.fields,t.fields,(e,n)=>e.isEqual(n))}};var ds=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function l_(){return typeof atob<"u"}var Et=class r{constructor(t){this.binaryString=t}static fromBase64String(t){let e=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new ds("Invalid base64 string: "+s):s}}(t);return new r(e)}static fromUint8Array(t){let e=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(t);return new r(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(e){return btoa(e)}(this.binaryString)}toUint8Array(){return function(e){let n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return n}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return z(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}};Et.EMPTY_BYTE_STRING=new Et("");var Vg=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function he(r){if(U(!!r),typeof r=="string"){let t=0,e=Vg.exec(r);if(U(!!e),e[1]){let i=e[1];i=(i+"000000000").substr(0,9),t=Number(i)}let n=new Date(r);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:ut(r.seconds),nanos:ut(r.nanos)}}function ut(r){return typeof r=="number"?r:typeof r=="string"?Number(r):0}function De(r){return typeof r=="string"?Et.fromBase64String(r):Et.fromUint8Array(r)}function no(r){var t,e;return((e=(((t=r?.mapValue)===null||t===void 0?void 0:t.fields)||{}).__type__)===null||e===void 0?void 0:e.stringValue)==="server_timestamp"}function hc(r){let t=r.mapValue.fields.__previous_value__;return no(t)?hc(t):t}function Yr(r){let t=he(r.mapValue.fields.__local_write_time__.timestampValue);return new ht(t.seconds,t.nanos)}var Ia=class{constructor(t,e,n,i,s,a,u,l,d){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=l,this.useFetchStreams=d}},Un=class r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new r("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(t){return t instanceof r&&t.projectId===this.projectId&&t.database===this.database}};var Ce={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},es={nullValue:"NULL_VALUE"};function nn(r){return"nullValue"in r?0:"booleanValue"in r?1:"integerValue"in r||"doubleValue"in r?2:"timestampValue"in r?3:"stringValue"in r?5:"bytesValue"in r?6:"referenceValue"in r?7:"geoPointValue"in r?8:"arrayValue"in r?9:"mapValue"in r?no(r)?4:bd(r)?9007199254740991:10:L()}function ne(r,t){if(r===t)return!0;let e=nn(r);if(e!==nn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return r.booleanValue===t.booleanValue;case 4:return Yr(r).isEqual(Yr(t));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let a=he(i.timestampValue),u=he(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(r,t);case 5:return r.stringValue===t.stringValue;case 6:return function(i,s){return De(i.bytesValue).isEqual(De(s.bytesValue))}(r,t);case 7:return r.referenceValue===t.referenceValue;case 8:return function(i,s){return ut(i.geoPointValue.latitude)===ut(s.geoPointValue.latitude)&&ut(i.geoPointValue.longitude)===ut(s.geoPointValue.longitude)}(r,t);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return ut(i.integerValue)===ut(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let a=ut(i.doubleValue),u=ut(s.doubleValue);return a===u?Wr(a)===Wr(u):isNaN(a)&&isNaN(u)}return!1}(r,t);case 9:return On(r.arrayValue.values||[],t.arrayValue.values||[],ne);case 10:return function(i,s){let a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(ph(a)!==ph(u))return!1;for(let l in a)if(a.hasOwnProperty(l)&&(u[l]===void 0||!ne(a[l],u[l])))return!1;return!0}(r,t);default:return L()}}function Xr(r,t){return(r.values||[]).find(e=>ne(e,t))!==void 0}function Pe(r,t){if(r===t)return 0;let e=nn(r),n=nn(t);if(e!==n)return z(e,n);switch(e){case 0:case 9007199254740991:return 0;case 1:return z(r.booleanValue,t.booleanValue);case 2:return function(s,a){let u=ut(s.integerValue||s.doubleValue),l=ut(a.integerValue||a.doubleValue);return u<l?-1:u>l?1:u===l?0:isNaN(u)?isNaN(l)?0:-1:1}(r,t);case 3:return yh(r.timestampValue,t.timestampValue);case 4:return yh(Yr(r),Yr(t));case 5:return z(r.stringValue,t.stringValue);case 6:return function(s,a){let u=De(s),l=De(a);return u.compareTo(l)}(r.bytesValue,t.bytesValue);case 7:return function(s,a){let u=s.split("/"),l=a.split("/");for(let d=0;d<u.length&&d<l.length;d++){let f=z(u[d],l[d]);if(f!==0)return f}return z(u.length,l.length)}(r.referenceValue,t.referenceValue);case 8:return function(s,a){let u=z(ut(s.latitude),ut(a.latitude));return u!==0?u:z(ut(s.longitude),ut(a.longitude))}(r.geoPointValue,t.geoPointValue);case 9:return function(s,a){let u=s.values||[],l=a.values||[];for(let d=0;d<u.length&&d<l.length;++d){let f=Pe(u[d],l[d]);if(f)return f}return z(u.length,l.length)}(r.arrayValue,t.arrayValue);case 10:return function(s,a){if(s===Ce.mapValue&&a===Ce.mapValue)return 0;if(s===Ce.mapValue)return 1;if(a===Ce.mapValue)return-1;let u=s.fields||{},l=Object.keys(u),d=a.fields||{},f=Object.keys(d);l.sort(),f.sort();for(let g=0;g<l.length&&g<f.length;++g){let v=z(l[g],f[g]);if(v!==0)return v;let C=Pe(u[l[g]],d[f[g]]);if(C!==0)return C}return z(l.length,f.length)}(r.mapValue,t.mapValue);default:throw L()}}function yh(r,t){if(typeof r=="string"&&typeof t=="string"&&r.length===t.length)return z(r,t);let e=he(r),n=he(t),i=z(e.seconds,n.seconds);return i!==0?i:z(e.nanos,n.nanos)}function Bn(r){return Ta(r)}function Ta(r){return"nullValue"in r?"null":"booleanValue"in r?""+r.booleanValue:"integerValue"in r?""+r.integerValue:"doubleValue"in r?""+r.doubleValue:"timestampValue"in r?function(e){let n=he(e);return`time(${n.seconds},${n.nanos})`}(r.timestampValue):"stringValue"in r?r.stringValue:"bytesValue"in r?function(e){return De(e).toBase64()}(r.bytesValue):"referenceValue"in r?function(e){return O.fromName(e).toString()}(r.referenceValue):"geoPointValue"in r?function(e){return`geo(${e.latitude},${e.longitude})`}(r.geoPointValue):"arrayValue"in r?function(e){let n="[",i=!0;for(let s of e.values||[])i?i=!1:n+=",",n+=Ta(s);return n+"]"}(r.arrayValue):"mapValue"in r?function(e){let n=Object.keys(e.fields||{}).sort(),i="{",s=!0;for(let a of n)s?s=!1:i+=",",i+=`${a}:${Ta(e.fields[a])}`;return i+"}"}(r.mapValue):L()}function rn(r,t){return{referenceValue:`projects/${r.projectId}/databases/${r.database}/documents/${t.path.canonicalString()}`}}function Aa(r){return!!r&&"integerValue"in r}function Zr(r){return!!r&&"arrayValue"in r}function _h(r){return!!r&&"nullValue"in r}function vh(r){return!!r&&"doubleValue"in r&&isNaN(Number(r.doubleValue))}function ns(r){return!!r&&"mapValue"in r}function jr(r){if(r.geoPointValue)return{geoPointValue:Object.assign({},r.geoPointValue)};if(r.timestampValue&&typeof r.timestampValue=="object")return{timestampValue:Object.assign({},r.timestampValue)};if(r.mapValue){let t={mapValue:{fields:{}}};return fn(r.mapValue.fields,(e,n)=>t.mapValue.fields[e]=jr(n)),t}if(r.arrayValue){let t={arrayValue:{values:[]}};for(let e=0;e<(r.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=jr(r.arrayValue.values[e]);return t}return Object.assign({},r)}function bd(r){return(((r.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function Sg(r){return"nullValue"in r?es:"booleanValue"in r?{booleanValue:!1}:"integerValue"in r||"doubleValue"in r?{doubleValue:NaN}:"timestampValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in r?{stringValue:""}:"bytesValue"in r?{bytesValue:""}:"referenceValue"in r?rn(Un.empty(),O.empty()):"geoPointValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in r?{arrayValue:{}}:"mapValue"in r?{mapValue:{}}:L()}function Dg(r){return"nullValue"in r?{booleanValue:!1}:"booleanValue"in r?{doubleValue:NaN}:"integerValue"in r||"doubleValue"in r?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in r?{stringValue:""}:"stringValue"in r?{bytesValue:""}:"bytesValue"in r?rn(Un.empty(),O.empty()):"referenceValue"in r?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in r?{arrayValue:{}}:"arrayValue"in r?{mapValue:{}}:"mapValue"in r?Ce:L()}function wh(r,t){let e=Pe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?-1:!r.inclusive&&t.inclusive?1:0}function Eh(r,t){let e=Pe(r.value,t.value);return e!==0?e:r.inclusive&&!t.inclusive?1:!r.inclusive&&t.inclusive?-1:0}var Rt=class r{constructor(t){this.value=t}static empty(){return new r({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!ns(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=jr(e)}setAll(t){let e=wt.emptyPath(),n={},i=[];t.forEach((a,u)=>{if(!e.isImmediateParentOf(u)){let l=this.getFieldsMap(e);this.applyChanges(l,n,i),n={},i=[],e=u.popLast()}a?n[u.lastSegment()]=jr(a):i.push(u.lastSegment())});let s=this.getFieldsMap(e);this.applyChanges(s,n,i)}delete(t){let e=this.field(t.popLast());ns(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ne(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let i=e.mapValue.fields[t.get(n)];ns(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=i),e=i}return e.mapValue.fields}applyChanges(t,e,n){fn(e,(i,s)=>t[i]=s);for(let i of n)delete t[i]}clone(){return new r(jr(this.value))}};function Cd(r){let t=[];return fn(r.fields,(e,n)=>{let i=new wt([e]);if(ns(n)){let s=Cd(n.mapValue).fields;if(s.length===0)t.push(i);else for(let a of s)t.push(i.child(a))}else t.push(i)}),new Bt(t)}var _t=class r{constructor(t,e,n,i,s,a,u){this.key=t,this.documentType=e,this.version=n,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(t){return new r(t,0,B.min(),B.min(),B.min(),Rt.empty(),0)}static newFoundDocument(t,e,n,i){return new r(t,1,e,B.min(),n,i,0)}static newNoDocument(t,e){return new r(t,2,e,B.min(),B.min(),Rt.empty(),0)}static newUnknownDocument(t,e){return new r(t,3,e,B.min(),B.min(),Rt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Rt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Rt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof r&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new r(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var re=class{constructor(t,e){this.position=t,this.inclusive=e}};function Ih(r,t,e){let n=0;for(let i=0;i<r.position.length;i++){let s=t[i],a=r.position[i];if(s.field.isKeyField()?n=O.comparator(O.fromName(a.referenceValue),e.key):n=Pe(a,e.data.field(s.field)),s.dir==="desc"&&(n*=-1),n!==0)break}return n}function Th(r,t){if(r===null)return t===null;if(t===null||r.inclusive!==t.inclusive||r.position.length!==t.position.length)return!1;for(let e=0;e<r.position.length;e++)if(!ne(r.position[e],t.position[e]))return!1;return!0}var sn=class{constructor(t,e="asc"){this.field=t,this.dir=e}};function Pg(r,t){return r.dir===t.dir&&r.field.isEqual(t.field)}var fs=class{},Q=class r extends fs{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,n):new Va(t,e,n):e==="array-contains"?new Pa(t,n):e==="in"?new ms(t,n):e==="not-in"?new Ra(t,n):e==="array-contains-any"?new xa(t,n):new r(t,e,n)}static createKeyFieldInFilter(t,e,n){return e==="in"?new Sa(t,n):new Da(t,n)}matches(t){let e=t.data.field(this.field);return this.op==="!="?e!==null&&this.matchesComparison(Pe(e,this.value)):e!==null&&nn(this.value)===nn(e)&&this.matchesComparison(Pe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},tt=class r extends fs{constructor(t,e){super(),this.filters=t,this.op=e,this.ae=null}static create(t,e){return new r(t,e)}matches(t){return qn(this)?this.filters.find(e=>!e.matches(t))===void 0:this.filters.find(e=>e.matches(t))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}};function qn(r){return r.op==="and"}function ba(r){return r.op==="or"}function dc(r){return Vd(r)&&qn(r)}function Vd(r){for(let t of r.filters)if(t instanceof tt)return!1;return!0}function Ca(r){if(r instanceof Q)return r.field.canonicalString()+r.op.toString()+Bn(r.value);if(dc(r))return r.filters.map(t=>Ca(t)).join(",");{let t=r.filters.map(e=>Ca(e)).join(",");return`${r.op}(${t})`}}function Sd(r,t){return r instanceof Q?function(n,i){return i instanceof Q&&n.op===i.op&&n.field.isEqual(i.field)&&ne(n.value,i.value)}(r,t):r instanceof tt?function(n,i){return i instanceof tt&&n.op===i.op&&n.filters.length===i.filters.length?n.filters.reduce((s,a,u)=>s&&Sd(a,i.filters[u]),!0):!1}(r,t):void L()}function Dd(r,t){let e=r.filters.concat(t);return tt.create(e,r.op)}function Pd(r){return r instanceof Q?function(e){return`${e.field.canonicalString()} ${e.op} ${Bn(e.value)}`}(r):r instanceof tt?function(e){return e.op.toString()+" {"+e.getFilters().map(Pd).join(" ,")+"}"}(r):"Filter"}var Va=class extends Q{constructor(t,e,n){super(t,e,n),this.key=O.fromName(n.referenceValue)}matches(t){let e=O.comparator(t.key,this.key);return this.matchesComparison(e)}},Sa=class extends Q{constructor(t,e){super(t,"in",e),this.keys=Rd("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}},Da=class extends Q{constructor(t,e){super(t,"not-in",e),this.keys=Rd("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}};function Rd(r,t){var e;return(((e=t.arrayValue)===null||e===void 0?void 0:e.values)||[]).map(n=>O.fromName(n.referenceValue))}var Pa=class extends Q{constructor(t,e){super(t,"array-contains",e)}matches(t){let e=t.data.field(this.field);return Zr(e)&&Xr(e.arrayValue,this.value)}},ms=class extends Q{constructor(t,e){super(t,"in",e)}matches(t){let e=t.data.field(this.field);return e!==null&&Xr(this.value.arrayValue,e)}},Ra=class extends Q{constructor(t,e){super(t,"not-in",e)}matches(t){if(Xr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let e=t.data.field(this.field);return e!==null&&!Xr(this.value.arrayValue,e)}},xa=class extends Q{constructor(t,e){super(t,"array-contains-any",e)}matches(t){let e=t.data.field(this.field);return!(!Zr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(n=>Xr(this.value.arrayValue,n))}};var Na=class{constructor(t,e=null,n=[],i=[],s=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}};function ka(r,t=null,e=[],n=[],i=null,s=null,a=null){return new Na(r,t,e,n,i,s,a)}function on(r){let t=F(r);if(t.ue===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(n=>Ca(n)).join(","),e+="|ob:",e+=t.orderBy.map(n=>function(s){return s.field.canonicalString()+s.dir}(n)).join(","),yi(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(n=>Bn(n)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(n=>Bn(n)).join(",")),t.ue=e}return t.ue}function _i(r,t){if(r.limit!==t.limit||r.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<r.orderBy.length;e++)if(!Pg(r.orderBy[e],t.orderBy[e]))return!1;if(r.filters.length!==t.filters.length)return!1;for(let e=0;e<r.filters.length;e++)if(!Sd(r.filters[e],t.filters[e]))return!1;return r.collectionGroup===t.collectionGroup&&!!r.path.isEqual(t.path)&&!!Th(r.startAt,t.startAt)&&Th(r.endAt,t.endAt)}function gs(r){return O.isDocumentKey(r.path)&&r.collectionGroup===null&&r.filters.length===0}function ps(r,t){return r.filters.filter(e=>e instanceof Q&&e.field.isEqual(t))}function Ah(r,t,e){let n=es,i=!0;for(let s of ps(r,t)){let a=es,u=!0;switch(s.op){case"<":case"<=":a=Sg(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=es}wh({value:n,inclusive:i},{value:a,inclusive:u})<0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];wh({value:n,inclusive:i},{value:a,inclusive:e.inclusive})<0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}function bh(r,t,e){let n=Ce,i=!0;for(let s of ps(r,t)){let a=Ce,u=!0;switch(s.op){case">=":case">":a=Dg(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=Ce}Eh({value:n,inclusive:i},{value:a,inclusive:u})>0&&(n=a,i=u)}if(e!==null){for(let s=0;s<r.orderBy.length;++s)if(r.orderBy[s].field.isEqual(t)){let a=e.position[s];Eh({value:n,inclusive:i},{value:a,inclusive:e.inclusive})>0&&(n=a,i=e.inclusive);break}}return{value:n,inclusive:i}}var Kt=class{constructor(t,e=null,n=[],i=[],s=null,a="F",u=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=l,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}};function xd(r,t,e,n,i,s,a,u){return new Kt(r,t,e,n,i,s,a,u)}function nr(r){return new Kt(r)}function Ch(r){return r.filters.length===0&&r.limit===null&&r.startAt==null&&r.endAt==null&&(r.explicitOrderBy.length===0||r.explicitOrderBy.length===1&&r.explicitOrderBy[0].field.isKeyField())}function fc(r){return r.collectionGroup!==null}function kn(r){let t=F(r);if(t.ce===null){t.ce=[];let e=new Set;for(let s of t.explicitOrderBy)t.ce.push(s),e.add(s.field.canonicalString());let n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new nt(wt.comparator);return a.filters.forEach(l=>{l.getFlattenedFilters().forEach(d=>{d.isInequality()&&(u=u.add(d.field))})}),u})(t).forEach(s=>{e.has(s.canonicalString())||s.isKeyField()||t.ce.push(new sn(s,n))}),e.has(wt.keyField().canonicalString())||t.ce.push(new sn(wt.keyField(),n))}return t.ce}function Mt(r){let t=F(r);return t.le||(t.le=Rg(t,kn(r))),t.le}function Rg(r,t){if(r.limitType==="F")return ka(r.path,r.collectionGroup,t,r.filters,r.limit,r.startAt,r.endAt);{t=t.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new sn(i.field,s)});let e=r.endAt?new re(r.endAt.position,r.endAt.inclusive):null,n=r.startAt?new re(r.startAt.position,r.startAt.inclusive):null;return ka(r.path,r.collectionGroup,t,r.filters,r.limit,e,n)}}function Ma(r,t){let e=r.filters.concat([t]);return new Kt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),e,r.limit,r.limitType,r.startAt,r.endAt)}function ys(r,t,e){return new Kt(r.path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),t,e,r.startAt,r.endAt)}function vi(r,t){return _i(Mt(r),Mt(t))&&r.limitType===t.limitType}function Nd(r){return`${on(Mt(r))}|lt:${r.limitType}`}function Sn(r){return`Query(target=${function(e){let n=e.path.canonicalString();return e.collectionGroup!==null&&(n+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(n+=`, filters: [${e.filters.map(i=>Pd(i)).join(", ")}]`),yi(e.limit)||(n+=", limit: "+e.limit),e.orderBy.length>0&&(n+=`, orderBy: [${e.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),e.startAt&&(n+=", startAt: ",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(i=>Bn(i)).join(",")),e.endAt&&(n+=", endAt: ",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(i=>Bn(i)).join(",")),`Target(${n})`}(Mt(r))}; limitType=${r.limitType})`}function wi(r,t){return t.isFoundDocument()&&function(n,i){let s=i.key.path;return n.collectionGroup!==null?i.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(s):O.isDocumentKey(n.path)?n.path.isEqual(s):n.path.isImmediateParentOf(s)}(r,t)&&function(n,i){for(let s of kn(n))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(r,t)&&function(n,i){for(let s of n.filters)if(!s.matches(i))return!1;return!0}(r,t)&&function(n,i){return!(n.startAt&&!function(a,u,l){let d=Ih(a,u,l);return a.inclusive?d<=0:d<0}(n.startAt,kn(n),i)||n.endAt&&!function(a,u,l){let d=Ih(a,u,l);return a.inclusive?d>=0:d>0}(n.endAt,kn(n),i))}(r,t)}function kd(r){return r.collectionGroup||(r.path.length%2==1?r.path.lastSegment():r.path.get(r.path.length-2))}function Md(r){return(t,e)=>{let n=!1;for(let i of kn(r)){let s=xg(i,t,e);if(s!==0)return s;n=n||i.field.isKeyField()}return 0}}function xg(r,t,e){let n=r.field.isKeyField()?O.comparator(t.key,e.key):function(s,a,u){let l=a.data.field(s),d=u.data.field(s);return l!==null&&d!==null?Pe(l,d):L()}(r.field,t,e);switch(r.dir){case"asc":return n;case"desc":return-1*n;default:return L()}}var ie=class{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n!==void 0){for(let[i,s]of n)if(this.equalsFn(i,t))return s}}has(t){return this.get(t)!==void 0}set(t,e){let n=this.mapKeyFn(t),i=this.inner[n];if(i===void 0)return this.inner[n]=[[t,e]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return void(i[s]=[t,e]);i.push([t,e]),this.innerSize++}delete(t){let e=this.mapKeyFn(t),n=this.inner[e];if(n===void 0)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],t))return n.length===1?delete this.inner[e]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(t){fn(this.inner,(e,n)=>{for(let[i,s]of n)t(i,s)})}isEmpty(){return Ad(this.inner)}size(){return this.innerSize}};var Ng=new it(O.comparator);function Ot(){return Ng}var Fd=new it(O.comparator);function qr(...r){let t=Fd;for(let e of r)t=t.insert(e.key,e);return t}function Od(r){let t=Fd;return r.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function Yt(){return zr()}function Ld(){return zr()}function zr(){return new ie(r=>r.toString(),(r,t)=>r.isEqual(t))}var kg=new it(O.comparator),Mg=new nt(O.comparator);function K(...r){let t=Mg;for(let e of r)t=t.add(e);return t}var Fg=new nt(z);function mc(){return Fg}function Ud(r,t){if(r.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Wr(t)?"-0":t}}function Bd(r){return{integerValue:""+r}}function qd(r,t){return _d(t)?Bd(t):Ud(r,t)}var Gn=class{constructor(){this._=void 0}};function Og(r,t,e){return r instanceof Re?function(i,s){let a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&no(s)&&(s=hc(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(e,t):r instanceof de?jd(r,t):r instanceof fe?zd(r,t):function(i,s){let a=Gd(i,s),u=Vh(a)+Vh(i.Pe);return Aa(a)&&Aa(i.Pe)?Bd(u):Ud(i.serializer,u)}(r,t)}function Lg(r,t,e){return r instanceof de?jd(r,t):r instanceof fe?zd(r,t):e}function Gd(r,t){return r instanceof xe?function(n){return Aa(n)||function(s){return!!s&&"doubleValue"in s}(n)}(t)?t:{integerValue:0}:null}var Re=class extends Gn{},de=class extends Gn{constructor(t){super(),this.elements=t}};function jd(r,t){let e=Kd(t);for(let n of r.elements)e.some(i=>ne(i,n))||e.push(n);return{arrayValue:{values:e}}}var fe=class extends Gn{constructor(t){super(),this.elements=t}};function zd(r,t){let e=Kd(t);for(let n of r.elements)e=e.filter(i=>!ne(i,n));return{arrayValue:{values:e}}}var xe=class extends Gn{constructor(t,e){super(),this.serializer=t,this.Pe=e}};function Vh(r){return ut(r.integerValue||r.doubleValue)}function Kd(r){return Zr(r)&&r.arrayValue.values?r.arrayValue.values.slice():[]}var an=class{constructor(t,e){this.field=t,this.transform=e}};function Ug(r,t){return r.field.isEqual(t.field)&&function(n,i){return n instanceof de&&i instanceof de||n instanceof fe&&i instanceof fe?On(n.elements,i.elements,ne):n instanceof xe&&i instanceof xe?ne(n.Pe,i.Pe):n instanceof Re&&i instanceof Re}(r.transform,t.transform)}var Fa=class{constructor(t,e){this.version=t,this.transformResults=e}},ct=class r{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new r}static exists(t){return new r(void 0,t)}static updateTime(t){return new r(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}};function rs(r,t){return r.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(r.updateTime):r.exists===void 0||r.exists===t.isFoundDocument()}var jn=class{};function $d(r,t){if(!r.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return r.isNoDocument()?new ke(r.key,ct.none()):new Ne(r.key,r.data,ct.none());{let e=r.data,n=Rt.empty(),i=new nt(wt.comparator);for(let s of t.fields)if(!i.has(s)){let a=e.field(s);a===null&&s.length>1&&(s=s.popLast(),a=e.field(s)),a===null?n.delete(s):n.set(s,a),i=i.add(s)}return new $t(r.key,n,new Bt(i.toArray()),ct.none())}}function Bg(r,t,e){r instanceof Ne?function(i,s,a){let u=i.value.clone(),l=Dh(i.fieldTransforms,s,a.transformResults);u.setAll(l),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(r,t,e):r instanceof $t?function(i,s,a){if(!rs(i.precondition,s))return void s.convertToUnknownDocument(a.version);let u=Dh(i.fieldTransforms,s,a.transformResults),l=s.data;l.setAll(Qd(i)),l.setAll(u),s.convertToFoundDocument(a.version,l).setHasCommittedMutations()}(r,t,e):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,t,e)}function Kr(r,t,e,n){return r instanceof Ne?function(s,a,u,l){if(!rs(s.precondition,a))return u;let d=s.value.clone(),f=Ph(s.fieldTransforms,l,a);return d.setAll(f),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null}(r,t,e,n):r instanceof $t?function(s,a,u,l){if(!rs(s.precondition,a))return u;let d=Ph(s.fieldTransforms,l,a),f=a.data;return f.setAll(Qd(s)),f.setAll(d),a.convertToFoundDocument(a.version,f).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(g=>g.field))}(r,t,e,n):function(s,a,u){return rs(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(r,t,e)}function qg(r,t){let e=null;for(let n of r.fieldTransforms){let i=t.data.field(n.field),s=Gd(n.transform,i||null);s!=null&&(e===null&&(e=Rt.empty()),e.set(n.field,s))}return e||null}function Sh(r,t){return r.type===t.type&&!!r.key.isEqual(t.key)&&!!r.precondition.isEqual(t.precondition)&&!!function(n,i){return n===void 0&&i===void 0||!(!n||!i)&&On(n,i,(s,a)=>Ug(s,a))}(r.fieldTransforms,t.fieldTransforms)&&(r.type===0?r.value.isEqual(t.value):r.type!==1||r.data.isEqual(t.data)&&r.fieldMask.isEqual(t.fieldMask))}var Ne=class extends jn{constructor(t,e,n,i=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},$t=class extends jn{constructor(t,e,n,i,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function Qd(r){let t=new Map;return r.fieldMask.fields.forEach(e=>{if(!e.isEmpty()){let n=r.data.field(e);t.set(e,n)}}),t}function Dh(r,t,e){let n=new Map;U(r.length===e.length);for(let i=0;i<e.length;i++){let s=r[i],a=s.transform,u=t.data.field(s.field);n.set(s.field,Lg(a,u,e[i]))}return n}function Ph(r,t,e){let n=new Map;for(let i of r){let s=i.transform,a=e.data.field(i.field);n.set(i.field,Og(s,a,t))}return n}var ke=class extends jn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},ti=class extends jn{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var ei=class{constructor(t,e,n,i){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(t,e){let n=e.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(t.key)&&Bg(s,t,n[i])}}applyToLocalView(t,e){for(let n of this.baseMutations)n.key.isEqual(t.key)&&(e=Kr(n,t,e,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(t.key)&&(e=Kr(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){let n=Ld();return this.mutations.forEach(i=>{let s=t.get(i.key),a=s.overlayedDocument,u=this.applyToLocalView(a,s.mutatedFields);u=e.has(i.key)?null:u;let l=$d(a,u);l!==null&&n.set(i.key,l),a.isValidDocument()||a.convertToNoDocument(B.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),K())}isEqual(t){return this.batchId===t.batchId&&On(this.mutations,t.mutations,(e,n)=>Sh(e,n))&&On(this.baseMutations,t.baseMutations,(e,n)=>Sh(e,n))}},Oa=class r{constructor(t,e,n,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=i}static from(t,e,n){U(t.mutations.length===n.length);let i=function(){return kg}(),s=t.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,n[a].version);return new r(t,e,n,i)}};var ni=class{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var La=class{constructor(t,e){this.count=t,this.unchangedNames=e}};var mt,W;function Hd(r){switch(r){default:return L();case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0}}function Wd(r){if(r===void 0)return lt("GRPC error has no .code"),S.UNKNOWN;switch(r){case mt.OK:return S.OK;case mt.CANCELLED:return S.CANCELLED;case mt.UNKNOWN:return S.UNKNOWN;case mt.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case mt.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case mt.INTERNAL:return S.INTERNAL;case mt.UNAVAILABLE:return S.UNAVAILABLE;case mt.UNAUTHENTICATED:return S.UNAUTHENTICATED;case mt.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case mt.NOT_FOUND:return S.NOT_FOUND;case mt.ALREADY_EXISTS:return S.ALREADY_EXISTS;case mt.PERMISSION_DENIED:return S.PERMISSION_DENIED;case mt.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case mt.ABORTED:return S.ABORTED;case mt.OUT_OF_RANGE:return S.OUT_OF_RANGE;case mt.UNIMPLEMENTED:return S.UNIMPLEMENTED;case mt.DATA_LOSS:return S.DATA_LOSS;default:return L()}}(W=mt||(mt={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";var Rh=null;function Jd(){return new TextEncoder}var Gg=new Ee([4294967295,4294967295],0);function xh(r){let t=Jd().encode(r),e=new Zo;return e.update(t),new Uint8Array(e.digest())}function Nh(r){let t=new DataView(r.buffer),e=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new Ee([e,n],0),new Ee([i,s],0)]}var Ua=class r{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new tn(`Invalid padding: ${e}`);if(n<0)throw new tn(`Invalid hash count: ${n}`);if(t.length>0&&this.hashCount===0)throw new tn(`Invalid hash count: ${n}`);if(t.length===0&&e!==0)throw new tn(`Invalid padding when bitmap length is 0: ${e}`);this.Ie=8*t.length-e,this.Te=Ee.fromNumber(this.Ie)}Ee(t,e,n){let i=t.add(e.multiply(Ee.fromNumber(n)));return i.compare(Gg)===1&&(i=new Ee([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(t){return(this.bitmap[Math.floor(t/8)]&1<<t%8)!=0}mightContain(t){if(this.Ie===0)return!1;let e=xh(t),[n,i]=Nh(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);if(!this.de(a))return!1}return!0}static create(t,e,n){let i=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),a=new r(s,i,e);return n.forEach(u=>a.insert(u)),a}insert(t){if(this.Ie===0)return;let e=xh(t),[n,i]=Nh(e);for(let s=0;s<this.hashCount;s++){let a=this.Ee(n,i,s);this.Ae(a)}}Ae(t){let e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}},tn=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var ri=class r{constructor(t,e,n,i,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){let i=new Map;return i.set(t,ii.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new r(B.min(),i,new it(z),Ot(),K())}},ii=class r{constructor(t,e,n,i,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new r(n,e,K(),K(),K())}};var Mn=class{constructor(t,e,n,i){this.Re=t,this.removedTargetIds=e,this.key=n,this.Ve=i}},_s=class{constructor(t,e){this.targetId=t,this.me=e}},vs=class{constructor(t,e,n=Et.EMPTY_BYTE_STRING,i=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=i}},ws=class{constructor(){this.fe=0,this.ge=Mh(),this.pe=Et.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(t){t.approximateByteSize()>0&&(this.we=!0,this.pe=t)}Ce(){let t=K(),e=K(),n=K();return this.ge.forEach((i,s)=>{switch(s){case 0:t=t.add(i);break;case 2:e=e.add(i);break;case 1:n=n.add(i);break;default:L()}}),new ii(this.pe,this.ye,t,e,n)}ve(){this.we=!1,this.ge=Mh()}Fe(t,e){this.we=!0,this.ge=this.ge.insert(t,e)}Me(t){this.we=!0,this.ge=this.ge.remove(t)}xe(){this.fe+=1}Oe(){this.fe-=1,U(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}},Ba=class{constructor(t){this.Le=t,this.Be=new Map,this.ke=Ot(),this.qe=kh(),this.Qe=new it(z)}Ke(t){for(let e of t.Re)t.Ve&&t.Ve.isFoundDocument()?this.$e(e,t.Ve):this.Ue(e,t.key,t.Ve);for(let e of t.removedTargetIds)this.Ue(e,t.key,t.Ve)}We(t){this.forEachTarget(t,e=>{let n=this.Ge(e);switch(t.state){case 0:this.ze(e)&&n.De(t.resumeToken);break;case 1:n.Oe(),n.Se||n.ve(),n.De(t.resumeToken);break;case 2:n.Oe(),n.Se||this.removeTarget(e);break;case 3:this.ze(e)&&(n.Ne(),n.De(t.resumeToken));break;case 4:this.ze(e)&&(this.je(e),n.De(t.resumeToken));break;default:L()}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Be.forEach((n,i)=>{this.ze(i)&&e(i)})}He(t){let e=t.targetId,n=t.me.count,i=this.Je(e);if(i){let s=i.target;if(gs(s))if(n===0){let a=new O(s.path);this.Ue(e,a,_t.newNoDocument(a,B.min()))}else U(n===1);else{let a=this.Ye(e);if(a!==n){let u=this.Ze(t),l=u?this.Xe(u,t,a):1;if(l!==0){this.je(e);let d=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(e,d)}Rh?.et(function(f,g,v,C,N){var k,x,G,j,q,H;let Z={localCacheCount:f,existenceFilterCount:g.count,databaseId:v.database,projectId:v.projectId},$=g.unchangedNames;return $&&(Z.bloomFilter={applied:N===0,hashCount:(k=$?.hashCount)!==null&&k!==void 0?k:0,bitmapLength:(j=(G=(x=$?.bits)===null||x===void 0?void 0:x.bitmap)===null||G===void 0?void 0:G.length)!==null&&j!==void 0?j:0,padding:(H=(q=$?.bits)===null||q===void 0?void 0:q.padding)!==null&&H!==void 0?H:0,mightContain:w=>{var p;return(p=C?.mightContain(w))!==null&&p!==void 0&&p}}),Z}(a,t.me,this.Le.tt(),u,l))}}}}Ze(t){let e=t.me.unchangedNames;if(!e||!e.bits)return null;let{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=e,a,u;try{a=De(n).toUint8Array()}catch(l){if(l instanceof ds)return ee("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{u=new Ua(a,i,s)}catch(l){return ee(l instanceof tn?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return u.Ie===0?null:u}Xe(t,e,n){return e.me.count===n-this.nt(t,e.targetId)?0:2}nt(t,e){let n=this.Le.getRemoteKeysForTarget(e),i=0;return n.forEach(s=>{let a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;t.mightContain(u)||(this.Ue(e,s,null),i++)}),i}rt(t){let e=new Map;this.Be.forEach((s,a)=>{let u=this.Je(a);if(u){if(s.current&&gs(u.target)){let l=new O(u.target.path);this.ke.get(l)!==null||this.it(a,l)||this.Ue(a,l,_t.newNoDocument(l,t))}s.be&&(e.set(a,s.Ce()),s.ve())}});let n=K();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(l=>{let d=this.Je(l);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(n=n.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(t));let i=new ri(t,e,this.Qe,this.ke,n);return this.ke=Ot(),this.qe=kh(),this.Qe=new it(z),i}$e(t,e){if(!this.ze(t))return;let n=this.it(t,e.key)?2:0;this.Ge(t).Fe(e.key,n),this.ke=this.ke.insert(e.key,e),this.qe=this.qe.insert(e.key,this.st(e.key).add(t))}Ue(t,e,n){if(!this.ze(t))return;let i=this.Ge(t);this.it(t,e)?i.Fe(e,1):i.Me(e),this.qe=this.qe.insert(e,this.st(e).delete(t)),n&&(this.ke=this.ke.insert(e,n))}removeTarget(t){this.Be.delete(t)}Ye(t){let e=this.Ge(t).Ce();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}xe(t){this.Ge(t).xe()}Ge(t){let e=this.Be.get(t);return e||(e=new ws,this.Be.set(t,e)),e}st(t){let e=this.qe.get(t);return e||(e=new nt(z),this.qe=this.qe.insert(t,e)),e}ze(t){let e=this.Je(t)!==null;return e||P("WatchChangeAggregator","Detected inactive target",t),e}Je(t){let e=this.Be.get(t);return e&&e.Se?null:this.Le.ot(t)}je(t){this.Be.set(t,new ws),this.Le.getRemoteKeysForTarget(t).forEach(e=>{this.Ue(t,e,null)})}it(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}};function kh(){return new it(O.comparator)}function Mh(){return new it(O.comparator)}var jg={asc:"ASCENDING",desc:"DESCENDING"},zg={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Kg={and:"AND",or:"OR"},qa=class{constructor(t,e){this.databaseId=t,this.useProto3Json=e}};function Ga(r,t){return r.useProto3Json||yi(t)?t:{value:t}}function zn(r,t){return r.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Yd(r,t){return r.useProto3Json?t.toBase64():t.toUint8Array()}function $g(r,t){return zn(r,t.toTimestamp())}function dt(r){return U(!!r),B.fromTimestamp(function(e){let n=he(e);return new ht(n.seconds,n.nanos)}(r))}function gc(r,t){return ja(r,t).canonicalString()}function ja(r,t){let e=function(i){return new J(["projects",i.projectId,"databases",i.database])}(r).child("documents");return t===void 0?e:e.child(t)}function Xd(r){let t=J.fromString(r);return U(cf(t)),t}function si(r,t){return gc(r.databaseId,t.path)}function Zt(r,t){let e=Xd(t);if(e.get(1)!==r.databaseId.projectId)throw new R(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+r.databaseId.projectId);if(e.get(3)!==r.databaseId.database)throw new R(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+r.databaseId.database);return new O(ef(e))}function Zd(r,t){return gc(r.databaseId,t)}function tf(r){let t=Xd(r);return t.length===4?J.emptyPath():ef(t)}function za(r){return new J(["projects",r.databaseId.projectId,"databases",r.databaseId.database]).canonicalString()}function ef(r){return U(r.length>4&&r.get(4)==="documents"),r.popFirst(5)}function Fh(r,t,e){return{name:si(r,t),fields:e.value.mapValue.fields}}function nf(r,t,e){let n=Zt(r,t.name),i=dt(t.updateTime),s=t.createTime?dt(t.createTime):B.min(),a=new Rt({mapValue:{fields:t.fields}}),u=_t.newFoundDocument(n,i,s,a);return e&&u.setHasCommittedMutations(),e?u.setHasCommittedMutations():u}function Qg(r,t){return"found"in t?function(n,i){U(!!i.found),i.found.name,i.found.updateTime;let s=Zt(n,i.found.name),a=dt(i.found.updateTime),u=i.found.createTime?dt(i.found.createTime):B.min(),l=new Rt({mapValue:{fields:i.found.fields}});return _t.newFoundDocument(s,a,u,l)}(r,t):"missing"in t?function(n,i){U(!!i.missing),U(!!i.readTime);let s=Zt(n,i.missing),a=dt(i.readTime);return _t.newNoDocument(s,a)}(r,t):L()}function Hg(r,t){let e;if("targetChange"in t){t.targetChange;let n=function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(d,f){return d.useProto3Json?(U(f===void 0||typeof f=="string"),Et.fromBase64String(f||"")):(U(f===void 0||f instanceof Buffer||f instanceof Uint8Array),Et.fromUint8Array(f||new Uint8Array))}(r,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&function(d){let f=d.code===void 0?S.UNKNOWN:Wd(d.code);return new R(f,d.message||"")}(a);e=new vs(n,i,s,u||null)}else if("documentChange"in t){t.documentChange;let n=t.documentChange;n.document,n.document.name,n.document.updateTime;let i=Zt(r,n.document.name),s=dt(n.document.updateTime),a=n.document.createTime?dt(n.document.createTime):B.min(),u=new Rt({mapValue:{fields:n.document.fields}}),l=_t.newFoundDocument(i,s,a,u),d=n.targetIds||[],f=n.removedTargetIds||[];e=new Mn(d,f,l.key,l)}else if("documentDelete"in t){t.documentDelete;let n=t.documentDelete;n.document;let i=Zt(r,n.document),s=n.readTime?dt(n.readTime):B.min(),a=_t.newNoDocument(i,s),u=n.removedTargetIds||[];e=new Mn([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;let n=t.documentRemove;n.document;let i=Zt(r,n.document),s=n.removedTargetIds||[];e=new Mn([],s,i,null)}else{if(!("filter"in t))return L();{t.filter;let n=t.filter;n.targetId;let{count:i=0,unchangedNames:s}=n,a=new La(i,s),u=n.targetId;e=new _s(u,a)}}return e}function oi(r,t){let e;if(t instanceof Ne)e={update:Fh(r,t.key,t.value)};else if(t instanceof ke)e={delete:si(r,t.key)};else if(t instanceof $t)e={update:Fh(r,t.key,t.data),updateMask:tp(t.fieldMask)};else{if(!(t instanceof ti))return L();e={verify:si(r,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map(n=>function(s,a){let u=a.transform;if(u instanceof Re)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof de)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof fe)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof xe)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw L()}(0,n))),t.precondition.isNone||(e.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:$g(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:L()}(r,t.precondition)),e}function Ka(r,t){let e=t.currentDocument?function(s){return s.updateTime!==void 0?ct.updateTime(dt(s.updateTime)):s.exists!==void 0?ct.exists(s.exists):ct.none()}(t.currentDocument):ct.none(),n=t.updateTransforms?t.updateTransforms.map(i=>function(a,u){let l=null;if("setToServerValue"in u)U(u.setToServerValue==="REQUEST_TIME"),l=new Re;else if("appendMissingElements"in u){let f=u.appendMissingElements.values||[];l=new de(f)}else if("removeAllFromArray"in u){let f=u.removeAllFromArray.values||[];l=new fe(f)}else"increment"in u?l=new xe(a,u.increment):L();let d=wt.fromServerFormat(u.fieldPath);return new an(d,l)}(r,i)):[];if(t.update){t.update.name;let i=Zt(r,t.update.name),s=new Rt({mapValue:{fields:t.update.fields}});if(t.updateMask){let a=function(l){let d=l.fieldPaths||[];return new Bt(d.map(f=>wt.fromServerFormat(f)))}(t.updateMask);return new $t(i,s,a,e,n)}return new Ne(i,s,e,n)}if(t.delete){let i=Zt(r,t.delete);return new ke(i,e)}if(t.verify){let i=Zt(r,t.verify);return new ti(i,e)}return L()}function Wg(r,t){return r&&r.length>0?(U(t!==void 0),r.map(e=>function(i,s){let a=i.updateTime?dt(i.updateTime):dt(s);return a.isEqual(B.min())&&(a=dt(s)),new Fa(a,i.transformResults||[])}(e,t))):[]}function rf(r,t){return{documents:[Zd(r,t.path)]}}function sf(r,t){let e={structuredQuery:{}},n=t.path,i;t.collectionGroup!==null?(i=n,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),e.structuredQuery.from=[{collectionId:n.lastSegment()}]),e.parent=Zd(r,i);let s=function(d){if(d.length!==0)return uf(tt.create(d,"and"))}(t.filters);s&&(e.structuredQuery.where=s);let a=function(d){if(d.length!==0)return d.map(f=>function(v){return{field:Dn(v.field),direction:Yg(v.dir)}}(f))}(t.orderBy);a&&(e.structuredQuery.orderBy=a);let u=Ga(r,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=function(d){return{before:d.inclusive,values:d.position}}(t.startAt)),t.endAt&&(e.structuredQuery.endAt=function(d){return{before:!d.inclusive,values:d.position}}(t.endAt)),{_t:e,parent:i}}function of(r){let t=tf(r.parent),e=r.structuredQuery,n=e.from?e.from.length:0,i=null;if(n>0){U(n===1);let f=e.from[0];f.allDescendants?i=f.collectionId:t=t.child(f.collectionId)}let s=[];e.where&&(s=function(g){let v=af(g);return v instanceof tt&&dc(v)?v.getFilters():[v]}(e.where));let a=[];e.orderBy&&(a=function(g){return g.map(v=>function(N){return new sn(Pn(N.field),function(x){switch(x){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(N.direction))}(v))}(e.orderBy));let u=null;e.limit&&(u=function(g){let v;return v=typeof g=="object"?g.value:g,yi(v)?null:v}(e.limit));let l=null;e.startAt&&(l=function(g){let v=!!g.before,C=g.values||[];return new re(C,v)}(e.startAt));let d=null;return e.endAt&&(d=function(g){let v=!g.before,C=g.values||[];return new re(C,v)}(e.endAt)),xd(t,i,a,s,u,"F",l,d)}function Jg(r,t){let e=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}(t.purpose);return e==null?null:{"goog-listen-tags":e}}function af(r){return r.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":let n=Pn(e.unaryFilter.field);return Q.create(n,"==",{doubleValue:NaN});case"IS_NULL":let i=Pn(e.unaryFilter.field);return Q.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=Pn(e.unaryFilter.field);return Q.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let a=Pn(e.unaryFilter.field);return Q.create(a,"!=",{nullValue:"NULL_VALUE"});default:return L()}}(r):r.fieldFilter!==void 0?function(e){return Q.create(Pn(e.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(e.fieldFilter.op),e.fieldFilter.value)}(r):r.compositeFilter!==void 0?function(e){return tt.create(e.compositeFilter.filters.map(n=>af(n)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return L()}}(e.compositeFilter.op))}(r):L()}function Yg(r){return jg[r]}function Xg(r){return zg[r]}function Zg(r){return Kg[r]}function Dn(r){return{fieldPath:r.canonicalString()}}function Pn(r){return wt.fromServerFormat(r.fieldPath)}function uf(r){return r instanceof Q?function(e){if(e.op==="=="){if(vh(e.value))return{unaryFilter:{field:Dn(e.field),op:"IS_NAN"}};if(_h(e.value))return{unaryFilter:{field:Dn(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(vh(e.value))return{unaryFilter:{field:Dn(e.field),op:"IS_NOT_NAN"}};if(_h(e.value))return{unaryFilter:{field:Dn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Dn(e.field),op:Xg(e.op),value:e.value}}}(r):r instanceof tt?function(e){let n=e.getFilters().map(i=>uf(i));return n.length===1?n[0]:{compositeFilter:{op:Zg(e.op),filters:n}}}(r):L()}function tp(r){let t=[];return r.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function cf(r){return r.length>=4&&r.get(0)==="projects"&&r.get(2)==="databases"}var Kn=class r{constructor(t,e,n,i,s=B.min(),a=B.min(),u=Et.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=l}withSequenceNumber(t){return new r(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new r(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}};var Es=class{constructor(t){this.ct=t}};function ep(r,t){let e;if(t.document)e=nf(r.ct,t.document,!!t.hasCommittedMutations);else if(t.noDocument){let n=O.fromSegments(t.noDocument.path),i=cn(t.noDocument.readTime);e=_t.newNoDocument(n,i),t.hasCommittedMutations&&e.setHasCommittedMutations()}else{if(!t.unknownDocument)return L();{let n=O.fromSegments(t.unknownDocument.path),i=cn(t.unknownDocument.version);e=_t.newUnknownDocument(n,i)}}return t.readTime&&e.setReadTime(function(i){let s=new ht(i[0],i[1]);return B.fromTimestamp(s)}(t.readTime)),e}function Oh(r,t){let e=t.key,n={prefixPath:e.getCollectionPath().popLast().toArray(),collectionGroup:e.collectionGroup,documentId:e.path.lastSegment(),readTime:Is(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())n.document=function(s,a){return{name:si(s,a.key),fields:a.data.value.mapValue.fields,updateTime:zn(s,a.version.toTimestamp()),createTime:zn(s,a.createTime.toTimestamp())}}(r.ct,t);else if(t.isNoDocument())n.noDocument={path:e.path.toArray(),readTime:un(t.version)};else{if(!t.isUnknownDocument())return L();n.unknownDocument={path:e.path.toArray(),version:un(t.version)}}return n}function Is(r){let t=r.toTimestamp();return[t.seconds,t.nanoseconds]}function un(r){let t=r.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function cn(r){let t=new ht(r.seconds,r.nanoseconds);return B.fromTimestamp(t)}function Ye(r,t){let e=(t.baseMutations||[]).map(s=>Ka(r.ct,s));for(let s=0;s<t.mutations.length-1;++s){let a=t.mutations[s];if(s+1<t.mutations.length&&t.mutations[s+1].transform!==void 0){let u=t.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,t.mutations.splice(s+1,1),++s}}let n=t.mutations.map(s=>Ka(r.ct,s)),i=ht.fromMillis(t.localWriteTimeMs);return new ei(t.batchId,i,e,n)}function Gr(r){let t=cn(r.readTime),e=r.lastLimboFreeSnapshotVersion!==void 0?cn(r.lastLimboFreeSnapshotVersion):B.min(),n;return n=function(s){return s.documents!==void 0}(r.query)?function(s){return U(s.documents.length===1),Mt(nr(tf(s.documents[0])))}(r.query):function(s){return Mt(of(s))}(r.query),new Kn(n,r.targetId,"TargetPurposeListen",r.lastListenSequenceNumber,t,e,Et.fromBase64String(r.resumeToken))}function lf(r,t){let e=un(t.snapshotVersion),n=un(t.lastLimboFreeSnapshotVersion),i;i=gs(t.target)?rf(r.ct,t.target):sf(r.ct,t.target)._t;let s=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:on(t.target),readTime:e,resumeToken:s,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:n,query:i}}function pc(r){let t=of({parent:r.parent,structuredQuery:r.structuredQuery});return r.limitType==="LAST"?ys(t,t.limit,"L"):t}function oa(r,t){return new ni(t.largestBatchId,Ka(r.ct,t.overlayMutation))}function Lh(r,t){let e=t.path.lastSegment();return[r,kt(t.path.popLast()),e]}function Uh(r,t,e,n){return{indexId:r,uid:t,sequenceNumber:e,readTime:un(n.readTime),documentKey:kt(n.documentKey.path),largestBatchId:n.largestBatchId}}var $a=class{getBundleMetadata(t,e){return Bh(t).get(e).next(n=>{if(n)return function(s){return{id:s.bundleId,createTime:cn(s.createTime),version:s.version}}(n)})}saveBundleMetadata(t,e){return Bh(t).put(function(i){return{bundleId:i.id,createTime:un(dt(i.createTime)),version:i.version}}(e))}getNamedQuery(t,e){return qh(t).get(e).next(n=>{if(n)return function(s){return{name:s.name,query:pc(s.bundledQuery),readTime:cn(s.readTime)}}(n)})}saveNamedQuery(t,e){return qh(t).put(function(i){return{name:i.name,readTime:un(dt(i.readTime)),bundledQuery:i.bundledQuery}}(e))}};function Bh(r){return It(r,"bundles")}function qh(r){return It(r,"namedQueries")}var Ts=class r{constructor(t,e){this.serializer=t,this.userId=e}static lt(t,e){let n=e.uid||"";return new r(t,n)}getOverlay(t,e){return Or(t).get(Lh(this.userId,e)).next(n=>n?oa(this.serializer,n):null)}getOverlays(t,e){let n=Yt();return b.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){let i=[];return n.forEach((s,a)=>{let u=new ni(e,a);i.push(this.ht(t,u))}),b.waitFor(i)}removeOverlaysForBatchId(t,e,n){let i=new Set;e.forEach(a=>i.add(kt(a.getCollectionPath())));let s=[];return i.forEach(a=>{let u=IDBKeyRange.bound([this.userId,a,n],[this.userId,a,n+1],!1,!0);s.push(Or(t).j("collectionPathOverlayIndex",u))}),b.waitFor(s)}getOverlaysForCollection(t,e,n){let i=Yt(),s=kt(e),a=IDBKeyRange.bound([this.userId,s,n],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Or(t).U("collectionPathOverlayIndex",a).next(u=>{for(let l of u){let d=oa(this.serializer,l);i.set(d.getKey(),d)}return i})}getOverlaysForCollectionGroup(t,e,n,i){let s=Yt(),a,u=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return Or(t).J({index:"collectionGroupOverlayIndex",range:u},(l,d,f)=>{let g=oa(this.serializer,d);s.size()<i||g.largestBatchId===a?(s.set(g.getKey(),g),a=g.largestBatchId):f.done()}).next(()=>s)}ht(t,e){return Or(t).put(function(i,s,a){let[u,l,d]=Lh(s,a.mutation.key);return{userId:s,collectionPath:l,documentId:d,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:oi(i.ct,a.mutation)}}(this.serializer,this.userId,e))}};function Or(r){return It(r,"documentOverlays")}var ce=class{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(ut(t.integerValue));else if("doubleValue"in t){let n=ut(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),Wr(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Et(e,20),typeof n=="string"&&(n=he(n)),e.At(`${n.seconds||""}`),e.dt(n.nanos||0)}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(De(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){let n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?bd(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):L()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){let n=t.fields||{};this.Et(e,55);for(let i of Object.keys(n))this.Rt(i,e),this.It(n[i],e)}wt(t,e){let n=t.values||[];this.Et(e,50);for(let i of n)this.It(i,e)}gt(t,e){this.Et(e,37),O.fromName(t).path.forEach(n=>{this.Et(e,60),this.St(n,e)})}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}};ce.bt=new ce;function np(r){if(r===0)return 8;let t=0;return!(r>>4)&&(t+=4,r<<=4),!(r>>6)&&(t+=2,r<<=2),!(r>>7)&&(t+=1),t}function Gh(r){let t=64-function(n){let i=0;for(let s=0;s<8;++s){let a=np(255&n[s]);if(i+=a,a!==8)break}return i}(r);return Math.ceil(t/8)}var Qa=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Ct(n.value),n=e.next();this.vt()}Ft(t){let e=t[Symbol.iterator](),n=e.next();for(;!n.done;)this.Mt(n.value),n=e.next();this.xt()}Ot(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Ct(n);else if(n<2048)this.Ct(960|n>>>6),this.Ct(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Ct(480|n>>>12),this.Ct(128|63&n>>>6),this.Ct(128|63&n);else{let i=e.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(t){for(let e of t){let n=e.charCodeAt(0);if(n<128)this.Mt(n);else if(n<2048)this.Mt(960|n>>>6),this.Mt(128|63&n);else if(e<"\uD800"||"\uDBFF"<e)this.Mt(480|n>>>12),this.Mt(128|63&n>>>6),this.Mt(128|63&n);else{let i=e.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(t){let e=this.Bt(t),n=Gh(e);this.kt(1+n),this.buffer[this.position++]=255&n;for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=255&e[i]}qt(t){let e=this.Bt(t),n=Gh(e);this.kt(1+n),this.buffer[this.position++]=~(255&n);for(let i=e.length-n;i<e.length;++i)this.buffer[this.position++]=~(255&e[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(t){this.kt(t.length),this.buffer.set(t,this.position),this.position+=t.length}Wt(){return this.buffer.slice(0,this.position)}Bt(t){let e=function(s){let a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(t),n=(128&e[0])!=0;e[0]^=n?255:128;for(let i=1;i<e.length;++i)e[i]^=n?255:0;return e}Ct(t){let e=255&t;e===0?(this.Kt(0),this.Kt(255)):e===255?(this.Kt(255),this.Kt(0)):this.Kt(e)}Mt(t){let e=255&t;e===0?(this.Ut(0),this.Ut(255)):e===255?(this.Ut(255),this.Ut(0)):this.Ut(t)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(t){this.kt(1),this.buffer[this.position++]=t}Ut(t){this.kt(1),this.buffer[this.position++]=~t}kt(t){let e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);let i=new Uint8Array(n);i.set(this.buffer),this.buffer=i}},Ha=class{constructor(t){this.Gt=t}ft(t){this.Gt.Dt(t)}At(t){this.Gt.Ot(t)}dt(t){this.Gt.Lt(t)}Tt(){this.Gt.Qt()}},Wa=class{constructor(t){this.Gt=t}ft(t){this.Gt.Ft(t)}At(t){this.Gt.Nt(t)}dt(t){this.Gt.qt(t)}Tt(){this.Gt.$t()}},Xe=class{constructor(){this.Gt=new Qa,this.zt=new Ha(this.Gt),this.jt=new Wa(this.Gt)}seed(t){this.Gt.seed(t)}Ht(t){return t===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var Ze=class r{constructor(t,e,n,i){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=i}Jt(){let t=this.directionalValue.length,e=t===0||this.directionalValue[t-1]===255?t+1:t,n=new Uint8Array(e);return n.set(this.directionalValue,0),e!==t?n.set([0],this.directionalValue.length):++n[n.length-1],new r(this.indexId,this.documentKey,this.arrayValue,n)}};function Ie(r,t){let e=r.indexId-t.indexId;return e!==0?e:(e=jh(r.arrayValue,t.arrayValue),e!==0?e:(e=jh(r.directionalValue,t.directionalValue),e!==0?e:O.comparator(r.documentKey,t.documentKey)))}function jh(r,t){for(let e=0;e<r.length&&e<t.length;++e){let n=r[e]-t[e];if(n!==0)return n}return r.length-t.length}var As=class{constructor(t){this.Yt=new nt((e,n)=>wt.comparator(e.field,n.field)),this.collectionId=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment(),this.Zt=t.orderBy,this.Xt=[];for(let e of t.filters){let n=e;n.isInequality()?this.Yt=this.Yt.add(n):this.Xt.push(n)}}get en(){return this.Yt.size>1}tn(t){if(U(t.collectionGroup===this.collectionId),this.en)return!1;let e=ya(t);if(e!==void 0&&!this.nn(e))return!1;let n=We(t),i=new Set,s=0,a=0;for(;s<n.length&&this.nn(n[s]);++s)i=i.add(n[s].fieldPath.canonicalString());if(s===n.length)return!0;if(this.Yt.size>0){let u=this.Yt.getIterator().getNext();if(!i.has(u.field.canonicalString())){let l=n[s];if(!this.rn(u,l)||!this.sn(this.Zt[a++],l))return!1}++s}for(;s<n.length;++s){let u=n[s];if(a>=this.Zt.length||!this.sn(this.Zt[a++],u))return!1}return!0}on(){if(this.en)return null;let t=new nt(wt.comparator),e=[];for(let n of this.Xt)if(!n.field.isKeyField())if(n.op==="array-contains"||n.op==="array-contains-any")e.push(new Nn(n.field,2));else{if(t.has(n.field))continue;t=t.add(n.field),e.push(new Nn(n.field,0))}for(let n of this.Zt)n.field.isKeyField()||t.has(n.field)||(t=t.add(n.field),e.push(new Nn(n.field,n.dir==="asc"?0:1)));return new Ln(Ln.UNKNOWN_ID,this.collectionId,e,Hr.empty())}nn(t){for(let e of this.Xt)if(this.rn(e,t))return!0;return!1}rn(t,e){if(t===void 0||!t.field.isEqual(e.fieldPath))return!1;let n=t.op==="array-contains"||t.op==="array-contains-any";return e.kind===2===n}sn(t,e){return!!t.field.isEqual(e.fieldPath)&&(e.kind===0&&t.dir==="asc"||e.kind===1&&t.dir==="desc")}};function hf(r){var t,e;if(U(r instanceof Q||r instanceof tt),r instanceof Q){if(r instanceof ms){let i=((e=(t=r.value.arrayValue)===null||t===void 0?void 0:t.values)===null||e===void 0?void 0:e.map(s=>Q.create(r.field,"==",s)))||[];return tt.create(i,"or")}return r}let n=r.filters.map(i=>hf(i));return tt.create(n,r.op)}function rp(r){if(r.getFilters().length===0)return[];let t=Xa(hf(r));return U(df(t)),Ja(t)||Ya(t)?[t]:t.getFilters()}function Ja(r){return r instanceof Q}function Ya(r){return r instanceof tt&&dc(r)}function df(r){return Ja(r)||Ya(r)||function(e){if(e instanceof tt&&ba(e)){for(let n of e.getFilters())if(!Ja(n)&&!Ya(n))return!1;return!0}return!1}(r)}function Xa(r){if(U(r instanceof Q||r instanceof tt),r instanceof Q)return r;if(r.filters.length===1)return Xa(r.filters[0]);let t=r.filters.map(n=>Xa(n)),e=tt.create(t,r.op);return e=bs(e),df(e)?e:(U(e instanceof tt),U(qn(e)),U(e.filters.length>1),e.filters.reduce((n,i)=>yc(n,i)))}function yc(r,t){let e;return U(r instanceof Q||r instanceof tt),U(t instanceof Q||t instanceof tt),e=r instanceof Q?t instanceof Q?function(i,s){return tt.create([i,s],"and")}(r,t):zh(r,t):t instanceof Q?zh(t,r):function(i,s){if(U(i.filters.length>0&&s.filters.length>0),qn(i)&&qn(s))return Dd(i,s.getFilters());let a=ba(i)?i:s,u=ba(i)?s:i,l=a.filters.map(d=>yc(d,u));return tt.create(l,"or")}(r,t),bs(e)}function zh(r,t){if(qn(t))return Dd(t,r.getFilters());{let e=t.filters.map(n=>yc(r,n));return tt.create(e,"or")}}function bs(r){if(U(r instanceof Q||r instanceof tt),r instanceof Q)return r;let t=r.getFilters();if(t.length===1)return bs(t[0]);if(Vd(r))return r;let e=t.map(i=>bs(i)),n=[];return e.forEach(i=>{i instanceof Q?n.push(i):i instanceof tt&&(i.op===r.op?n.push(...i.filters):n.push(i))}),n.length===1?n[0]:tt.create(n,r.op)}var Za=class{constructor(){this._n=new ai}addToCollectionParentIndex(t,e){return this._n.add(e),b.resolve()}getCollectionParents(t,e){return b.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return b.resolve()}deleteFieldIndex(t,e){return b.resolve()}deleteAllFieldIndexes(t){return b.resolve()}createTargetIndexes(t,e){return b.resolve()}getDocumentsMatchingTarget(t,e){return b.resolve(null)}getIndexType(t,e){return b.resolve(0)}getFieldIndexes(t,e){return b.resolve([])}getNextCollectionGroupToUpdate(t){return b.resolve(null)}getMinOffset(t,e){return b.resolve(jt.min())}getMinOffsetFromCollectionGroup(t,e){return b.resolve(jt.min())}updateCollectionGroup(t,e,n){return b.resolve()}updateIndexEntries(t,e){return b.resolve()}},ai=class{constructor(){this.index={}}add(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e]||new nt(J.comparator),s=!i.has(n);return this.index[e]=i.add(n),s}has(t){let e=t.lastSegment(),n=t.popLast(),i=this.index[e];return i&&i.has(n)}getEntries(t){return(this.index[t]||new nt(J.comparator)).toArray()}};var Ji=new Uint8Array(0),tu=class{constructor(t,e){this.databaseId=e,this.an=new ai,this.un=new ie(n=>on(n),(n,i)=>_i(n,i)),this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.an.has(e)){let n=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(()=>{this.an.add(e)});let s={collectionId:n,parent:kt(i)};return Kh(t).put(s)}return b.resolve()}getCollectionParents(t,e){let n=[],i=IDBKeyRange.bound([e,""],[fd(e),""],!1,!0);return Kh(t).U(i).next(s=>{for(let a of s){if(a.collectionId!==e)break;n.push(Jt(a.parent))}return n})}addFieldIndex(t,e){let n=Lr(t),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(l=>[l.fieldPath.canonicalString(),l.kind])}}(e);delete i.indexId;let s=n.add(i);if(e.indexState){let a=bn(t);return s.next(u=>{a.put(Uh(u,this.uid,e.indexState.sequenceNumber,e.indexState.offset))})}return s.next()}deleteFieldIndex(t,e){let n=Lr(t),i=bn(t),s=An(t);return n.delete(e.indexId).next(()=>i.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))}deleteAllFieldIndexes(t){let e=Lr(t),n=An(t),i=bn(t);return e.j().next(()=>n.j()).next(()=>i.j())}createTargetIndexes(t,e){return b.forEach(this.cn(e),n=>this.getIndexType(t,n).next(i=>{if(i===0||i===1){let s=new As(n).on();if(s!=null)return this.addFieldIndex(t,s)}}))}getDocumentsMatchingTarget(t,e){let n=An(t),i=!0,s=new Map;return b.forEach(this.cn(e),a=>this.ln(t,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=K(),u=[];return b.forEach(s,(l,d)=>{P("IndexedDbIndexManager",`Using index ${function(q){return`id=${q.indexId}|cg=${q.collectionGroup}|f=${q.fields.map(H=>`${H.fieldPath}:${H.kind}`).join(",")}`}(l)} to execute ${on(e)}`);let f=function(q,H){let Z=ya(H);if(Z===void 0)return null;for(let $ of ps(q,Z.fieldPath))switch($.op){case"array-contains-any":return $.value.arrayValue.values||[];case"array-contains":return[$.value]}return null}(d,l),g=function(q,H){let Z=new Map;for(let $ of We(H))for(let w of ps(q,$.fieldPath))switch(w.op){case"==":case"in":Z.set($.fieldPath.canonicalString(),w.value);break;case"not-in":case"!=":return Z.set($.fieldPath.canonicalString(),w.value),Array.from(Z.values())}return null}(d,l),v=function(q,H){let Z=[],$=!0;for(let w of We(H)){let p=w.kind===0?Ah(q,w.fieldPath,q.startAt):bh(q,w.fieldPath,q.startAt);Z.push(p.value),$&&($=p.inclusive)}return new re(Z,$)}(d,l),C=function(q,H){let Z=[],$=!0;for(let w of We(H)){let p=w.kind===0?bh(q,w.fieldPath,q.endAt):Ah(q,w.fieldPath,q.endAt);Z.push(p.value),$&&($=p.inclusive)}return new re(Z,$)}(d,l),N=this.hn(l,d,v),k=this.hn(l,d,C),x=this.Pn(l,d,g),G=this.In(l.indexId,f,N,v.inclusive,k,C.inclusive,x);return b.forEach(G,j=>n.G(j,e.limit).next(q=>{q.forEach(H=>{let Z=O.fromSegments(H.documentKey);a.has(Z)||(a=a.add(Z),u.push(Z))})}))}).next(()=>u)}return b.resolve(null)})}cn(t){let e=this.un.get(t);return e||(t.filters.length===0?e=[t]:e=rp(tt.create(t.filters,"and")).map(n=>ka(t.path,t.collectionGroup,t.orderBy,n.getFilters(),t.limit,t.startAt,t.endAt)),this.un.set(t,e),e)}In(t,e,n,i,s,a,u){let l=(e!=null?e.length:1)*Math.max(n.length,s.length),d=l/(e!=null?e.length:1),f=[];for(let g=0;g<l;++g){let v=e?this.Tn(e[g/d]):Ji,C=this.En(t,v,n[g%d],i),N=this.dn(t,v,s[g%d],a),k=u.map(x=>this.En(t,v,x,!0));f.push(...this.createRange(C,N,k))}return f}En(t,e,n,i){let s=new Ze(t,O.empty(),e,n);return i?s:s.Jt()}dn(t,e,n,i){let s=new Ze(t,O.empty(),e,n);return i?s.Jt():s}ln(t,e){let n=new As(e),i=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment();return this.getFieldIndexes(t,i).next(s=>{let a=null;for(let u of s)n.tn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(t,e){let n=2,i=this.cn(e);return b.forEach(i,s=>this.ln(t,s).next(a=>{a?n!==0&&a.fields.length<function(l){let d=new nt(wt.comparator),f=!1;for(let g of l.filters)for(let v of g.getFlattenedFilters())v.field.isKeyField()||(v.op==="array-contains"||v.op==="array-contains-any"?f=!0:d=d.add(v.field));for(let g of l.orderBy)g.field.isKeyField()||(d=d.add(g.field));return d.size+(f?1:0)}(s)&&(n=1):n=0})).next(()=>function(a){return a.limit!==null}(e)&&i.length>1&&n===2?1:n)}An(t,e){let n=new Xe;for(let i of We(t)){let s=e.data.field(i.fieldPath);if(s==null)return null;let a=n.Ht(i.kind);ce.bt.Pt(s,a)}return n.Wt()}Tn(t){let e=new Xe;return ce.bt.Pt(t,e.Ht(0)),e.Wt()}Rn(t,e){let n=new Xe;return ce.bt.Pt(rn(this.databaseId,e),n.Ht(function(s){let a=We(s);return a.length===0?0:a[a.length-1].kind}(t))),n.Wt()}Pn(t,e,n){if(n===null)return[];let i=[];i.push(new Xe);let s=0;for(let a of We(t)){let u=n[s++];for(let l of i)if(this.Vn(e,a.fieldPath)&&Zr(u))i=this.mn(i,a,u);else{let d=l.Ht(a.kind);ce.bt.Pt(u,d)}}return this.fn(i)}hn(t,e,n){return this.Pn(t,e,n.position)}fn(t){let e=[];for(let n=0;n<t.length;++n)e[n]=t[n].Wt();return e}mn(t,e,n){let i=[...t],s=[];for(let a of n.arrayValue.values||[])for(let u of i){let l=new Xe;l.seed(u.Wt()),ce.bt.Pt(a,l.Ht(e.kind)),s.push(l)}return s}Vn(t,e){return!!t.filters.find(n=>n instanceof Q&&n.field.isEqual(e)&&(n.op==="in"||n.op==="not-in"))}getFieldIndexes(t,e){let n=Lr(t),i=bn(t);return(e?n.U("collectionGroupIndex",IDBKeyRange.bound(e,e)):n.U()).next(s=>{let a=[];return b.forEach(s,u=>i.get([u.indexId,this.uid]).next(l=>{a.push(function(f,g){let v=g?new Hr(g.sequenceNumber,new jt(cn(g.readTime),new O(Jt(g.documentKey)),g.largestBatchId)):Hr.empty(),C=f.fields.map(([N,k])=>new Nn(wt.fromServerFormat(N),k));return new Ln(f.indexId,f.collectionGroup,C,v)}(u,l))})).next(()=>a)})}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next(e=>e.length===0?null:(e.sort((n,i)=>{let s=n.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:z(n.collectionGroup,i.collectionGroup)}),e[0].collectionGroup))}updateCollectionGroup(t,e,n){let i=Lr(t),s=bn(t);return this.gn(t).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(e,e)).next(u=>b.forEach(u,l=>s.put(Uh(l.indexId,this.uid,a,n)))))}updateIndexEntries(t,e){let n=new Map;return b.forEach(e,(i,s)=>{let a=n.get(i.collectionGroup);return(a?b.resolve(a):this.getFieldIndexes(t,i.collectionGroup)).next(u=>(n.set(i.collectionGroup,u),b.forEach(u,l=>this.pn(t,i,l).next(d=>{let f=this.yn(s,l);return d.isEqual(f)?b.resolve():this.wn(t,s,l,d,f)}))))})}Sn(t,e,n,i){return An(t).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(n,e.key),documentKey:e.key.path.toArray()})}bn(t,e,n,i){return An(t).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(n,e.key),e.key.path.toArray()])}pn(t,e,n){let i=An(t),s=new nt(Ie);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.Rn(n,e)])},(a,u)=>{s=s.add(new Ze(n.indexId,e,u.arrayValue,u.directionalValue))}).next(()=>s)}yn(t,e){let n=new nt(Ie),i=this.An(e,t);if(i==null)return n;let s=ya(e);if(s!=null){let a=t.data.field(s.fieldPath);if(Zr(a))for(let u of a.arrayValue.values||[])n=n.add(new Ze(e.indexId,t.key,this.Tn(u),i))}else n=n.add(new Ze(e.indexId,t.key,Ji,i));return n}wn(t,e,n,i,s){P("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);let a=[];return function(l,d,f,g,v){let C=l.getIterator(),N=d.getIterator(),k=Tn(C),x=Tn(N);for(;k||x;){let G=!1,j=!1;if(k&&x){let q=f(k,x);q<0?j=!0:q>0&&(G=!0)}else k!=null?j=!0:G=!0;G?(g(x),x=Tn(N)):j?(v(k),k=Tn(C)):(k=Tn(C),x=Tn(N))}}(i,s,Ie,u=>{a.push(this.Sn(t,e,n,u))},u=>{a.push(this.bn(t,e,n,u))}),b.waitFor(a)}gn(t){let e=1;return bn(t).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(n,i,s)=>{s.done(),e=i.sequenceNumber+1}).next(()=>e)}createRange(t,e,n){n=n.sort((a,u)=>Ie(a,u)).filter((a,u,l)=>!u||Ie(a,l[u-1])!==0);let i=[];i.push(t);for(let a of n){let u=Ie(a,t),l=Ie(a,e);if(u===0)i[0]=t.Jt();else if(u>0&&l<0)i.push(a),i.push(a.Jt());else if(l>0)break}i.push(e);let s=[];for(let a=0;a<i.length;a+=2){if(this.Dn(i[a],i[a+1]))return[];let u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Ji,[]],l=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Ji,[]];s.push(IDBKeyRange.bound(u,l))}return s}Dn(t,e){return Ie(t,e)>0}getMinOffsetFromCollectionGroup(t,e){return this.getFieldIndexes(t,e).next($h)}getMinOffset(t,e){return b.mapArray(this.cn(e),n=>this.ln(t,n).next(i=>i||L())).next($h)}};function Kh(r){return It(r,"collectionParents")}function An(r){return It(r,"indexEntries")}function Lr(r){return It(r,"indexConfiguration")}function bn(r){return It(r,"indexState")}function $h(r){U(r.length!==0);let t=r[0].indexState.offset,e=t.largestBatchId;for(let n=1;n<r.length;n++){let i=r[n].indexState.offset;cc(i,t)<0&&(t=i),e<i.largestBatchId&&(e=i.largestBatchId)}return new jt(t.readTime,t.documentKey,e)}var Qh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Gt=class r{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new r(t,r.DEFAULT_COLLECTION_PERCENTILE,r.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function ff(r,t,e){let n=r.store("mutations"),i=r.store("documentMutations"),s=[],a=IDBKeyRange.only(e.batchId),u=0,l=n.J({range:a},(f,g,v)=>(u++,v.delete()));s.push(l.next(()=>{U(u===1)}));let d=[];for(let f of e.mutations){let g=vd(t,f.key.path,e.batchId);s.push(i.delete(g)),d.push(f.key)}return b.waitFor(s).next(()=>d)}function Cs(r){if(!r)return 0;let t;if(r.document)t=r.document;else if(r.unknownDocument)t=r.unknownDocument;else{if(!r.noDocument)throw L();t=r.noDocument}return JSON.stringify(t).length}Gt.DEFAULT_COLLECTION_PERCENTILE=10,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Gt.DEFAULT=new Gt(41943040,Gt.DEFAULT_COLLECTION_PERCENTILE,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Gt.DISABLED=new Gt(-1,0,0);var Vs=class r{constructor(t,e,n,i){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=i,this.Cn={}}static lt(t,e,n,i){U(t.uid!=="");let s=t.isAuthenticated()?t.uid:"";return new r(s,e,n,i)}checkEmpty(t){let e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Te(t).J({index:"userMutationsIndex",range:n},(i,s,a)=>{e=!1,a.done()}).next(()=>e)}addMutationBatch(t,e,n,i){let s=Rn(t),a=Te(t);return a.add({}).next(u=>{U(typeof u=="number");let l=new ei(u,e,n,i),d=function(C,N,k){let x=k.baseMutations.map(j=>oi(C.ct,j)),G=k.mutations.map(j=>oi(C.ct,j));return{userId:N,batchId:k.batchId,localWriteTimeMs:k.localWriteTime.toMillis(),baseMutations:x,mutations:G}}(this.serializer,this.userId,l),f=[],g=new nt((v,C)=>z(v.canonicalString(),C.canonicalString()));for(let v of i){let C=vd(this.userId,v.key.path,u);g=g.add(v.key.path.popLast()),f.push(a.put(d)),f.push(s.put(C,lg))}return g.forEach(v=>{f.push(this.indexManager.addToCollectionParentIndex(t,v))}),t.addOnCommittedListener(()=>{this.Cn[u]=l.keys()}),b.waitFor(f).next(()=>l)})}lookupMutationBatch(t,e){return Te(t).get(e).next(n=>n?(U(n.userId===this.userId),Ye(this.serializer,n)):null)}vn(t,e){return this.Cn[e]?b.resolve(this.Cn[e]):this.lookupMutationBatch(t,e).next(n=>{if(n){let i=n.keys();return this.Cn[e]=i,i}return null})}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=IDBKeyRange.lowerBound([this.userId,n]),s=null;return Te(t).J({index:"userMutationsIndex",range:i},(a,u,l)=>{u.userId===this.userId&&(U(u.batchId>=n),s=Ye(this.serializer,u)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(t){let e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return Te(t).J({index:"userMutationsIndex",range:e,reverse:!0},(i,s,a)=>{n=s.batchId,a.done()}).next(()=>n)}getAllMutationBatches(t){let e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Te(t).U("userMutationsIndex",e).next(n=>n.map(i=>Ye(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(t,e){let n=ts(this.userId,e.path),i=IDBKeyRange.lowerBound(n),s=[];return Rn(t).J({range:i},(a,u,l)=>{let[d,f,g]=a,v=Jt(f);if(d===this.userId&&e.path.isEqual(v))return Te(t).get(g).next(C=>{if(!C)throw L();U(C.userId===this.userId),s.push(Ye(this.serializer,C))});l.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(z),i=[];return e.forEach(s=>{let a=ts(this.userId,s.path),u=IDBKeyRange.lowerBound(a),l=Rn(t).J({range:u},(d,f,g)=>{let[v,C,N]=d,k=Jt(C);v===this.userId&&s.path.isEqual(k)?n=n.add(N):g.done()});i.push(l)}),b.waitFor(i).next(()=>this.Fn(t,n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=ts(this.userId,n),a=IDBKeyRange.lowerBound(s),u=new nt(z);return Rn(t).J({range:a},(l,d,f)=>{let[g,v,C]=l,N=Jt(v);g===this.userId&&n.isPrefixOf(N)?N.length===i&&(u=u.add(C)):f.done()}).next(()=>this.Fn(t,u))}Fn(t,e){let n=[],i=[];return e.forEach(s=>{i.push(Te(t).get(s).next(a=>{if(a===null)throw L();U(a.userId===this.userId),n.push(Ye(this.serializer,a))}))}),b.waitFor(i).next(()=>n)}removeMutationBatch(t,e){return ff(t._e,this.userId,e).next(n=>(t.addOnCommittedListener(()=>{this.Mn(e.batchId)}),b.forEach(n,i=>this.referenceDelegate.markPotentiallyOrphaned(t,i))))}Mn(t){delete this.Cn[t]}performConsistencyCheck(t){return this.checkEmpty(t).next(e=>{if(!e)return b.resolve();let n=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return Rn(t).J({range:n},(s,a,u)=>{if(s[0]===this.userId){let l=Jt(s[1]);i.push(l)}else u.done()}).next(()=>{U(i.length===0)})})}containsKey(t,e){return mf(t,this.userId,e)}xn(t){return gf(t).get(this.userId).next(e=>e||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function mf(r,t,e){let n=ts(t,e.path),i=n[1],s=IDBKeyRange.lowerBound(n),a=!1;return Rn(r).J({range:s,H:!0},(u,l,d)=>{let[f,g,v]=u;f===t&&g===i&&(a=!0),d.done()}).next(()=>a)}function Te(r){return It(r,"mutations")}function Rn(r){return It(r,"documentMutations")}function gf(r){return It(r,"mutationQueues")}var $n=class r{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new r(0)}static Ln(){return new r(-1)}};var eu=class{constructor(t,e){this.referenceDelegate=t,this.serializer=e}allocateTargetId(t){return this.Bn(t).next(e=>{let n=new $n(e.highestTargetId);return e.highestTargetId=n.next(),this.kn(t,e).next(()=>e.highestTargetId)})}getLastRemoteSnapshotVersion(t){return this.Bn(t).next(e=>B.fromTimestamp(new ht(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(t){return this.Bn(t).next(e=>e.highestListenSequenceNumber)}setTargetsMetadata(t,e,n){return this.Bn(t).next(i=>(i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),this.kn(t,i)))}addTargetData(t,e){return this.qn(t,e).next(()=>this.Bn(t).next(n=>(n.targetCount+=1,this.Qn(e,n),this.kn(t,n))))}updateTargetData(t,e){return this.qn(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next(()=>Cn(t).delete(e.targetId)).next(()=>this.Bn(t)).next(n=>(U(n.targetCount>0),n.targetCount-=1,this.kn(t,n)))}removeTargets(t,e,n){let i=0,s=[];return Cn(t).J((a,u)=>{let l=Gr(u);l.sequenceNumber<=e&&n.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(t,l)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(t,e){return Cn(t).J((n,i)=>{let s=Gr(i);e(s)})}Bn(t){return Hh(t).get("targetGlobalKey").next(e=>(U(e!==null),e))}kn(t,e){return Hh(t).put("targetGlobalKey",e)}qn(t,e){return Cn(t).put(lf(this.serializer,e))}Qn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Bn(t).next(e=>e.targetCount)}getTargetData(t,e){let n=on(e),i=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),s=null;return Cn(t).J({range:i,index:"queryTargetsIndex"},(a,u,l)=>{let d=Gr(u);_i(e,d.target)&&(s=d,l.done())}).next(()=>s)}addMatchingKeys(t,e,n){let i=[],s=Ae(t);return e.forEach(a=>{let u=kt(a.path);i.push(s.put({targetId:n,path:u})),i.push(this.referenceDelegate.addReference(t,n,a))}),b.waitFor(i)}removeMatchingKeys(t,e,n){let i=Ae(t);return b.forEach(e,s=>{let a=kt(s.path);return b.waitFor([i.delete([n,a]),this.referenceDelegate.removeReference(t,n,s)])})}removeMatchingKeysForTargetId(t,e){let n=Ae(t),i=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(i)}getMatchingKeysForTargetId(t,e){let n=IDBKeyRange.bound([e],[e+1],!1,!0),i=Ae(t),s=K();return i.J({range:n,H:!0},(a,u,l)=>{let d=Jt(a[1]),f=new O(d);s=s.add(f)}).next(()=>s)}containsKey(t,e){let n=kt(e.path),i=IDBKeyRange.bound([n],[fd(n)],!1,!0),s=0;return Ae(t).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],l,d)=>{a!==0&&(s++,d.done())}).next(()=>s>0)}ot(t,e){return Cn(t).get(e).next(n=>n?Gr(n):null)}};function Cn(r){return It(r,"targets")}function Hh(r){return It(r,"targetGlobal")}function Ae(r){return It(r,"targetDocuments")}function Wh([r,t],[e,n]){let i=z(r,e);return i===0?z(t,n):i}var nu=class{constructor(t){this.Kn=t,this.buffer=new nt(Wh),this.$n=0}Un(){return++this.$n}Wn(t){let e=[t,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(e);else{let n=this.buffer.last();Wh(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}}get maxValue(){return this.buffer.last()[0]}},ru=class{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(t){P("LruGarbageCollector",`Garbage collection scheduled in ${t}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,()=>D(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(e){Be(e)?P("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e):yield Ue(e)}yield this.zn(3e5)}))}},iu=class{constructor(t,e){this.jn=t,this.params=e}calculateTargetCount(t,e){return this.jn.Hn(t).next(n=>Math.floor(e/100*n))}nthSequenceNumber(t,e){if(e===0)return b.resolve(Ut.oe);let n=new nu(e);return this.jn.forEachTarget(t,i=>n.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(t,i=>n.Wn(i))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.jn.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.jn.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(P("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(Qh)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(P("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Qh):this.Yn(t,e))}getCacheSize(t){return this.jn.getCacheSize(t)}Yn(t,e){let n,i,s,a,u,l,d,f=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(g=>(g>this.params.maximumSequenceNumbersToCollect?(P("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${g}`),i=this.params.maximumSequenceNumbersToCollect):i=g,a=Date.now(),this.nthSequenceNumber(t,i))).next(g=>(n=g,u=Date.now(),this.removeTargets(t,n,e))).next(g=>(s=g,l=Date.now(),this.removeOrphanedDocuments(t,n))).next(g=>(d=Date.now(),Vn()<=Wt.DEBUG&&P("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-f}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(l-u)+`ms
	Removed ${g} documents in `+(d-l)+`ms
Total Duration: ${d-f}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:g})))}};function ip(r,t){return new iu(r,t)}var su=class{constructor(t,e){this.db=t,this.garbageCollector=ip(this,e)}Hn(t){let e=this.Zn(t);return this.db.getTargetCache().getTargetCount(t).next(n=>e.next(i=>n+i))}Zn(t){let e=0;return this.Jn(t,n=>{e++}).next(()=>e)}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}Jn(t,e){return this.Xn(t,(n,i)=>e(i))}addReference(t,e,n){return Yi(t,n)}removeReference(t,e,n){return Yi(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return Yi(t,e)}er(t,e){return function(i,s){let a=!1;return gf(i).Y(u=>mf(i,u,s).next(l=>(l&&(a=!0),b.resolve(!l)))).next(()=>a)}(t,e)}removeOrphanedDocuments(t,e){let n=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(t,(a,u)=>{if(u<=e){let l=this.er(t,a).next(d=>{if(!d)return s++,n.getEntry(t,a).next(()=>(n.removeEntry(a,B.min()),Ae(t).delete(function(g){return[0,kt(g.path)]}(a))))});i.push(l)}}).next(()=>b.waitFor(i)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){let n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return Yi(t,e)}Xn(t,e){let n=Ae(t),i,s=Ut.oe;return n.J({index:"documentTargetsIndex"},([a,u],{path:l,sequenceNumber:d})=>{a===0?(s!==Ut.oe&&e(new O(Jt(i)),s),s=d,i=l):s=Ut.oe}).next(()=>{s!==Ut.oe&&e(new O(Jt(i)),s)})}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}};function Yi(r,t){return Ae(r).put(function(n,i){return{targetId:0,path:kt(n.path),sequenceNumber:i}}(t,r.currentSequenceNumber))}var Ss=class{constructor(){this.changes=new ie(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,_t.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();let n=this.changes.get(e);return n!==void 0?b.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}};var ou=class{constructor(t){this.serializer=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return He(t).put(n)}removeEntry(t,e,n){return He(t).delete(function(s,a){let u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Is(a),u[u.length-1]]}(e,n))}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.tr(t,n)))}getEntry(t,e){let n=_t.newInvalidDocument(e);return He(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ur(e))},(i,s)=>{n=this.nr(e,s)}).next(()=>n)}rr(t,e){let n={size:0,document:_t.newInvalidDocument(e)};return He(t).J({index:"documentKeyIndex",range:IDBKeyRange.only(Ur(e))},(i,s)=>{n={document:this.nr(e,s),size:Cs(s)}}).next(()=>n)}getEntries(t,e){let n=Ot();return this.ir(t,e,(i,s)=>{let a=this.nr(i,s);n=n.insert(i,a)}).next(()=>n)}sr(t,e){let n=Ot(),i=new it(O.comparator);return this.ir(t,e,(s,a)=>{let u=this.nr(s,a);n=n.insert(s,u),i=i.insert(s,Cs(a))}).next(()=>({documents:n,_r:i}))}ir(t,e,n){if(e.isEmpty())return b.resolve();let i=new nt(Xh);e.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(Ur(i.first()),Ur(i.last())),a=i.getIterator(),u=a.getNext();return He(t).J({index:"documentKeyIndex",range:s},(l,d,f)=>{let g=O.fromSegments([...d.prefixPath,d.collectionGroup,d.documentId]);for(;u&&Xh(u,g)<0;)n(u,null),u=a.getNext();u&&u.isEqual(g)&&(n(u,d),u=a.hasNext()?a.getNext():null),u?f.$(Ur(u)):f.done()}).next(()=>{for(;u;)n(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(t,e,n,i,s){let a=e.path,u=[a.popLast().toArray(),a.lastSegment(),Is(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],l=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return He(t).U(IDBKeyRange.bound(u,l,!0)).next(d=>{s?.incrementDocumentReadCount(d.length);let f=Ot();for(let g of d){let v=this.nr(O.fromSegments(g.prefixPath.concat(g.collectionGroup,g.documentId)),g);v.isFoundDocument()&&(wi(e,v)||i.has(v.key))&&(f=f.insert(v.key,v))}return f})}getAllFromCollectionGroup(t,e,n,i){let s=Ot(),a=Yh(e,n),u=Yh(e,jt.max());return He(t).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(l,d,f)=>{let g=this.nr(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);s=s.insert(g.key,g),s.size===i&&f.done()}).next(()=>s)}newChangeBuffer(t){return new au(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next(e=>e.byteSize)}getMetadata(t){return Jh(t).get("remoteDocumentGlobalKey").next(e=>(U(!!e),e))}tr(t,e){return Jh(t).put("remoteDocumentGlobalKey",e)}nr(t,e){if(e){let n=ep(this.serializer,e);if(!(n.isNoDocument()&&n.version.isEqual(B.min())))return n}return _t.newInvalidDocument(t)}};function pf(r){return new ou(r)}var au=class extends Ss{constructor(t,e){super(),this.ar=t,this.trackRemovals=e,this.ur=new ie(n=>n.toString(),(n,i)=>n.isEqual(i))}applyChanges(t){let e=[],n=0,i=new nt((s,a)=>z(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{let u=this.ur.get(s);if(e.push(this.ar.removeEntry(t,s,u.readTime)),a.isValidDocument()){let l=Oh(this.ar.serializer,a);i=i.add(s.path.popLast());let d=Cs(l);n+=d-u.size,e.push(this.ar.addEntry(t,s,l))}else if(n-=u.size,this.trackRemovals){let l=Oh(this.ar.serializer,a.convertToNoDocument(B.min()));e.push(this.ar.addEntry(t,s,l))}}),i.forEach(s=>{e.push(this.ar.indexManager.addToCollectionParentIndex(t,s))}),e.push(this.ar.updateMetadata(t,n)),b.waitFor(e)}getFromCache(t,e){return this.ar.rr(t,e).next(n=>(this.ur.set(e,{size:n.size,readTime:n.document.readTime}),n.document))}getAllFromCache(t,e){return this.ar.sr(t,e).next(({documents:n,_r:i})=>(i.forEach((s,a)=>{this.ur.set(s,{size:a,readTime:n.get(s).readTime})}),n))}};function Jh(r){return It(r,"remoteDocumentGlobal")}function He(r){return It(r,"remoteDocumentsV14")}function Ur(r){let t=r.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Yh(r,t){let e=t.documentKey.path.toArray();return[r,Is(t.readTime),e.slice(0,e.length-2),e.length>0?e[e.length-1]:""]}function Xh(r,t){let e=r.path.toArray(),n=t.path.toArray(),i=0;for(let s=0;s<e.length-2&&s<n.length-2;++s)if(i=z(e[s],n[s]),i)return i;return i=z(e.length,n.length),i||(i=z(e[e.length-2],n[n.length-2]),i||z(e[e.length-1],n[n.length-1]))}var uu=class{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}};var Ds=class{constructor(t,e,n,i){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=i}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(i=>(n=i,this.remoteDocumentCache.getEntry(t,e))).next(i=>(n!==null&&Kr(n.mutation,i,Bt.empty(),ht.now()),i))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.getLocalViewOfDocuments(t,n,K()).next(()=>n))}getLocalViewOfDocuments(t,e,n=K()){let i=Yt();return this.populateOverlays(t,i,e).next(()=>this.computeViews(t,e,i,n).next(s=>{let a=qr();return s.forEach((u,l)=>{a=a.insert(u,l.overlayedDocument)}),a}))}getOverlayedDocuments(t,e){let n=Yt();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,K()))}populateOverlays(t,e,n){let i=[];return n.forEach(s=>{e.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(t,i).next(s=>{s.forEach((a,u)=>{e.set(a,u)})})}computeViews(t,e,n,i){let s=Ot(),a=zr(),u=function(){return zr()}();return e.forEach((l,d)=>{let f=n.get(d.key);i.has(d.key)&&(f===void 0||f.mutation instanceof $t)?s=s.insert(d.key,d):f!==void 0?(a.set(d.key,f.mutation.getFieldMask()),Kr(f.mutation,d,f.mutation.getFieldMask(),ht.now())):a.set(d.key,Bt.empty())}),this.recalculateAndSaveOverlays(t,s).next(l=>(l.forEach((d,f)=>a.set(d,f)),e.forEach((d,f)=>{var g;return u.set(d,new uu(f,(g=a.get(d))!==null&&g!==void 0?g:null))}),u))}recalculateAndSaveOverlays(t,e){let n=zr(),i=new it((a,u)=>a-u),s=K();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(a=>{for(let u of a)u.keys().forEach(l=>{let d=e.get(l);if(d===null)return;let f=n.get(l)||Bt.empty();f=u.applyToLocalView(d,f),n.set(l,f);let g=(i.get(u.batchId)||K()).add(l);i=i.insert(u.batchId,g)})}).next(()=>{let a=[],u=i.getReverseIterator();for(;u.hasNext();){let l=u.getNext(),d=l.key,f=l.value,g=Ld();f.forEach(v=>{if(!s.has(v)){let C=$d(e.get(v),n.get(v));C!==null&&g.set(v,C),s=s.add(v)}}),a.push(this.documentOverlayCache.saveOverlays(t,d,g))}return b.waitFor(a)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(n=>this.recalculateAndSaveOverlays(t,n))}getDocumentsMatchingQuery(t,e,n,i){return function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):fc(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,i):this.getDocumentsMatchingCollectionQuery(t,e,n,i)}getNextDocuments(t,e,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,i).next(s=>{let a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,i-s.size):b.resolve(Yt()),u=-1,l=s;return a.next(d=>b.forEach(d,(f,g)=>(u<g.largestBatchId&&(u=g.largestBatchId),s.get(f)?b.resolve():this.remoteDocumentCache.getEntry(t,f).next(v=>{l=l.insert(f,v)}))).next(()=>this.populateOverlays(t,d,s)).next(()=>this.computeViews(t,l,d,K())).next(f=>({batchId:u,changes:Od(f)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new O(e)).next(n=>{let i=qr();return n.isFoundDocument()&&(i=i.insert(n.key,n)),i})}getDocumentsMatchingCollectionGroupQuery(t,e,n,i){let s=e.collectionGroup,a=qr();return this.indexManager.getCollectionParents(t,s).next(u=>b.forEach(u,l=>{let d=function(g,v){return new Kt(v,null,g.explicitOrderBy.slice(),g.filters.slice(),g.limit,g.limitType,g.startAt,g.endAt)}(e,l.child(s));return this.getDocumentsMatchingCollectionQuery(t,d,n,i).next(f=>{f.forEach((g,v)=>{a=a.insert(g,v)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(t,e,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,i))).next(a=>{s.forEach((l,d)=>{let f=d.getKey();a.get(f)===null&&(a=a.insert(f,_t.newInvalidDocument(f)))});let u=qr();return a.forEach((l,d)=>{let f=s.get(l);f!==void 0&&Kr(f.mutation,d,Bt.empty(),ht.now()),wi(e,d)&&(u=u.insert(l,d))}),u})}};var cu=class{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return b.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(i){return{id:i.id,version:i.version,createTime:dt(i.createTime)}}(e)),b.resolve()}getNamedQuery(t,e){return b.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(i){return{name:i.name,query:pc(i.bundledQuery),readTime:dt(i.readTime)}}(e)),b.resolve()}};var lu=class{constructor(){this.overlays=new it(O.comparator),this.hr=new Map}getOverlay(t,e){return b.resolve(this.overlays.get(e))}getOverlays(t,e){let n=Yt();return b.forEach(e,i=>this.getOverlay(t,i).next(s=>{s!==null&&n.set(i,s)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((i,s)=>{this.ht(t,e,s)}),b.resolve()}removeOverlaysForBatchId(t,e,n){let i=this.hr.get(n);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(n)),b.resolve()}getOverlaysForCollection(t,e,n){let i=Yt(),s=e.length+1,a=new O(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){let l=u.getNext().value,d=l.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===s&&l.largestBatchId>n&&i.set(l.getKey(),l)}return b.resolve(i)}getOverlaysForCollectionGroup(t,e,n,i){let s=new it((d,f)=>d-f),a=this.overlays.getIterator();for(;a.hasNext();){let d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>n){let f=s.get(d.largestBatchId);f===null&&(f=Yt(),s=s.insert(d.largestBatchId,f)),f.set(d.getKey(),d)}}let u=Yt(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,f)=>u.set(d,f)),!(u.size()>=i)););return b.resolve(u)}ht(t,e,n){let i=this.overlays.get(n.key);if(i!==null){let a=this.hr.get(i.largestBatchId).delete(n.key);this.hr.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new ni(e,n));let s=this.hr.get(e);s===void 0&&(s=K(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}};var ui=class{constructor(){this.Pr=new nt(gt.Ir),this.Tr=new nt(gt.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){let n=new gt(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach(n=>this.addReference(n,e))}removeReference(t,e){this.Ar(new gt(t,e))}Rr(t,e){t.forEach(n=>this.removeReference(n,e))}Vr(t){let e=new O(new J([])),n=new gt(e,t),i=new gt(e,t+1),s=[];return this.Tr.forEachInRange([n,i],a=>{this.Ar(a),s.push(a.key)}),s}mr(){this.Pr.forEach(t=>this.Ar(t))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){let e=new O(new J([])),n=new gt(e,t),i=new gt(e,t+1),s=K();return this.Tr.forEachInRange([n,i],a=>{s=s.add(a.key)}),s}containsKey(t){let e=new gt(t,0),n=this.Pr.firstAfterOrEqual(e);return n!==null&&t.isEqual(n.key)}},gt=class{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return O.comparator(t.key,e.key)||z(t.pr,e.pr)}static Er(t,e){return z(t.pr,e.pr)||O.comparator(t.key,e.key)}};var hu=class{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new nt(gt.Ir)}checkEmpty(t){return b.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,n,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let a=new ei(s,e,n,i);this.mutationQueue.push(a);for(let u of i)this.wr=this.wr.add(new gt(u.key,s)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return b.resolve(a)}lookupMutationBatch(t,e){return b.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){let n=e+1,i=this.br(n),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(t){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){let n=new gt(e,0),i=new gt(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,i],a=>{let u=this.Sr(a.pr);s.push(u)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new nt(z);return e.forEach(i=>{let s=new gt(i,0),a=new gt(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,a],u=>{n=n.add(u.pr)})}),b.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){let n=e.path,i=n.length+1,s=n;O.isDocumentKey(s)||(s=s.child(""));let a=new gt(new O(s),0),u=new nt(z);return this.wr.forEachWhile(l=>{let d=l.key.path;return!!n.isPrefixOf(d)&&(d.length===i&&(u=u.add(l.pr)),!0)},a),b.resolve(this.Dr(u))}Dr(t){let e=[];return t.forEach(n=>{let i=this.Sr(n);i!==null&&e.push(i)}),e}removeMutationBatch(t,e){U(this.Cr(e.batchId,"removed")===0),this.mutationQueue.shift();let n=this.wr;return b.forEach(e.mutations,i=>{let s=new gt(i.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(()=>{this.wr=n})}Mn(t){}containsKey(t,e){let n=new gt(e,0),i=this.wr.firstAfterOrEqual(n);return b.resolve(e.isEqual(i&&i.key))}performConsistencyCheck(t){return this.mutationQueue.length,b.resolve()}Cr(t,e){return this.br(t)}br(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Sr(t){let e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}};var du=class{constructor(t){this.vr=t,this.docs=function(){return new it(O.comparator)}(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){let n=e.key,i=this.docs.get(n),s=i?i.size:0,a=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){let e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){let n=this.docs.get(e);return b.resolve(n?n.document.mutableCopy():_t.newInvalidDocument(e))}getEntries(t,e){let n=Ot();return e.forEach(i=>{let s=this.docs.get(i);n=n.insert(i,s?s.document.mutableCopy():_t.newInvalidDocument(i))}),b.resolve(n)}getDocumentsMatchingQuery(t,e,n,i){let s=Ot(),a=e.path,u=new O(a.child("")),l=this.docs.getIteratorFrom(u);for(;l.hasNext();){let{key:d,value:{document:f}}=l.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||cc(gd(f),n)<=0||(i.has(f.key)||wi(e,f))&&(s=s.insert(f.key,f.mutableCopy()))}return b.resolve(s)}getAllFromCollectionGroup(t,e,n,i){L()}Fr(t,e){return b.forEach(this.docs,n=>e(n))}newChangeBuffer(t){return new fu(this)}getSize(t){return b.resolve(this.size)}},fu=class extends Ss{constructor(t){super(),this.ar=t}applyChanges(t){let e=[];return this.changes.forEach((n,i)=>{i.isValidDocument()?e.push(this.ar.addEntry(t,i)):this.ar.removeEntry(n)}),b.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}};var mu=class{constructor(t){this.persistence=t,this.Mr=new ie(e=>on(e),_i),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.Or=0,this.Nr=new ui,this.targetCount=0,this.Lr=$n.Nn()}forEachTarget(t,e){return this.Mr.forEach((n,i)=>e(i)),b.resolve()}getLastRemoteSnapshotVersion(t){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return b.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Lr.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),b.resolve()}qn(t){this.Mr.set(t.target,t);let e=t.targetId;e>this.highestTargetId&&(this.Lr=new $n(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,b.resolve()}updateTargetData(t,e){return this.qn(e),b.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,b.resolve()}removeTargets(t,e,n){let i=0,s=[];return this.Mr.forEach((a,u)=>{u.sequenceNumber<=e&&n.get(u.targetId)===null&&(this.Mr.delete(a),s.push(this.removeMatchingKeysForTargetId(t,u.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(t){return b.resolve(this.targetCount)}getTargetData(t,e){let n=this.Mr.get(e)||null;return b.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),b.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);let i=this.persistence.referenceDelegate,s=[];return i&&e.forEach(a=>{s.push(i.markPotentiallyOrphaned(t,a))}),b.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),b.resolve()}getMatchingKeysForTargetId(t,e){let n=this.Nr.gr(e);return b.resolve(n)}containsKey(t,e){return b.resolve(this.Nr.containsKey(e))}};var Ps=class{constructor(t,e){this.Br={},this.overlays={},this.kr=new Ut(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new mu(this),this.indexManager=new Za,this.remoteDocumentCache=function(i){return new du(i)}(n=>this.referenceDelegate.Kr(n)),this.serializer=new Es(e),this.$r=new cu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new lu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Br[t.toKey()];return n||(n=new hu(e,this.referenceDelegate),this.Br[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){P("MemoryPersistence","Starting transaction:",t);let i=new gu(this.kr.next());return this.referenceDelegate.Ur(),n(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(t,e){return b.or(Object.values(this.Br).map(n=>()=>n.containsKey(t,e)))}},gu=class extends cs{constructor(t){super(),this.currentSequenceNumber=t}},Rs=class r{constructor(t){this.persistence=t,this.zr=new ui,this.jr=null}static Hr(t){return new r(t)}get Jr(){if(this.jr)return this.jr;throw L()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),b.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),b.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),b.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach(i=>this.Jr.add(i.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>n.removeTargetData(t,e))}Ur(){this.jr=new Set}Wr(t){let e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Jr,n=>{let i=O.fromPath(n);return this.Yr(t,i).next(s=>{s||e.removeEntry(i,B.min())})}).next(()=>(this.jr=null,e.apply(t)))}updateLimboDocument(t,e){return this.Yr(t,e).next(n=>{n?this.Jr.delete(e.toString()):this.Jr.add(e.toString())})}Kr(t){return 0}Yr(t,e){return b.or([()=>b.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}};var pu=class{constructor(t){this.serializer=t}O(t,e,n,i){let s=new ls("createOrUpgrade",e);n<1&&i>=1&&(function(l){l.createObjectStore("owner")}(t),function(l){l.createObjectStore("mutationQueues",{keyPath:"userId"}),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gh,{unique:!0}),l.createObjectStore("documentMutations")}(t),Zh(t),function(l){l.createObjectStore("remoteDocuments")}(t));let a=b.resolve();return n<3&&i>=3&&(n!==0&&(function(l){l.deleteObjectStore("targetDocuments"),l.deleteObjectStore("targets"),l.deleteObjectStore("targetGlobal")}(t),Zh(t)),a=a.next(()=>function(l){let d=l.store("targetGlobal"),f={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:B.min().toTimestamp(),targetCount:0};return d.put("targetGlobalKey",f)}(s))),n<4&&i>=4&&(n!==0&&(a=a.next(()=>function(l,d){return d.store("mutations").U().next(f=>{l.deleteObjectStore("mutations"),l.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",gh,{unique:!0});let g=d.store("mutations"),v=f.map(C=>g.put(C));return b.waitFor(v)})}(t,s))),a=a.next(()=>{(function(l){l.createObjectStore("clientMetadata",{keyPath:"clientId"})})(t)})),n<5&&i>=5&&(a=a.next(()=>this.Xr(s))),n<6&&i>=6&&(a=a.next(()=>(function(l){l.createObjectStore("remoteDocumentGlobal")}(t),this.ei(s)))),n<7&&i>=7&&(a=a.next(()=>this.ti(s))),n<8&&i>=8&&(a=a.next(()=>this.ni(t,s))),n<9&&i>=9&&(a=a.next(()=>{(function(l){l.objectStoreNames.contains("remoteDocumentChanges")&&l.deleteObjectStore("remoteDocumentChanges")})(t)})),n<10&&i>=10&&(a=a.next(()=>this.ri(s))),n<11&&i>=11&&(a=a.next(()=>{(function(l){l.createObjectStore("bundles",{keyPath:"bundleId"})})(t),function(l){l.createObjectStore("namedQueries",{keyPath:"name"})}(t)})),n<12&&i>=12&&(a=a.next(()=>{(function(l){let d=l.createObjectStore("documentOverlays",{keyPath:Ig});d.createIndex("collectionPathOverlayIndex",Tg,{unique:!1}),d.createIndex("collectionGroupOverlayIndex",Ag,{unique:!1})})(t)})),n<13&&i>=13&&(a=a.next(()=>function(l){let d=l.createObjectStore("remoteDocumentsV14",{keyPath:hg});d.createIndex("documentKeyIndex",dg),d.createIndex("collectionGroupIndex",fg)}(t)).next(()=>this.ii(t,s)).next(()=>t.deleteObjectStore("remoteDocuments"))),n<14&&i>=14&&(a=a.next(()=>this.si(t,s))),n<15&&i>=15&&(a=a.next(()=>function(l){l.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),l.createObjectStore("indexState",{keyPath:_g}).createIndex("sequenceNumberIndex",vg,{unique:!1}),l.createObjectStore("indexEntries",{keyPath:wg}).createIndex("documentKeyIndex",Eg,{unique:!1})}(t))),n<16&&i>=16&&(a=a.next(()=>{e.objectStore("indexState").clear()}).next(()=>{e.objectStore("indexEntries").clear()})),a}ei(t){let e=0;return t.store("remoteDocuments").J((n,i)=>{e+=Cs(i)}).next(()=>{let n={byteSize:e};return t.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)})}Xr(t){let e=t.store("mutationQueues"),n=t.store("mutations");return e.U().next(i=>b.forEach(i,s=>{let a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return n.U("userMutationsIndex",a).next(u=>b.forEach(u,l=>{U(l.userId===s.userId);let d=Ye(this.serializer,l);return ff(t,s.userId,d).next(()=>{})}))}))}ti(t){let e=t.store("targetDocuments"),n=t.store("remoteDocuments");return t.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return n.J((a,u)=>{let l=new J(a),d=function(g){return[0,kt(g)]}(l);s.push(e.get(d).next(f=>f?b.resolve():(g=>e.put({targetId:0,path:kt(g),sequenceNumber:i.highestListenSequenceNumber}))(l)))}).next(()=>b.waitFor(s))})}ni(t,e){t.createObjectStore("collectionParents",{keyPath:yg});let n=e.store("collectionParents"),i=new ai,s=a=>{if(i.add(a)){let u=a.lastSegment(),l=a.popLast();return n.put({collectionId:u,parent:kt(l)})}};return e.store("remoteDocuments").J({H:!0},(a,u)=>{let l=new J(a);return s(l.popLast())}).next(()=>e.store("documentMutations").J({H:!0},([a,u,l],d)=>{let f=Jt(u);return s(f.popLast())}))}ri(t){let e=t.store("targets");return e.J((n,i)=>{let s=Gr(i),a=lf(this.serializer,s);return e.put(a)})}ii(t,e){let n=e.store("remoteDocuments"),i=[];return n.J((s,a)=>{let u=e.store("remoteDocumentsV14"),l=function(g){return g.document?new O(J.fromString(g.document.name).popFirst(5)):g.noDocument?O.fromSegments(g.noDocument.path):g.unknownDocument?O.fromSegments(g.unknownDocument.path):L()}(a).path.toArray(),d={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(d))}).next(()=>b.waitFor(i))}si(t,e){let n=e.store("mutations"),i=pf(this.serializer),s=new Ps(Rs.Hr,this.serializer.ct);return n.U().next(a=>{let u=new Map;return a.forEach(l=>{var d;let f=(d=u.get(l.userId))!==null&&d!==void 0?d:K();Ye(this.serializer,l).keys().forEach(g=>f=f.add(g)),u.set(l.userId,f)}),b.forEach(u,(l,d)=>{let f=new pt(d),g=Ts.lt(this.serializer,f),v=s.getIndexManager(f),C=Vs.lt(f,this.serializer,v,s.referenceDelegate);return new Ds(i,C,g,v).recalculateAndSaveOverlaysForDocumentKeys(new Jr(e,Ut.oe),l).next()})})}};function Zh(r){r.createObjectStore("targetDocuments",{keyPath:gg}).createIndex("documentTargetsIndex",pg,{unique:!0}),r.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",mg,{unique:!0}),r.createObjectStore("targetGlobal")}var aa="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",yu=class r{constructor(t,e,n,i,s,a,u,l,d,f,g=16){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.oi=s,this.window=a,this.document=u,this._i=d,this.ai=f,this.ui=g,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=v=>Promise.resolve(),!r.D())throw new R(S.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new su(this,i),this.Ti=e+"main",this.serializer=new Es(l),this.Ei=new Se(this.Ti,this.ui,new pu(this.serializer)),this.Qr=new eu(this.referenceDelegate,this.serializer),this.remoteDocumentCache=pf(this.serializer),this.$r=new $a,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,f===!1&&lt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new R(S.FAILED_PRECONDITION,aa);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Qr.getHighestSequenceNumber(t))}).then(t=>{this.kr=new Ut(t,this._i)}).then(()=>{this.qr=!0}).catch(t=>(this.Ei&&this.Ei.close(),Promise.reject(t)))}fi(t){return this.Ii=e=>D(this,null,function*(){if(this.started)return t(e)}),t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ei.L(e=>D(this,null,function*(){e.newVersion===null&&(yield t())}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.oi.enqueueAndForget(()=>D(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>Xi(t).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(t).next(e=>{e||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(t)).next(e=>this.isPrimary&&!e?this.yi(t).next(()=>!1):!!e&&this.wi(t).next(()=>!0))).catch(t=>{if(Be(t))return P("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return P("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.oi.enqueueRetryable(()=>this.Ii(t)),this.isPrimary=t})}gi(t){return Br(t).get("owner").next(e=>b.resolve(this.Si(e)))}bi(t){return Xi(t).delete(this.clientId)}Di(){return D(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let t=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",e=>{let n=It(e,"clientMetadata");return n.U().next(i=>{let s=this.vi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return b.forEach(a,u=>n.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.di)for(let e of t)this.di.removeItem(this.Fi(e.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(t){return!!t&&t.ownerId===this.clientId}pi(t){return this.ai?b.resolve(!0):Br(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)){if(this.Si(e)&&this.networkEnabled)return!0;if(!this.Si(e)){if(!e.allowTabSynchronization)throw new R(S.FAILED_PRECONDITION,aa);return!1}}return!(!this.networkEnabled||!this.inForeground)||Xi(t).U().next(n=>this.vi(n,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(e=>(this.isPrimary!==e&&P("IndexedDbPersistence",`Client ${e?"is":"is not"} eligible for a primary lease.`),e))}shutdown(){return D(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{let e=new Jr(t,Ut.oe);return this.yi(e).next(()=>this.bi(e))}),this.Ei.close(),this.Li()})}vi(t,e){return t.filter(n=>this.Ci(n.updateTimeMs,e)&&!this.Mi(n.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",t=>Xi(t).U().next(e=>this.vi(e,18e5).map(n=>n.clientId)))}get started(){return this.qr}getMutationQueue(t,e){return Vs.lt(t,this.serializer,e,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(t){return new tu(t,this.serializer.ct.databaseId)}getDocumentOverlayCache(t){return Ts.lt(this.serializer,t)}getBundleCache(){return this.$r}runTransaction(t,e,n){P("IndexedDbPersistence","Starting transaction:",t);let i=e==="readonly"?"readonly":"readwrite",s=function(l){return l===16?Cg:l===15?Td:l===14?Id:l===13?Ed:l===12?bg:l===11?wd:void L()}(this.ui),a;return this.Ei.runTransaction(t,i,s,u=>(a=new Jr(u,this.kr?this.kr.next():Ut.oe),e==="readwrite-primary"?this.gi(a).next(l=>!!l||this.pi(a)).next(l=>{if(!l)throw lt(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new R(S.FAILED_PRECONDITION,pd);return n(a)}).next(l=>this.wi(a).next(()=>l)):this.ki(a).next(()=>n(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}ki(t){return Br(t).get("owner").next(e=>{if(e!==null&&this.Ci(e.leaseTimestampMs,5e3)&&!this.Mi(e.ownerId)&&!this.Si(e)&&!(this.ai||this.allowTabSynchronization&&e.allowTabSynchronization))throw new R(S.FAILED_PRECONDITION,aa)})}wi(t){let e={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Br(t).put("owner",e)}static D(){return Se.D()}yi(t){let e=Br(t);return e.get("owner").next(n=>this.Si(n)?(P("IndexedDbPersistence","Releasing primary lease."),e.delete("owner")):b.resolve())}Ci(t,e){let n=Date.now();return!(t<n-e)&&(!(t>n)||(lt(`Detected an update time that is in the future: ${t} > ${n}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var t;typeof((t=this.window)===null||t===void 0?void 0:t.addEventListener)=="function"&&(this.ci=()=>{this.xi();let e=/(?:Version|Mobile)\/1[456]/;Yo()&&(navigator.appVersion.match(e)||navigator.userAgent.match(e))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(t){var e;try{let n=((e=this.di)===null||e===void 0?void 0:e.getItem(this.Fi(t)))!==null;return P("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(n){return lt("IndexedDbPersistence","Failed to get zombied client id.",n),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(t){lt("Failed to set zombie client id.",t)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(t){return`firestore_zombie_${this.persistenceKey}_${t}`}};function Br(r){return It(r,"owner")}function Xi(r){return It(r,"clientMetadata")}function _c(r,t){let e=r.projectId;return r.isDefaultDatabase||(e+="."+r.database),"firestore/"+t+"/"+e+"/"}var _u=class r{constructor(t,e,n,i){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=i}static Ki(t,e){let n=K(),i=K();for(let s of e.docChanges)switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new r(t,e.fromCache,n,i)}};var vu=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}};var xs=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return Yo()?8:yd(kr())>0?6:4}()}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,i){let s={result:null};return this.ji(t,e).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Hi(t,e,i,n).next(a=>{s.result=a})}).next(()=>{if(s.result)return;let a=new vu;return this.Ji(t,e,a).next(u=>{if(s.result=u,this.Ui)return this.Yi(t,e,a,u.size)})}).next(()=>s.result)}Yi(t,e,n,i){return n.documentReadCount<this.Wi?(Vn()<=Wt.DEBUG&&P("QueryEngine","SDK will not create cache indexes for query:",Sn(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),b.resolve()):(Vn()<=Wt.DEBUG&&P("QueryEngine","Query:",Sn(e),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.Gi*i?(Vn()<=Wt.DEBUG&&P("QueryEngine","The SDK decides to create cache indexes for query:",Sn(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Mt(e))):b.resolve())}ji(t,e){if(Ch(e))return b.resolve(null);let n=Mt(e);return this.indexManager.getIndexType(t,n).next(i=>i===0?null:(e.limit!==null&&i===1&&(e=ys(e,null,"F"),n=Mt(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(s=>{let a=K(...s);return this.zi.getDocuments(t,a).next(u=>this.indexManager.getMinOffset(t,n).next(l=>{let d=this.Zi(e,u);return this.Xi(e,d,a,l.readTime)?this.ji(t,ys(e,null,"F")):this.es(t,d,e,l)}))})))}Hi(t,e,n,i){return Ch(e)||i.isEqual(B.min())?b.resolve(null):this.zi.getDocuments(t,n).next(s=>{let a=this.Zi(e,s);return this.Xi(e,a,n,i)?b.resolve(null):(Vn()<=Wt.DEBUG&&P("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sn(e)),this.es(t,a,e,md(i,-1)).next(u=>u))})}Zi(t,e){let n=new nt(Md(t));return e.forEach((i,s)=>{wi(t,s)&&(n=n.add(s))}),n}Xi(t,e,n,i){if(t.limit===null)return!1;if(n.size!==e.size)return!0;let s=t.limitType==="F"?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(t,e,n){return Vn()<=Wt.DEBUG&&P("QueryEngine","Using full collection scan to execute query:",Sn(e)),this.zi.getDocumentsMatchingQuery(t,e,jt.min(),n)}es(t,e,n,i){return this.zi.getDocumentsMatchingQuery(t,n,i).next(s=>(e.forEach(a=>{s=s.insert(a.key,a)}),s))}};var wu=class{constructor(t,e,n,i){this.persistence=t,this.ts=e,this.serializer=i,this.ns=new it(z),this.rs=new ie(s=>on(s),_i),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Ds(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.ns))}};function yf(r,t,e,n){return new wu(r,t,e,n)}function _f(r,t){return D(this,null,function*(){let e=F(r);return yield e.persistence.runTransaction("Handle user change","readonly",n=>{let i;return e.mutationQueue.getAllMutationBatches(n).next(s=>(i=s,e._s(t),e.mutationQueue.getAllMutationBatches(n))).next(s=>{let a=[],u=[],l=K();for(let d of i){a.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}for(let d of s){u.push(d.batchId);for(let f of d.mutations)l=l.add(f.key)}return e.localDocuments.getDocuments(n,l).next(d=>({us:d,removedBatchIds:a,addedBatchIds:u}))})})})}function sp(r,t){let e=F(r);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",n=>{let i=t.batch.keys(),s=e.os.newChangeBuffer({trackRemovals:!0});return function(u,l,d,f){let g=d.batch,v=g.keys(),C=b.resolve();return v.forEach(N=>{C=C.next(()=>f.getEntry(l,N)).next(k=>{let x=d.docVersions.get(N);U(x!==null),k.version.compareTo(x)<0&&(g.applyToRemoteDocument(k,d),k.isValidDocument()&&(k.setReadTime(d.commitVersion),f.addEntry(k)))})}),C.next(()=>u.mutationQueue.removeMutationBatch(l,g))}(e,n,t,s).next(()=>s.apply(n)).next(()=>e.mutationQueue.performConsistencyCheck(n)).next(()=>e.documentOverlayCache.removeOverlaysForBatchId(n,i,t.batch.batchId)).next(()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(n,function(u){let l=K();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(l=l.add(u.batch.mutations[d].key));return l}(t))).next(()=>e.localDocuments.getDocuments(n,i))})}function vf(r){let t=F(r);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Qr.getLastRemoteSnapshotVersion(e))}function op(r,t){let e=F(r),n=t.snapshotVersion,i=e.ns;return e.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let a=e.os.newChangeBuffer({trackRemovals:!0});i=e.ns;let u=[];t.targetChanges.forEach((f,g)=>{let v=i.get(g);if(!v)return;u.push(e.Qr.removeMatchingKeys(s,f.removedDocuments,g).next(()=>e.Qr.addMatchingKeys(s,f.addedDocuments,g)));let C=v.withSequenceNumber(s.currentSequenceNumber);t.targetMismatches.get(g)!==null?C=C.withResumeToken(Et.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):f.resumeToken.approximateByteSize()>0&&(C=C.withResumeToken(f.resumeToken,n)),i=i.insert(g,C),function(k,x,G){return k.resumeToken.approximateByteSize()===0||x.snapshotVersion.toMicroseconds()-k.snapshotVersion.toMicroseconds()>=3e8?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0}(v,C,f)&&u.push(e.Qr.updateTargetData(s,C))});let l=Ot(),d=K();if(t.documentUpdates.forEach(f=>{t.resolvedLimboDocuments.has(f)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(s,f))}),u.push(wf(s,a,t.documentUpdates).next(f=>{l=f.cs,d=f.ls})),!n.isEqual(B.min())){let f=e.Qr.getLastRemoteSnapshotVersion(s).next(g=>e.Qr.setTargetsMetadata(s,s.currentSequenceNumber,n));u.push(f)}return b.waitFor(u).next(()=>a.apply(s)).next(()=>e.localDocuments.getLocalViewOfDocuments(s,l,d)).next(()=>l)}).then(s=>(e.ns=i,s))}function wf(r,t,e){let n=K(),i=K();return e.forEach(s=>n=n.add(s)),t.getEntries(r,n).next(s=>{let a=Ot();return e.forEach((u,l)=>{let d=s.get(u);l.isFoundDocument()!==d.isFoundDocument()&&(i=i.add(u)),l.isNoDocument()&&l.version.isEqual(B.min())?(t.removeEntry(u,l.readTime),a=a.insert(u,l)):!d.isValidDocument()||l.version.compareTo(d.version)>0||l.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(l),a=a.insert(u,l)):P("LocalStore","Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",l.version)}),{cs:a,ls:i}})}function ap(r,t){let e=F(r);return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(t===void 0&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}function Qn(r,t){let e=F(r);return e.persistence.runTransaction("Allocate target","readwrite",n=>{let i;return e.Qr.getTargetData(n,t).next(s=>s?(i=s,b.resolve(i)):e.Qr.allocateTargetId(n).next(a=>(i=new Kn(t,a,"TargetPurposeListen",n.currentSequenceNumber),e.Qr.addTargetData(n,i).next(()=>i))))}).then(n=>{let i=e.ns.get(n.targetId);return(i===null||n.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(e.ns=e.ns.insert(n.targetId,n),e.rs.set(t,n.targetId)),n})}function Hn(r,t,e){return D(this,null,function*(){let n=F(r),i=n.ns.get(t),s=e?"readwrite":"readwrite-primary";try{e||(yield n.persistence.runTransaction("Release target",s,a=>n.persistence.referenceDelegate.removeTarget(a,i)))}catch(a){if(!Be(a))throw a;P("LocalStore",`Failed to update sequence numbers for target ${t}: ${a}`)}n.ns=n.ns.remove(t),n.rs.delete(i.target)})}function Ns(r,t,e){let n=F(r),i=B.min(),s=K();return n.persistence.runTransaction("Execute query","readwrite",a=>function(l,d,f){let g=F(l),v=g.rs.get(f);return v!==void 0?b.resolve(g.ns.get(v)):g.Qr.getTargetData(d,f)}(n,a,Mt(t)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,n.Qr.getMatchingKeysForTargetId(a,u.targetId).next(l=>{s=l})}).next(()=>n.ts.getDocumentsMatchingQuery(a,t,e?i:B.min(),e?s:K())).next(u=>(Tf(n,kd(t),u),{documents:u,hs:s})))}function Ef(r,t){let e=F(r),n=F(e.Qr),i=e.ns.get(t);return i?Promise.resolve(i.target):e.persistence.runTransaction("Get target data","readonly",s=>n.ot(s,t).next(a=>a?a.target:null))}function If(r,t){let e=F(r),n=e.ss.get(t)||B.min();return e.persistence.runTransaction("Get new document changes","readonly",i=>e.os.getAllFromCollectionGroup(i,t,md(n,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Tf(e,t,i),i))}function Tf(r,t,e){let n=r.ss.get(t)||B.min();e.forEach((i,s)=>{s.readTime.compareTo(n)>0&&(n=s.readTime)}),r.ss.set(t,n)}function up(r,t,e,n){return D(this,null,function*(){let i=F(r),s=K(),a=Ot();for(let d of e){let f=t.Ps(d.metadata.name);d.document&&(s=s.add(f));let g=t.Is(d);g.setReadTime(t.Ts(d.metadata.readTime)),a=a.insert(f,g)}let u=i.os.newChangeBuffer({trackRemovals:!0}),l=yield Qn(i,function(f){return Mt(nr(J.fromString(`__bundle__/docs/${f}`)))}(n));return i.persistence.runTransaction("Apply bundle documents","readwrite",d=>wf(d,u,a).next(f=>(u.apply(d),f)).next(f=>i.Qr.removeMatchingKeysForTargetId(d,l.targetId).next(()=>i.Qr.addMatchingKeys(d,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(d,f.cs,f.ls)).next(()=>f.cs)))})}function cp(n,i){return D(this,arguments,function*(r,t,e=K()){let s=yield Qn(r,Mt(pc(t.bundledQuery))),a=F(r);return a.persistence.runTransaction("Save named query","readwrite",u=>{let l=dt(t.readTime);if(s.snapshotVersion.compareTo(l)>=0)return a.$r.saveNamedQuery(u,t);let d=s.withResumeToken(Et.EMPTY_BYTE_STRING,l);return a.ns=a.ns.insert(d.targetId,d),a.Qr.updateTargetData(u,d).next(()=>a.Qr.removeMatchingKeysForTargetId(u,s.targetId)).next(()=>a.Qr.addMatchingKeys(u,e,s.targetId)).next(()=>a.$r.saveNamedQuery(u,t))})})}function td(r,t){return`firestore_clients_${r}_${t}`}function ed(r,t,e){let n=`firestore_mutations_${r}_${e}`;return t.isAuthenticated()&&(n+=`_${t.uid}`),n}function ua(r,t){return`firestore_targets_${r}_${t}`}var ks=class r{constructor(t,e,n,i){this.user=t,this.batchId=e,this.state=n,this.error=i}static Es(t,e,n){let i=JSON.parse(n),s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new R(i.error.code,i.error.message))),a?new r(t,e,i.state,s):(lt("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},$r=class r{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Es(t,e){let n=JSON.parse(e),i,s=typeof n=="object"&&["not-current","current","rejected"].indexOf(n.state)!==-1&&(n.error===void 0||typeof n.error=="object");return s&&n.error&&(s=typeof n.error.message=="string"&&typeof n.error.code=="string",s&&(i=new R(n.error.code,n.error.message))),s?new r(t,n.state,i):(lt("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ds(){let t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}},Ms=class r{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Es(t,e){let n=JSON.parse(e),i=typeof n=="object"&&n.activeTargetIds instanceof Array,s=mc();for(let a=0;i&&a<n.activeTargetIds.length;++a)i=_d(n.activeTargetIds[a]),s=s.add(n.activeTargetIds[a]);return i?new r(t,s):(lt("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}},Eu=class r{constructor(t,e){this.clientId=t,this.onlineState=e}static Es(t){let e=JSON.parse(t);return typeof e=="object"&&["Unknown","Online","Offline"].indexOf(e.onlineState)!==-1&&typeof e.clientId=="string"?new r(e.clientId,e.onlineState):(lt("SharedClientState",`Failed to parse online state: ${t}`),null)}},ci=class{constructor(){this.activeTargetIds=mc()}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){let t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}},Qr=class{constructor(t,e,n,i,s){this.window=t,this.oi=e,this.persistenceKey=n,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new it(z),this.started=!1,this.ys=[];let a=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=td(this.persistenceKey,this.Vs),this.Ss=function(l){return`firestore_sequence_number_${l}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new ci),this.bs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.vs=function(l){return`firestore_online_state_${l}`}(this.persistenceKey),this.Fs=function(l){return`firestore_bundle_loaded_v2_${l}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(t){return!(!t||!t.localStorage)}start(){return D(this,null,function*(){let t=yield this.syncEngine.Bi();for(let n of t){if(n===this.Vs)continue;let i=this.getItem(td(this.persistenceKey,n));if(i){let s=Ms.Es(n,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let e=this.storage.getItem(this.vs);if(e){let n=this.xs(e);n&&this.Os(n)}for(let n of this.ys)this.gs(n);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(t){this.setItem(this.Ss,JSON.stringify(t))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(t){let e=!1;return this.ps.forEach((n,i)=>{i.activeTargetIds.has(t)&&(e=!0)}),e}addPendingMutation(t){this.Ls(t,"pending")}updateMutationState(t,e,n){this.Ls(t,e,n),this.Bs(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){let n=this.storage.getItem(ua(this.persistenceKey,t));if(n){let i=$r.Es(t,n);i&&(e=i.state)}}return this.ks.As(t),this.Ms(),e}removeLocalQueryTarget(t){this.ks.Rs(t),this.Ms()}isLocalQueryTarget(t){return this.ks.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(ua(this.persistenceKey,t))}updateQueryState(t,e,n){this.qs(t,e,n)}handleUserChange(t,e,n){e.forEach(i=>{this.Bs(i)}),this.currentUser=t,n.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(t){this.Qs(t)}notifyBundleLoaded(t){this.Ks(t)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(t){let e=this.storage.getItem(t);return P("SharedClientState","READ",t,e),e}setItem(t,e){P("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){P("SharedClientState","REMOVE",t),this.storage.removeItem(t)}gs(t){let e=t;if(e.storageArea===this.storage){if(P("SharedClientState","EVENT",e.key,e.newValue),e.key===this.ws)return void lt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>D(this,null,function*(){if(this.started){if(e.key!==null){if(this.bs.test(e.key)){if(e.newValue==null){let n=this.$s(e.key);return this.Us(n,null)}{let n=this.Ws(e.key,e.newValue);if(n)return this.Us(n.clientId,n)}}else if(this.Ds.test(e.key)){if(e.newValue!==null){let n=this.Gs(e.key,e.newValue);if(n)return this.zs(n)}}else if(this.Cs.test(e.key)){if(e.newValue!==null){let n=this.js(e.key,e.newValue);if(n)return this.Hs(n)}}else if(e.key===this.vs){if(e.newValue!==null){let n=this.xs(e.newValue);if(n)return this.Os(n)}}else if(e.key===this.Ss){let n=function(s){let a=Ut.oe;if(s!=null)try{let u=JSON.parse(s);U(typeof u=="number"),a=u}catch(u){lt("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(e.newValue);n!==Ut.oe&&this.sequenceNumberHandler(n)}else if(e.key===this.Fs){let n=this.Js(e.newValue);yield Promise.all(n.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(e)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(t,e,n){let i=new ks(this.currentUser,t,e,n),s=ed(this.persistenceKey,this.currentUser,t);this.setItem(s,i.ds())}Bs(t){let e=ed(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Qs(t){let e={clientId:this.Vs,onlineState:t};this.storage.setItem(this.vs,JSON.stringify(e))}qs(t,e,n){let i=ua(this.persistenceKey,t),s=new $r(t,e,n);this.setItem(i,s.ds())}Ks(t){let e=JSON.stringify(Array.from(t));this.setItem(this.Fs,e)}$s(t){let e=this.bs.exec(t);return e?e[1]:null}Ws(t,e){let n=this.$s(t);return Ms.Es(n,e)}Gs(t,e){let n=this.Ds.exec(t),i=Number(n[1]),s=n[2]!==void 0?n[2]:null;return ks.Es(new pt(s),i,e)}js(t,e){let n=this.Cs.exec(t),i=Number(n[1]);return $r.Es(i,e)}xs(t){return Eu.Es(t)}Js(t){return JSON.parse(t)}zs(t){return D(this,null,function*(){if(t.user.uid===this.currentUser.uid)return this.syncEngine.Zs(t.batchId,t.state,t.error);P("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)})}Hs(t){return this.syncEngine.Xs(t.targetId,t.state,t.error)}Us(t,e){let n=e?this.ps.insert(t,e):this.ps.remove(t),i=this.Ns(this.ps),s=this.Ns(n),a=[],u=[];return s.forEach(l=>{i.has(l)||a.push(l)}),i.forEach(l=>{s.has(l)||u.push(l)}),this.syncEngine.eo(a,u).then(()=>{this.ps=n})}Os(t){this.ps.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}Ns(t){let e=mc();return t.forEach((n,i)=>{e=e.unionWith(i.activeTargetIds)}),e}},Fs=class{constructor(){this.no=new ci,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new ci,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}};var Iu=class{io(t){}shutdown(){}};var Os=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){P("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let t of this.uo)t(0)}ao(){P("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let t of this.uo)t(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Zi=null;function ca(){return Zi===null?Zi=function(){return 268435456+Math.round(2147483648*Math.random())}():Zi++,"0x"+Zi.toString(16)}var lp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var Tu=class{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}Ao(t){this.Ro=t}onMessage(t){this.Vo=t}close(){this.ho()}send(t){this.lo(t)}mo(){this.Io()}fo(){this.Eo()}po(t){this.Ro(t)}yo(t){this.Vo(t)}};var Pt="WebChannelConnection",Au=class extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;let n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.wo=n+"://"+e.host,this.So=`projects/${i}/databases/${s}`,this.bo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Do(){return!1}Co(e,n,i,s,a){let u=ca(),l=this.vo(e,n.toUriEncodedString());P("RestConnection",`Sending RPC '${e}' ${u}:`,l,i);let d={"google-cloud-resource-prefix":this.So,"x-goog-request-params":this.bo};return this.Fo(d,s,a),this.Mo(e,l,d,i).then(f=>(P("RestConnection",`Received RPC '${e}' ${u}: `,f),f),f=>{throw ee("RestConnection",`RPC '${e}' ${u} failed with error: `,f,"url: ",l,"request:",i),f})}xo(e,n,i,s,a,u){return this.Co(e,n,i,s,a)}Fo(e,n,i){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+er}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach((s,a)=>e[a]=s),i&&i.headers.forEach((s,a)=>e[a]=s)}vo(e,n){let i=lp[e];return`${this.wo}/v1/${n}:${i}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Mo(t,e,n,i){let s=ca();return new Promise((a,u)=>{let l=new ta;l.setWithCredentials(!0),l.listenOnce(na.COMPLETE,()=>{try{switch(l.getLastErrorCode()){case Fr.NO_ERROR:let f=l.getResponseJson();P(Pt,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(f)),a(f);break;case Fr.TIMEOUT:P(Pt,`RPC '${t}' ${s} timed out`),u(new R(S.DEADLINE_EXCEEDED,"Request time out"));break;case Fr.HTTP_ERROR:let g=l.getStatus();if(P(Pt,`RPC '${t}' ${s} failed with status:`,g,"response text:",l.getResponseText()),g>0){let v=l.getResponseJson();Array.isArray(v)&&(v=v[0]);let C=v?.error;if(C&&C.status&&C.message){let N=function(x){let G=x.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(G)>=0?G:S.UNKNOWN}(C.status);u(new R(N,C.message))}else u(new R(S.UNKNOWN,"Server responded with status "+l.getStatus()))}else u(new R(S.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{P(Pt,`RPC '${t}' ${s} completed.`)}});let d=JSON.stringify(i);P(Pt,`RPC '${t}' ${s} sending request:`,i),l.send(e,"POST",d,n,15)})}Oo(t,e,n){let i=ca(),s=[this.wo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=sa(),u=ia(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(l.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(l.xmlHttpFactory=new ea({})),this.Fo(l.initMessageHeaders,e,n),l.encodeInitMessageHeaders=!0;let f=s.join("");P(Pt,`Creating RPC '${t}' stream ${i}: ${f}`,l);let g=a.createWebChannel(f,l),v=!1,C=!1,N=new Tu({lo:x=>{C?P(Pt,`Not sending because RPC '${t}' stream ${i} is closed:`,x):(v||(P(Pt,`Opening RPC '${t}' stream ${i} transport.`),g.open(),v=!0),P(Pt,`RPC '${t}' stream ${i} sending:`,x),g.send(x))},ho:()=>g.close()}),k=(x,G,j)=>{x.listen(G,q=>{try{j(q)}catch(H){setTimeout(()=>{throw H},0)}})};return k(g,In.EventType.OPEN,()=>{C||(P(Pt,`RPC '${t}' stream ${i} transport opened.`),N.mo())}),k(g,In.EventType.CLOSE,()=>{C||(C=!0,P(Pt,`RPC '${t}' stream ${i} transport closed`),N.po())}),k(g,In.EventType.ERROR,x=>{C||(C=!0,ee(Pt,`RPC '${t}' stream ${i} transport errored:`,x),N.po(new R(S.UNAVAILABLE,"The operation could not be completed")))}),k(g,In.EventType.MESSAGE,x=>{var G;if(!C){let j=x.data[0];U(!!j);let q=j,H=q.error||((G=q[0])===null||G===void 0?void 0:G.error);if(H){P(Pt,`RPC '${t}' stream ${i} received error:`,H);let Z=H.status,$=function(_){let E=mt[_];if(E!==void 0)return Wd(E)}(Z),w=H.message;$===void 0&&($=S.INTERNAL,w="Unknown error status: "+Z+" with message "+H.message),C=!0,N.po(new R($,w)),g.close()}else P(Pt,`RPC '${t}' stream ${i} received:`,j),N.yo(j)}}),k(u,ra.STAT_EVENT,x=>{x.stat===Wi.PROXY?P(Pt,`RPC '${t}' stream ${i} detected buffering proxy`):x.stat===Wi.NOPROXY&&P(Pt,`RPC '${t}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{N.fo()},0),N}};function Af(){return typeof window<"u"?window:null}function is(){return typeof document<"u"?document:null}function Ei(r){return new qa(r,!0)}var li=class{constructor(t,e,n=1e3,i=1.5,s=6e4){this.oi=t,this.timerId=e,this.No=n,this.Lo=i,this.Bo=s,this.ko=0,this.qo=null,this.Qo=Date.now(),this.reset()}reset(){this.ko=0}Ko(){this.ko=this.Bo}$o(t){this.cancel();let e=Math.floor(this.ko+this.Uo()),n=Math.max(0,Date.now()-this.Qo),i=Math.max(0,e-n);i>0&&P("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.ko} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.qo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Qo=Date.now(),t())),this.ko*=this.Lo,this.ko<this.No&&(this.ko=this.No),this.ko>this.Bo&&(this.ko=this.Bo)}Wo(){this.qo!==null&&(this.qo.skipDelay(),this.qo=null)}cancel(){this.qo!==null&&(this.qo.cancel(),this.qo=null)}Uo(){return(Math.random()-.5)*this.ko}};var Ls=class{constructor(t,e,n,i,s,a,u,l){this.oi=t,this.Go=n,this.zo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=l,this.state=0,this.jo=0,this.Ho=null,this.Jo=null,this.stream=null,this.Yo=new li(t,e)}Zo(){return this.state===1||this.state===5||this.Xo()}Xo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.e_()}stop(){return D(this,null,function*(){this.Zo()&&(yield this.close(0))})}t_(){this.state=0,this.Yo.reset()}n_(){this.Xo()&&this.Ho===null&&(this.Ho=this.oi.enqueueAfterDelay(this.Go,6e4,()=>this.r_()))}i_(t){this.s_(),this.stream.send(t)}r_(){return D(this,null,function*(){if(this.Xo())return this.close(0)})}s_(){this.Ho&&(this.Ho.cancel(),this.Ho=null)}o_(){this.Jo&&(this.Jo.cancel(),this.Jo=null)}close(t,e){return D(this,null,function*(){this.s_(),this.o_(),this.Yo.cancel(),this.jo++,t!==4?this.Yo.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(lt(e.toString()),lt("Using maximum backoff delay to prevent overloading the backend."),this.Yo.Ko()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.__(),this.stream.close(),this.stream=null),this.state=t,yield this.listener.Ao(e)})}__(){}auth(){this.state=1;let t=this.a_(this.jo),e=this.jo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([n,i])=>{this.jo===e&&this.u_(n,i)},n=>{t(()=>{let i=new R(S.UNKNOWN,"Fetching auth token failed: "+n.message);return this.c_(i)})})}u_(t,e){let n=this.a_(this.jo);this.stream=this.l_(t,e),this.stream.Po(()=>{n(()=>this.listener.Po())}),this.stream.To(()=>{n(()=>(this.state=2,this.Jo=this.oi.enqueueAfterDelay(this.zo,1e4,()=>(this.Xo()&&(this.state=3),Promise.resolve())),this.listener.To()))}),this.stream.Ao(i=>{n(()=>this.c_(i))}),this.stream.onMessage(i=>{n(()=>this.onMessage(i))})}e_(){this.state=5,this.Yo.$o(()=>D(this,null,function*(){this.state=0,this.start()}))}c_(t){return P("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}a_(t){return e=>{this.oi.enqueueAndForget(()=>this.jo===t?e():(P("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},bu=class extends Ls{constructor(t,e,n,i,s,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s}l_(t,e){return this.connection.Oo("Listen",t,e)}onMessage(t){this.Yo.reset();let e=Hg(this.serializer,t),n=function(s){if(!("targetChange"in s))return B.min();let a=s.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?dt(a.readTime):B.min()}(t);return this.listener.h_(e,n)}P_(t){let e={};e.database=za(this.serializer),e.addTarget=function(s,a){let u,l=a.target;if(u=gs(l)?{documents:rf(s,l)}:{query:sf(s,l)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Yd(s,a.resumeToken);let d=Ga(s,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){u.readTime=zn(s,a.snapshotVersion.toTimestamp());let d=Ga(s,a.expectedCount);d!==null&&(u.expectedCount=d)}return u}(this.serializer,t);let n=Jg(this.serializer,t);n&&(e.labels=n),this.i_(e)}I_(t){let e={};e.database=za(this.serializer),e.removeTarget=t,this.i_(e)}},Cu=class extends Ls{constructor(t,e,n,i,s,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,i,a),this.serializer=s,this.T_=!1}get E_(){return this.T_}start(){this.T_=!1,this.lastStreamToken=void 0,super.start()}__(){this.T_&&this.d_([])}l_(t,e){return this.connection.Oo("Write",t,e)}onMessage(t){if(U(!!t.streamToken),this.lastStreamToken=t.streamToken,this.T_){this.Yo.reset();let e=Wg(t.writeResults,t.commitTime),n=dt(t.commitTime);return this.listener.A_(n,e)}return U(!t.writeResults||t.writeResults.length===0),this.T_=!0,this.listener.R_()}V_(){let t={};t.database=za(this.serializer),this.i_(t)}d_(t){let e={streamToken:this.lastStreamToken,writes:t.map(n=>oi(this.serializer,n))};this.i_(e)}};var Vu=class extends class{}{constructor(t,e,n,i){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=i,this.m_=!1}f_(){if(this.m_)throw new R(S.FAILED_PRECONDITION,"The client has already been terminated.")}Co(t,e,n,i){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Co(t,ja(e,n),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new R(S.UNKNOWN,s.toString())})}xo(t,e,n,i,s){return this.f_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.xo(t,ja(e,n),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new R(S.UNKNOWN,a.toString())})}terminate(){this.m_=!0,this.connection.terminate()}},Su=class{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}w_(){this.g_===0&&(this.S_("Unknown"),this.p_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.p_=null,this.b_("Backend didn't respond within 10 seconds."),this.S_("Offline"),Promise.resolve())))}D_(t){this.state==="Online"?this.S_("Unknown"):(this.g_++,this.g_>=1&&(this.C_(),this.b_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.S_("Offline")))}set(t){this.C_(),this.g_=0,t==="Online"&&(this.y_=!1),this.S_(t)}S_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}b_(t){let e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.y_?(lt(e),this.y_=!1):P("OnlineStateTracker",e)}C_(){this.p_!==null&&(this.p_.cancel(),this.p_=null)}};var Du=class{constructor(t,e,n,i,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.v_=[],this.F_=new Map,this.M_=new Set,this.x_=[],this.O_=s,this.O_.io(a=>{n.enqueueAndForget(()=>D(this,null,function*(){qe(this)&&(P("RemoteStore","Restarting streams for network reachability change."),yield function(l){return D(this,null,function*(){let d=F(l);d.M_.add(4),yield rr(d),d.N_.set("Unknown"),d.M_.delete(4),yield Ii(d)})}(this))}))}),this.N_=new Su(n,i)}};function Ii(r){return D(this,null,function*(){if(qe(r))for(let t of r.x_)yield t(!0)})}function rr(r){return D(this,null,function*(){for(let t of r.x_)yield t(!1)})}function ro(r,t){let e=F(r);e.F_.has(t.targetId)||(e.F_.set(t.targetId,t),Ec(e)?wc(e):sr(e).Xo()&&vc(e,t))}function Wn(r,t){let e=F(r),n=sr(e);e.F_.delete(t),n.Xo()&&bf(e,t),e.F_.size===0&&(n.Xo()?n.n_():qe(e)&&e.N_.set("Unknown"))}function vc(r,t){if(r.L_.xe(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){let e=r.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}sr(r).P_(t)}function bf(r,t){r.L_.xe(t),sr(r).I_(t)}function wc(r){r.L_=new Ba({getRemoteKeysForTarget:t=>r.remoteSyncer.getRemoteKeysForTarget(t),ot:t=>r.F_.get(t)||null,tt:()=>r.datastore.serializer.databaseId}),sr(r).start(),r.N_.w_()}function Ec(r){return qe(r)&&!sr(r).Zo()&&r.F_.size>0}function qe(r){return F(r).M_.size===0}function Cf(r){r.L_=void 0}function hp(r){return D(this,null,function*(){r.N_.set("Online")})}function dp(r){return D(this,null,function*(){r.F_.forEach((t,e)=>{vc(r,t)})})}function fp(r,t){return D(this,null,function*(){Cf(r),Ec(r)?(r.N_.D_(t),wc(r)):r.N_.set("Unknown")})}function mp(r,t,e){return D(this,null,function*(){if(r.N_.set("Online"),t instanceof vs&&t.state===2&&t.cause)try{yield function(i,s){return D(this,null,function*(){let a=s.cause;for(let u of s.targetIds)i.F_.has(u)&&(yield i.remoteSyncer.rejectListen(u,a),i.F_.delete(u),i.L_.removeTarget(u))})}(r,t)}catch(n){P("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),yield Us(r,n)}else if(t instanceof Mn?r.L_.Ke(t):t instanceof _s?r.L_.He(t):r.L_.We(t),!e.isEqual(B.min()))try{let n=yield vf(r.localStore);e.compareTo(n)>=0&&(yield function(s,a){let u=s.L_.rt(a);return u.targetChanges.forEach((l,d)=>{if(l.resumeToken.approximateByteSize()>0){let f=s.F_.get(d);f&&s.F_.set(d,f.withResumeToken(l.resumeToken,a))}}),u.targetMismatches.forEach((l,d)=>{let f=s.F_.get(l);if(!f)return;s.F_.set(l,f.withResumeToken(Et.EMPTY_BYTE_STRING,f.snapshotVersion)),bf(s,l);let g=new Kn(f.target,l,d,f.sequenceNumber);vc(s,g)}),s.remoteSyncer.applyRemoteEvent(u)}(r,e))}catch(n){P("RemoteStore","Failed to raise snapshot:",n),yield Us(r,n)}})}function Us(r,t,e){return D(this,null,function*(){if(!Be(t))throw t;r.M_.add(1),yield rr(r),r.N_.set("Offline"),e||(e=()=>vf(r.localStore)),r.asyncQueue.enqueueRetryable(()=>D(this,null,function*(){P("RemoteStore","Retrying IndexedDB access"),yield e(),r.M_.delete(1),yield Ii(r)}))})}function Vf(r,t){return t().catch(e=>Us(r,e,t))}function ir(r){return D(this,null,function*(){let t=F(r),e=Me(t),n=t.v_.length>0?t.v_[t.v_.length-1].batchId:-1;for(;gp(t);)try{let i=yield ap(t.localStore,n);if(i===null){t.v_.length===0&&e.n_();break}n=i.batchId,pp(t,i)}catch(i){yield Us(t,i)}Sf(t)&&Df(t)})}function gp(r){return qe(r)&&r.v_.length<10}function pp(r,t){r.v_.push(t);let e=Me(r);e.Xo()&&e.E_&&e.d_(t.mutations)}function Sf(r){return qe(r)&&!Me(r).Zo()&&r.v_.length>0}function Df(r){Me(r).start()}function yp(r){return D(this,null,function*(){Me(r).V_()})}function _p(r){return D(this,null,function*(){let t=Me(r);for(let e of r.v_)t.d_(e.mutations)})}function vp(r,t,e){return D(this,null,function*(){let n=r.v_.shift(),i=Oa.from(n,t,e);yield Vf(r,()=>r.remoteSyncer.applySuccessfulWrite(i)),yield ir(r)})}function wp(r,t){return D(this,null,function*(){t&&Me(r).E_&&(yield function(n,i){return D(this,null,function*(){if(function(a){return Hd(a)&&a!==S.ABORTED}(i.code)){let s=n.v_.shift();Me(n).t_(),yield Vf(n,()=>n.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield ir(n)}})}(r,t)),Sf(r)&&Df(r)})}function nd(r,t){return D(this,null,function*(){let e=F(r);e.asyncQueue.verifyOperationInProgress(),P("RemoteStore","RemoteStore received new credentials");let n=qe(e);e.M_.add(3),yield rr(e),n&&e.N_.set("Unknown"),yield e.remoteSyncer.handleCredentialChange(t),e.M_.delete(3),yield Ii(e)})}function Pu(r,t){return D(this,null,function*(){let e=F(r);t?(e.M_.delete(2),yield Ii(e)):t||(e.M_.add(2),yield rr(e),e.N_.set("Unknown"))})}function sr(r){return r.B_||(r.B_=function(e,n,i){let s=F(e);return s.f_(),new bu(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:hp.bind(null,r),To:dp.bind(null,r),Ao:fp.bind(null,r),h_:mp.bind(null,r)}),r.x_.push(t=>D(this,null,function*(){t?(r.B_.t_(),Ec(r)?wc(r):r.N_.set("Unknown")):(yield r.B_.stop(),Cf(r))}))),r.B_}function Me(r){return r.k_||(r.k_=function(e,n,i){let s=F(e);return s.f_(),new Cu(n,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(r.datastore,r.asyncQueue,{Po:()=>Promise.resolve(),To:yp.bind(null,r),Ao:wp.bind(null,r),R_:_p.bind(null,r),A_:vp.bind(null,r)}),r.x_.push(t=>D(this,null,function*(){t?(r.k_.t_(),yield ir(r)):(yield r.k_.stop(),r.v_.length>0&&(P("RemoteStore",`Stopping write stream with ${r.v_.length} pending writes`),r.v_=[]))}))),r.k_}var Ru=class r{constructor(t,e,n,i,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new yt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,i,s){let a=Date.now()+n,u=new r(t,e,a,i,s);return u.start(n),u}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new R(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function or(r,t){if(lt("AsyncQueue",`${t}: ${r}`),Be(r))return new R(S.UNAVAILABLE,`${t}: ${r}`);throw r}var Bs=class r{constructor(t){this.comparator=t?(e,n)=>t(e,n)||O.comparator(e.key,n.key):(e,n)=>O.comparator(e.key,n.key),this.keyedMap=qr(),this.sortedSet=new it(this.comparator)}static emptySet(t){return new r(t.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){let e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){let e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){let e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof r)||this.size!==t.size)return!1;let e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){let i=e.getNext().key,s=n.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let t=[];return this.forEach(e=>{t.push(e.toString())}),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){let n=new r;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}};var qs=class{constructor(){this.q_=new it(O.comparator)}track(t){let e=t.doc.key,n=this.q_.get(e);n?t.type!==0&&n.type===3?this.q_=this.q_.insert(e,t):t.type===3&&n.type!==1?this.q_=this.q_.insert(e,{type:n.type,doc:t.doc}):t.type===2&&n.type===2?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):t.type===2&&n.type===0?this.q_=this.q_.insert(e,{type:0,doc:t.doc}):t.type===1&&n.type===0?this.q_=this.q_.remove(e):t.type===1&&n.type===2?this.q_=this.q_.insert(e,{type:1,doc:n.doc}):t.type===0&&n.type===1?this.q_=this.q_.insert(e,{type:2,doc:t.doc}):L():this.q_=this.q_.insert(e,t)}Q_(){let t=[];return this.q_.inorderTraversal((e,n)=>{t.push(n)}),t}},Jn=class r{constructor(t,e,n,i,s,a,u,l,d){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=l,this.hasCachedResults=d}static fromInitialDocuments(t,e,n,i,s){let a=[];return e.forEach(u=>{a.push({type:0,doc:u})}),new r(t,e,Bs.emptySet(e),a,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&vi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;let e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let i=0;i<e.length;i++)if(e[i].type!==n[i].type||!e[i].doc.isEqual(n[i].doc))return!1;return!0}};var xu=class{constructor(){this.K_=void 0,this.U_=[]}W_(){return this.U_.some(t=>t.G_())}},Nu=class{constructor(){this.queries=new ie(t=>Nd(t),vi),this.onlineState="Unknown",this.z_=new Set}};function Ic(r,t){return D(this,null,function*(){let e=F(r),n=3,i=t.query,s=e.queries.get(i);s?!s.W_()&&t.G_()&&(n=2):(s=new xu,n=t.G_()?0:1);try{switch(n){case 0:s.K_=yield e.onListen(i,!0);break;case 1:s.K_=yield e.onListen(i,!1);break;case 2:yield e.onFirstRemoteStoreListen(i)}}catch(a){let u=or(a,`Initialization of query '${Sn(t.query)}' failed`);return void t.onError(u)}e.queries.set(i,s),s.U_.push(t),t.j_(e.onlineState),s.K_&&t.H_(s.K_)&&Ac(e)})}function Tc(r,t){return D(this,null,function*(){let e=F(r),n=t.query,i=3,s=e.queries.get(n);if(s){let a=s.U_.indexOf(t);a>=0&&(s.U_.splice(a,1),s.U_.length===0?i=t.G_()?0:1:!s.W_()&&t.G_()&&(i=2))}switch(i){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}})}function Ep(r,t){let e=F(r),n=!1;for(let i of t){let s=i.query,a=e.queries.get(s);if(a){for(let u of a.U_)u.H_(i)&&(n=!0);a.K_=i}}n&&Ac(e)}function Ip(r,t,e){let n=F(r),i=n.queries.get(t);if(i)for(let s of i.U_)s.onError(e);n.queries.delete(t)}function Ac(r){r.z_.forEach(t=>{t.next()})}var ku,rd;(rd=ku||(ku={})).J_="default",rd.Cache="cache";var hi=class{constructor(t,e,n){this.query=t,this.Y_=e,this.Z_=!1,this.X_=null,this.onlineState="Unknown",this.options=n||{}}H_(t){if(!this.options.includeMetadataChanges){let n=[];for(let i of t.docChanges)i.type!==3&&n.push(i);t=new Jn(t.query,t.docs,t.oldDocs,n,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Z_?this.ea(t)&&(this.Y_.next(t),e=!0):this.ta(t,this.onlineState)&&(this.na(t),e=!0),this.X_=t,e}onError(t){this.Y_.error(t)}j_(t){this.onlineState=t;let e=!1;return this.X_&&!this.Z_&&this.ta(this.X_,t)&&(this.na(this.X_),e=!0),e}ta(t,e){if(!t.fromCache||!this.G_())return!0;let n=e!=="Offline";return(!this.options.ra||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}ea(t){if(t.docChanges.length>0)return!0;let e=this.X_&&this.X_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}na(t){t=Jn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Z_=!0,this.Y_.next(t)}G_(){return this.options.source!==ku.Cache}};var Mu=class{constructor(t,e){this.ia=t,this.byteLength=e}sa(){return"metadata"in this.ia}};var Gs=class{constructor(t){this.serializer=t}Ps(t){return Zt(this.serializer,t)}Is(t){return t.metadata.exists?nf(this.serializer,t.document,!1):_t.newNoDocument(this.Ps(t.metadata.name),this.Ts(t.metadata.readTime))}Ts(t){return dt(t)}},Fu=class{constructor(t,e,n){this.oa=t,this.localStore=e,this.serializer=n,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Pf(t)}_a(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;if(t.ia.namedQuery)this.queries.push(t.ia.namedQuery);else if(t.ia.documentMetadata){this.documents.push({metadata:t.ia.documentMetadata}),t.ia.documentMetadata.exists||++e;let n=J.fromString(t.ia.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else t.ia.document&&(this.documents[this.documents.length-1].document=t.ia.document,++e);return e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}aa(t){let e=new Map,n=new Gs(this.serializer);for(let i of t)if(i.metadata.queries){let s=n.Ps(i.metadata.name);for(let a of i.metadata.queries){let u=(e.get(a)||K()).add(s);e.set(a,u)}}return e}complete(){return D(this,null,function*(){let t=yield up(this.localStore,new Gs(this.serializer),this.documents,this.oa.id),e=this.aa(this.documents);for(let n of this.queries)yield cp(this.localStore,n,e.get(n.name));return this.progress.taskState="Success",{progress:this.progress,ua:this.collectionGroups,ca:t}})}};function Pf(r){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:r.totalDocuments,totalBytes:r.totalBytes}}var js=class{constructor(t){this.key=t}},zs=class{constructor(t){this.key=t}},Ks=class{constructor(t,e){this.query=t,this.la=e,this.ha=null,this.hasCachedResults=!1,this.current=!1,this.Pa=K(),this.mutatedKeys=K(),this.Ia=Md(t),this.Ta=new Bs(this.Ia)}get Ea(){return this.la}da(t,e){let n=e?e.Aa:new qs,i=e?e.Ta:this.Ta,s=e?e.mutatedKeys:this.mutatedKeys,a=i,u=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,d=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal((f,g)=>{let v=i.get(f),C=wi(this.query,g)?g:null,N=!!v&&this.mutatedKeys.has(v.key),k=!!C&&(C.hasLocalMutations||this.mutatedKeys.has(C.key)&&C.hasCommittedMutations),x=!1;v&&C?v.data.isEqual(C.data)?N!==k&&(n.track({type:3,doc:C}),x=!0):this.Ra(v,C)||(n.track({type:2,doc:C}),x=!0,(l&&this.Ia(C,l)>0||d&&this.Ia(C,d)<0)&&(u=!0)):!v&&C?(n.track({type:0,doc:C}),x=!0):v&&!C&&(n.track({type:1,doc:v}),x=!0,(l||d)&&(u=!0)),x&&(C?(a=a.add(C),s=k?s.add(f):s.delete(f)):(a=a.delete(f),s=s.delete(f)))}),this.query.limit!==null)for(;a.size>this.query.limit;){let f=this.query.limitType==="F"?a.last():a.first();a=a.delete(f.key),s=s.delete(f.key),n.track({type:1,doc:f})}return{Ta:a,Aa:n,Xi:u,mutatedKeys:s}}Ra(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,i){let s=this.Ta;this.Ta=t.Ta,this.mutatedKeys=t.mutatedKeys;let a=t.Aa.Q_();a.sort((f,g)=>function(C,N){let k=x=>{switch(x){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return k(C)-k(N)}(f.type,g.type)||this.Ia(f.doc,g.doc)),this.Va(n),i=i!=null&&i;let u=e&&!i?this.ma():[],l=this.Pa.size===0&&this.current&&!i?1:0,d=l!==this.ha;return this.ha=l,a.length!==0||d?{snapshot:new Jn(this.query,t.Ta,s,a,t.mutatedKeys,l===0,d,!1,!!n&&n.resumeToken.approximateByteSize()>0),fa:u}:{fa:u}}j_(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({Ta:this.Ta,Aa:new qs,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{fa:[]}}ga(t){return!this.la.has(t)&&!!this.Ta.has(t)&&!this.Ta.get(t).hasLocalMutations}Va(t){t&&(t.addedDocuments.forEach(e=>this.la=this.la.add(e)),t.modifiedDocuments.forEach(e=>{}),t.removedDocuments.forEach(e=>this.la=this.la.delete(e)),this.current=t.current)}ma(){if(!this.current)return[];let t=this.Pa;this.Pa=K(),this.Ta.forEach(n=>{this.ga(n.key)&&(this.Pa=this.Pa.add(n.key))});let e=[];return t.forEach(n=>{this.Pa.has(n)||e.push(new zs(n))}),this.Pa.forEach(n=>{t.has(n)||e.push(new js(n))}),e}pa(t){this.la=t.hs,this.Pa=K();let e=this.da(t.documents);return this.applyChanges(e,!0)}ya(){return Jn.fromInitialDocuments(this.query,this.Ta,this.mutatedKeys,this.ha===0,this.hasCachedResults)}},Ou=class{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}},Lu=class{constructor(t){this.key=t,this.wa=!1}},Uu=class{constructor(t,e,n,i,s,a){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Sa={},this.ba=new ie(u=>Nd(u),vi),this.Da=new Map,this.Ca=new Set,this.va=new it(O.comparator),this.Fa=new Map,this.Ma=new ui,this.xa={},this.Oa=new Map,this.Na=$n.Ln(),this.onlineState="Unknown",this.La=void 0}get isPrimaryClient(){return this.La===!0}};function Tp(r,t,e=!0){return D(this,null,function*(){let n=io(r),i,s=n.ba.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ya()):i=yield Rf(n,t,e,!0),i})}function Ap(r,t){return D(this,null,function*(){let e=io(r);yield Rf(e,t,!0,!1)})}function Rf(r,t,e,n){return D(this,null,function*(){let i=yield Qn(r.localStore,Mt(t)),s=i.targetId,a=e?r.sharedClientState.addLocalQueryTarget(s):"not-current",u;return n&&(u=yield bc(r,t,s,a==="current",i.resumeToken)),r.isPrimaryClient&&e&&ro(r.remoteStore,i),u})}function bc(r,t,e,n,i){return D(this,null,function*(){r.Ba=(g,v,C)=>function(k,x,G,j){return D(this,null,function*(){let q=x.view.da(G);q.Xi&&(q=yield Ns(k.localStore,x.query,!1).then(({documents:w})=>x.view.da(w,q)));let H=j&&j.targetChanges.get(x.targetId),Z=j&&j.targetMismatches.get(x.targetId)!=null,$=x.view.applyChanges(q,k.isPrimaryClient,H,Z);return Bu(k,x.targetId,$.fa),$.snapshot})}(r,g,v,C);let s=yield Ns(r.localStore,t,!0),a=new Ks(t,s.hs),u=a.da(s.documents),l=ii.createSynthesizedTargetChangeForCurrentChange(e,n&&r.onlineState!=="Offline",i),d=a.applyChanges(u,r.isPrimaryClient,l);Bu(r,e,d.fa);let f=new Ou(t,e,a);return r.ba.set(t,f),r.Da.has(e)?r.Da.get(e).push(t):r.Da.set(e,[t]),d.snapshot})}function bp(r,t,e){return D(this,null,function*(){let n=F(r),i=n.ba.get(t),s=n.Da.get(i.targetId);if(s.length>1)return n.Da.set(i.targetId,s.filter(a=>!vi(a,t))),void n.ba.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Hn(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),e&&Wn(n.remoteStore,i.targetId),Yn(n,i.targetId)}).catch(Ue))):(Yn(n,i.targetId),yield Hn(n.localStore,i.targetId,!0))})}function Cp(r,t){return D(this,null,function*(){let e=F(r),n=e.ba.get(t),i=e.Da.get(n.targetId);e.isPrimaryClient&&i.length===1&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),Wn(e.remoteStore,n.targetId))})}function Vp(r,t,e){return D(this,null,function*(){let n=Dc(r);try{let i=yield function(a,u){let l=F(a),d=ht.now(),f=u.reduce((C,N)=>C.add(N.key),K()),g,v;return l.persistence.runTransaction("Locally write mutations","readwrite",C=>{let N=Ot(),k=K();return l.os.getEntries(C,f).next(x=>{N=x,N.forEach((G,j)=>{j.isValidDocument()||(k=k.add(G))})}).next(()=>l.localDocuments.getOverlayedDocuments(C,N)).next(x=>{g=x;let G=[];for(let j of u){let q=qg(j,g.get(j.key).overlayedDocument);q!=null&&G.push(new $t(j.key,q,Cd(q.value.mapValue),ct.exists(!0)))}return l.mutationQueue.addMutationBatch(C,d,G,u)}).next(x=>{v=x;let G=x.applyToLocalDocumentSet(g,k);return l.documentOverlayCache.saveOverlays(C,x.batchId,G)})}).then(()=>({batchId:v.batchId,changes:Od(g)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(i.batchId),function(a,u,l){let d=a.xa[a.currentUser.toKey()];d||(d=new it(z)),d=d.insert(u,l),a.xa[a.currentUser.toKey()]=d}(n,i.batchId,e),yield pe(n,i.changes),yield ir(n.remoteStore)}catch(i){let s=or(i,"Failed to persist write");e.reject(s)}})}function xf(r,t){return D(this,null,function*(){let e=F(r);try{let n=yield op(e.localStore,t);t.targetChanges.forEach((i,s)=>{let a=e.Fa.get(s);a&&(U(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.wa=!0:i.modifiedDocuments.size>0?U(a.wa):i.removedDocuments.size>0&&(U(a.wa),a.wa=!1))}),yield pe(e,n,t)}catch(n){yield Ue(n)}})}function id(r,t,e){let n=F(r);if(n.isPrimaryClient&&e===0||!n.isPrimaryClient&&e===1){let i=[];n.ba.forEach((s,a)=>{let u=a.view.j_(t);u.snapshot&&i.push(u.snapshot)}),function(a,u){let l=F(a);l.onlineState=u;let d=!1;l.queries.forEach((f,g)=>{for(let v of g.U_)v.j_(u)&&(d=!0)}),d&&Ac(l)}(n.eventManager,t),i.length&&n.Sa.h_(i),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}function Sp(r,t,e){return D(this,null,function*(){let n=F(r);n.sharedClientState.updateQueryState(t,"rejected",e);let i=n.Fa.get(t),s=i&&i.key;if(s){let a=new it(O.comparator);a=a.insert(s,_t.newNoDocument(s,B.min()));let u=K().add(s),l=new ri(B.min(),new Map,new it(z),a,u);yield xf(n,l),n.va=n.va.remove(s),n.Fa.delete(t),Sc(n)}else yield Hn(n.localStore,t,!1).then(()=>Yn(n,t,e)).catch(Ue)})}function Dp(r,t){return D(this,null,function*(){let e=F(r),n=t.batch.batchId;try{let i=yield sp(e.localStore,t);Vc(e,n,null),Cc(e,n),e.sharedClientState.updateMutationState(n,"acknowledged"),yield pe(e,i)}catch(i){yield Ue(i)}})}function Pp(r,t,e){return D(this,null,function*(){let n=F(r);try{let i=yield function(a,u){let l=F(a);return l.persistence.runTransaction("Reject batch","readwrite-primary",d=>{let f;return l.mutationQueue.lookupMutationBatch(d,u).next(g=>(U(g!==null),f=g.keys(),l.mutationQueue.removeMutationBatch(d,g))).next(()=>l.mutationQueue.performConsistencyCheck(d)).next(()=>l.documentOverlayCache.removeOverlaysForBatchId(d,f,u)).next(()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,f)).next(()=>l.localDocuments.getDocuments(d,f))})}(n.localStore,t);Vc(n,t,e),Cc(n,t),n.sharedClientState.updateMutationState(t,"rejected",e),yield pe(n,i)}catch(i){yield Ue(i)}})}function Rp(r,t){return D(this,null,function*(){let e=F(r);qe(e.remoteStore)||P("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let n=yield function(a){let u=F(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",l=>u.mutationQueue.getHighestUnacknowledgedBatchId(l))}(e.localStore);if(n===-1)return void t.resolve();let i=e.Oa.get(n)||[];i.push(t),e.Oa.set(n,i)}catch(n){let i=or(n,"Initialization of waitForPendingWrites() operation failed");t.reject(i)}})}function Cc(r,t){(r.Oa.get(t)||[]).forEach(e=>{e.resolve()}),r.Oa.delete(t)}function Vc(r,t,e){let n=F(r),i=n.xa[n.currentUser.toKey()];if(i){let s=i.get(t);s&&(e?s.reject(e):s.resolve(),i=i.remove(t)),n.xa[n.currentUser.toKey()]=i}}function Yn(r,t,e=null){r.sharedClientState.removeLocalQueryTarget(t);for(let n of r.Da.get(t))r.ba.delete(n),e&&r.Sa.ka(n,e);r.Da.delete(t),r.isPrimaryClient&&r.Ma.Vr(t).forEach(n=>{r.Ma.containsKey(n)||Nf(r,n)})}function Nf(r,t){r.Ca.delete(t.path.canonicalString());let e=r.va.get(t);e!==null&&(Wn(r.remoteStore,e),r.va=r.va.remove(t),r.Fa.delete(e),Sc(r))}function Bu(r,t,e){for(let n of e)n instanceof js?(r.Ma.addReference(n.key,t),xp(r,n)):n instanceof zs?(P("SyncEngine","Document no longer in limbo: "+n.key),r.Ma.removeReference(n.key,t),r.Ma.containsKey(n.key)||Nf(r,n.key)):L()}function xp(r,t){let e=t.key,n=e.path.canonicalString();r.va.get(e)||r.Ca.has(n)||(P("SyncEngine","New document in limbo: "+e),r.Ca.add(n),Sc(r))}function Sc(r){for(;r.Ca.size>0&&r.va.size<r.maxConcurrentLimboResolutions;){let t=r.Ca.values().next().value;r.Ca.delete(t);let e=new O(J.fromString(t)),n=r.Na.next();r.Fa.set(n,new Lu(e)),r.va=r.va.insert(e,n),ro(r.remoteStore,new Kn(Mt(nr(e.path)),n,"TargetPurposeLimboResolution",Ut.oe))}}function pe(r,t,e){return D(this,null,function*(){let n=F(r),i=[],s=[],a=[];n.ba.isEmpty()||(n.ba.forEach((u,l)=>{a.push(n.Ba(l,t,e).then(d=>{if((d||e)&&n.isPrimaryClient){let f=d&&!d.fromCache;n.sharedClientState.updateQueryState(l.targetId,f?"current":"not-current")}if(d){i.push(d);let f=_u.Ki(l.targetId,d);s.push(f)}}))}),yield Promise.all(a),n.Sa.h_(i),yield function(l,d){return D(this,null,function*(){let f=F(l);try{yield f.persistence.runTransaction("notifyLocalViewChanges","readwrite",g=>b.forEach(d,v=>b.forEach(v.qi,C=>f.persistence.referenceDelegate.addReference(g,v.targetId,C)).next(()=>b.forEach(v.Qi,C=>f.persistence.referenceDelegate.removeReference(g,v.targetId,C)))))}catch(g){if(!Be(g))throw g;P("LocalStore","Failed to update sequence numbers: "+g)}for(let g of d){let v=g.targetId;if(!g.fromCache){let C=f.ns.get(v),N=C.snapshotVersion,k=C.withLastLimboFreeSnapshotVersion(N);f.ns=f.ns.insert(v,k)}}})}(n.localStore,s))})}function Np(r,t){return D(this,null,function*(){let e=F(r);if(!e.currentUser.isEqual(t)){P("SyncEngine","User change. New user:",t.toKey());let n=yield _f(e.localStore,t);e.currentUser=t,function(s,a){s.Oa.forEach(u=>{u.forEach(l=>{l.reject(new R(S.CANCELLED,a))})}),s.Oa.clear()}(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),yield pe(e,n.us)}})}function kp(r,t){let e=F(r),n=e.Fa.get(t);if(n&&n.wa)return K().add(n.key);{let i=K(),s=e.Da.get(t);if(!s)return i;for(let a of s){let u=e.ba.get(a);i=i.unionWith(u.view.Ea)}return i}}function Mp(r,t){return D(this,null,function*(){let e=F(r),n=yield Ns(e.localStore,t.query,!0),i=t.view.pa(n);return e.isPrimaryClient&&Bu(e,t.targetId,i.fa),i})}function Fp(r,t){return D(this,null,function*(){let e=F(r);return If(e.localStore,t).then(n=>pe(e,n))})}function Op(r,t,e,n){return D(this,null,function*(){let i=F(r),s=yield function(u,l){let d=F(u),f=F(d.mutationQueue);return d.persistence.runTransaction("Lookup mutation documents","readonly",g=>f.vn(g,l).next(v=>v?d.localDocuments.getDocuments(g,v):b.resolve(null)))}(i.localStore,t);s!==null?(e==="pending"?yield ir(i.remoteStore):e==="acknowledged"||e==="rejected"?(Vc(i,t,n||null),Cc(i,t),function(u,l){F(F(u).mutationQueue).Mn(l)}(i.localStore,t)):L(),yield pe(i,s)):P("SyncEngine","Cannot apply mutation batch with id: "+t)})}function Lp(r,t){return D(this,null,function*(){let e=F(r);if(io(e),Dc(e),t===!0&&e.La!==!0){let n=e.sharedClientState.getAllActiveQueryTargets(),i=yield sd(e,n.toArray());e.La=!0,yield Pu(e.remoteStore,!0);for(let s of i)ro(e.remoteStore,s)}else if(t===!1&&e.La!==!1){let n=[],i=Promise.resolve();e.Da.forEach((s,a)=>{e.sharedClientState.isLocalQueryTarget(a)?n.push(a):i=i.then(()=>(Yn(e,a),Hn(e.localStore,a,!0))),Wn(e.remoteStore,a)}),yield i,yield sd(e,n),function(a){let u=F(a);u.Fa.forEach((l,d)=>{Wn(u.remoteStore,d)}),u.Ma.mr(),u.Fa=new Map,u.va=new it(O.comparator)}(e),e.La=!1,yield Pu(e.remoteStore,!1)}})}function sd(r,t,e){return D(this,null,function*(){let n=F(r),i=[],s=[];for(let a of t){let u,l=n.Da.get(a);if(l&&l.length!==0){u=yield Qn(n.localStore,Mt(l[0]));for(let d of l){let f=n.ba.get(d),g=yield Mp(n,f);g.snapshot&&s.push(g.snapshot)}}else{let d=yield Ef(n.localStore,a);u=yield Qn(n.localStore,d),yield bc(n,kf(d),a,!1,u.resumeToken)}i.push(u)}return n.Sa.h_(s),i})}function kf(r){return xd(r.path,r.collectionGroup,r.orderBy,r.filters,r.limit,"F",r.startAt,r.endAt)}function Up(r){return function(e){return F(F(e).persistence).Bi()}(F(r).localStore)}function Bp(r,t,e,n){return D(this,null,function*(){let i=F(r);if(i.La)return void P("SyncEngine","Ignoring unexpected query state notification.");let s=i.Da.get(t);if(s&&s.length>0)switch(e){case"current":case"not-current":{let a=yield If(i.localStore,kd(s[0])),u=ri.createSynthesizedRemoteEventForCurrentChange(t,e==="current",Et.EMPTY_BYTE_STRING);yield pe(i,a,u);break}case"rejected":yield Hn(i.localStore,t,!0),Yn(i,t,n);break;default:L()}})}function qp(r,t,e){return D(this,null,function*(){let n=io(r);if(n.La){for(let i of t){if(n.Da.has(i)&&n.sharedClientState.isActiveQueryTarget(i)){P("SyncEngine","Adding an already active target "+i);continue}let s=yield Ef(n.localStore,i),a=yield Qn(n.localStore,s);yield bc(n,kf(s),a.targetId,!1,a.resumeToken),ro(n.remoteStore,a)}for(let i of e)n.Da.has(i)&&(yield Hn(n.localStore,i,!1).then(()=>{Wn(n.remoteStore,i),Yn(n,i)}).catch(Ue))}})}function io(r){let t=F(r);return t.remoteStore.remoteSyncer.applyRemoteEvent=xf.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=kp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Sp.bind(null,t),t.Sa.h_=Ep.bind(null,t.eventManager),t.Sa.ka=Ip.bind(null,t.eventManager),t}function Dc(r){let t=F(r);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Dp.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Pp.bind(null,t),t}function Gp(r,t,e){let n=F(r);(function(s,a,u){return D(this,null,function*(){try{let l=yield a.getMetadata();if(yield function(C,N){let k=F(C),x=dt(N.createTime);return k.persistence.runTransaction("hasNewerBundle","readonly",G=>k.$r.getBundleMetadata(G,N.id)).then(G=>!!G&&G.createTime.compareTo(x)>=0)}(s.localStore,l))return yield a.close(),u._completeWith(function(C){return{taskState:"Success",documentsLoaded:C.totalDocuments,bytesLoaded:C.totalBytes,totalDocuments:C.totalDocuments,totalBytes:C.totalBytes}}(l)),Promise.resolve(new Set);u._updateProgress(Pf(l));let d=new Fu(l,s.localStore,a.serializer),f=yield a.qa();for(;f;){let v=yield d._a(f);v&&u._updateProgress(v),f=yield a.qa()}let g=yield d.complete();return yield pe(s,g.ca,void 0),yield function(C,N){let k=F(C);return k.persistence.runTransaction("Save bundle","readwrite",x=>k.$r.saveBundleMetadata(x,N))}(s.localStore,l),u._completeWith(g.progress),Promise.resolve(g.ua)}catch(l){return ee("SyncEngine",`Loading bundle failed with ${l}`),u._failWith(l),Promise.resolve(new Set)}})})(n,t,e).then(i=>{n.sharedClientState.notifyBundleLoaded(i)})}var di=class{constructor(){this.synchronizeTabs=!1}initialize(t){return D(this,null,function*(){this.serializer=Ei(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),yield this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)})}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return yf(this.persistence,new xs,t.initialUser,this.serializer)}createPersistence(t){return new Ps(Rs.Hr,this.serializer)}createSharedClientState(t){return new Fs}terminate(){return D(this,null,function*(){var t,e;(t=this.gcScheduler)===null||t===void 0||t.stop(),(e=this.indexBackfillerScheduler)===null||e===void 0||e.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var $s=class r extends di{constructor(t,e,n){super(),this.Qa=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}initialize(t){return D(this,null,function*(){yield $o(r.prototype,this,"initialize").call(this,t),yield this.Qa.initialize(this,t),yield Dc(this.Qa.syncEngine),yield ir(this.Qa.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(t){return yf(this.persistence,new xs,t.initialUser,this.serializer)}createGarbageCollectionScheduler(t,e){let n=this.persistence.referenceDelegate.garbageCollector;return new ru(n,t.asyncQueue,e)}createIndexBackfillerScheduler(t,e){let n=new Ea(e,this.persistence);return new wa(t.asyncQueue,n)}createPersistence(t){let e=_c(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=this.cacheSizeBytes!==void 0?Gt.withCacheSize(this.cacheSizeBytes):Gt.DEFAULT;return new yu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Af(),is(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(t){return new Fs}},qu=class r extends $s{constructor(t,e){super(t,e,!1),this.Qa=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}initialize(t){return D(this,null,function*(){yield $o(r.prototype,this,"initialize").call(this,t);let e=this.Qa.syncEngine;this.sharedClientState instanceof Qr&&(this.sharedClientState.syncEngine={Zs:Op.bind(null,e),Xs:Bp.bind(null,e),eo:qp.bind(null,e),Bi:Up.bind(null,e),Ys:Fp.bind(null,e)},yield this.sharedClientState.start()),yield this.persistence.fi(n=>D(this,null,function*(){yield Lp(this.Qa.syncEngine,n),this.gcScheduler&&(n&&!this.gcScheduler.started?this.gcScheduler.start():n||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(n&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():n||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(t){let e=Af();if(!Qr.D(e))throw new R(S.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let n=_c(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Qr(e,t.asyncQueue,n,t.clientId,t.initialUser)}},fi=class{initialize(t,e){return D(this,null,function*(){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=n=>id(this.syncEngine,n,1),this.remoteStore.remoteSyncer.handleCredentialChange=Np.bind(null,this.syncEngine),yield Pu(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(t){return function(){return new Nu}()}createDatastore(t){let e=Ei(t.databaseInfo.databaseId),n=function(s){return new Au(s)}(t.databaseInfo);return function(s,a,u,l){return new Vu(s,a,u,l)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(n,i,s,a,u){return new Du(n,i,s,a,u)}(this.localStore,this.datastore,t.asyncQueue,e=>id(this.syncEngine,e,0),function(){return Os.D()?new Os:new Iu}())}createSyncEngine(t,e){return function(i,s,a,u,l,d,f){let g=new Uu(i,s,a,u,l,d);return f&&(g.La=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return D(this,null,function*(){var t;yield function(n){return D(this,null,function*(){let i=F(n);P("RemoteStore","RemoteStore shutting down."),i.M_.add(5),yield rr(i),i.O_.shutdown(),i.N_.set("Unknown")})}(this.remoteStore),(t=this.datastore)===null||t===void 0||t.terminate()})}};function od(r,t=10240){let e=0;return{read(){return D(this,null,function*(){if(e<r.byteLength){let i={value:r.slice(e,e+t),done:!1};return e+=t,i}return{done:!0}})},cancel(){return D(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Xn=class{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ka(this.observer.next,t)}error(t){this.observer.error?this.Ka(this.observer.error,t):lt("Uncaught Error in snapshot listener:",t.toString())}$a(){this.muted=!0}Ka(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}};var Gu=class{constructor(t,e){this.Ua=t,this.serializer=e,this.metadata=new yt,this.buffer=new Uint8Array,this.Wa=function(){return new TextDecoder("utf-8")}(),this.Ga().then(n=>{n&&n.sa()?this.metadata.resolve(n.ia.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(n?.ia)}`))},n=>this.metadata.reject(n))}close(){return this.Ua.cancel()}getMetadata(){return D(this,null,function*(){return this.metadata.promise})}qa(){return D(this,null,function*(){return yield this.getMetadata(),this.Ga()})}Ga(){return D(this,null,function*(){let t=yield this.za();if(t===null)return null;let e=this.Wa.decode(t),n=Number(e);isNaN(n)&&this.ja(`length string (${e}) is not valid number`);let i=yield this.Ha(n);return new Mu(JSON.parse(i),t.length+n)})}Ja(){return this.buffer.findIndex(t=>t===123)}za(){return D(this,null,function*(){for(;this.Ja()<0&&!(yield this.Ya()););if(this.buffer.length===0)return null;let t=this.Ja();t<0&&this.ja("Reached the end of bundle when a length string is expected.");let e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e})}Ha(t){return D(this,null,function*(){for(;this.buffer.length<t;)(yield this.Ya())&&this.ja("Reached the end of bundle when more is expected.");let e=this.Wa.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e})}ja(t){throw this.Ua.cancel(),new Error(`Invalid bundle format: ${t}`)}Ya(){return D(this,null,function*(){let t=yield this.Ua.read();if(!t.done){let e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done})}};var ju=class{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(t){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new R(S.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let e=yield function(i,s){return D(this,null,function*(){let a=F(i),u={documents:s.map(g=>si(a.serializer,g))},l=yield a.xo("BatchGetDocuments",a.serializer.databaseId,J.emptyPath(),u,s.length),d=new Map;l.forEach(g=>{let v=Qg(a.serializer,g);d.set(v.key.toString(),v)});let f=[];return s.forEach(g=>{let v=d.get(g.toString());U(!!v),f.push(v)}),f})}(this.datastore,t);return e.forEach(n=>this.recordVersion(n)),e})}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(n){this.lastTransactionError=n}this.writtenDocs.add(t.toString())}delete(t){this.write(new ke(t,this.precondition(t))),this.writtenDocs.add(t.toString())}commit(){return D(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let t=this.readVersions;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((e,n)=>{let i=O.fromPath(n);this.mutations.push(new ti(i,this.precondition(i)))}),yield function(n,i){return D(this,null,function*(){let s=F(n),a={writes:i.map(u=>oi(s.serializer,u))};yield s.Co("Commit",s.serializer.databaseId,J.emptyPath(),a)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw L();e=B.min()}let n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new R(S.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){let e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?e.isEqual(B.min())?ct.exists(!1):ct.updateTime(e):ct.none()}preconditionForUpdate(t){let e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(B.min()))throw new R(S.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ct.updateTime(e)}return ct.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}};var zu=class{constructor(t,e,n,i,s){this.asyncQueue=t,this.datastore=e,this.options=n,this.updateFunction=i,this.deferred=s,this.Za=n.maxAttempts,this.Yo=new li(this.asyncQueue,"transaction_retry")}Xa(){this.Za-=1,this.eu()}eu(){this.Yo.$o(()=>D(this,null,function*(){let t=new ju(this.datastore),e=this.tu(t);e&&e.then(n=>{this.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{this.deferred.resolve(n)}).catch(i=>{this.nu(i)}))}).catch(n=>{this.nu(n)})}))}tu(t){try{let e=this.updateFunction(t);return!yi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}nu(t){this.Za>0&&this.ru(t)?(this.Za-=1,this.asyncQueue.enqueueAndForget(()=>(this.eu(),Promise.resolve()))):this.deferred.reject(t)}ru(t){if(t.name==="FirebaseError"){let e=t.code;return e==="aborted"||e==="failed-precondition"||e==="already-exists"||!Hd(e)}return!1}};var Ku=class{constructor(t,e,n,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=i,this.user=pt.UNAUTHENTICATED,this.clientId=as.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,s=>D(this,null,function*(){P("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(n,s=>(P("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new R(S.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let t=new yt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){let n=or(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}};function ss(r,t){return D(this,null,function*(){r.asyncQueue.verifyOperationInProgress(),P("FirestoreClient","Initializing OfflineComponentProvider");let e=r.configuration;yield t.initialize(e);let n=e.initialUser;r.setCredentialChangeListener(i=>D(this,null,function*(){n.isEqual(i)||(yield _f(t.localStore,i),n=i)})),t.persistence.setDatabaseDeletedListener(()=>r.terminate()),r._offlineComponents=t})}function $u(r,t){return D(this,null,function*(){r.asyncQueue.verifyOperationInProgress();let e=yield Pc(r);P("FirestoreClient","Initializing OnlineComponentProvider"),yield t.initialize(e,r.configuration),r.setCredentialChangeListener(n=>nd(t.remoteStore,n)),r.setAppCheckTokenChangeListener((n,i)=>nd(t.remoteStore,i)),r._onlineComponents=t})}function Mf(r){return r.name==="FirebaseError"?r.code===S.FAILED_PRECONDITION||r.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&r instanceof DOMException)||r.code===22||r.code===20||r.code===11}function Pc(r){return D(this,null,function*(){if(!r._offlineComponents)if(r._uninitializedComponentsProvider){P("FirestoreClient","Using user provided OfflineComponentProvider");try{yield ss(r,r._uninitializedComponentsProvider._offline)}catch(t){let e=t;if(!Mf(e))throw e;ee("Error using user provided cache. Falling back to memory cache: "+e),yield ss(r,new di)}}else P("FirestoreClient","Using default OfflineComponentProvider"),yield ss(r,new di);return r._offlineComponents})}function so(r){return D(this,null,function*(){return r._onlineComponents||(r._uninitializedComponentsProvider?(P("FirestoreClient","Using user provided OnlineComponentProvider"),yield $u(r,r._uninitializedComponentsProvider._online)):(P("FirestoreClient","Using default OnlineComponentProvider"),yield $u(r,new fi))),r._onlineComponents})}function Ff(r){return Pc(r).then(t=>t.persistence)}function Rc(r){return Pc(r).then(t=>t.localStore)}function Of(r){return so(r).then(t=>t.remoteStore)}function xc(r){return so(r).then(t=>t.syncEngine)}function jp(r){return so(r).then(t=>t.datastore)}function Zn(r){return D(this,null,function*(){let t=yield so(r),e=t.eventManager;return e.onListen=Tp.bind(null,t.syncEngine),e.onUnlisten=bp.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Ap.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Cp.bind(null,t.syncEngine),e})}function zp(r){return r.asyncQueue.enqueue(()=>D(this,null,function*(){let t=yield Ff(r),e=yield Of(r);return t.setNetworkEnabled(!0),function(i){let s=F(i);return s.M_.delete(0),Ii(s)}(e)}))}function Kp(r){return r.asyncQueue.enqueue(()=>D(this,null,function*(){let t=yield Ff(r),e=yield Of(r);return t.setNetworkEnabled(!1),function(i){return D(this,null,function*(){let s=F(i);s.M_.add(0),yield rr(s),s.N_.set("Offline")})}(e)}))}function $p(r,t){let e=new yt;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s,a){return D(this,null,function*(){try{let u=yield function(d,f){let g=F(d);return g.persistence.runTransaction("read document","readonly",v=>g.localDocuments.getDocument(v,f))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new R(S.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){let l=or(u,`Failed to get document '${s} from cache`);a.reject(l)}})}(yield Rc(r),t,e)})),e.promise}function Lf(r,t,e={}){let n=new yt;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,a,u,l,d){let f=new Xn({next:v=>{a.enqueueAndForget(()=>Tc(s,g));let C=v.docs.has(u);!C&&v.fromCache?d.reject(new R(S.UNAVAILABLE,"Failed to get document because the client is offline.")):C&&v.fromCache&&l&&l.source==="server"?d.reject(new R(S.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):d.resolve(v)},error:v=>d.reject(v)}),g=new hi(nr(u.path),f,{includeMetadataChanges:!0,ra:!0});return Ic(s,g)}(yield Zn(r),r.asyncQueue,t,e,n)})),n.promise}function Qp(r,t){let e=new yt;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s,a){return D(this,null,function*(){try{let u=yield Ns(i,s,!0),l=new Ks(s,u.hs),d=l.da(u.documents),f=l.applyChanges(d,!1);a.resolve(f.snapshot)}catch(u){let l=or(u,`Failed to execute query '${s} against cache`);a.reject(l)}})}(yield Rc(r),t,e)})),e.promise}function Uf(r,t,e={}){let n=new yt;return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(s,a,u,l,d){let f=new Xn({next:v=>{a.enqueueAndForget(()=>Tc(s,g)),v.fromCache&&l.source==="server"?d.reject(new R(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(v)},error:v=>d.reject(v)}),g=new hi(u,f,{includeMetadataChanges:!0,ra:!0});return Ic(s,g)}(yield Zn(r),r.asyncQueue,t,e,n)})),n.promise}function Hp(r,t){let e=new Xn(t);return r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s){F(i).z_.add(s),s.next()}(yield Zn(r),e)})),()=>{e.$a(),r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return function(i,s){F(i).z_.delete(s)}(yield Zn(r),e)}))}}function Wp(r,t,e,n){let i=function(a,u){let l;return l=typeof a=="string"?Jd().encode(a):a,function(f,g){return new Gu(f,g)}(function(f,g){if(f instanceof Uint8Array)return od(f,g);if(f instanceof ArrayBuffer)return od(new Uint8Array(f),g);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(l),u)}(e,Ei(t));r.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){Gp(yield xc(r),i,n)}))}function Jp(r,t){return r.asyncQueue.enqueue(()=>D(this,null,function*(){return function(n,i){let s=F(n);return s.persistence.runTransaction("Get named query","readonly",a=>s.$r.getNamedQuery(a,i))}(yield Rc(r),t)}))}function Bf(r){let t={};return r.timeoutSeconds!==void 0&&(t.timeoutSeconds=r.timeoutSeconds),t}var ad=new Map;function Nc(r,t,e){if(!e)throw new R(S.INVALID_ARGUMENT,`Function ${r}() cannot be called with an empty ${t}.`)}function Yp(r,t,e,n){if(t===!0&&n===!0)throw new R(S.INVALID_ARGUMENT,`${r} and ${e} cannot be used together.`)}function ud(r){if(!O.isDocumentKey(r))throw new R(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${r} has ${r.length}.`)}function cd(r){if(O.isDocumentKey(r))throw new R(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${r} has ${r.length}.`)}function oo(r){if(r===void 0)return"undefined";if(r===null)return"null";if(typeof r=="string")return r.length>20&&(r=`${r.substring(0,20)}...`),JSON.stringify(r);if(typeof r=="number"||typeof r=="boolean")return""+r;if(typeof r=="object"){if(r instanceof Array)return"an array";{let t=function(n){return n.constructor?n.constructor.name:null}(r);return t?`a custom ${t} object`:"an object"}}return typeof r=="function"?"a function":L()}function X(r,t){if("_delegate"in r&&(r=r._delegate),!(r instanceof t)){if(t.name===r.constructor.name)throw new R(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let e=oo(r);throw new R(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return r}function qf(r,t){if(t<=0)throw new R(S.INVALID_ARGUMENT,`Function ${r}() requires a positive number, but it was: ${t}.`)}var Qs=class{constructor(t){var e,n;if(t.host===void 0){if(t.ssl!==void 0)throw new R(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=(e=t.ssl)===null||e===void 0||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<1048576)throw new R(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}Yp("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Bf((n=t.experimentalLongPollingOptions)!==null&&n!==void 0?n:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new R(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new R(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new R(S.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(n,i){return n.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}},ln=class{constructor(t,e,n,i){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Qs({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new R(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(t){if(this._settingsFrozen)throw new R(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Qs(t),t.credentials!==void 0&&(this._authCredentials=function(n){if(!n)return new la;switch(n.type){case"firstParty":return new ma(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new R(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){let n=ad.get(e);n&&(P("ComponentProvider","Removing Datastore"),ad.delete(e),n.terminate())}(this),Promise.resolve()}};function Xp(r,t,e,n={}){var i;let s=(r=X(r,ln))._getSettings(),a=`${t}:${e}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&ee("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),r._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),n.mockUserToken){let u,l;if(typeof n.mockUserToken=="string")u=n.mockUserToken,l=pt.MOCK_USER;else{u=th(n.mockUserToken,(i=r._app)===null||i===void 0?void 0:i.options.projectId);let d=n.mockUserToken.sub||n.mockUserToken.user_id;if(!d)throw new R(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new pt(d)}r._authCredentials=new ha(new os(u,l))}}var At=class r{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new r(this.firestore,t,this._query)}},ft=class r{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new te(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new r(this.firestore,t,this._key)}},te=class r extends At{constructor(t,e,n){super(t,e,nr(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let t=this._path.popLast();return t.isEmpty()?null:new ft(this.firestore,null,new O(t))}withConverter(t){return new r(this.firestore,t,this._path)}};function f_(r,t,...e){if(r=vt(r),Nc("collection","path",t),r instanceof ln){let n=J.fromString(t,...e);return cd(n),new te(r,null,n)}{if(!(r instanceof ft||r instanceof te))throw new R(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(J.fromString(t,...e));return cd(n),new te(r.firestore,null,n)}}function m_(r,t){if(r=X(r,ln),Nc("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new R(S.INVALID_ARGUMENT,`Invalid collection ID '${t}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new At(r,null,function(n){return new Kt(J.emptyPath(),n)}(t))}function Zp(r,t,...e){if(r=vt(r),arguments.length===1&&(t=as.newId()),Nc("doc","path",t),r instanceof ln){let n=J.fromString(t,...e);return ud(n),new ft(r,null,new O(n))}{if(!(r instanceof ft||r instanceof te))throw new R(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let n=r._path.child(J.fromString(t,...e));return ud(n),new ft(r.firestore,r instanceof te?r.converter:null,new O(n))}}function g_(r,t){return r=vt(r),t=vt(t),(r instanceof ft||r instanceof te)&&(t instanceof ft||t instanceof te)&&r.firestore===t.firestore&&r.path===t.path&&r.converter===t.converter}function ty(r,t){return r=vt(r),t=vt(t),r instanceof At&&t instanceof At&&r.firestore===t.firestore&&vi(r._query,t._query)&&r.converter===t.converter}var Qu=class{constructor(){this.iu=Promise.resolve(),this.su=[],this.ou=!1,this._u=[],this.au=null,this.uu=!1,this.cu=!1,this.lu=[],this.Yo=new li(this,"async_queue_retry"),this.hu=()=>{let e=is();e&&P("AsyncQueue","Visibility state changed to "+e.visibilityState),this.Yo.Wo()};let t=is();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.hu)}get isShuttingDown(){return this.ou}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.Pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.ou){this.ou=!0,this.cu=t||!1;let e=is();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this.hu)}}enqueue(t){if(this.Pu(),this.ou)return new Promise(()=>{});let e=new yt;return this.Iu(()=>this.ou&&this.cu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.su.push(t),this.Tu()))}Tu(){return D(this,null,function*(){if(this.su.length!==0){try{yield this.su[0](),this.su.shift(),this.Yo.reset()}catch(t){if(!Be(t))throw t;P("AsyncQueue","Operation failed with retryable error: "+t)}this.su.length>0&&this.Yo.$o(()=>this.Tu())}})}Iu(t){let e=this.iu.then(()=>(this.uu=!0,t().catch(n=>{this.au=n,this.uu=!1;let i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(n);throw lt("INTERNAL UNHANDLED ERROR: ",i),n}).then(n=>(this.uu=!1,n))));return this.iu=e,e}enqueueAfterDelay(t,e,n){this.Pu(),this.lu.indexOf(t)>-1&&(e=0);let i=Ru.createAndSchedule(this,t,e,n,s=>this.Eu(s));return this._u.push(i),i}Pu(){this.au&&L()}verifyOperationInProgress(){}du(){return D(this,null,function*(){let t;do t=this.iu,yield t;while(t!==this.iu)})}Au(t){for(let e of this._u)if(e.timerId===t)return!0;return!1}Ru(t){return this.du().then(()=>{this._u.sort((e,n)=>e.targetTimeMs-n.targetTimeMs);for(let e of this._u)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.du()})}Vu(t){this.lu.push(t)}Eu(t){let e=this._u.indexOf(t);this._u.splice(e,1)}};function Hu(r){return function(e,n){if(typeof e!="object"||e===null)return!1;let i=e;for(let s of n)if(s in i&&typeof i[s]=="function")return!0;return!1}(r,["next","error","complete"])}var Wu=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new yt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}};var p_=-1,st=class extends ln{constructor(t,e,n,i){super(t,e,n,i),this.type="firestore",this._queue=function(){return new Qu}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||jf(this),this._firestoreClient.terminate()}};function Gf(r,t){let e=typeof r=="object"?r:ch(),n=typeof r=="string"?r:t||"(default)",i=oh(e,"firestore").getImmediate({identifier:n});if(!i._initialized){let s=Zl("firestore");s&&Xp(i,...s)}return i}function bt(r){return r._firestoreClient||jf(r),r._firestoreClient.verifyNotTerminated(),r._firestoreClient}function jf(r){var t,e,n;let i=r._freezeSettings(),s=function(u,l,d,f){return new Ia(u,l,d,f.host,f.ssl,f.experimentalForceLongPolling,f.experimentalAutoDetectLongPolling,Bf(f.experimentalLongPollingOptions),f.useFetchStreams)}(r._databaseId,((t=r._app)===null||t===void 0?void 0:t.options.appId)||"",r._persistenceKey,i);r._firestoreClient=new Ku(r._authCredentials,r._appCheckCredentials,r._queue,s),!((e=i.localCache)===null||e===void 0)&&e._offlineComponentProvider&&(!((n=i.localCache)===null||n===void 0)&&n._onlineComponentProvider)&&(r._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function y_(r,t){Kf(r=X(r,st));let e=bt(r);if(e._uninitializedComponentsProvider)throw new R(S.FAILED_PRECONDITION,"SDK cache is already specified.");ee("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let n=r._freezeSettings(),i=new fi;return zf(e,i,new $s(i,n.cacheSizeBytes,t?.forceOwnership))}function __(r){Kf(r=X(r,st));let t=bt(r);if(t._uninitializedComponentsProvider)throw new R(S.FAILED_PRECONDITION,"SDK cache is already specified.");ee("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let e=r._freezeSettings(),n=new fi;return zf(t,n,new qu(n,e.cacheSizeBytes))}function zf(r,t,e){let n=new yt;return r.asyncQueue.enqueue(()=>D(this,null,function*(){try{yield ss(r,e),yield $u(r,t),n.resolve()}catch(i){let s=i;if(!Mf(s))throw s;ee("Error enabling indexeddb cache. Falling back to memory cache: "+s),n.reject(s)}})).then(()=>n.promise)}function v_(r){if(r._initialized&&!r._terminated)throw new R(S.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let t=new yt;return r._queue.enqueueAndForgetEvenWhileRestricted(()=>D(this,null,function*(){try{yield function(n){return D(this,null,function*(){if(!Se.D())return Promise.resolve();let i=n+"main";yield Se.delete(i)})}(_c(r._databaseId,r._persistenceKey)),t.resolve()}catch(e){t.reject(e)}})),t.promise}function w_(r){return function(e){let n=new yt;return e.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return Rp(yield xc(e),n)})),n.promise}(bt(r=X(r,st)))}function E_(r){return zp(bt(r=X(r,st)))}function I_(r){return Kp(bt(r=X(r,st)))}function T_(r,t){let e=bt(r=X(r,st)),n=new Wu;return Wp(e,r._databaseId,t,n),n}function A_(r,t){return Jp(bt(r=X(r,st)),t).then(e=>e?new At(r,null,e.query):null)}function Kf(r){if(r._initialized||r._terminated)throw new R(S.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var tr=class r{constructor(t){this._byteString=t}static fromBase64String(t){try{return new r(Et.fromBase64String(t))}catch(e){throw new R(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new r(Et.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}};var Fe=class{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new R(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}};var me=class{constructor(t){this._methodName=t}};var mi=class{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new R(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new R(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return z(this._lat,t._lat)||z(this._long,t._long)}};var ey=/^__.*__$/,Ju=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return this.fieldMask!==null?new $t(t,this.data,this.fieldMask,e,this.fieldTransforms):new Ne(t,this.data,e,this.fieldTransforms)}},Hs=class{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new $t(t,this.data,this.fieldMask,e,this.fieldTransforms)}};function $f(r){switch(r){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var Ws=class r{constructor(t,e,n,i,s,a){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=i,s===void 0&&this.mu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get fu(){return this.settings.fu}gu(t){return new r(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}pu(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.gu({path:n,yu:!1});return i.wu(t),i}Su(t){var e;let n=(e=this.path)===null||e===void 0?void 0:e.child(t),i=this.gu({path:n,yu:!1});return i.mu(),i}bu(t){return this.gu({path:void 0,yu:!0})}Du(t){return Js(t,this.settings.methodName,this.settings.Cu||!1,this.path,this.settings.vu)}contains(t){return this.fieldMask.find(e=>t.isPrefixOf(e))!==void 0||this.fieldTransforms.find(e=>t.isPrefixOf(e.field))!==void 0}mu(){if(this.path)for(let t=0;t<this.path.length;t++)this.wu(this.path.get(t))}wu(t){if(t.length===0)throw this.Du("Document fields must not be empty");if($f(this.fu)&&ey.test(t))throw this.Du('Document fields cannot begin and end with "__"')}},Yu=class{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ei(t)}Fu(t,e,n,i=!1){return new Ws({fu:t,methodName:e,vu:n,path:wt.emptyPath(),yu:!1,Cu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function mn(r){let t=r._freezeSettings(),e=Ei(r._databaseId);return new Yu(r._databaseId,!!t.ignoreUndefinedProperties,e)}function ao(r,t,e,n,i,s={}){let a=r.Fu(s.merge||s.mergeFields?2:0,t,e,i);Fc("Data must be an object, but it was:",a,n);let u=Wf(n,a),l,d;if(s.merge)l=new Bt(a.fieldMask),d=a.fieldTransforms;else if(s.mergeFields){let f=[];for(let g of s.mergeFields){let v=nc(t,g,e);if(!a.contains(v))throw new R(S.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);Yf(f,v)||f.push(v)}l=new Bt(f),d=a.fieldTransforms.filter(g=>l.covers(g.field))}else l=null,d=a.fieldTransforms;return new Ju(new Rt(u),l,d)}var gi=class r extends me{_toFieldTransform(t){if(t.fu!==2)throw t.fu===1?t.Du(`${this._methodName}() can only appear at the top level of your update data`):t.Du(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof r}};function Qf(r,t,e){return new Ws({fu:3,vu:t.settings.vu,methodName:r._methodName,yu:e},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}var Xu=class r extends me{_toFieldTransform(t){return new an(t.path,new Re)}isEqual(t){return t instanceof r}},Zu=class r extends me{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){let e=Qf(this,t,!0),n=this.Mu.map(s=>gn(s,e)),i=new de(n);return new an(t.path,i)}isEqual(t){return t instanceof r&&Xo(this.Mu,t.Mu)}},tc=class r extends me{constructor(t,e){super(t),this.Mu=e}_toFieldTransform(t){let e=Qf(this,t,!0),n=this.Mu.map(s=>gn(s,e)),i=new fe(n);return new an(t.path,i)}isEqual(t){return t instanceof r&&Xo(this.Mu,t.Mu)}},ec=class r extends me{constructor(t,e){super(t),this.xu=e}_toFieldTransform(t){let e=new xe(t.serializer,qd(t.serializer,this.xu));return new an(t.path,e)}isEqual(t){return t instanceof r&&this.xu===t.xu}};function kc(r,t,e,n){let i=r.Fu(1,t,e);Fc("Data must be an object, but it was:",i,n);let s=[],a=Rt.empty();fn(n,(l,d)=>{let f=Oc(t,l,e);d=vt(d);let g=i.Su(f);if(d instanceof gi)s.push(f);else{let v=gn(d,g);v!=null&&(s.push(f),a.set(f,v))}});let u=new Bt(s);return new Hs(a,u,i.fieldTransforms)}function Mc(r,t,e,n,i,s){let a=r.Fu(1,t,e),u=[nc(t,n,e)],l=[i];if(s.length%2!=0)throw new R(S.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<s.length;v+=2)u.push(nc(t,s[v])),l.push(s[v+1]);let d=[],f=Rt.empty();for(let v=u.length-1;v>=0;--v)if(!Yf(d,u[v])){let C=u[v],N=l[v];N=vt(N);let k=a.Su(C);if(N instanceof gi)d.push(C);else{let x=gn(N,k);x!=null&&(d.push(C),f.set(C,x))}}let g=new Bt(d);return new Hs(f,g,a.fieldTransforms)}function Hf(r,t,e,n=!1){return gn(e,r.Fu(n?4:3,t))}function gn(r,t){if(Jf(r=vt(r)))return Fc("Unsupported field value:",t,r),Wf(r,t);if(r instanceof me)return function(n,i){if(!$f(i.fu))throw i.Du(`${n._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Du(`${n._methodName}() is not currently supported inside arrays`);let s=n._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(r,t),null;if(r===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),r instanceof Array){if(t.settings.yu&&t.fu!==4)throw t.Du("Nested arrays are not supported");return function(n,i){let s=[],a=0;for(let u of n){let l=gn(u,i.bu(a));l==null&&(l={nullValue:"NULL_VALUE"}),s.push(l),a++}return{arrayValue:{values:s}}}(r,t)}return function(n,i){if((n=vt(n))===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return qd(i.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let s=ht.fromDate(n);return{timestampValue:zn(i.serializer,s)}}if(n instanceof ht){let s=new ht(n.seconds,1e3*Math.floor(n.nanoseconds/1e3));return{timestampValue:zn(i.serializer,s)}}if(n instanceof mi)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof tr)return{bytesValue:Yd(i.serializer,n._byteString)};if(n instanceof ft){let s=i.databaseId,a=n.firestore._databaseId;if(!a.isEqual(s))throw i.Du(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:gc(n.firestore._databaseId||i.databaseId,n._key.path)}}throw i.Du(`Unsupported field value: ${oo(n)}`)}(r,t)}function Wf(r,t){let e={};return Ad(r)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):fn(r,(n,i)=>{let s=gn(i,t.pu(n));s!=null&&(e[n]=s)}),{mapValue:{fields:e}}}function Jf(r){return!(typeof r!="object"||r===null||r instanceof Array||r instanceof Date||r instanceof ht||r instanceof mi||r instanceof tr||r instanceof ft||r instanceof me)}function Fc(r,t,e){if(!Jf(e)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(e)){let n=oo(e);throw n==="an object"?t.Du(r+" a custom object"):t.Du(r+" "+n)}}function nc(r,t,e){if((t=vt(t))instanceof Fe)return t._internalPath;if(typeof t=="string")return Oc(r,t);throw Js("Field path arguments must be of type string or ",r,!1,void 0,e)}var ny=new RegExp("[~\\*/\\[\\]]");function Oc(r,t,e){if(t.search(ny)>=0)throw Js(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,r,!1,void 0,e);try{return new Fe(...t.split("."))._internalPath}catch{throw Js(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,r,!1,void 0,e)}}function Js(r,t,e,n,i){let s=n&&!n.isEmpty(),a=i!==void 0,u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let l="";return(s||a)&&(l+=" (found",s&&(l+=` in field ${n}`),a&&(l+=` in document ${i}`),l+=")"),new R(S.INVALID_ARGUMENT,u+r+l)}function Yf(r,t){return r.some(e=>e.isEqual(t))}var hn=class{constructor(t,e,n,i,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ft(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let t=new rc(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){let e=this._document.data.field(uo("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}},rc=class extends hn{data(){return super.data()}};function uo(r,t){return typeof t=="string"?Oc(r,t):t instanceof Fe?t._internalPath:t._delegate._internalPath}function Xf(r){if(r.limitType==="L"&&r.explicitOrderBy.length===0)throw new R(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var pi=class{},dn=class extends pi{};function b_(r,t,...e){let n=[];t instanceof pi&&n.push(t),n=n.concat(e),function(s){let a=s.filter(l=>l instanceof ic).length,u=s.filter(l=>l instanceof Ys).length;if(a>1||a>0&&u>0)throw new R(S.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(n);for(let i of n)r=i._apply(r);return r}var Ys=class r extends dn{constructor(t,e,n){super(),this._field=t,this._op=e,this._value=n,this.type="where"}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=this._parse(t);return tm(t._query,e),new At(t.firestore,t.converter,Ma(t._query,e))}_parse(t){let e=mn(t.firestore);return function(s,a,u,l,d,f,g){let v;if(d.isKeyField()){if(f==="array-contains"||f==="array-contains-any")throw new R(S.INVALID_ARGUMENT,`Invalid Query. You can't perform '${f}' queries on documentId().`);if(f==="in"||f==="not-in"){hd(g,f);let C=[];for(let N of g)C.push(ld(l,s,N));v={arrayValue:{values:C}}}else v=ld(l,s,g)}else f!=="in"&&f!=="not-in"&&f!=="array-contains-any"||hd(g,f),v=Hf(u,a,g,f==="in"||f==="not-in");return Q.create(d,f,v)}(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}};function C_(r,t,e){let n=t,i=uo("where",r);return Ys._create(i,n,e)}var ic=class r extends pi{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new r(t,e)}_parse(t){let e=this._queryConstraints.map(n=>n._parse(t)).filter(n=>n.getFilters().length>0);return e.length===1?e[0]:tt.create(e,this._getOperator())}_apply(t){let e=this._parse(t);return e.getFilters().length===0?t:(function(i,s){let a=i,u=s.getFlattenedFilters();for(let l of u)tm(a,l),a=Ma(a,l)}(t._query,e),new At(t.firestore,t.converter,Ma(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var sc=class r extends dn{constructor(t,e){super(),this._field=t,this._direction=e,this.type="orderBy"}static _create(t,e){return new r(t,e)}_apply(t){let e=function(i,s,a){if(i.startAt!==null)throw new R(S.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new R(S.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new sn(s,a)}(t._query,this._field,this._direction);return new At(t.firestore,t.converter,function(i,s){let a=i.explicitOrderBy.concat([s]);return new Kt(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(t._query,e))}};function V_(r,t="asc"){let e=t,n=uo("orderBy",r);return sc._create(n,e)}var Xs=class r extends dn{constructor(t,e,n){super(),this.type=t,this._limit=e,this._limitType=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){return new At(t.firestore,t.converter,ys(t._query,this._limit,this._limitType))}};function S_(r){return qf("limit",r),Xs._create("limit",r,"F")}function D_(r){return qf("limitToLast",r),Xs._create("limitToLast",r,"L")}var Zs=class r extends dn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Zf(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,function(i,s){return new Kt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(t._query,e))}};function P_(...r){return Zs._create("startAt",r,!0)}function R_(...r){return Zs._create("startAfter",r,!1)}var to=class r extends dn{constructor(t,e,n){super(),this.type=t,this._docOrFields=e,this._inclusive=n}static _create(t,e,n){return new r(t,e,n)}_apply(t){let e=Zf(t,this.type,this._docOrFields,this._inclusive);return new At(t.firestore,t.converter,function(i,s){return new Kt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(t._query,e))}};function x_(...r){return to._create("endBefore",r,!1)}function N_(...r){return to._create("endAt",r,!0)}function Zf(r,t,e,n){if(e[0]=vt(e[0]),e[0]instanceof hn)return function(s,a,u,l,d){if(!l)throw new R(S.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);let f=[];for(let g of kn(s))if(g.field.isKeyField())f.push(rn(a,l.key));else{let v=l.data.field(g.field);if(no(v))throw new R(S.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(v===null){let C=g.field.canonicalString();throw new R(S.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${C}' (used as the orderBy) does not exist.`)}f.push(v)}return new re(f,d)}(r._query,r.firestore._databaseId,t,e[0]._document,n);{let i=mn(r.firestore);return function(a,u,l,d,f,g){let v=a.explicitOrderBy;if(f.length>v.length)throw new R(S.INVALID_ARGUMENT,`Too many arguments provided to ${d}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let C=[];for(let N=0;N<f.length;N++){let k=f[N];if(v[N].field.isKeyField()){if(typeof k!="string")throw new R(S.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${d}(), but got a ${typeof k}`);if(!fc(a)&&k.indexOf("/")!==-1)throw new R(S.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${d}() must be a plain document ID, but '${k}' contains a slash.`);let x=a.path.child(J.fromString(k));if(!O.isDocumentKey(x))throw new R(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${d}() must result in a valid document path, but '${x}' is not because it contains an odd number of segments.`);let G=new O(x);C.push(rn(u,G))}else{let x=Hf(l,d,k);C.push(x)}}return new re(C,g)}(r._query,r.firestore._databaseId,i,t,e,n)}}function ld(r,t,e){if(typeof(e=vt(e))=="string"){if(e==="")throw new R(S.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!fc(t)&&e.indexOf("/")!==-1)throw new R(S.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);let n=t.path.child(J.fromString(e));if(!O.isDocumentKey(n))throw new R(S.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${n}' is not because it has an odd number of segments (${n.length}).`);return rn(r,new O(n))}if(e instanceof ft)return rn(r,e._key);throw new R(S.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${oo(e)}.`)}function hd(r,t){if(!Array.isArray(r)||r.length===0)throw new R(S.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function tm(r,t){let e=function(i,s){for(let a of i)for(let u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(r.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(e!==null)throw e===t.op?new R(S.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new R(S.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}var eo=class{convertValue(t,e="none"){switch(nn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return ut(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(De(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw L()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){let n={};return fn(t,(i,s)=>{n[i]=this.convertValue(s,e)}),n}convertGeoPoint(t){return new mi(ut(t.latitude),ut(t.longitude))}convertArray(t,e){return(t.values||[]).map(n=>this.convertValue(n,e))}convertServerTimestamp(t,e){switch(e){case"previous":let n=hc(t);return n==null?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Yr(t));default:return null}}convertTimestamp(t){let e=he(t);return new ht(e.seconds,e.nanos)}convertDocumentKey(t,e){let n=J.fromString(t);U(cf(n));let i=new Un(n.get(1),n.get(3)),s=new O(n.popFirst(5));return i.isEqual(e)||lt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}};function co(r,t,e){let n;return n=r?e&&(e.merge||e.mergeFields)?r.toFirestore(t,e):r.toFirestore(t):t,n}var oc=class extends eo{constructor(t){super(),this.firestore=t}convertBytes(t){return new tr(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ft(this.firestore,null,e)}};var le=class{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}},Oe=class extends hn{constructor(t,e,n,i,s,a){super(t,e,n,i,a),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){let e=new Fn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){let n=this._document.data.field(uo("DocumentSnapshot.get",t));if(n!==null)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}},Fn=class extends Oe{data(t={}){return super.data(t)}},Le=class{constructor(t,e,n,i){this._firestore=t,this._userDataWriter=e,this._snapshot=i,this.metadata=new le(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){let t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new Fn(this._firestore,this._userDataWriter,n.key,n,new le(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){let e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new R(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{let l=new Fn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new le(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:l,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{let l=new Fn(i._firestore,i._userDataWriter,u.doc.key,u.doc,new le(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),d=-1,f=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),f=a.indexOf(u.doc.key)),{type:ry(u.type),doc:l,oldIndex:d,newIndex:f}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}};function ry(r){switch(r){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function k_(r,t){return r instanceof Oe&&t instanceof Oe?r._firestore===t._firestore&&r._key.isEqual(t._key)&&(r._document===null?t._document===null:r._document.isEqual(t._document))&&r._converter===t._converter:r instanceof Le&&t instanceof Le&&r._firestore===t._firestore&&ty(r.query,t.query)&&r.metadata.isEqual(t.metadata)&&r._snapshot.isEqual(t._snapshot)}function M_(r){r=X(r,ft);let t=X(r.firestore,st);return Lf(bt(t),r._key).then(e=>Lc(t,r,e))}var ge=class extends eo{constructor(t){super(),this.firestore=t}convertBytes(t){return new tr(t)}convertReference(t){let e=this.convertDocumentKey(t,this.firestore._databaseId);return new ft(this.firestore,null,e)}};function F_(r){r=X(r,ft);let t=X(r.firestore,st),e=bt(t),n=new ge(t);return $p(e,r._key).then(i=>new Oe(t,n,r._key,i,new le(i!==null&&i.hasLocalMutations,!0),r.converter))}function O_(r){r=X(r,ft);let t=X(r.firestore,st);return Lf(bt(t),r._key,{source:"server"}).then(e=>Lc(t,r,e))}function L_(r){r=X(r,At);let t=X(r.firestore,st),e=bt(t),n=new ge(t);return Xf(r._query),Uf(e,r._query).then(i=>new Le(t,n,r,i))}function U_(r){r=X(r,At);let t=X(r.firestore,st),e=bt(t),n=new ge(t);return Qp(e,r._query).then(i=>new Le(t,n,r,i))}function B_(r){r=X(r,At);let t=X(r.firestore,st),e=bt(t),n=new ge(t);return Uf(e,r._query,{source:"server"}).then(i=>new Le(t,n,r,i))}function q_(r,t,e){r=X(r,ft);let n=X(r.firestore,st),i=co(r.converter,t,e);return lo(n,[ao(mn(n),"setDoc",r._key,i,r.converter!==null,e).toMutation(r._key,ct.none())])}function G_(r,t,e,...n){r=X(r,ft);let i=X(r.firestore,st),s=mn(i),a;return a=typeof(t=vt(t))=="string"||t instanceof Fe?Mc(s,"updateDoc",r._key,t,e,n):kc(s,"updateDoc",r._key,t),lo(i,[a.toMutation(r._key,ct.exists(!0))])}function j_(r){return lo(X(r.firestore,st),[new ke(r._key,ct.none())])}function z_(r,t){let e=X(r.firestore,st),n=Zp(r),i=co(r.converter,t);return lo(e,[ao(mn(r.firestore),"addDoc",n._key,i,r.converter!==null,{}).toMutation(n._key,ct.exists(!1))]).then(()=>n)}function K_(r,...t){var e,n,i;r=vt(r);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof t[a]!="object"||Hu(t[a])||(s=t[a],a++);let u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Hu(t[a])){let g=t[a];t[a]=(e=g.next)===null||e===void 0?void 0:e.bind(g),t[a+1]=(n=g.error)===null||n===void 0?void 0:n.bind(g),t[a+2]=(i=g.complete)===null||i===void 0?void 0:i.bind(g)}let l,d,f;if(r instanceof ft)d=X(r.firestore,st),f=nr(r._key.path),l={next:g=>{t[a]&&t[a](Lc(d,r,g))},error:t[a+1],complete:t[a+2]};else{let g=X(r,At);d=X(g.firestore,st),f=g._query;let v=new ge(d);l={next:C=>{t[a]&&t[a](new Le(d,v,g,C))},error:t[a+1],complete:t[a+2]},Xf(r._query)}return function(v,C,N,k){let x=new Xn(k),G=new hi(C,x,N);return v.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return Ic(yield Zn(v),G)})),()=>{x.$a(),v.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return Tc(yield Zn(v),G)}))}}(bt(d),f,u,l)}function $_(r,t){return Hp(bt(r=X(r,st)),Hu(t)?t:{next:t})}function lo(r,t){return function(n,i){let s=new yt;return n.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){return Vp(yield xc(n),i,s)})),s.promise}(bt(r),t)}function Lc(r,t,e){let n=e.docs.get(t._key),i=new ge(r);return new Oe(r,i,t._key,n,new le(e.hasPendingWrites,e.fromCache),t.converter)}var iy={maxAttempts:5};var dd=class{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=mn(t)}set(t,e,n){this._verifyNotCommitted();let i=be(t,this._firestore),s=co(i.converter,e,n),a=ao(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,n);return this._mutations.push(a.toMutation(i._key,ct.none())),this}update(t,e,n,...i){this._verifyNotCommitted();let s=be(t,this._firestore),a;return a=typeof(e=vt(e))=="string"||e instanceof Fe?Mc(this._dataReader,"WriteBatch.update",s._key,e,n,i):kc(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(a.toMutation(s._key,ct.exists(!0))),this}delete(t){this._verifyNotCommitted();let e=be(t,this._firestore);return this._mutations=this._mutations.concat(new ke(e._key,ct.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new R(S.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function be(r,t){if((r=vt(r)).firestore!==t)throw new R(S.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return r}var ac=class extends class{constructor(e,n){this._firestore=e,this._transaction=n,this._dataReader=mn(e)}get(e){let n=be(e,this._firestore),i=new oc(this._firestore);return this._transaction.lookup([n._key]).then(s=>{if(!s||s.length!==1)return L();let a=s[0];if(a.isFoundDocument())return new hn(this._firestore,i,a.key,a,n.converter);if(a.isNoDocument())return new hn(this._firestore,i,n._key,null,n.converter);throw L()})}set(e,n,i){let s=be(e,this._firestore),a=co(s.converter,n,i),u=ao(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(e,n,i,...s){let a=be(e,this._firestore),u;return u=typeof(n=vt(n))=="string"||n instanceof Fe?Mc(this._dataReader,"Transaction.update",a._key,n,i,s):kc(this._dataReader,"Transaction.update",a._key,n),this._transaction.update(a._key,u),this}delete(e){let n=be(e,this._firestore);return this._transaction.delete(n._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){let e=be(t,this._firestore),n=new ge(this._firestore);return super.get(t).then(i=>new Oe(this._firestore,n,e._key,i._document,new le(!1,!1),e.converter))}};function H_(r,t,e){r=X(r,st);let n=Object.assign(Object.assign({},iy),e);return function(s){if(s.maxAttempts<1)throw new R(S.INVALID_ARGUMENT,"Max attempts must be at least 1")}(n),function(s,a,u){let l=new yt;return s.asyncQueue.enqueueAndForget(()=>D(this,null,function*(){let d=yield jp(s);new zu(s.asyncQueue,d,u,a,l).Xa()})),l.promise}(bt(r),i=>t(new ac(r,i)),n)}function W_(){return new gi("deleteField")}function J_(){return new Xu("serverTimestamp")}function Y_(...r){return new Zu("arrayUnion",r)}function X_(...r){return new tc("arrayRemove",r)}function Z_(r){return new ec("increment",r)}(function(t,e=!0){(function(i){er=i})(ah),sh(new rh("firestore",(n,{instanceIdentifier:i,options:s})=>{let a=n.getProvider("app").getImmediate(),u=new st(new da(n.getProvider("auth-internal")),new pa(n.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new R(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Un(d.options.projectId,f)}(a,i),a);return s=Object.assign({useFetchStreams:e},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),Mr(dh,"4.6.3",t),Mr(dh,"4.6.3","esm2017")})();var sy="firebase",oy="10.12.2";Mr(sy,oy,"app");var em={apiKey:"AIzaSyDAyqanqrMWsn3ZD5S3K3Fw1ncvLm3AW4I",authDomain:"checklistwf3.firebaseapp.com",projectId:"checklistwf3",storageBucket:"checklistwf3.appspot.com",messagingSenderId:"945728064927",appId:"1:945728064927:web:b7511ac72fe11d745e81aa",measurementId:"G-QY9BBZ34H5"};var{apiKey:ay,appId:uy,authDomain:cy,measurementId:ly,messagingSenderId:hy,projectId:dy,storageBucket:fy}=em,my={apiKey:ay,authDomain:cy,projectId:dy,storageBucket:fy,messagingSenderId:hy,appId:uy,measurementId:ly},hv=uh(my),dv=Gf();var lm=(()=>{let t=class t{constructor(n,i){this._renderer=n,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(n,i){this._renderer.setProperty(this._elementRef.nativeElement,n,i)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}};t.\u0275fac=function(i){return new(i||t)(ot(Nr),ot(Rr))},t.\u0275dir=Ft({type:t});let r=t;return r})(),vo=(()=>{let t=class t extends lm{};t.\u0275fac=(()=>{let n;return function(s){return(n||(n=Pr(t)))(s||t)}})(),t.\u0275dir=Ft({type:t,features:[Ht]});let r=t;return r})(),Di=new wn(""),gy={provide:Di,useExisting:$e(()=>py),multi:!0},py=(()=>{let t=class t extends vo{writeValue(n){this.setProperty("checked",n)}};t.\u0275fac=(()=>{let n;return function(s){return(n||(n=Pr(t)))(s||t)}})(),t.\u0275dir=Ft({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,s){i&1&&En("change",function(u){return s.onChange(u.target.checked)})("blur",function(){return s.onTouched()})},features:[Qe([gy]),Ht]});let r=t;return r})(),yy={provide:Di,useExisting:$e(()=>hm),multi:!0};function _y(){let r=Jo()?Jo().getUserAgent():"";return/android (\d+)/.test(r.toLowerCase())}var vy=new wn(""),hm=(()=>{let t=class t extends lm{constructor(n,i,s){super(n,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!_y())}writeValue(n){let i=n??"";this.setProperty("value",i)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}};t.\u0275fac=function(i){return new(i||t)(ot(Nr),ot(Rr),ot(vy,8))},t.\u0275dir=Ft({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&En("input",function(u){return s._handleInput(u.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(u){return s._compositionEnd(u.target.value)})},features:[Qe([yy]),Ht]});let r=t;return r})();var dm=new wn(""),fm=new wn("");function mm(r){return r!=null}function gm(r){return Jl(r)?$l(r):r}function pm(r){let t={};return r.forEach(e=>{t=e!=null?qt(qt({},t),e):t}),Object.keys(t).length===0?null:t}function ym(r,t){return t.map(e=>e(r))}function wy(r){return!r.validate}function _m(r){return r.map(t=>wy(t)?t:e=>t.validate(e))}function Ey(r){if(!r)return null;let t=r.filter(mm);return t.length==0?null:function(e){return pm(ym(e,t))}}function Bc(r){return r!=null?Ey(_m(r)):null}function Iy(r){if(!r)return null;let t=r.filter(mm);return t.length==0?null:function(e){let n=ym(e,t).map(gm);return Hl(n).pipe(Ql(pm))}}function qc(r){return r!=null?Iy(_m(r)):null}function nm(r,t){return r===null?[t]:Array.isArray(r)?[...r,t]:[r,t]}function Ty(r){return r._rawValidators}function Ay(r){return r._rawAsyncValidators}function Uc(r){return r?Array.isArray(r)?r:[r]:[]}function fo(r,t){return Array.isArray(r)?r.includes(t):r===t}function rm(r,t){let e=Uc(t);return Uc(r).forEach(i=>{fo(e,i)||e.push(i)}),e}function im(r,t){return Uc(t).filter(e=>!fo(r,e))}var mo=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=Bc(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=qc(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t=void 0){this.control&&this.control.reset(t)}hasError(t,e){return this.control?this.control.hasError(t,e):!1}getError(t,e){return this.control?this.control.getError(t,e):null}},cr=class extends mo{get formDirective(){return null}get path(){return null}},Si=class extends mo{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},go=class{constructor(t){this._cd=t}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},by={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},Mv=Qt(qt({},by),{"[class.ng-submitted]":"isSubmitted"}),Fv=(()=>{let t=class t extends go{constructor(n){super(n)}};t.\u0275fac=function(i){return new(i||t)(ot(Si,2))},t.\u0275dir=Ft({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Wo("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Ht]});let r=t;return r})(),Ov=(()=>{let t=class t extends go{constructor(n){super(n)}};t.\u0275fac=function(i){return new(i||t)(ot(cr,10))},t.\u0275dir=Ft({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Wo("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Ht]});let r=t;return r})();var Ti="VALID",ho="INVALID",ar="PENDING",Ai="DISABLED",lr=class{},po=class extends lr{constructor(t,e){super(),this.value=t,this.source=e}},Ci=class extends lr{constructor(t,e){super(),this.pristine=t,this.source=e}},Vi=class extends lr{constructor(t,e){super(),this.touched=t,this.source=e}},ur=class extends lr{constructor(t,e){super(),this.status=t,this.source=e}};function vm(r){return(wo(r)?r.validators:r)||null}function Cy(r){return Array.isArray(r)?Bc(r):r||null}function wm(r,t){return(wo(t)?t.asyncValidators:r)||null}function Vy(r){return Array.isArray(r)?qc(r):r||null}function wo(r){return r!=null&&!Array.isArray(r)&&typeof r=="object"}function Sy(r,t,e){let n=r.controls;if(!(t?Object.keys(n):n).length)throw new Qi(1e3,"");if(!n[e])throw new Qi(1001,"")}function Dy(r,t,e){r._forEachChild((n,i)=>{if(e[i]===void 0)throw new Qi(1002,"")})}var yo=class{constructor(t,e){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=null,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._events=new Kl,this.events=this._events.asObservable(),this._onDisabledChange=[],this._assignValidators(t),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===Ti}get invalid(){return this.status===ho}get pending(){return this.status==ar}get disabled(){return this.status===Ai}get enabled(){return this.status!==Ai}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._assignValidators(t)}setAsyncValidators(t){this._assignAsyncValidators(t)}addValidators(t){this.setValidators(rm(t,this._rawValidators))}addAsyncValidators(t){this.setAsyncValidators(rm(t,this._rawAsyncValidators))}removeValidators(t){this.setValidators(im(t,this._rawValidators))}removeAsyncValidators(t){this.setAsyncValidators(im(t,this._rawAsyncValidators))}hasValidator(t){return fo(this._rawValidators,t)}hasAsyncValidator(t){return fo(this._rawAsyncValidators,t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){let e=this.touched===!1;this.touched=!0;let n=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsTouched(Qt(qt({},t),{sourceControl:n})),e&&t.emitEvent!==!1&&this._events.next(new Vi(!0,n))}markAllAsTouched(t={}){this.markAsTouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(t))}markAsUntouched(t={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let n=t.sourceControl??this;this._forEachChild(i=>{i.markAsUntouched({onlySelf:!0,emitEvent:t.emitEvent,sourceControl:n})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,n),e&&t.emitEvent!==!1&&this._events.next(new Vi(!1,n))}markAsDirty(t={}){let e=this.pristine===!0;this.pristine=!1;let n=t.sourceControl??this;this._parent&&!t.onlySelf&&this._parent.markAsDirty(Qt(qt({},t),{sourceControl:n})),e&&t.emitEvent!==!1&&this._events.next(new Ci(!1,n))}markAsPristine(t={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let n=t.sourceControl??this;this._forEachChild(i=>{i.markAsPristine({onlySelf:!0,emitEvent:t.emitEvent})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t,n),e&&t.emitEvent!==!1&&this._events.next(new Ci(!0,n))}markAsPending(t={}){this.status=ar;let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new ur(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.markAsPending(Qt(qt({},t),{sourceControl:e}))}disable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Ai,this.errors=null,this._forEachChild(i=>{i.disable(Qt(qt({},t),{onlySelf:!0}))}),this._updateValue();let n=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new po(this.value,n)),this._events.next(new ur(this.status,n)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Qt(qt({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(i=>i(!0))}enable(t={}){let e=this._parentMarkedDirty(t.onlySelf);this.status=Ti,this._forEachChild(n=>{n.enable(Qt(qt({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Qt(qt({},t),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(n=>n(!1))}_updateAncestors(t,e){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(t){this._parent=t}getRawValue(){return this.value}updateValueAndValidity(t={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let n=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ti||this.status===ar)&&this._runAsyncValidator(n,t.emitEvent)}let e=t.sourceControl??this;t.emitEvent!==!1&&(this._events.next(new po(this.value,e)),this._events.next(new ur(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(Qt(qt({},t),{sourceControl:e}))}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ai:Ti}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t,e){if(this.asyncValidator){this.status=ar,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let n=gm(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(i=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(i,{emitEvent:e,shouldHaveEmitted:t})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let t=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,t}return!1}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(t){let e=t;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((n,i)=>n&&n._find(i),this)}getError(t,e){let n=e?this.get(e):this;return n&&n.errors?n.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t,e,n){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),(t||n)&&this._events.next(new ur(this.status,e)),this._parent&&this._parent._updateControlsErrors(t,e,n)}_initObservables(){this.valueChanges=new xr,this.statusChanges=new xr}_calculateStatus(){return this._allControlsDisabled()?Ai:this.errors?ho:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ar)?ar:this._anyControlsHaveStatus(ho)?ho:Ti}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t,e){let n=!this._anyControlsDirty(),i=this.pristine!==n;this.pristine=n,this._parent&&!t.onlySelf&&this._parent._updatePristine(t,e),i&&this._events.next(new Ci(this.pristine,e))}_updateTouched(t={},e){this.touched=this._anyControlsTouched(),this._events.next(new Vi(this.touched,e)),this._parent&&!t.onlySelf&&this._parent._updateTouched(t,e)}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){wo(t)&&t.updateOn!=null&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){let e=this._parent&&this._parent.dirty;return!t&&!!e&&!this._parent._anyControlsDirty()}_find(t){return null}_assignValidators(t){this._rawValidators=Array.isArray(t)?t.slice():t,this._composedValidatorFn=Cy(this._rawValidators)}_assignAsyncValidators(t){this._rawAsyncValidators=Array.isArray(t)?t.slice():t,this._composedAsyncValidatorFn=Vy(this._rawAsyncValidators)}},_o=class extends yo{constructor(t,e,n){super(vm(e),wm(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e,n={}){this.registerControl(t,e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}removeControl(t,e={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(t,e,n={}){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){Dy(this,!0,t),Object.keys(t).forEach(n=>{Sy(this,!0,n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){t!=null&&(Object.keys(t).forEach(n=>{let i=this.controls[n];i&&i.patchValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((n,i)=>{n.reset(t?t[i]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,n)=>(t[n]=e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(e,n)=>n._syncPendingControls()?!0:e);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_forEachChild(t){Object.keys(this.controls).forEach(e=>{let n=this.controls[e];n&&t(n,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(let[e,n]of Object.entries(this.controls))if(this.contains(e)&&t(n))return!0;return!1}_reduceValue(){let t={};return this._reduceChildren(t,(e,n,i)=>((n.enabled||this.disabled)&&(e[i]=n.value),e))}_reduceChildren(t,e){let n=t;return this._forEachChild((i,s)=>{n=e(n,i,s)}),n}_allControlsDisabled(){for(let t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(t){return this.controls.hasOwnProperty(t)?this.controls[t]:null}};var Gc=new wn("CallSetDisabledState",{providedIn:"root",factory:()=>jc}),jc="always";function Py(r,t){return[...t.path,r]}function Em(r,t,e=jc){Im(r,t),t.valueAccessor.writeValue(r.value),(r.disabled||e==="always")&&t.valueAccessor.setDisabledState?.(r.disabled),xy(r,t),ky(r,t),Ny(r,t),Ry(r,t)}function sm(r,t){r.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(t)})}function Ry(r,t){if(t.valueAccessor.setDisabledState){let e=n=>{t.valueAccessor.setDisabledState(n)};r.registerOnDisabledChange(e),t._registerOnDestroy(()=>{r._unregisterOnDisabledChange(e)})}}function Im(r,t){let e=Ty(r);t.validator!==null?r.setValidators(nm(e,t.validator)):typeof e=="function"&&r.setValidators([e]);let n=Ay(r);t.asyncValidator!==null?r.setAsyncValidators(nm(n,t.asyncValidator)):typeof n=="function"&&r.setAsyncValidators([n]);let i=()=>r.updateValueAndValidity();sm(t._rawValidators,i),sm(t._rawAsyncValidators,i)}function xy(r,t){t.valueAccessor.registerOnChange(e=>{r._pendingValue=e,r._pendingChange=!0,r._pendingDirty=!0,r.updateOn==="change"&&Tm(r,t)})}function Ny(r,t){t.valueAccessor.registerOnTouched(()=>{r._pendingTouched=!0,r.updateOn==="blur"&&r._pendingChange&&Tm(r,t),r.updateOn!=="submit"&&r.markAsTouched()})}function Tm(r,t){r._pendingDirty&&r.markAsDirty(),r.setValue(r._pendingValue,{emitModelToViewChange:!1}),t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1}function ky(r,t){let e=(n,i)=>{t.valueAccessor.writeValue(n),i&&t.viewToModelUpdate(n)};r.registerOnChange(e),t._registerOnDestroy(()=>{r._unregisterOnChange(e)})}function My(r,t){r==null,Im(r,t)}function Fy(r,t){if(!r.hasOwnProperty("model"))return!1;let e=r.model;return e.isFirstChange()?!0:!Object.is(t,e.currentValue)}function Oy(r){return Object.getPrototypeOf(r.constructor)===vo}function Ly(r,t){r._syncPendingControls(),t.forEach(e=>{let n=e.control;n.updateOn==="submit"&&n._pendingChange&&(e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1)})}function Uy(r,t){if(!t)return null;Array.isArray(t);let e,n,i;return t.forEach(s=>{s.constructor===hm?e=s:Oy(s)?n=s:i=s}),i||n||e||null}var By={provide:cr,useExisting:$e(()=>qy)},bi=Promise.resolve(),qy=(()=>{let t=class t extends cr{constructor(n,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new xr,this.form=new _o({},Bc(n),qc(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){bi.then(()=>{let i=this._findContainer(n.path);n.control=i.registerControl(n.name,n.control),Em(n.control,n,this.callSetDisabledState),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){bi.then(()=>{let i=this._findContainer(n.path);i&&i.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){bi.then(()=>{let i=this._findContainer(n.path),s=new _o({});My(s,n),i.registerControl(n.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){bi.then(()=>{let i=this._findContainer(n.path);i&&i.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,i){bi.then(()=>{this.form.get(n.path).setValue(i)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,Ly(this.form,this._directives),this.ngSubmit.emit(n),n?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(n=void 0){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}};t.\u0275fac=function(i){return new(i||t)(ot(dm,10),ot(fm,10),ot(Gc,8))},t.\u0275dir=Ft({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&En("submit",function(u){return s.onSubmit(u)})("reset",function(){return s.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[Qe([By]),Ht]});let r=t;return r})();function om(r,t){let e=r.indexOf(t);e>-1&&r.splice(e,1)}function am(r){return typeof r=="object"&&r!==null&&Object.keys(r).length===2&&"value"in r&&"disabled"in r}var Gy=class extends yo{constructor(t=null,e,n){super(vm(e),wm(n,e)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),wo(e)&&(e.nonNullable||e.initialValueIsDefault)&&(am(t)?this.defaultValue=t.value:this.defaultValue=t)}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(n=>n(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=this.defaultValue,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){om(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){om(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(t){am(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}};var jy={provide:Si,useExisting:$e(()=>zy)},um=Promise.resolve(),zy=(()=>{let t=class t extends Si{constructor(n,i,s,a,u,l){super(),this._changeDetectorRef=u,this.callSetDisabledState=l,this.control=new Gy,this._registered=!1,this.name="",this.update=new xr,this._parent=n,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=Uy(this,a)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){let i=n.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),Fy(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Em(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(n){um.then(()=>{this.control.setValue(n,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(n){let i=n.isDisabled.currentValue,s=i!==0&&Xl(i);um.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(n){return this._parent?Py(n,this._parent):[n]}};t.\u0275fac=function(i){return new(i||t)(ot(cr,9),ot(dm,10),ot(fm,10),ot(Di,10),ot(Yl,8),ot(Gc,8))},t.\u0275dir=Ft({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[Qe([jy]),Ht,Wl]});let r=t;return r})(),Uv=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275dir=Ft({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let r=t;return r})();var Ky={provide:Di,useExisting:$e(()=>bm),multi:!0};function Am(r,t){return r==null?`${t}`:(t&&typeof t=="object"&&(t="Object"),`${r}: ${t}`.slice(0,50))}function $y(r){return r.split(":")[0]}var bm=(()=>{let t=class t extends vo{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;let i=this._getOptionId(n),s=Am(i,n);this.setProperty("value",s)}registerOnChange(n){this.onChange=i=>{this.value=this._getOptionValue(i),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),n))return i;return null}_getOptionValue(n){let i=$y(n);return this._optionMap.has(i)?this._optionMap.get(i):n}};t.\u0275fac=(()=>{let n;return function(s){return(n||(n=Pr(t)))(s||t)}})(),t.\u0275dir=Ft({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,s){i&1&&En("change",function(u){return s.onChange(u.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[Qe([Ky]),Ht]});let r=t;return r})(),Bv=(()=>{let t=class t{constructor(n,i,s){this._element=n,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(n){this._select!=null&&(this._select._optionMap.set(this.id,n),this._setElementValue(Am(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};t.\u0275fac=function(i){return new(i||t)(ot(Rr),ot(Nr),ot(bm,9))},t.\u0275dir=Ft({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let r=t;return r})(),Qy={provide:Di,useExisting:$e(()=>Cm),multi:!0};function cm(r,t){return r==null?`${t}`:(typeof t=="string"&&(t=`'${t}'`),t&&typeof t=="object"&&(t="Object"),`${r}: ${t}`.slice(0,50))}function Hy(r){return r.split(":")[0]}var Cm=(()=>{let t=class t extends vo{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;let i;if(Array.isArray(n)){let s=n.map(a=>this._getOptionId(a));i=(a,u)=>{a._setSelected(s.indexOf(u.toString())>-1)}}else i=(s,a)=>{s._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(n){this.onChange=i=>{let s=[],a=i.selectedOptions;if(a!==void 0){let u=a;for(let l=0;l<u.length;l++){let d=u[l],f=this._getOptionValue(d.value);s.push(f)}}else{let u=i.options;for(let l=0;l<u.length;l++){let d=u[l];if(d.selected){let f=this._getOptionValue(d.value);s.push(f)}}}this.value=s,n(s)}}_registerOption(n){let i=(this._idCounter++).toString();return this._optionMap.set(i,n),i}_getOptionId(n){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,n))return i;return null}_getOptionValue(n){let i=Hy(n);return this._optionMap.has(i)?this._optionMap.get(i)._value:n}};t.\u0275fac=(()=>{let n;return function(s){return(n||(n=Pr(t)))(s||t)}})(),t.\u0275dir=Ft({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,s){i&1&&En("change",function(u){return s.onChange(u.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[Qe([Qy]),Ht]});let r=t;return r})(),qv=(()=>{let t=class t{constructor(n,i,s){this._element=n,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){this._select!=null&&(this._value=n,this._setElementValue(cm(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(cm(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};t.\u0275fac=function(i){return new(i||t)(ot(Rr),ot(Nr),ot(Cm,9))},t.\u0275dir=Ft({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let r=t;return r})();var Wy=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=Ho({type:t}),t.\u0275inj=Qo({});let r=t;return r})();var Gv=(()=>{let t=class t{static withConfig(n){return{ngModule:t,providers:[{provide:Gc,useValue:n.callSetDisabledState??jc}]}}};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=Ho({type:t}),t.\u0275inj=Qo({imports:[Wy]});let r=t;return r})();export{a_ as a,ee as b,u_ as c,R as d,ht as e,wt as f,O as g,l_ as h,Un as i,Yp as j,X as k,Xp as l,ft as m,f_ as n,m_ as o,Zp as p,g_ as q,ty as r,p_ as s,Gf as t,bt as u,y_ as v,__ as w,v_ as x,w_ as y,E_ as z,I_ as A,T_ as B,A_ as C,tr as D,Fe as E,mi as F,b_ as G,C_ as H,V_ as I,S_ as J,D_ as K,P_ as L,R_ as M,x_ as N,N_ as O,eo as P,Oe as Q,Fn as R,Le as S,k_ as T,M_ as U,F_ as V,O_ as W,L_ as X,U_ as Y,B_ as Z,q_ as _,G_ as $,j_ as aa,z_ as ba,K_ as ca,$_ as da,lo as ea,dd as fa,H_ as ga,W_ as ha,J_ as ia,Y_ as ja,X_ as ka,Z_ as la,my as ma,dv as na,py as oa,hm as pa,Fv as qa,Ov as ra,qy as sa,zy as ta,Uv as ua,bm as va,Bv as wa,qv as xa,Gv as ya};
