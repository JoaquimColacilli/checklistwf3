import{a as ie}from"./chunk-GCE7TE5F.js";import"./chunk-IWCTQMW2.js";import{U as B,X as q,_ as F,aa as H,ba as J,n as k,na as b,oa as K,p as w,pa as Q,qa as U,ta as X,va as Y,wa as Z,xa as ee,ya as te}from"./chunk-2XORILJT.js";import"./chunk-TC6LVV5X.js";import"./chunk-ICTHBN6B.js";import{Bb as G,Cb as W,Fb as z,Ia as s,Ja as L,Qb as R,_a as x,ab as _,cb as M,eb as a,ec as O,fb as n,fc as j,gb as D,ic as $,ja as T,jb as C,lb as m,mb as c,nb as I,sa as p,ta as g,tb as o,ub as V,vb as h,wb as N,xb as P,yb as S,zb as A}from"./chunk-NOL2URQB.js";import{a as y,b as E,f}from"./chunk-XBB5NZD7.js";var re=()=>[5,10,15,20];function ae(l,u){if(l&1){let r=C();a(0,"input",42),A("ngModelChange",function(e){p(r);let i=c().$implicit;return S(i.valor,e)||(i.valor=e),g(e)}),m("blur",function(){p(r);let e=c().index,i=c(2);return g(i.guardarCampo(e))}),n()}if(l&2){let r=c().$implicit;P("ngModel",r.valor)}}function oe(l,u){if(l&1){let r=C();a(0,"tr",34)(1,"td",27),o(2),n(),a(3,"td",35)(4,"div",36)(5,"input",37),A("ngModelChange",function(e){let i=p(r).$implicit;return S(i.responsableChecked,e)||(i.responsableChecked=e),g(e)}),m("change",function(){p(r);let e=c(2);return g(e.checkResponsableStatus())}),n(),o(6),n(),x(7,ae,1,1,"ng-template",null,0,z),n(),a(9,"td",27)(10,"button",38),m("click",function(){let e=p(r).index,i=c(2);return g(i.editarCampo(e))}),D(11,"i",39),o(12," Editar "),n(),a(13,"button",40),m("click",function(){let e=p(r).index,i=c(2);return g(i.confirmarEliminar(e))}),a(14,"i",41),m("click",function(){let e=p(r).index,i=c(2);return g(i.confirmarEliminar(e))}),n(),o(15," Eliminar "),n()()()}if(l&2){let r=u.$implicit,t=u.index;s(2),h(" ",t+1," "),s(3),P("ngModel",r.responsableChecked),s(),h(" ",r.valor," "),s(8),I("id","icono-",t,"")}}function se(l,u){if(l&1){let r=C();a(0,"div",20)(1,"div",21)(2,"div",22)(3,"h2",23),o(4," Editar Checklist "),n(),a(5,"table",24)(6,"thead",25)(7,"tr")(8,"th",26),o(9," ID "),n(),a(10,"th",27),o(11," Campo "),n(),a(12,"th",28),o(13," Acciones "),n()()(),a(14,"tbody"),x(15,oe,16,5,"tr",29),a(16,"tr")(17,"td",30)(18,"button",4),m("click",function(){p(r);let e=c();return g(e.agregarCampo())}),o(19," Agregar Campo "),n()()()()(),a(20,"div",31)(21,"button",32),m("click",function(){p(r);let e=c();return g(e.cerrarModal())}),o(22," Cancelar "),n(),a(23,"button",33),m("click",function(){p(r);let e=c();return g(e.guardarCambios())}),o(24," Guardar "),n()()()()()}if(l&2){let r=c();s(15),_("ngForOf",r.campos),s(8),_("disabled",!r.todosResponsablesMarcados())}}function le(l,u){if(l&1){let r=C();a(0,"app-nuevo-despliegue",43),m("cerrar",function(){p(r);let e=c();return g(e.cerrarModalNuevoDespliegue())})("guardar",function(e){p(r);let i=c();return g(i.guardarNuevoDespliegue(e,"WF3"))})("editar",function(e){p(r);let i=c();return g(i.editarNuevoDespliegue(e,"WF3"))}),n()}if(l&2){let r=c();_("campos",r.campos)("despliegue",r.esNuevoDespliegue?null:r.despliegueSeleccionado)("ambiente",r.ambiente)}}function ce(l,u){if(l&1){let r=C();a(0,"div",20)(1,"div",48)(2,"h2",49),o(3," Confirmar eliminaci\xF3n "),n(),a(4,"p",50),o(5," \xBFEst\xE1 seguro de eliminar el despliegue "),a(6,"strong"),o(7),n(),o(8," de "),a(9,"strong"),o(10),n(),o(11,"? "),n(),a(12,"div",51)(13,"button",3),m("click",function(){p(r);let e=c(2);return g(e.showConfirmDeleteModal=!1)}),o(14," Cancelar "),n(),a(15,"button",4),m("click",function(){p(r);let e=c().index,i=c();return g(i.eliminarDespliegue(e,"WF3"))}),o(16," Eliminar "),n()()()()}if(l&2){let r=c(2);s(7),V(r.deploymentToDelete.tag),s(3),V(r.deploymentToDelete.microservicio)}}function de(l,u){if(l&1){let r=C();a(0,"tr",44)(1,"td",27),o(2),n(),a(3,"td",27),o(4),n(),a(5,"td",27),o(6),n(),a(7,"td",27),o(8),n(),a(9,"td",27),o(10),n(),a(11,"td",27),o(12),n(),a(13,"td",27)(14,"button",45),m("click",function(){let e=p(r).index,i=c();return g(i.editarDespliegue(e))}),D(15,"i",39),n(),a(16,"button",46),m("click",function(){let e=p(r).index,i=c();return g(i.confirmDeleteDeployment(e))}),D(17,"i",47),n()(),x(18,ce,17,2,"div",5),n()}if(l&2){let r=u.$implicit,t=u.index,e=c();s(2),h(" ",t+1+(e.currentPage-1)*e.itemsPerPage," "),s(2),h(" ",r.responsable," "),s(2),h(" ",r.tag," "),s(2),h(" ",r.microservicio," "),s(2),h(" ",r.auditor," "),s(2),h(" ",r.fecha," "),s(6),_("ngIf",e.showConfirmDeleteModal)}}function me(l,u){if(l&1&&(a(0,"option",52),o(1),n()),l&2){let r=u.$implicit;_("value",r),s(),h(" ",r," ")}}var be=(()=>{let u=class u{constructor(t){this.cdr=t,this.modalAbierto=!1,this.modalNuevoDespliegueAbierto=!1,this.campos=[],this.datosGuardados=[],this.pagedDatosGuardados=[],this.despliegueSeleccionado=null,this.esNuevoDespliegue=!0,this.deploymentToDelete={auditor:null,checkList:null,fecha:null,id:null,microservicio:null,responsable:null,tag:null},this.showConfirmDeleteModal=!1,this.ambiente="WF3",this.itemsPerPage=5,this.currentPage=1,this.totalPages=1}ngOnInit(){return f(this,null,function*(){yield this.cargarDespliegues(this.ambiente),yield this.cargarDatos(this.ambiente)})}cargarDatos(t){return f(this,null,function*(){let e=w(k(b,"checklists"),`checklistActas_${t}`),i=yield B(e);if(i.exists()){let d=i.data();d&&"campos"in d&&Array.isArray(d.campos)?(this.campos=d.campos,this.cdr.markForCheck()):console.log("La estructura de datos en Firestore es incorrecta o no contiene campos.")}else console.log("No se encontraron datos en Firestore.")})}cargarDespliegues(t){return f(this,null,function*(){let e=k(b,`nuevosDespliegues_${t}`),i=yield q(e);this.datosGuardados=i.docs.map(d=>y({id:d.id},d.data())),this.totalPages=Math.ceil(this.datosGuardados.length/this.itemsPerPage),this.actualizarPagina(),this.cdr.markForCheck()})}actualizarPagina(){let t=(this.currentPage-1)*this.itemsPerPage,e=t+this.itemsPerPage;this.pagedDatosGuardados=this.datosGuardados.slice(t,e)}cambiarItemsPorPagina(){this.totalPages=Math.ceil(this.datosGuardados.length/this.itemsPerPage),this.currentPage=1,this.actualizarPagina()}paginaAnterior(){this.currentPage>1&&(this.currentPage--,this.actualizarPagina())}paginaSiguiente(){this.currentPage<this.totalPages&&(this.currentPage++,this.actualizarPagina())}abrirModal(){this.modalAbierto=!0}cerrarModal(){this.modalAbierto=!1}agregarCampo(){this.campos.push({valor:"",editando:!0,responsableChecked:!1})}confirmarEliminar(t){if(this.campos[t]?.confirmarEliminar)this.eliminarCampo(t);else if(this.campos[t]){this.campos[t].confirmarEliminar=!0;let e=document.getElementById("icono-"+t);e&&e.classList.add("text-red-500"),setTimeout(()=>{e&&e.classList.remove("text-red-500"),this.campos[t]&&(this.campos[t].confirmarEliminar=!1)},3e3)}}guardarCampo(t){this.campos[t].valor.trim()!==""&&(this.campos[t].editando=!1,this.actualizarCampoEnFirestore("WF3"))}actualizarCampoEnFirestore(t){return f(this,null,function*(){let e=w(k(b,"checklists"),`checklistActas_${t}`);try{yield F(e,{campos:this.campos,ambiente:t}),console.log("Cambios guardados en Firestore.")}catch(i){console.error("Error guardando los cambios en Firestore:",i)}})}editarCampo(t){this.campos[t].editando=!0}eliminarCampo(t){this.campos.splice(t,1),this.actualizarCampoEnFirestore("WF3")}guardarCambios(){return f(this,null,function*(){this.campos=this.campos.map((t,e)=>E(y({},t),{id:e+1})),this.cerrarModal(),yield this.actualizarCampoEnFirestore("WF3")})}todosResponsablesMarcados(){return this.campos.every(t=>t.responsableChecked)}checkResponsableStatus(){this.cdr.markForCheck()}abrirNuevoDespliegueModal(){this.modalNuevoDespliegueAbierto=!0,this.despliegueSeleccionado=null,this.esNuevoDespliegue=!0}cerrarModalNuevoDespliegue(){this.modalNuevoDespliegueAbierto=!1}guardarNuevoDespliegue(t,e){return f(this,null,function*(){console.log(t);try{let i=k(b,`nuevosDespliegues_${e}`),d=yield J(i,E(y({},t),{ambiente:e}));console.log("Nuevo despliegue guardado con ID: ",d.id),this.datosGuardados.push(E(y({},t),{id:d.id})),this.totalPages=Math.ceil(this.datosGuardados.length/this.itemsPerPage),this.actualizarPagina(),this.cdr.markForCheck(),this.cerrarModalNuevoDespliegue()}catch(i){console.error("Error guardando el nuevo despliegue en Firestore:",i)}})}editarNuevoDespliegue(t,e){return f(this,null,function*(){try{let i=w(b,`nuevosDespliegues_${e}`,t.id);yield F(i,t),console.log("Despliegue editado con ID: ",t.id);let d=this.datosGuardados.findIndex(v=>v.id===t.id);d>-1&&(this.datosGuardados[d]=t),this.actualizarPagina(),this.cdr.markForCheck(),this.cerrarModalNuevoDespliegue()}catch(i){console.error("Error editando el despliegue en Firestore:",i)}})}eliminarDespliegue(t,e){return f(this,null,function*(){try{let i=this.deploymentToDelete.id,d=w(b,`nuevosDespliegues_${e}`,i);yield H(d),this.datosGuardados=this.datosGuardados.filter((v,ne)=>ne!==t),this.totalPages=Math.ceil(this.datosGuardados.length/this.itemsPerPage),this.actualizarPagina(),console.log("Despliegue eliminado con ID: ",i),this.showConfirmDeleteModal=!1,this.cdr.markForCheck()}catch(i){console.error("Error eliminando el despliegue en Firestore:",i)}})}confirmDeleteDeployment(t){this.deploymentToDelete=this.datosGuardados[t],console.log(this.deploymentToDelete.id),this.showConfirmDeleteModal=!0}editarDespliegue(t){let e=this.datosGuardados[t];console.log(e),this.despliegueSeleccionado=e,this.esNuevoDespliegue=!1,console.log(this.despliegueSeleccionado),this.modalNuevoDespliegueAbierto=!0}};u.\u0275fac=function(e){return new(e||u)(L(R))},u.\u0275cmp=T({type:u,selectors:[["app-check-list-actas"]],standalone:!0,features:[G],decls:42,vars:14,consts:[["mostrarValor",""],[1,"font-bold","text-lg","lg:text-3xl","mb-4"],[1,"flex","justify-end","mb-4"],[1,"btn-primary","mr-2",3,"click"],[1,"btn-primary",3,"click"],["class","fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",4,"ngIf"],[3,"campos","despliegue","ambiente","cerrar","guardar","editar",4,"ngIf"],[1,"overflow-x-auto","mt-4"],[1,"w-full","table-auto","bg-gray-800","rounded-lg","overflow-hidden"],[1,"bg-gray-700","text-white"],[1,"px-4","py-2"],["class","hover:bg-gray-700 transition-colors",4,"ngFor","ngForOf"],[1,"flex","justify-between","items-center","mt-4","px-4","py-2","bg-gray-900","rounded-md"],[1,"flex","items-center"],["for","itemsPerPage",1,"text-gray-300","mr-2"],["id","itemsPerPage",1,"rounded-md","text-gray-900","bg-gray-200","border","border-gray-400","focus:outline-none","focus:ring-2","focus:ring-indigo-600",3,"ngModelChange","change","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"flex","items-center","space-x-2"],[1,"btn-secondary",3,"click","disabled"],[1,"text-gray-300"],[1,"fixed","inset-0","flex","items-center","justify-center","bg-black","bg-opacity-50","z-50"],[1,"bg-gray-900","rounded-lg","w-1/3","max-h-[80%]","max-w-[80%]","overflow-auto","px-3","py-2","scrollbar-thin","scrollbar-thumb-gray-700","scrollbar-track-gray-900","scrollbar-thumb-rounded-full","scrollbar-track-rounded-full"],[1,"modal-content"],[1,"text-2xl","font-bold","text-center","text-white","mb-4"],[1,"w-full","table-auto","bg-gray-800","rounded-lg"],[1,"bg-gray-700","text-white","rounded-t-lg"],[1,"px-4","py-2","border-b","border-gray-700","text-center","rounded-tl-lg"],[1,"px-4","py-2","border-b","border-gray-700","text-center"],[1,"px-4","py-2","border-b","border-gray-700","text-center","rounded-tr-lg"],["class","hover:bg-gray-700 transition-colors","style","height: 50px",4,"ngFor","ngForOf"],["colspan","3",1,"px-4","py-2","text-center"],[1,"flex","justify-end","mt-4"],[1,"btn-primary","mr-1",3,"click"],[1,"btn-primary",3,"click","disabled"],[1,"hover:bg-gray-700","transition-colors",2,"height","50px"],[1,"px-4","py-2","border-b","border-gray-700","boxPerso"],[1,"flex","items-center","justify-center"],["type","checkbox",1,"mr-2",3,"ngModelChange","change","ngModel"],[1,"btn-secondary","mr-2","transition-transform","duration-300","ease-in-out","hover:scale-105",3,"click"],[1,"fas","fa-edit"],[1,"btn-danger","transition-transform","duration-300","ease-in-out","hover:scale-105",3,"click"],[1,"fas","fa-trash-alt",3,"click","id"],[1,"w-full","rounded-md","text-gray-900","bg-gray-200","border","border-gray-400","focus:outline-none","focus:ring-2","focus:ring-indigo-600",3,"ngModelChange","blur","ngModel"],[3,"cerrar","guardar","editar","campos","despliegue","ambiente"],[1,"hover:bg-gray-700","transition-colors"],[1,"btn-secondary","transition-transform","duration-300","ease-in-out","hover:scale-105","mr-2",3,"click"],[1,"btn-secondary","transition-transform","duration-300","ease-in-out","hover:scale-105",3,"click"],[1,"fas","fa-trash"],[1,"bg-gray-900","rounded-lg","p-4","max-w-sm"],[1,"text-lg","font-bold","text-center","text-white","mb-3"],[1,"text-gray-300","mb-4","text-center","justify-center"],[1,"flex","justify-end"],[3,"value"]],template:function(e,i){e&1&&(a(0,"h1",1),o(1,"WF3 - Actas Digitales"),n(),a(2,"div",2)(3,"button",3),m("click",function(){return i.abrirNuevoDespliegueModal()}),o(4," Nuevo Despliegue "),n(),a(5,"button",4),m("click",function(){return i.abrirModal()}),o(6,"Editar Checklist"),n()(),x(7,se,25,2,"div",5)(8,le,1,3,"app-nuevo-despliegue",6),a(9,"div",7)(10,"table",8)(11,"thead")(12,"tr",9)(13,"th",10),o(14,"ID"),n(),a(15,"th",10),o(16,"Responsable"),n(),a(17,"th",10),o(18,"Tag"),n(),a(19,"th",10),o(20,"Microservicio"),n(),a(21,"th",10),o(22,"Auditor"),n(),a(23,"th",10),o(24,"Fecha"),n(),a(25,"th",10),o(26,"Acciones"),n()()(),a(27,"tbody"),x(28,de,19,7,"tr",11),n()()(),a(29,"div",12)(30,"div",13)(31,"label",14),o(32,"Items por p\xE1gina:"),n(),a(33,"select",15),A("ngModelChange",function(v){return S(i.itemsPerPage,v)||(i.itemsPerPage=v),v}),m("change",function(){return i.cambiarItemsPorPagina()}),x(34,me,2,2,"option",16),n()(),a(35,"div",17)(36,"button",18),m("click",function(){return i.paginaAnterior()}),o(37," Anterior "),n(),a(38,"span",19),o(39),n(),a(40,"button",18),m("click",function(){return i.paginaSiguiente()}),o(41," Siguiente "),n()()()),e&2&&(s(7),_("ngIf",i.modalAbierto),s(),_("ngIf",i.modalNuevoDespliegueAbierto),s(20),_("ngForOf",i.pagedDatosGuardados),s(5),P("ngModel",i.itemsPerPage),s(),_("ngForOf",W(13,re)),s(2),M("opacity-50",i.currentPage===1),_("disabled",i.currentPage===1),s(3),N("P\xE1gina ",i.currentPage," de ",i.totalPages,""),s(),M("opacity-50",i.currentPage===i.totalPages),_("disabled",i.currentPage===i.totalPages))},dependencies:[$,O,j,te,Z,ee,Q,K,Y,U,X,ie],changeDetection:0});let l=u;return l})();export{be as default};
