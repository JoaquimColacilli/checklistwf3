import{a as W}from"./chunk-OUWSLELB.js";import{a as Kl,b as Ql,c as Ii,d as bi,e as Yl,f as Zl,g as Ti}from"./chunk-V5EY3OZK.js";import{b as Gr,c as Ui,d as Dc,f as Bi,h as ji,i as Vi,j as Hi,k as Nc,l as Kr,o as Qr,p as xc,q as Fc,r as vn,s as Cn,t as Oc,u as qi,v as $t,w as Ye,x as zi,y as Ut}from"./chunk-IWCTQMW2.js";import{$ as Wi,A as vr,B as Cr,C as wr,D as Fi,E as Er,F as bc,G as xe,H as Ir,I as br,J as Tr,K as Ar,L as Sr,M as kr,N as Rr,O as Pr,P as Tc,Q as Oi,R as Ac,S as Dr,T as Mi,U as Nr,V as xr,W as Fr,X as Or,Y as Mr,Z as Lr,_ as Li,a as ur,aa as Wr,b as hc,ba as $r,c as fc,ca as $i,d as Wt,da as Ur,e as pc,ea as Sc,f as gc,fa as kc,g as mc,ga as Br,h as _c,ha as jr,i as yc,ia as Vr,j as vc,ja as Hr,k as Cc,ka as qr,l as dr,la as zr,m as _n,ma as Rc,n as Ni,o as hr,p as yn,q as xi,r as fr,s as wc,t as Ec,u as Ic,v as pr,w as gr,x as mr,y as _r,ya as Pc,z as yr}from"./chunk-2XORILJT.js";import{A as rc,B as ue,C as Qe,D as ki,E as pn,G as oc,J as ac,L as _,M as ne,N as L,O as lr,P as lc,Q as gn,R as U,S as Ce,T as Ri,U as cr,V as cc,W as Lt,_ as mn,a as f,b as Mt,ba as uc,c as Ai,ca as dc,d as Xl,da as Pi,ea as Di,f as Jl,ga as se,j as $,k as ec,m as ar,q as tc,s as Ne,u as nc,w as ic,x as Si,y as M,z as sc}from"./chunk-TC6LVV5X.js";import"./chunk-ICTHBN6B.js";import{$ as G,$a as hn,A as ke,Bb as ve,Da as Pe,Db as sr,Ea as dn,Eb as rr,G as _i,Gb as Ul,Hb as wi,I as yi,Ia as Be,Ja as F,K as El,Ka as Pl,La as Dl,Ma as Nl,N as vi,O as ht,Oa as xl,Ob as Bl,P as Il,Pb as or,Q as Js,Qa as Fl,Qb as jl,Ra as O,S as bl,T as ze,U as Ue,V as er,Va as Ci,X as Tl,Y as Al,Yb as Ot,Z as Sl,_a as ft,aa as ee,ab as Ft,bc as Vl,c as Se,ca as A,cb as tr,db as Ol,ea as g,eb as ye,ec as Hl,f as ge,fa as Ge,fb as De,ga as Re,gb as Ke,gc as ql,h as Nt,hb as nr,hc as zl,i as wl,ib as ir,ic as Gl,ja as me,k as He,ka as te,kb as Ml,l as ut,lc as Ei,m as qe,ma as xt,n as ce,na as kl,pb as Ll,qb as Wl,r as N,rb as $l,tb as pt,ub as fn,w as mi,wa as _e,ya as un,z as dt,za as Rl}from"./chunk-NOL2URQB.js";import{a as z,b as ct,f as Ae}from"./chunk-XBB5NZD7.js";var K=new Ul("ANGULARFIRE2_VERSION");function Zr(n,e,t){if(e){if(e.length===1)return e[0];let r=e.filter(o=>o.app===t);if(r.length===1)return r[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var wn=(n,e)=>{let t=e?[e]:Di(),i=[];return t.forEach(s=>{s.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},de=class{constructor(){return wn(Yh)}},Yh="app-check";function Bt(){}var Gi=class{zone;delegate;constructor(e,t=wl){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let s=this.zone,r=function(o){s.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(r,t,i)}},Yr=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let i=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Bt,{},Bt,Bt)),t.pipe(Tl({next:i,complete:i,error:i})).subscribe(e).add(i)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Ee=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Gi(Zone.current)),this.insideAngular=t.run(()=>new Gi(Zone.current,Nt)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(i){return new(i||n)(g(O))};static \u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function Ki(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function Zh(n){return Ki().ngZone.runOutsideAngular(()=>n())}function gt(n){return Ki().ngZone.run(()=>n())}function x(n){return Xh(Ki())(n)}function Xh(n){return function(t){return t=t.lift(new Yr(n.ngZone)),t.pipe(ut(n.outsideAngular),He(n.insideAngular))}}var Jh=(n,e)=>function(){let i=arguments;return e&&setTimeout(()=>{e.state==="scheduled"&&e.invoke()},10),gt(()=>n.apply(void 0,i))},En=(n,e)=>function(){let t,i=arguments;for(let r=0;r<arguments.length;r++)typeof i[r]=="function"&&(e&&(t||=gt(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Bt,{},Bt,Bt))),i[r]=Jh(i[r],t));let s=Zh(()=>n.apply(this,i));if(!e)if(s instanceof Se){let r=Ki();return s.pipe(ut(r.outsideAngular),He(r.insideAngular))}else return gt(()=>s);return s instanceof Se?s.pipe(x):s instanceof Promise?gt(()=>new Promise((r,o)=>s.then(a=>gt(()=>r(a)),a=>gt(()=>o(a))))):typeof s=="function"&&t?function(){return setTimeout(()=>{t&&t.state==="scheduled"&&t.invoke()},10),s.apply(this,arguments)}:gt(()=>s)};var ef="firebase",tf="10.12.2";W.registerVersion(ef,tf,"app-compat");var nf=["ngOnDestroy"],Lc=(n,e,t,i={})=>new Proxy(n,{get:(s,r)=>t.runOutsideAngular(()=>{if(n[r])return i?.spy?.get&&i.spy.get(r,n[r]),n[r];if(nf.indexOf(r)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[r];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return i?.spy?.apply&&i.spy.apply(r,c,d),d})})})});var Qi=class{constructor(e){return e}},Ze=new A("angularfire2.app.options"),Xe=new A("angularfire2.app.name");function mt(n,e,t){let i=typeof t=="string"&&t||"[DEFAULT]",s=typeof t=="object"&&t||{};s.name=s.name||i;let o=W.apps.filter(a=>a&&a.name===s.name)[0]||e.runOutsideAngular(()=>W.initializeApp(n,s));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;sf("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Qi(o)}var sf=(n,...e)=>{or()&&typeof console<"u"&&console[n](...e)},rf={provide:Qi,useFactory:mt,deps:[Ze,O,[new Re,Xe]]},Wc=(()=>{class n{static initializeApp(t,i){return{ngModule:n,providers:[{provide:Ze,useValue:t},{provide:Xe,useValue:i}]}}constructor(t){W.registerVersion("angularfire",K.full,"core"),W.registerVersion("angularfire",K.full,"app-compat"),W.registerVersion("angular",wi.full,t.toString())}static \u0275fac=function(i){return new(i||n)(g(Pe))};static \u0275mod=te({type:n});static \u0275inj=ee({providers:[rf]})}return n})();function jt(n,e,t,i,s){let[,r,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(r)return of(s,o)||(Mc("error",`${e} was already initialized on the ${t} Firebase App with different settings.${af?" You may need to reload as Firebase is not HMR aware.":""}`),Mc("warn",{is:s,was:o})),r;{let a=i();return globalThis.\u0275AngularfireInstanceCache.push([n,a,s]),a}}function of(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var af=typeof module<"u"&&!!module.hot,Mc=(n,...e)=>{or()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var _t=class{constructor(e){return e}},In=class{constructor(){return Di()}};function lf(n){return n&&n.length===1?n[0]:new _t(Pi())}var Jr=new A("angularfire2._apps"),cf={provide:_t,useFactory:lf,deps:[[new Re,Jr]]},uf={provide:In,deps:[[new Re,Jr]]};function df(n){return(e,t)=>{let i=t.get(Pe);se("angularfire",K.full,"core"),se("angularfire",K.full,"app"),se("angular",wi.full,i.toString());let s=e.runOutsideAngular(()=>n(t));return new _t(s)}}function $c(n,...e){return xt([cf,uf,{provide:Jr,useFactory:df(n),multi:!0,deps:[O,_e,Ee,...e]}])}var Uc=En(dc,!0);var ff=new Map,pf={activated:!1,tokenObservers:[]},gf={initialized:!1,enabled:!1};function Ie(n){return ff.get(n)||Object.assign({},pf)}function qc(){return gf}var mf="https://content-firebaseappcheck.googleapis.com/v1";var _f="exchangeDebugToken",Bc={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},lv=24*60*60*1e3;var to=class{constructor(e,t,i,s,r){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=s,this.upperBound=r,this.pending=null,this.nextErrorWaitInterval=s,s>r)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return Ae(this,null,function*(){this.stop();try{this.pending=new $,this.pending.promise.catch(t=>{}),yield yf(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new $,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function yf(n){return new Promise(e=>{setTimeout(e,n)})}var vf={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},Je=new ic("appCheck","AppCheck",vf);function zc(n){if(!Ie(n).activated)throw Je.create("use-before-activation",{appName:n.name})}function Gc(i,s){return Ae(this,arguments,function*({url:n,body:e},t){let r={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(r["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:r},l;try{l=yield fetch(n,a)}catch(p){throw Je.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw Je.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw Je.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw Je.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function Kc(n,e){let{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${mf}/projects/${t}/apps/${i}:${_f}?key=${s}`,body:{debug_token:e}}}var Cf="firebase-app-check-database",wf=1,no="firebase-app-check-store";var Yi=null;function Ef(){return Yi||(Yi=new Promise((n,e)=>{try{let t=indexedDB.open(Cf,wf);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var s;e(Je.create("storage-open",{originalErrorMessage:(s=i.target.error)===null||s===void 0?void 0:s.message}))},t.onupgradeneeded=i=>{let s=i.target.result;switch(i.oldVersion){case 0:s.createObjectStore(no,{keyPath:"compositeKey"})}}}catch(t){e(Je.create("storage-open",{originalErrorMessage:t?.message}))}}),Yi)}function If(n,e){return bf(Tf(n),e)}function bf(n,e){return Ae(this,null,function*(){let i=(yield Ef()).transaction(no,"readwrite"),r=i.objectStore(no).put({compositeKey:n,value:e});return new Promise((o,a)=>{r.onsuccess=l=>{o()},i.onerror=l=>{var c;a(Je.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function Tf(n){return`${n.options.appId}-${n.name}`}var io=new Lt("@firebase/app-check");function eo(n,e){return nc()?If(n,e).catch(t=>{io.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Qc(){return qc().enabled}function Yc(){return Ae(this,null,function*(){let n=qc();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Af={error:"UNKNOWN_ERROR"};function Sf(n){return Ai.encodeString(JSON.stringify(n),!1)}function so(n,e=!1){return Ae(this,null,function*(){let t=n.app;zc(t);let i=Ie(t),s=i.token,r;if(s&&!bn(s)&&(i.token=void 0,s=void 0),!s){let l=yield i.cachedTokenPromise;l&&(bn(l)?s=l:yield eo(t,void 0))}if(!e&&s&&bn(s))return{token:s.token};let o=!1;if(Qc()){i.exchangeTokenPromise||(i.exchangeTokenPromise=Gc(Kc(t,yield Yc()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);let l=yield i.exchangeTokenPromise;return yield eo(t,l),i.token=l,{token:l.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),s=yield Ie(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?io.warn(l.message):io.error(l),r=l}let a;return s?r?bn(s)?a={token:s.token,internalError:r}:a=Vc(r):(a={token:s.token},i.token=s,yield eo(t,s)):a=Vc(r),o&&Df(t,a),a})}function kf(n){return Ae(this,null,function*(){let e=n.app;zc(e);let{provider:t}=Ie(e);if(Qc()){let i=yield Yc(),{token:s}=yield Gc(Kc(e,i),n.heartbeatServiceProvider);return{token:s}}else{let{token:i}=yield t.getToken();return{token:i}}})}function Rf(n,e,t,i){let{app:s}=n,r=Ie(s),o={next:t,error:i,type:e};if(r.tokenObservers=[...r.tokenObservers,o],r.token&&bn(r.token)){let a=r.token;Promise.resolve().then(()=>{t({token:a.token}),jc(n)}).catch(()=>{})}r.cachedTokenPromise.then(()=>jc(n))}function Zc(n,e){let t=Ie(n),i=t.tokenObservers.filter(s=>s.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function jc(n){let{app:e}=n,t=Ie(e),i=t.tokenRefresher;i||(i=Pf(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function Pf(n){let{app:e}=n;return new to(()=>Ae(this,null,function*(){let t=Ie(e),i;if(t.token?i=yield so(n,!0):i=yield so(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=Ie(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,s=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,s),Math.max(0,i-Date.now())}else return 0},Bc.RETRIAL_MIN_WAIT,Bc.RETRIAL_MAX_WAIT)}function Df(n,e){let t=Ie(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function bn(n){return n.expireTimeMillis-Date.now()>0}function Vc(n){return{token:Sf(Af),error:n}}var ro=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Ie(this.app);for(let t of e)Zc(this.app,t.next);return Promise.resolve()}};function Nf(n,e){return new ro(n,e)}function xf(n){return{getToken:e=>so(n,e),getLimitedUseToken:()=>kf(n),addTokenListener:e=>Rf(n,"INTERNAL",e),removeTokenListener:e=>Zc(n.app,e)}}var Ff="@firebase/app-check",Of="0.8.4";var Mf="app-check",Hc="app-check-internal";function Lf(){mn(new Ce(Mf,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return Nf(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Hc).initialize()})),mn(new Ce(Hc,n=>{let e=n.getProvider("app-check").getImmediate();return xf(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),se(Ff,Of)}Lf();var Wf=["localhost","0.0.0.0","127.0.0.1"],Cv=typeof window<"u"&&Wf.includes(window.location.hostname);var Tn=new A("angularfire2.auth.use-emulator"),An=new A("angularfire2.auth.settings"),Sn=new A("angularfire2.auth.tenant-id"),kn=new A("angularfire2.auth.langugage-code"),Rn=new A("angularfire2.auth.use-device-language"),Pn=new A("angularfire.auth.persistence"),Dn=(n,e,t,i,s,r,o,a)=>jt(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),i&&(l.tenantId=i),l.languageCode=s,r&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,i,s,r,o,a]),Nn=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,i,s,r,o,a,l,c,u,d,h,p){let m=new ge,v=ce(void 0).pipe(He(o.outsideAngular),Ue(()=>r.runOutsideAngular(()=>import("./chunk-YBIN4SYT.js"))),N(()=>mt(t,r,i)),N(S=>Dn(S,r,a,c,u,d,l,h)),Js({bufferSize:1,refCount:!1}));if(Ei(s))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=ce(null);else{v.pipe(El()).subscribe();let S=v.pipe(Ue(T=>T.getRedirectResult().then(q=>q,()=>null)),x,Js({bufferSize:1,refCount:!1})),H=v.pipe(Ue(T=>new Se(q=>({unsubscribe:r.runOutsideAngular(()=>T.onAuthStateChanged(ie=>q.next(ie),ie=>q.error(ie),()=>q.complete()))})))),J=v.pipe(Ue(T=>new Se(q=>({unsubscribe:r.runOutsideAngular(()=>T.onIdTokenChanged(ie=>q.next(ie),ie=>q.error(ie),()=>q.complete()))}))));this.authState=S.pipe(er(H),ut(o.outsideAngular),He(o.insideAngular)),this.user=S.pipe(er(J),ut(o.outsideAngular),He(o.insideAngular)),this.idToken=this.user.pipe(Ue(T=>T?qe(T.getIdToken()):ce(null))),this.idTokenResult=this.user.pipe(Ue(T=>T?qe(T.getIdTokenResult()):ce(null))),this.credential=dt(S,m,this.authState.pipe(ke(T=>!T))).pipe(N(T=>T?.user?T:null),ut(o.outsideAngular),He(o.insideAngular))}return Lc(this,v,r,{spy:{apply:(S,H,J)=>{(S.startsWith("signIn")||S.startsWith("createUser"))&&J.then(T=>m.next(T))}}})}static \u0275fac=function(i){return new(i||n)(g(Ze),g(Xe,8),g(Pe),g(O),g(Ee),g(Tn,8),g(An,8),g(Sn,8),g(kn,8),g(Rn,8),g(Pn,8),g(de,8))};static \u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Xc=(()=>{class n{constructor(){W.registerVersion("angularfire",K.full,"auth-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=te({type:n});static \u0275inj=ee({providers:[Nn]})}return n})();var eu="@firebase/database",tu="1.0.5";var va="";function Ca(n){va=n}var go=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),M(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Si(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var mo=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return ue(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Nu=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new go(e)}}catch{}return new mo},vt=Nu("localStorage"),_o=Nu("sessionStorage");var zt=new Lt("@firebase/database"),xu=function(){let n=1;return function(){return n++}}(),Fu=function(n){let e=lc(n),t=new ac;t.update(e);let i=t.digest();return Ai.encodeByteArray(i)},ni=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=ni.apply(null,i):typeof i=="object"?e+=M(i):e+=i,e+=" "}return e},Ct=null,nu=!0,Ou=function(n,e){f(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(zt.logLevel=cc.VERBOSE,Ct=zt.log.bind(zt),e&&_o.set("logging_enabled",!0)):typeof n=="function"?Ct=n:(Ct=null,_o.remove("logging_enabled"))},B=function(...n){if(nu===!0&&(nu=!1,Ct===null&&_o.get("logging_enabled")===!0&&Ou(!0)),Ct){let e=ni.apply(null,n);Ct(e)}},ii=function(n){return function(...e){B(n,...e)}},yo=function(...n){let e="FIREBASE INTERNAL ERROR: "+ni(...n);zt.error(e)},Me=function(...n){let e=`FIREBASE FATAL ERROR: ${ni(...n)}`;throw zt.error(e),new Error(e)},V=function(...n){let e="FIREBASE WARNING: "+ni(...n);zt.warn(e)},$f=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&V("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},bs=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Uf=function(n){if(Ne()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},it="[MIN_NAME]",je="[MAX_NAME]",Et=function(n,e){if(n===e)return 0;if(n===it||e===je)return-1;if(e===it||n===je)return 1;{let t=iu(n),i=iu(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},Bf=function(n,e){return n===e?0:n<e?-1:1},xn=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+M(e))},wa=function(n){if(typeof n!="object"||n===null)return M(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=M(e[i]),t+=":",t+=wa(n[e[i]]);return t+="}",t},Mu=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function j(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var Lu=function(n){f(!bs(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,s,r,o,a,l;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));let c=[];for(l=t;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=e;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let u=c.join(""),d="";for(l=0;l<64;l+=8){let h=parseInt(u.substr(l,8),2).toString(16);h.length===1&&(h="0"+h),d=d+h}return d.toLowerCase()},jf=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Vf=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Hf(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var qf=new RegExp("^-?(0*)\\d{1,10}$"),zf=-2147483648,Gf=2147483647,iu=function(n){if(qf.test(n)){let e=Number(n);if(e>=zf&&e<=Gf)return e}return null},tn=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw V("Exception was thrown by user callback.",t),e},Math.floor(0))}},Kf=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ln=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var vo=class{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){V(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Co=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(B("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',V(e)}},Wn=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Xi="5",Wu="v",$u="s",Uu="r",Bu="f",ju=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Vu="ls",Hu="p",wo="ac",qu="websocket",zu="long_polling";var Ji=class{constructor(e,t,i,s,r=!1,o="",a=!1,l=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=vt.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&vt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Qf(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function Gu(n,e,t){f(typeof e=="string","typeof type must == string"),f(typeof t=="object","typeof params must == object");let i;if(e===qu)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===zu)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Qf(n)&&(t.ns=n.namespace);let s=[];return j(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}var Eo=class{constructor(){this.counters_={}}incrementCounter(e,t=1){ue(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return Jl(this.counters_)}};var ao={},lo={};function Ea(n){let e=n.toString();return ao[e]||(ao[e]=new Eo),ao[e]}function Yf(n,e){let t=n.toString();return lo[t]||(lo[t]=e()),lo[t]}var Io=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&tn(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var su="start",Zf="close",Xf="pLPCommand",Jf="pRTLPCB",Ku="id",Qu="pw",Yu="ser",ep="cb",tp="seg",np="ts",ip="d",sp="dframe",Zu=1870,Xu=30,rp=Zu-Xu,op=25e3,ap=3e4,jn=class n{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ii(e),this.stats_=Ea(t),this.urlFn=l=>(this.appCheckToken&&(l[wo]=this.appCheckToken),Gu(t,zu,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Io(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ap)),Uf(()=>{if(this.isClosed_)return;this.scriptTagHolder=new bo((...r)=>{let[o,a,l,c,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===su)this.id=a,this.password=l;else if(o===Zf)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[su]="t",i[Yu]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[ep]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Wu]=Xi,this.transportSessionId&&(i[$u]=this.transportSessionId),this.lastSessionId&&(i[Vu]=this.lastSessionId),this.applicationId&&(i[Hu]=this.applicationId),this.appCheckToken&&(i[wo]=this.appCheckToken),typeof location<"u"&&location.hostname&&ju.test(location.hostname)&&(i[Uu]=Bu);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return Ne()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!jf()&&!Vf()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=M(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=Xl(t),s=Mu(i,rp);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(Ne())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[sp]="t",i[Ku]=e,i[Qu]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=M(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},bo=class n{constructor(e,t,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,Ne())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=xu(),window[Xf+this.uniqueCallbackIdentifier]=e,window[Jf+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){B("frame writing exception"),a.stack&&B(a.stack),B(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||B("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[Ku]=this.myID,e[Qu]=this.myPW,e[Yu]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Xu+i.length<=Zu;){let o=this.pendingSegs.shift();i=i+"&"+tp+s+"="+o.seg+"&"+np+s+"="+o.ts+"&"+ip+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(op)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){Ne()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{B("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var lp=16384,cp=45e3,es=null;typeof MozWebSocket<"u"?es=MozWebSocket:typeof WebSocket<"u"&&(es=WebSocket);var Ht=(()=>{class n{constructor(t,i,s,r,o,a,l){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ii(this.connId),this.stats_=Ea(i),this.connURL=n.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){let a={};return a[Wu]=Xi,!Ne()&&typeof location<"u"&&location.hostname&&ju.test(location.hostname)&&(a[Uu]=Bu),i&&(a[$u]=i),s&&(a[Vu]=s),r&&(a[wo]=r),o&&(a[Hu]=o),Gu(t,qu,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,vt.set("previous_websocket_failure",!0);try{let s;if(Ne()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${Xi}/${va}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new es(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(i);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&es!==null&&!n.forceDisallow_}static previouslyFailed(){return vt.isInMemoryStorage||vt.get("previous_websocket_failure")===!0}markConnectionHealthy(){vt.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let s=Si(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(f(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let s=this.extractFrameCount_(i);s!==null&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();let i=M(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let s=Mu(i,lp);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(cp))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Ju=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[jn,Ht]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){let i=Ht&&Ht.isAvailable(),s=i&&!Ht.previouslyFailed();if(t.webSocketOnly&&(i||V("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Ht];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),up=6e4,dp=5e3,hp=10*1024,fp=100*1024,co="t",ru="d",pp="s",ou="r",gp="e",au="o",lu="a",cu="n",uu="p",mp="h",To=class{constructor(e,t,i,s,r,o,a,l,c,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ii("c:"+this.id+":"),this.transportManager_=new Ju(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=Ln(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>fp?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>hp?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(co in e){let t=e[co];t===lu?this.upgradeIfSecondaryHealthy_():t===ou?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===au&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=xn("t",e),i=xn("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:uu,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:lu,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:cu,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=xn("t",e),i=xn("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=xn(co,e);if(ru in e){let i=e[ru];if(t===mp){let s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===cu){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===pp?this.onConnectionShutdown_(i):t===ou?this.onReset_(i):t===gp?yo("Server Error: "+i):t===au?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):yo("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Xi!==i&&V("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),Ln(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(up))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ln(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(dp))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:uu,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(vt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var ts=class{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var ns=class{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);let s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var is=class n extends ns{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ar()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new n}getInitialEvent(e){return f(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var du=32,hu=768,b=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function I(){return new b("")}function C(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function st(n){return n.pieces_.length-n.pieceNum_}function k(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new b(n.pieces_,e)}function Ia(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function _p(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Vn(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function ed(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new b(e,0)}function P(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof b)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new b(t,0)}function w(n){return n.pieceNum_>=n.pieces_.length}function Q(n,e){let t=C(n),i=C(e);if(t===null)return e;if(t===i)return Q(k(n),k(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function yp(n,e){let t=Vn(n,0),i=Vn(e,0);for(let s=0;s<t.length&&s<i.length;s++){let r=Et(t[s],i[s]);if(r!==0)return r}return t.length===i.length?0:t.length<i.length?-1:1}function ba(n,e){if(st(n)!==st(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function he(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(st(n)>st(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var Ao=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Vn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=gn(this.parts_[i]);td(this)}};function vp(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=gn(e),td(n)}function Cp(n){let e=n.parts_.pop();n.byteLength_-=gn(e),n.parts_.length>0&&(n.byteLength_-=1)}function td(n){if(n.byteLength_>hu)throw new Error(n.errorPrefix_+"has a key path longer than "+hu+" bytes ("+n.byteLength_+").");if(n.parts_.length>du)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+du+") or object contains a cycle "+yt(n))}function yt(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var So=class n extends ns{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new n}getInitialEvent(e){return f(e==="visible","Unknown event type: "+e),[this.visible_]}};var Fn=1e3,wp=60*5*1e3,fu=30*1e3,Ep=1.3,Ip=3e4,bp="server_kill",pu=3,Ta=(()=>{class n extends ts{constructor(t,i,s,r,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=ii("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Fn,this.maxReconnectDelay_=wp,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!Ne())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");So.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&is.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){let r=++this.requestNumber_,o={r,a:t,b:i};this.log_(M(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();let i=new $,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,s,r){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){let i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,u=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",l),u!=="ok"&&this.removeListen_(s,r),t.onComplete&&t.onComplete(u,c))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&ue(t,"w")){let s=Qe(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();V(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||rc(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=fu)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=sc(t)?"auth":"gauth",s={cred:t};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,s=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){let s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){let o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();let a={p:i,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+M(t));let i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):yo("Unrecognized action received from server: "+M(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Fn,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Fn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Ip&&(this.reconnectDelay_=Fn),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=new Date().getTime()-this.lastConnectionAttemptTime_,i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ep)}this.onConnectStatus_(!1)}establishConnection_(){return Ae(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,s())},u=function(h){f(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(h)};this.realtime_={close:c,sendRequest:u};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[h,p]=yield Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?B("getToken() completed but was canceled"):(B("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=p&&p.token,l=new To(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,s,m=>{V(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(bp)},o))}catch(h){this.log_("Failed to get token: "+h),a||(this.repoInfo_.nodeAdmin&&V(h),c())}}})}interrupt(t){B("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){B("Resuming connection for reason: "+t),delete this.interruptReasons_[t],ki(this.interruptReasons_)&&(this.reconnectDelay_=Fn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;i?s=i.map(o=>wa(o)).join("$"):s="default";let r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){let s=new b(t).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(i),o.delete(i),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){B("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=pu&&(this.reconnectDelay_=fu,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){B("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=pu&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";Ne()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+va.replace(/\./g,"-")]=1,ar()?t["framework.cordova"]=1:tc()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=is.getInstance().currentlyOnline();return ki(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),E=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var Gt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new E(it,e),s=new E(it,t);return this.compare(i,s)!==0}minPost(){return E.MIN}};var Zi,ss=class extends Gt{static get __EMPTY_NODE(){return Zi}static set __EMPTY_NODE(e){Zi=e}compare(e,t){return Et(e.name,t.name)}isDefinedOn(e){throw Mt("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return E.MIN}maxPost(){return new E(je,Zi)}makePost(e,t){return f(typeof e=="string","KeyIndex indexValue must always be a string."),new E(e,Zi)}toString(){return".key"}},Oe=new ss;var qt=class{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},be=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??fe.EMPTY_NODE,this.right=o??fe.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this,o=s(t,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(t,i,s),null):o===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return fe.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),i(t,s.key)===0){if(s.right.isEmpty())return fe.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),ko=class{copy(e,t,i,s,r){return this}insert(e,t,i){return new be(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},fe=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,be.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,be.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new qt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new qt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new qt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new qt(this.root_,null,this.comparator_,!0,e)}};fe.EMPTY_NODE=new ko;function Tp(n,e){return Et(n.name,e.name)}function Aa(n,e){return Et(n,e)}var Ro;function Ap(n){Ro=n}var nd=function(n){return typeof n=="number"?"number:"+Lu(n):"string:"+n},id=function(n){if(n.isLeafNode()){let e=n.val();f(typeof e=="string"||typeof e=="number"||typeof e=="object"&&ue(e,".sv"),"Priority must be a string or number.")}else f(n===Ro||n.isEmpty(),"priority of unexpected type.");f(n===Ro||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var gu,Kt=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),id(this.priorityNode_)}static set __childrenNodeConstructor(t){gu=t}static get __childrenNodeConstructor(){return gu}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return w(t)?this:C(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let s=C(t);return s===null?i:i.isEmpty()&&s!==".priority"?this:(f(s!==".priority"||st(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(k(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+nd(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=Lu(this.value_):t+=this.value_,this.lazyHash_=Fu(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(f(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return f(r>=0,"Unknown leaf type: "+i),f(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),sd,rd;function Sp(n){sd=n}function kp(n){rd=n}var Po=class extends Gt{compare(e,t){let i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?Et(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return E.MIN}maxPost(){return new E(je,new Kt("[PRIORITY-POST]",rd))}makePost(e,t){let i=sd(e);return new E(t,new Kt("[PRIORITY-POST]",i))}toString(){return".priority"}},R=new Po;var Rp=Math.log(2),Do=class{constructor(e){let t=r=>parseInt(Math.log(r)/Rp,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},rs=function(n,e,t,i){n.sort(e);let s=function(l,c){let u=c-l,d,h;if(u===0)return null;if(u===1)return d=n[l],h=t?t(d):d,new be(h,d.node,be.BLACK,null,null);{let p=parseInt(u/2,10)+l,m=s(l,p),v=s(p+1,c);return d=n[p],h=t?t(d):d,new be(h,d.node,be.BLACK,m,v)}},r=function(l){let c=null,u=null,d=n.length,h=function(m,v){let S=d-m,H=d;d-=m;let J=s(S+1,H),T=n[S],q=t?t(T):T;p(new be(q,T.node,v,null,J))},p=function(m){c?(c.left=m,c=m):(u=m,c=m)};for(let m=0;m<l.count;++m){let v=l.nextBitIsOne(),S=Math.pow(2,l.count-(m+1));v?h(S,be.BLACK):(h(S,be.BLACK),h(S,be.RED))}return u},o=new Do(n.length),a=r(o);return new fe(i||e,a)};var uo,Vt={},Qt=class n{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f(Vt&&R,"ChildrenNode.ts has not been loaded"),uo=uo||new n({".priority":Vt},{".priority":R}),uo}get(e){let t=Qe(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof fe?t:null}hasIndex(e){return ue(this.indexSet_,e.toString())}addIndex(e,t){f(e!==Oe,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=t.getIterator(E.Wrap),o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=rs(i,e.getCompare()):a=Vt;let l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;let u=Object.assign({},this.indexes_);return u[l]=a,new n(u,c)}addToIndexes(e,t){let i=pn(this.indexes_,(s,r)=>{let o=Qe(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),s===Vt)if(o.isDefinedOn(e.node)){let a=[],l=t.getIterator(E.Wrap),c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),rs(a,o.getCompare())}else return Vt;else{let a=t.get(e.name),l=s;return a&&(l=l.remove(new E(e.name,a))),l.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=pn(this.indexes_,s=>{if(s===Vt)return s;{let r=t.get(e.name);return r?s.remove(new E(e.name,r)):s}});return new n(i,this.indexSet_)}};var On,y=(()=>{class n{constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&id(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return On||(On=new n(new fe(Aa),null,Qt.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||On}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?On:i}}getChild(t){let i=C(t);return i===null?this:this.getImmediateChild(i).getChild(k(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(f(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let s=new E(t,i),r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?On:this.priorityNode_;return new n(r,a,o)}}updateChild(t,i){let s=C(t);if(s===null)return i;{f(C(t)!==".priority"||st(t)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(k(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},s=0,r=0,o=!0;if(this.forEachChild(R,(a,l)=>{i[a]=l.val(t),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){let a=[];for(let l in i)a[l]=i[l];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+nd(this.getPriority().val())+":"),this.forEachChild(R,(i,s)=>{let r=s.hash();r!==""&&(t+=":"+i+":"+r)}),this.lazyHash_=t===""?"":Fu(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new E(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new E(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let s=i.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new E(i,this.children_.get(i)):null}forEachChild(t,i){let s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{let r=this.children_.getIteratorFrom(t.name,E.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{let r=this.children_.getReverseIteratorFrom(t.name,E.Wrap),o=r.peek();for(;o!=null&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===si?-1:0}withIndex(t){if(t===Oe||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===Oe||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let s=this.getIterator(R),r=i.getIterator(R),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Oe?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),No=class extends y{constructor(){super(new fe(Aa),y.EMPTY_NODE,Qt.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return y.EMPTY_NODE}isEmpty(){return!1}},si=new No;Object.defineProperties(E,{MIN:{value:new E(it,y.EMPTY_NODE)},MAX:{value:new E(je,si)}});ss.__EMPTY_NODE=y.EMPTY_NODE;Kt.__childrenNodeConstructor=y;Ap(si);kp(si);var Pp=!0;function D(n,e=null){if(n===null)return y.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),f(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new Kt(t,D(e))}if(!(n instanceof Array)&&Pp){let t=[],i=!1;if(j(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=D(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new E(o,l)))}}),t.length===0)return y.EMPTY_NODE;let r=rs(t,Tp,o=>o.name,Aa);if(i){let o=rs(t,R.getCompare());return new y(r,D(e),new Qt({".priority":o},{".priority":R}))}else return new y(r,D(e),Qt.Default)}else{let t=y.EMPTY_NODE;return j(n,(i,s)=>{if(ue(n,i)&&i.substring(0,1)!=="."){let r=D(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(D(e))}}Sp(D);var Hn=class extends Gt{constructor(e){super(),this.indexPath_=e,f(!w(e)&&C(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?Et(e.name,t.name):r}makePost(e,t){let i=D(e),s=y.EMPTY_NODE.updateChild(this.indexPath_,i);return new E(t,s)}maxPost(){let e=y.EMPTY_NODE.updateChild(this.indexPath_,si);return new E(je,e)}toString(){return Vn(this.indexPath_,0).join("/")}};var xo=class extends Gt{compare(e,t){let i=e.node.compareTo(t.node);return i===0?Et(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return E.MIN}maxPost(){return E.MAX}makePost(e,t){let i=D(e);return new E(t,i)}toString(){return".value"}},Sa=new xo;function od(n){return{type:"value",snapshotNode:n}}function Yt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function qn(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function zn(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Dp(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Gn=class{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(qn(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Yt(t,i)):o.trackChildChange(zn(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(R,(s,r)=>{t.hasChild(s)||i.trackChildChange(qn(s,r))}),t.isLeafNode()||t.forEachChild(R,(s,r)=>{if(e.hasChild(s)){let o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(zn(s,r,o))}else i.trackChildChange(Yt(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?y.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var os=class n{constructor(e){this.indexedFilter_=new Gn(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new E(t,i))||(i=y.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=y.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(y.EMPTY_NODE);let r=this;return t.forEachChild(R,(o,a)=>{r.matches(new E(o,a))||(s=s.updateImmediateChild(o,y.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Fo=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new os(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new E(t,i))||(i=y.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=y.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=y.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(y.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,y.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){let d=this.index_.getCompare();o=(h,p)=>d(p,h)}else o=this.index_.getCompare();let a=e;f(a.numChildren()===this.limit_,"");let l=new E(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(l);if(a.hasChild(t)){let d=a.getImmediateChild(t),h=s.getChildAfterChild(this.index_,c,this.reverse_);for(;h!=null&&(h.name===t||a.hasChild(h.name));)h=s.getChildAfterChild(this.index_,h,this.reverse_);let p=h==null?1:o(h,l);if(u&&!i.isEmpty()&&p>=0)return r?.trackChildChange(zn(t,i,d)),a.updateImmediateChild(t,i);{r?.trackChildChange(qn(t,d));let v=a.updateImmediateChild(t,y.EMPTY_NODE);return h!=null&&this.rangedFilter_.matches(h)?(r?.trackChildChange(Yt(h.name,h.node)),v.updateImmediateChild(h.name,h.node)):v}}else return i.isEmpty()?e:u&&o(c,l)>=0?(r!=null&&(r.trackChildChange(qn(c.name,c.node)),r.trackChildChange(Yt(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,y.EMPTY_NODE)):e}};var Kn=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=R}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:it}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:je}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===R}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function Np(n){return n.loadsAllData()?new Gn(n.getIndex()):n.hasLimit()?new Fo(n):new os(n)}function xp(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Fp(n,e){let t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Oo(n,e,t){let i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function Op(n,e,t){let i;return n.index_===Oe||t?i=Oo(n,e,t):i=Oo(n,e,je),i.startAfterSet_=!0,i}function Mo(n,e,t){let i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function Mp(n,e,t){let i;return n.index_===Oe||t?i=Mo(n,e,t):i=Mo(n,e,it),i.endBeforeSet_=!0,i}function Ts(n,e){let t=n.copy();return t.index_=e,t}function mu(n){let e={};if(n.isDefault())return e;let t;if(n.index_===R?t="$priority":n.index_===Sa?t="$value":n.index_===Oe?t="$key":(f(n.index_ instanceof Hn,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=M(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=M(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+M(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=M(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+M(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function _u(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==R&&(e.i=n.index_.toString()),e}var Lo=class n extends ts{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=ii("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let l=mu(e._queryParams);this.restRequest_(r+".json",l,(c,u)=>{let d=u;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(r,d,!1,i),Qe(this.listens_,o)===a){let h;c?c===401?h="permission_denied":h="rest_error:"+c:h="ok",s(h,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=mu(e._queryParams),i=e._path.toString(),s=new $;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+oc(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=Si(a.responseText)}catch{V("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&V("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var Wo=class{constructor(){this.rootNode_=y.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function as(){return{value:null,children:new Map}}function nn(n,e,t){if(w(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=C(e);n.children.has(i)||n.children.set(i,as());let s=n.children.get(i);e=k(e),nn(s,e,t)}}function $o(n,e){if(w(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{let t=n.value;return n.value=null,t.forEachChild(R,(i,s)=>{nn(n,new b(i),s)}),$o(n,e)}}else if(n.children.size>0){let t=C(e);return e=k(e),n.children.has(t)&&$o(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Uo(n,e,t){n.value!==null?t(e,n.value):Lp(n,(i,s)=>{let r=new b(e.toString()+"/"+i);Uo(s,r,t)})}function Lp(n,e){n.children.forEach((t,i)=>{e(i,t)})}var Bo=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&j(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}};var yu=10*1e3,Wp=30*1e3,$p=5*60*1e3,jo=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Bo(e);let i=yu+(Wp-yu)*Math.random();Ln(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;j(e,(s,r)=>{r>0&&ue(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),Ln(this.reportStats_.bind(this),Math.floor(Math.random()*2*$p))}};var Fe=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(Fe||{});function ka(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Ra(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Pa(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Vo=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Fe.ACK_USER_WRITE,this.source=ka()}operationForChild(e){if(w(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new b(e));return new n(I(),t,this.revert)}}else return f(C(this.path)===e,"operationForChild called for unrelated child."),new n(k(this.path),this.affectedTree,this.revert)}};var ls=class n{constructor(e,t){this.source=e,this.path=t,this.type=Fe.LISTEN_COMPLETE}operationForChild(e){return w(this.path)?new n(this.source,I()):new n(this.source,k(this.path))}};var Zt=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Fe.OVERWRITE}operationForChild(e){return w(this.path)?new n(this.source,I(),this.snap.getImmediateChild(e)):new n(this.source,k(this.path),this.snap)}};var Qn=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Fe.MERGE}operationForChild(e){if(w(this.path)){let t=this.children.subtree(new b(e));return t.isEmpty()?null:t.value?new Zt(this.source,I(),t.value):new n(this.source,I(),t)}else return f(C(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,k(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var Le=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(w(e))return this.isFullyInitialized()&&!this.filtered_;let t=C(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Ho=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function Up(n,e,t,i){let s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Dp(o.childName,o.snapshotNode))}),Mn(n,s,"child_removed",e,i,t),Mn(n,s,"child_added",e,i,t),Mn(n,s,"child_moved",r,i,t),Mn(n,s,"child_changed",e,i,t),Mn(n,s,"value",e,i,t),s}function Mn(n,e,t,i,s,r){let o=i.filter(a=>a.type===t);o.sort((a,l)=>jp(n,a,l)),o.forEach(a=>{let l=Bp(n,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function Bp(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function jp(n,e,t){if(e.childName==null||t.childName==null)throw Mt("Should only compare child_ events.");let i=new E(e.childName,e.snapshotNode),s=new E(t.childName,t.snapshotNode);return n.index_.compare(i,s)}function As(n,e){return{eventCache:n,serverCache:e}}function $n(n,e,t,i){return As(new Le(e,t,i),n.serverCache)}function ad(n,e,t,i){return As(n.eventCache,new Le(e,t,i))}function cs(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function wt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var ho,Vp=()=>(ho||(ho=new fe(Bf)),ho),Y=class n{constructor(e,t=Vp()){this.value=e,this.children=t}static fromObject(e){let t=new n(null);return j(e,(i,s)=>{t=t.set(new b(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:I(),value:this.value};if(w(e))return null;{let i=C(e),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(k(e),t);return r!=null?{path:P(new b(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(w(e))return this;{let t=C(e),i=this.children.get(t);return i!==null?i.subtree(k(e)):new n(null)}}set(e,t){if(w(e))return new n(t,this.children);{let i=C(e),r=(this.children.get(i)||new n(null)).set(k(e),t),o=this.children.insert(i,r);return new n(this.value,o)}}remove(e){if(w(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=C(e),i=this.children.get(t);if(i){let s=i.remove(k(e)),r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(e){if(w(e))return this.value;{let t=C(e),i=this.children.get(t);return i?i.get(k(e)):null}}setTree(e,t){if(w(e))return t;{let i=C(e),r=(this.children.get(i)||new n(null)).setTree(k(e),t),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new n(this.value,o)}}fold(e){return this.fold_(I(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(P(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,I(),t)}findOnPath_(e,t,i){let s=this.value?i(t,this.value):!1;if(s)return s;if(w(e))return null;{let r=C(e),o=this.children.get(r);return o?o.findOnPath_(k(e),P(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,I(),t)}foreachOnPath_(e,t,i){if(w(e))return this;{this.value&&i(t,this.value);let s=C(e),r=this.children.get(s);return r?r.foreachOnPath_(k(e),P(t,s),i):new n(null)}}foreach(e){this.foreach_(I(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(P(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var Te=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new Y(null))}};function Un(n,e,t){if(w(e))return new Te(new Y(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let s=i.path,r=i.value,o=Q(s,e);return r=r.updateChild(o,t),new Te(n.writeTree_.set(s,r))}else{let s=new Y(t),r=n.writeTree_.setTree(e,s);return new Te(r)}}}function qo(n,e,t){let i=n;return j(t,(s,r)=>{i=Un(i,P(e,s),r)}),i}function vu(n,e){if(w(e))return Te.empty();{let t=n.writeTree_.setTree(e,new Y(null));return new Te(t)}}function zo(n,e){return It(n,e)!=null}function It(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(Q(t.path,e)):null}function Cu(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(R,(i,s)=>{e.push(new E(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new E(i,s.value))}),e}function tt(n,e){if(w(e))return n;{let t=It(n,e);return t!=null?new Te(new Y(t)):new Te(n.writeTree_.subtree(e))}}function Go(n){return n.writeTree_.isEmpty()}function Xt(n,e){return ld(I(),n.writeTree_,e)}function ld(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(f(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=ld(P(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(P(n,".priority"),i)),t}}function Ss(n,e){return hd(e,n)}function Hp(n,e,t,i,s){f(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=Un(n.visibleWrites,e,t)),n.lastWriteId=i}function qp(n,e,t,i){f(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=qo(n.visibleWrites,e,t),n.lastWriteId=i}function zp(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function Gp(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&Kp(a,i.path)?s=!1:he(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return Qp(n),!0;if(i.snap)n.visibleWrites=vu(n.visibleWrites,i.path);else{let a=i.children;j(a,l=>{n.visibleWrites=vu(n.visibleWrites,P(i.path,l))})}return!0}else return!1}function Kp(n,e){if(n.snap)return he(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&he(P(n.path,t),e))return!0;return!1}function Qp(n){n.visibleWrites=cd(n.allWrites,Yp,I()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Yp(n){return n.visible}function cd(n,e,t){let i=Te.empty();for(let s=0;s<n.length;++s){let r=n[s];if(e(r)){let o=r.path,a;if(r.snap)he(t,o)?(a=Q(t,o),i=Un(i,a,r.snap)):he(o,t)&&(a=Q(o,t),i=Un(i,I(),r.snap.getChild(a)));else if(r.children){if(he(t,o))a=Q(t,o),i=qo(i,a,r.children);else if(he(o,t))if(a=Q(o,t),w(a))i=qo(i,I(),r.children);else{let l=Qe(r.children,C(a));if(l){let c=l.getChild(k(a));i=Un(i,I(),c)}}}else throw Mt("WriteRecord should have .snap or .children")}}return i}function ud(n,e,t,i,s){if(!i&&!s){let r=It(n.visibleWrites,e);if(r!=null)return r;{let o=tt(n.visibleWrites,e);if(Go(o))return t;if(t==null&&!zo(o,I()))return null;{let a=t||y.EMPTY_NODE;return Xt(o,a)}}}else{let r=tt(n.visibleWrites,e);if(!s&&Go(r))return t;if(!s&&t==null&&!zo(r,I()))return null;{let o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(he(c.path,e)||he(e,c.path))},a=cd(n.allWrites,o,e),l=t||y.EMPTY_NODE;return Xt(a,l)}}}function Zp(n,e,t){let i=y.EMPTY_NODE,s=It(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(R,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){let r=tt(n.visibleWrites,e);return t.forEachChild(R,(o,a)=>{let l=Xt(tt(r,new b(o)),a);i=i.updateImmediateChild(o,l)}),Cu(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=tt(n.visibleWrites,e);return Cu(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Xp(n,e,t,i,s){f(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=P(e,t);if(zo(n.visibleWrites,r))return null;{let o=tt(n.visibleWrites,r);return Go(o)?s.getChild(t):Xt(o,s.getChild(t))}}function Jp(n,e,t,i){let s=P(e,t),r=It(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){let o=tt(n.visibleWrites,s);return Xt(o,i.getNode().getImmediateChild(t))}else return null}function eg(n,e){return It(n.visibleWrites,e)}function tg(n,e,t,i,s,r,o){let a,l=tt(n.visibleWrites,e),c=It(l,I());if(c!=null)a=c;else if(t!=null)a=Xt(l,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let u=[],d=o.getCompare(),h=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),p=h.getNext();for(;p&&u.length<s;)d(p,i)!==0&&u.push(p),p=h.getNext();return u}else return[]}function ng(){return{visibleWrites:Te.empty(),allWrites:[],lastWriteId:-1}}function us(n,e,t,i){return ud(n.writeTree,n.treePath,e,t,i)}function Da(n,e){return Zp(n.writeTree,n.treePath,e)}function wu(n,e,t,i){return Xp(n.writeTree,n.treePath,e,t,i)}function ds(n,e){return eg(n.writeTree,P(n.treePath,e))}function ig(n,e,t,i,s,r){return tg(n.writeTree,n.treePath,e,t,i,s,r)}function Na(n,e,t){return Jp(n.writeTree,n.treePath,e,t)}function dd(n,e){return hd(P(n.treePath,e),n.writeTree)}function hd(n,e){return{treePath:n,writeTree:e}}var Ko=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;f(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),f(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,zn(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,qn(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,Yt(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,zn(i,e.snapshotNode,s.oldSnap));else throw Mt("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var Qo=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},fd=new Qo,Yn=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new Le(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Na(this.writes_,e,i)}}getChildAfterChild(e,t,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:wt(this.viewCache_),r=ig(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}};function sg(n){return{filter:n}}function rg(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function og(n,e,t,i,s){let r=new Ko,o,a;if(t.type===Fe.OVERWRITE){let c=t;c.source.fromUser?o=Yo(n,e,c.path,c.snap,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!w(c.path),o=hs(n,e,c.path,c.snap,i,s,a,r))}else if(t.type===Fe.MERGE){let c=t;c.source.fromUser?o=lg(n,e,c.path,c.children,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=Zo(n,e,c.path,c.children,i,s,a,r))}else if(t.type===Fe.ACK_USER_WRITE){let c=t;c.revert?o=dg(n,e,c.path,i,s,r):o=cg(n,e,c.path,c.affectedTree,i,s,r)}else if(t.type===Fe.LISTEN_COMPLETE)o=ug(n,e,t.path,i,r);else throw Mt("Unknown operation type: "+t.type);let l=r.getChanges();return ag(e,o,l),{viewCache:o,changes:l}}function ag(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=cs(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(od(cs(e)))}}function pd(n,e,t,i,s,r){let o=e.eventCache;if(ds(i,t)!=null)return e;{let a,l;if(w(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let c=wt(e),u=c instanceof y?c:y.EMPTY_NODE,d=Da(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),d,r)}else{let c=us(i,wt(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{let c=C(t);if(c===".priority"){f(st(t)===1,"Can't have a priority with additional path components");let u=o.getNode();l=e.serverCache.getNode();let d=wu(i,t,u,l);d!=null?a=n.filter.updatePriority(u,d):a=o.getNode()}else{let u=k(t),d;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();let h=wu(i,t,o.getNode(),l);h!=null?d=o.getNode().getImmediateChild(c).updateChild(u,h):d=o.getNode().getImmediateChild(c)}else d=Na(i,c,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),c,d,u,s,r):a=o.getNode()}}return $n(e,a,o.isFullyInitialized()||w(t),n.filter.filtersNodes())}}function hs(n,e,t,i,s,r,o,a){let l=e.serverCache,c,u=o?n.filter:n.filter.getIndexedFilter();if(w(t))c=u.updateFullNode(l.getNode(),i,null);else if(u.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(t,i);c=u.updateFullNode(l.getNode(),p,null)}else{let p=C(t);if(!l.isCompleteForPath(t)&&st(t)>1)return e;let m=k(t),S=l.getNode().getImmediateChild(p).updateChild(m,i);p===".priority"?c=u.updatePriority(l.getNode(),S):c=u.updateChild(l.getNode(),p,S,m,fd,null)}let d=ad(e,c,l.isFullyInitialized()||w(t),u.filtersNodes()),h=new Yn(s,d,r);return pd(n,d,t,s,h,a)}function Yo(n,e,t,i,s,r,o){let a=e.eventCache,l,c,u=new Yn(s,e,r);if(w(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=$n(e,c,!0,n.filter.filtersNodes());else{let d=C(t);if(d===".priority")c=n.filter.updatePriority(e.eventCache.getNode(),i),l=$n(e,c,a.isFullyInitialized(),a.isFiltered());else{let h=k(t),p=a.getNode().getImmediateChild(d),m;if(w(h))m=i;else{let v=u.getCompleteChild(d);v!=null?Ia(h)===".priority"&&v.getChild(ed(h)).isEmpty()?m=v:m=v.updateChild(h,i):m=y.EMPTY_NODE}if(p.equals(m))l=e;else{let v=n.filter.updateChild(a.getNode(),d,m,h,u,o);l=$n(e,v,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function Eu(n,e){return n.eventCache.isCompleteForChild(e)}function lg(n,e,t,i,s,r,o){let a=e;return i.foreach((l,c)=>{let u=P(t,l);Eu(e,C(u))&&(a=Yo(n,a,u,c,s,r,o))}),i.foreach((l,c)=>{let u=P(t,l);Eu(e,C(u))||(a=Yo(n,a,u,c,s,r,o))}),a}function Iu(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function Zo(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let l=e,c;w(t)?c=i:c=new Y(null).setTree(t,i);let u=e.serverCache.getNode();return c.children.inorderTraversal((d,h)=>{if(u.hasChild(d)){let p=e.serverCache.getNode().getImmediateChild(d),m=Iu(n,p,h);l=hs(n,l,new b(d),m,s,r,o,a)}}),c.children.inorderTraversal((d,h)=>{let p=!e.serverCache.isCompleteForChild(d)&&h.value===null;if(!u.hasChild(d)&&!p){let m=e.serverCache.getNode().getImmediateChild(d),v=Iu(n,m,h);l=hs(n,l,new b(d),v,s,r,o,a)}}),l}function cg(n,e,t,i,s,r,o){if(ds(s,t)!=null)return e;let a=e.serverCache.isFiltered(),l=e.serverCache;if(i.value!=null){if(w(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return hs(n,e,t,l.getNode().getChild(t),s,r,a,o);if(w(t)){let c=new Y(null);return l.getNode().forEachChild(Oe,(u,d)=>{c=c.set(new b(u),d)}),Zo(n,e,t,c,s,r,a,o)}else return e}else{let c=new Y(null);return i.foreach((u,d)=>{let h=P(t,u);l.isCompleteForPath(h)&&(c=c.set(u,l.getNode().getChild(h)))}),Zo(n,e,t,c,s,r,a,o)}}function ug(n,e,t,i,s){let r=e.serverCache,o=ad(e,r.getNode(),r.isFullyInitialized()||w(t),r.isFiltered());return pd(n,o,t,i,fd,s)}function dg(n,e,t,i,s,r){let o;if(ds(i,t)!=null)return e;{let a=new Yn(i,e,s),l=e.eventCache.getNode(),c;if(w(t)||C(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=us(i,wt(e));else{let d=e.serverCache.getNode();f(d instanceof y,"serverChildren would be complete if leaf node"),u=Da(i,d)}u=u,c=n.filter.updateFullNode(l,u,r)}else{let u=C(t),d=Na(i,u,e.serverCache);d==null&&e.serverCache.isCompleteForChild(u)&&(d=l.getImmediateChild(u)),d!=null?c=n.filter.updateChild(l,u,d,k(t),a,r):e.eventCache.getNode().hasChild(u)?c=n.filter.updateChild(l,u,y.EMPTY_NODE,k(t),a,r):c=l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=us(i,wt(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||ds(i,I())!=null,$n(e,c,o,n.filter.filtersNodes())}}var Xo=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new Gn(i.getIndex()),r=Np(i);this.processor_=sg(r);let o=t.serverCache,a=t.eventCache,l=s.updateFullNode(y.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(y.EMPTY_NODE,a.getNode(),null),u=new Le(l,o.isFullyInitialized(),s.filtersNodes()),d=new Le(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=As(d,u),this.eventGenerator_=new Ho(this.query_)}get query(){return this.query_}};function hg(n){return n.viewCache_.serverCache.getNode()}function fg(n){return cs(n.viewCache_)}function pg(n,e){let t=wt(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!w(e)&&!t.getImmediateChild(C(e)).isEmpty())?t.getChild(e):null}function bu(n){return n.eventRegistrations_.length===0}function gg(n,e){n.eventRegistrations_.push(e)}function Tu(n,e,t){let i=[];if(t){f(e==null,"A cancel should cancel all event registrations.");let s=n.query._path;n.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){let o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Au(n,e,t,i){e.type===Fe.MERGE&&e.source.queryId!==null&&(f(wt(n.viewCache_),"We should always have a full cache before handling merges"),f(cs(n.viewCache_),"Missing event cache, even though we have a server cache"));let s=n.viewCache_,r=og(n.processor_,s,e,t,i);return rg(n.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,gd(n,r.changes,r.viewCache.eventCache.getNode(),null)}function mg(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(R,(r,o)=>{i.push(Yt(r,o))}),t.isFullyInitialized()&&i.push(od(t.getNode())),gd(n,i,t.getNode(),e)}function gd(n,e,t,i){let s=i?[i]:n.eventRegistrations_;return Up(n.eventGenerator_,e,t,s)}var fs,ps=class{constructor(){this.views=new Map}};function _g(n){f(!fs,"__referenceConstructor has already been defined"),fs=n}function yg(){return f(fs,"Reference.ts has not been loaded"),fs}function vg(n){return n.views.size===0}function xa(n,e,t,i){let s=e.source.queryId;if(s!==null){let r=n.views.get(s);return f(r!=null,"SyncTree gave us an op for an invalid query."),Au(r,e,t,i)}else{let r=[];for(let o of n.views.values())r=r.concat(Au(o,e,t,i));return r}}function md(n,e,t,i,s){let r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=us(t,s?i:null),l=!1;a?l=!0:i instanceof y?(a=Da(t,i),l=!1):(a=y.EMPTY_NODE,l=!1);let c=As(new Le(a,l,!1),new Le(i,s,!1));return new Xo(e,c)}return o}function Cg(n,e,t,i,s,r){let o=md(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),gg(o,t),mg(o,t)}function wg(n,e,t,i){let s=e._queryIdentifier,r=[],o=[],a=rt(n);if(s==="default")for(let[l,c]of n.views.entries())o=o.concat(Tu(c,t,i)),bu(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=n.views.get(s);l&&(o=o.concat(Tu(l,t,i)),bu(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!rt(n)&&r.push(new(yg())(e._repo,e._path)),{removed:r,events:o}}function _d(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function nt(n,e){let t=null;for(let i of n.views.values())t=t||pg(i,e);return t}function yd(n,e){if(e._queryParams.loadsAllData())return ks(n);{let i=e._queryIdentifier;return n.views.get(i)}}function vd(n,e){return yd(n,e)!=null}function rt(n){return ks(n)!=null}function ks(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var gs;function Eg(n){f(!gs,"__referenceConstructor has already been defined"),gs=n}function Ig(){return f(gs,"Reference.ts has not been loaded"),gs}var bg=1,ms=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Y(null),this.pendingWriteTree_=ng(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Fa(n,e,t,i,s){return Hp(n.pendingWriteTree_,e,t,i,s),s?sn(n,new Zt(ka(),e,t)):[]}function Tg(n,e,t,i){qp(n.pendingWriteTree_,e,t,i);let s=Y.fromObject(t);return sn(n,new Qn(ka(),e,s))}function et(n,e,t=!1){let i=zp(n.pendingWriteTree_,e);if(Gp(n.pendingWriteTree_,e)){let r=new Y(null);return i.snap!=null?r=r.set(I(),!0):j(i.children,o=>{r=r.set(new b(o),!0)}),sn(n,new Vo(i.path,r,t))}else return[]}function ri(n,e,t){return sn(n,new Zt(Ra(),e,t))}function Ag(n,e,t){let i=Y.fromObject(t);return sn(n,new Qn(Ra(),e,i))}function Sg(n,e){return sn(n,new ls(Ra(),e))}function kg(n,e,t){let i=Oa(n,t);if(i){let s=Ma(i),r=s.path,o=s.queryId,a=Q(r,e),l=new ls(Pa(o),a);return La(n,r,l)}else return[]}function _s(n,e,t,i,s=!1){let r=e._path,o=n.syncPointTree_.get(r),a=[];if(o&&(e._queryIdentifier==="default"||vd(o,e))){let l=wg(o,e,t,i);vg(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!s){let u=c.findIndex(h=>h._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(r,(h,p)=>rt(p));if(u&&!d){let h=n.syncPointTree_.subtree(r);if(!h.isEmpty()){let p=Dg(h);for(let m=0;m<p.length;++m){let v=p[m],S=v.query,H=Id(n,v);n.listenProvider_.startListening(Bn(S),Zn(n,S),H.hashFn,H.onComplete)}}}!d&&c.length>0&&!i&&(u?n.listenProvider_.stopListening(Bn(e),null):c.forEach(h=>{let p=n.queryToTagMap.get(Ps(h));n.listenProvider_.stopListening(Bn(h),p)}))}Ng(n,c)}return a}function Cd(n,e,t,i){let s=Oa(n,i);if(s!=null){let r=Ma(s),o=r.path,a=r.queryId,l=Q(o,e),c=new Zt(Pa(a),l,t);return La(n,o,c)}else return[]}function Rg(n,e,t,i){let s=Oa(n,i);if(s){let r=Ma(s),o=r.path,a=r.queryId,l=Q(o,e),c=Y.fromObject(t),u=new Qn(Pa(a),l,c);return La(n,o,u)}else return[]}function Jo(n,e,t,i=!1){let s=e._path,r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(h,p)=>{let m=Q(h,s);r=r||nt(p,m),o=o||rt(p)});let a=n.syncPointTree_.get(s);a?(o=o||rt(a),r=r||nt(a,I())):(a=new ps,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=y.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((p,m)=>{let v=nt(m,I());v&&(r=r.updateImmediateChild(p,v))}));let c=vd(a,e);if(!c&&!e._queryParams.loadsAllData()){let h=Ps(e);f(!n.queryToTagMap.has(h),"View does not exist, but we have a tag");let p=xg();n.queryToTagMap.set(h,p),n.tagToQueryMap.set(p,h)}let u=Ss(n.pendingWriteTree_,s),d=Cg(a,e,t,u,r,l);if(!c&&!o&&!i){let h=yd(a,e);d=d.concat(Fg(n,e,h))}return d}function Rs(n,e,t){let s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{let l=Q(o,e),c=nt(a,l);if(c)return c});return ud(s,e,r,t,!0)}function Pg(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(c,u)=>{let d=Q(c,t);i=i||nt(u,d)});let s=n.syncPointTree_.get(t);s?i=i||nt(s,I()):(s=new ps,n.syncPointTree_=n.syncPointTree_.set(t,s));let r=i!=null,o=r?new Le(i,!0,!1):null,a=Ss(n.pendingWriteTree_,e._path),l=md(s,e,a,r?o.getNode():y.EMPTY_NODE,r);return fg(l)}function sn(n,e){return wd(e,n.syncPointTree_,null,Ss(n.pendingWriteTree_,I()))}function wd(n,e,t,i){if(w(n.path))return Ed(n,e,t,i);{let s=e.get(I());t==null&&s!=null&&(t=nt(s,I()));let r=[],o=C(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){let c=t?t.getImmediateChild(o):null,u=dd(i,o);r=r.concat(wd(a,l,c,u))}return s&&(r=r.concat(xa(s,n,i,t))),r}}function Ed(n,e,t,i){let s=e.get(I());t==null&&s!=null&&(t=nt(s,I()));let r=[];return e.children.inorderTraversal((o,a)=>{let l=t?t.getImmediateChild(o):null,c=dd(i,o),u=n.operationForChild(o);u&&(r=r.concat(Ed(u,a,l,c)))}),s&&(r=r.concat(xa(s,n,i,t))),r}function Id(n,e){let t=e.query,i=Zn(n,t);return{hashFn:()=>(hg(e)||y.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?kg(n,t._path,i):Sg(n,t._path);{let r=Hf(s,t);return _s(n,t,null,r)}}}}function Zn(n,e){let t=Ps(e);return n.queryToTagMap.get(t)}function Ps(n){return n._path.toString()+"$"+n._queryIdentifier}function Oa(n,e){return n.tagToQueryMap.get(e)}function Ma(n){let e=n.indexOf("$");return f(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new b(n.substr(0,e))}}function La(n,e,t){let i=n.syncPointTree_.get(e);f(i,"Missing sync point for query tag that we're tracking");let s=Ss(n.pendingWriteTree_,e);return xa(i,t,s,null)}function Dg(n){return n.fold((e,t,i)=>{if(t&&rt(t))return[ks(t)];{let s=[];return t&&(s=_d(t)),j(i,(r,o)=>{s=s.concat(o)}),s}})}function Bn(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(Ig())(n._repo,n._path):n}function Ng(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let s=Ps(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function xg(){return bg++}function Fg(n,e,t){let i=e._path,s=Zn(n,e),r=Id(n,t),o=n.listenProvider_.startListening(Bn(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)f(!rt(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,u,d)=>{if(!w(c)&&u&&rt(u))return[ks(u).query];{let h=[];return u&&(h=h.concat(_d(u).map(p=>p.query))),j(d,(p,m)=>{h=h.concat(m)}),h}});for(let c=0;c<l.length;++c){let u=l[c];n.listenProvider_.stopListening(Bn(u),Zn(n,u))}}return o}var ea=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},ta=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=P(this.path_,e);return new n(this.syncTree_,t)}node(){return Rs(this.syncTree_,this.path_)}},Og=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Su=function(n,e,t){if(!n||typeof n!="object")return n;if(f(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return Mg(n[".sv"],e,t);if(typeof n[".sv"]=="object")return Lg(n[".sv"],e);f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},Mg=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:f(!1,"Unexpected server value: "+n)}},Lg=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&f(!1,"Unexpected increment value: "+i);let s=e.node();if(f(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},bd=function(n,e,t,i){return $a(e,new ta(t,n),i)},Wa=function(n,e,t){return $a(n,new ea(e),t)};function $a(n,e,t){let i=n.getPriority().val(),s=Su(i,e.getImmediateChild(".priority"),t),r;if(n.isLeafNode()){let o=n,a=Su(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Kt(a,D(s)):n}else{let o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Kt(s))),o.forEachChild(R,(a,l)=>{let c=$a(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var Xn=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function Ds(n,e){let t=e instanceof b?e:new b(e),i=n,s=C(t);for(;s!==null;){let r=Qe(i.node.children,s)||{children:{},childCount:0};i=new Xn(s,i,r),t=k(t),s=C(t)}return i}function bt(n){return n.node.value}function Ua(n,e){n.node.value=e,na(n)}function Td(n){return n.node.childCount>0}function Wg(n){return bt(n)===void 0&&!Td(n)}function Ns(n,e){j(n.node.children,(t,i)=>{e(new Xn(t,n,i))})}function Ad(n,e,t,i){t&&!i&&e(n),Ns(n,s=>{Ad(s,e,!0,i)}),t&&i&&e(n)}function $g(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function oi(n){return new b(n.parent===null?n.name:oi(n.parent)+"/"+n.name)}function na(n){n.parent!==null&&Ug(n.parent,n.name,n)}function Ug(n,e,t){let i=Wg(t),s=ue(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,na(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,na(n))}var Bg=/[\[\].#$\/\u0000-\u001F\u007F]/,jg=/[\[\].#$\u0000-\u001F\u007F]/,fo=10*1024*1024,xs=function(n){return typeof n=="string"&&n.length!==0&&!Bg.test(n)},Sd=function(n){return typeof n=="string"&&n.length!==0&&!jg.test(n)},Vg=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Sd(n)},Jn=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!bs(n)||n&&typeof n=="object"&&ue(n,".sv")},We=function(n,e,t,i){i&&e===void 0||ai(ne(n,"value"),e,t)},ai=function(n,e,t){let i=t instanceof b?new Ao(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+yt(i));if(typeof e=="function")throw new Error(n+"contains a function "+yt(i)+" with contents = "+e.toString());if(bs(e))throw new Error(n+"contains "+e.toString()+" "+yt(i));if(typeof e=="string"&&e.length>fo/3&&gn(e)>fo)throw new Error(n+"contains a string greater than "+fo+" utf8 bytes "+yt(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(j(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!xs(o)))throw new Error(n+" contains an invalid key ("+o+") "+yt(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);vp(i,o),ai(n,a,i),Cp(i)}),s&&r)throw new Error(n+' contains ".value" child '+yt(i)+" in addition to actual children.")}},Hg=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];let r=Vn(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!xs(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(yp);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&he(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},kd=function(n,e,t,i){if(i&&e===void 0)return;let s=ne(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");let r=[];j(e,(o,a)=>{let l=new b(o);if(ai(s,a,P(t,l)),Ia(l)===".priority"&&!Jn(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),Hg(s,r)},Ba=function(n,e,t){if(!(t&&e===void 0)){if(bs(e))throw new Error(ne(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Jn(e))throw new Error(ne(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},li=function(n,e,t,i){if(!(i&&t===void 0)&&!xs(t))throw new Error(ne(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},rn=function(n,e,t,i){if(!(i&&t===void 0)&&!Sd(t))throw new Error(ne(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},qg=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),rn(n,e,t,i)},re=function(n,e){if(C(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},Rd=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!xs(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Vg(t))throw new Error(ne(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var ia=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Fs(n,e){let t=null;for(let i=0;i<e.length;i++){let s=e[i],r=s.getPath();t!==null&&!ba(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function Pd(n,e,t){Fs(n,t),Dd(n,i=>ba(i,e))}function oe(n,e,t){Fs(n,t),Dd(n,i=>he(i,e)||he(e,i))}function Dd(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let s=n.eventLists_[i];if(s){let r=s.path;e(r)?(zg(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function zg(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();Ct&&B("event: "+t.toString()),tn(i)}}}var Nd="repo_interrupt",Gg=25,sa=class{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ia,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=as(),this.transactionQueueTree_=new Xn,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Kg(n,e,t){if(n.stats_=Ea(n.repoInfo_),n.forceRestClient_||Kf())n.server_=new Lo(n.repoInfo_,(i,s,r,o)=>{ku(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Ru(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{M(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Ta(n.repoInfo_,e,(i,s,r,o)=>{ku(n,i,s,r,o)},i=>{Ru(n,i)},i=>{Qg(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=Yf(n.repoInfo_,()=>new jo(n.stats_,n.server_)),n.infoData_=new Wo,n.infoSyncTree_=new ms({startListening:(i,s,r,o)=>{let a=[],l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=ri(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),ja(n,"connected",!1),n.serverSyncTree_=new ms({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{let c=o(a,l);oe(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function xd(n){let t=n.infoData_.getNode(new b(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function ci(n){return Og({timestamp:xd(n)})}function ku(n,e,t,i,s){n.dataUpdateCount++;let r=new b(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){let l=pn(t,c=>D(c));o=Rg(n.serverSyncTree_,r,l,s)}else{let l=D(t);o=Cd(n.serverSyncTree_,r,l,s)}else if(i){let l=pn(t,c=>D(c));o=Ag(n.serverSyncTree_,r,l)}else{let l=D(t);o=ri(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=Jt(n,r)),oe(n.eventQueue_,a,o)}function Ru(n,e){ja(n,"connected",e),e===!1&&Xg(n)}function Qg(n,e){j(e,(t,i)=>{ja(n,t,i)})}function ja(n,e,t){let i=new b("/.info/"+e),s=D(t);n.infoData_.updateSnapshot(i,s);let r=ri(n.infoSyncTree_,i,s);oe(n.eventQueue_,i,r)}function Os(n){return n.nextWriteId_++}function Yg(n,e,t){let i=Pg(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(s=>{let r=D(s).withIndex(e._queryParams.getIndex());Jo(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=ri(n.serverSyncTree_,e._path,r);else{let a=Zn(n.serverSyncTree_,e);o=Cd(n.serverSyncTree_,e._path,r,a)}return oe(n.eventQueue_,e._path,o),_s(n.serverSyncTree_,e,t,null,!0),r},s=>(on(n,"get for query "+M(e)+" failed: "+s),Promise.reject(new Error(s))))}function Va(n,e,t,i,s){on(n,"set",{path:e.toString(),value:t,priority:i});let r=ci(n),o=D(t,i),a=Rs(n.serverSyncTree_,e),l=Wa(o,a,r),c=Os(n),u=Fa(n.serverSyncTree_,e,l,c,!0);Fs(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(h,p)=>{let m=h==="ok";m||V("set at "+e+" failed: "+h);let v=et(n.serverSyncTree_,c,!m);oe(n.eventQueue_,e,v),ot(n,s,h,p)});let d=qa(n,e);Jt(n,d),oe(n.eventQueue_,d,[])}function Zg(n,e,t,i){on(n,"update",{path:e.toString(),value:t});let s=!0,r=ci(n),o={};if(j(t,(a,l)=>{s=!1,o[a]=bd(P(e,a),D(l),n.serverSyncTree_,r)}),s)B("update() called with empty data.  Don't do anything."),ot(n,i,"ok",void 0);else{let a=Os(n),l=Tg(n.serverSyncTree_,e,o,a);Fs(n.eventQueue_,l),n.server_.merge(e.toString(),t,(c,u)=>{let d=c==="ok";d||V("update at "+e+" failed: "+c);let h=et(n.serverSyncTree_,a,!d),p=h.length>0?Jt(n,e):e;oe(n.eventQueue_,p,h),ot(n,i,c,u)}),j(t,c=>{let u=qa(n,P(e,c));Jt(n,u)}),oe(n.eventQueue_,e,[])}}function Xg(n){on(n,"onDisconnectEvents");let e=ci(n),t=as();Uo(n.onDisconnect_,I(),(s,r)=>{let o=bd(s,r,n.serverSyncTree_,e);nn(t,s,o)});let i=[];Uo(t,I(),(s,r)=>{i=i.concat(ri(n.serverSyncTree_,s,r));let o=qa(n,s);Jt(n,o)}),n.onDisconnect_=as(),oe(n.eventQueue_,I(),i)}function Jg(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{i==="ok"&&$o(n.onDisconnect_,e),ot(n,t,i,s)})}function Pu(n,e,t,i){let s=D(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&nn(n.onDisconnect_,e,s),ot(n,i,r,o)})}function em(n,e,t,i,s){let r=D(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&nn(n.onDisconnect_,e,r),ot(n,s,o,a)})}function tm(n,e,t,i){if(ki(t)){B("onDisconnect().update() called with empty data.  Don't do anything."),ot(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&j(t,(o,a)=>{let l=D(a);nn(n.onDisconnect_,P(e,o),l)}),ot(n,i,s,r)})}function nm(n,e,t){let i;C(e._path)===".info"?i=Jo(n.infoSyncTree_,e,t):i=Jo(n.serverSyncTree_,e,t),Pd(n.eventQueue_,e._path,i)}function ra(n,e,t){let i;C(e._path)===".info"?i=_s(n.infoSyncTree_,e,t):i=_s(n.serverSyncTree_,e,t),Pd(n.eventQueue_,e._path,i)}function Fd(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Nd)}function im(n){n.persistentConnection_&&n.persistentConnection_.resume(Nd)}function on(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),B(t,...e)}function ot(n,e,t,i){e&&tn(()=>{if(t==="ok")e(null);else{let s=(t||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,e(o)}})}function sm(n,e,t,i,s,r){on(n,"transaction on "+e);let o={path:e,update:t,onComplete:i,status:null,order:xu(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=Ha(n,e,void 0);o.currentInputSnapshot=a;let l=o.update(a.val());if(l===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ai("transaction failed: Data returned ",l,o.path),o.status=0;let c=Ds(n.transactionQueueTree_,e),u=bt(c)||[];u.push(o),Ua(c,u);let d;typeof l=="object"&&l!==null&&ue(l,".priority")?(d=Qe(l,".priority"),f(Jn(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):d=(Rs(n.serverSyncTree_,e)||y.EMPTY_NODE).getPriority().val();let h=ci(n),p=D(l,d),m=Wa(p,a,h);o.currentOutputSnapshotRaw=p,o.currentOutputSnapshotResolved=m,o.currentWriteId=Os(n);let v=Fa(n.serverSyncTree_,e,m,o.currentWriteId,o.applyLocally);oe(n.eventQueue_,e,v),Ms(n,n.transactionQueueTree_)}}function Ha(n,e,t){return Rs(n.serverSyncTree_,e,t)||y.EMPTY_NODE}function Ms(n,e=n.transactionQueueTree_){if(e||Ls(n,e),bt(e)){let t=Md(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&rm(n,oi(e),t)}else Td(e)&&Ns(e,t=>{Ms(n,t)})}function rm(n,e,t){let i=t.map(c=>c.currentWriteId),s=Ha(n,e,i),r=s,o=s.hash();for(let c=0;c<t.length;c++){let u=t[c];f(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;let d=Q(e,u.path);r=r.updateChild(d,u.currentOutputSnapshotRaw)}let a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{on(n,"transaction put response",{path:l.toString(),status:c});let u=[];if(c==="ok"){let d=[];for(let h=0;h<t.length;h++)t[h].status=2,u=u.concat(et(n.serverSyncTree_,t[h].currentWriteId)),t[h].onComplete&&d.push(()=>t[h].onComplete(null,!0,t[h].currentOutputSnapshotResolved)),t[h].unwatcher();Ls(n,Ds(n.transactionQueueTree_,e)),Ms(n,n.transactionQueueTree_),oe(n.eventQueue_,e,u);for(let h=0;h<d.length;h++)tn(d[h])}else{if(c==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{V("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=c}Jt(n,e)}},o)}function Jt(n,e){let t=Od(n,e),i=oi(t),s=Md(n,t);return om(n,s,i),i}function om(n,e,t){if(e.length===0)return;let i=[],s=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let l=e[a],c=Q(t,l.path),u=!1,d;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)u=!0,d=l.abortReason,s=s.concat(et(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=Gg)u=!0,d="maxretry",s=s.concat(et(n.serverSyncTree_,l.currentWriteId,!0));else{let h=Ha(n,l.path,o);l.currentInputSnapshot=h;let p=e[a].update(h.val());if(p!==void 0){ai("transaction failed: Data returned ",p,l.path);let m=D(p);typeof p=="object"&&p!=null&&ue(p,".priority")||(m=m.updatePriority(h.getPriority()));let S=l.currentWriteId,H=ci(n),J=Wa(m,h,H);l.currentOutputSnapshotRaw=m,l.currentOutputSnapshotResolved=J,l.currentWriteId=Os(n),o.splice(o.indexOf(S),1),s=s.concat(Fa(n.serverSyncTree_,l.path,J,l.currentWriteId,l.applyLocally)),s=s.concat(et(n.serverSyncTree_,S,!0))}else u=!0,d="nodata",s=s.concat(et(n.serverSyncTree_,l.currentWriteId,!0))}oe(n.eventQueue_,t,s),s=[],u&&(e[a].status=2,function(h){setTimeout(h,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(d),!1,null))))}Ls(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)tn(i[a]);Ms(n,n.transactionQueueTree_)}function Od(n,e){let t,i=n.transactionQueueTree_;for(t=C(e);t!==null&&bt(i)===void 0;)i=Ds(i,t),e=k(e),t=C(e);return i}function Md(n,e){let t=[];return Ld(n,e,t),t.sort((i,s)=>i.order-s.order),t}function Ld(n,e,t){let i=bt(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);Ns(e,s=>{Ld(n,s,t)})}function Ls(n,e){let t=bt(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,Ua(e,t.length>0?t:void 0)}Ns(e,i=>{Ls(n,i)})}function qa(n,e){let t=oi(Od(n,e)),i=Ds(n.transactionQueueTree_,e);return $g(i,s=>{po(n,s)}),po(n,i),Ad(i,s=>{po(n,s)}),t}function po(n,e){let t=bt(e);if(t){let i=[],s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(f(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(et(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Ua(e,void 0):t.length=r+1,oe(n.eventQueue_,oi(e),s);for(let o=0;o<i.length;o++)tn(i[o])}}function am(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function lm(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):V(`Invalid query segment '${t}' in query '${n}'`)}return e}var oa=function(n,e){let t=cm(n),i=t.namespace;t.domain==="firebase.com"&&Me(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&Me("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||$f();let s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Ji(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new b(t.pathString)}},cm=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let u=n.indexOf("/");u===-1&&(u=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(u,d)),u<d&&(s=am(n.substring(u,d)));let h=lm(n.substring(Math.min(n.length,d)));c=e.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(e.substring(c+1),10)):c=e.length;let p=e.slice(0,c);if(p.toLowerCase()==="localhost")t="localhost";else if(p.split(".").length<=2)t=p;else{let m=e.indexOf(".");i=e.substring(0,m).toLowerCase(),t=e.substring(m+1),r=i}"ns"in h&&(r=h.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};var Du="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",um=function(){let n=0,e=[];return function(t){let i=t===n;n=t;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=Du.charAt(t%64),t=Math.floor(t/64);f(t===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=Du.charAt(e[s]);return f(o.length===20,"nextPushId: Length should be 20."),o}}();var ys=class{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+M(this.snapshot.exportVal())}},vs=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var ei=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var Cs=class{constructor(e,t){this._repo=e,this._path=t}cancel(){let e=new $;return Jg(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){re("OnDisconnect.remove",this._path);let e=new $;return Pu(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){re("OnDisconnect.set",this._path),We("OnDisconnect.set",e,this._path,!1);let t=new $;return Pu(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){re("OnDisconnect.setWithPriority",this._path),We("OnDisconnect.setWithPriority",e,this._path,!1),Ba("OnDisconnect.setWithPriority",t,!1);let i=new $;return em(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){re("OnDisconnect.update",this._path),kd("OnDisconnect.update",e,this._path,!1);let t=new $;return tm(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};var Z=class n{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return w(this._path)?null:Ia(this._path)}get ref(){return new ae(this._repo,this._path)}get _queryIdentifier(){let e=_u(this._queryParams),t=wa(e);return t==="{}"?"default":t}get _queryObject(){return _u(this._queryParams)}isEqual(e){if(e=U(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=ba(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+_p(this._path)}};function Ws(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function lt(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===Oe){let i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==it)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==je)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===R){if(e!=null&&!Jn(e)||t!=null&&!Jn(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(f(n.getIndex()instanceof Hn||n.getIndex()===Sa,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function $s(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var ae=class n extends Z{constructor(e,t){super(e,t,new Kn,!1)}get parent(){let e=ed(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},en=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new b(e),i=at(this.ref,e);return new n(this._node.getChild(t),i,R)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new n(s,at(this.ref,i),R)))}hasChild(e){let t=new b(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function za(n,e){return n=U(n),n._checkNotDeleted("ref"),e!==void 0?at(n._root,e):n._root}function Ga(n,e){n=U(n),n._checkNotDeleted("refFromURL");let t=oa(e,n._repo.repoInfo_.nodeAdmin);Rd("refFromURL",t);let i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&Me("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),za(n,t.path.toString())}function at(n,e){return n=U(n),C(n._path)===null?qg("child","path",e,!1):rn("child","path",e,!1),new ae(n._repo,P(n._path,e))}function Wd(n,e){n=U(n),re("push",n._path),We("push",e,n._path,!0);let t=xd(n._repo),i=um(t),s=at(n,i),r=at(n,i),o;return e!=null?o=Us(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function $d(n){return re("remove",n._path),Us(n,null)}function Us(n,e){n=U(n),re("set",n._path),We("set",e,n._path,!1);let t=new $;return Va(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function Ud(n,e){n=U(n),re("setPriority",n._path),Ba("setPriority",e,!1);let t=new $;return Va(n._repo,P(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function Bd(n,e,t){if(re("setWithPriority",n._path),We("setWithPriority",e,n._path,!1),Ba("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";let i=new $;return Va(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function jd(n,e){kd("update",e,n._path,!1);let t=new $;return Zg(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function Vd(n){n=U(n);let e=new ei(()=>{}),t=new ti(e);return Yg(n._repo,n,t).then(i=>new en(i,new ae(n._repo,n._path),n._queryParams.getIndex()))}var ti=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new ys("value",this,new en(e.snapshotNode,new ae(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new vs(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},ws=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new vs(this,e,t):null}createEvent(e,t){f(e.childName!=null,"Child events should have a childName.");let i=at(new ae(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new ys(e.type,this,new en(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function ui(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let l=t,c=(u,d)=>{ra(n._repo,n,a),l(u,d)};c.userCallback=t.userCallback,c.context=t.context,t=c}let o=new ei(t,r||void 0),a=e==="value"?new ti(o):new ws(e,o);return nm(n._repo,n,a),()=>ra(n._repo,n,a)}function Bs(n,e,t,i){return ui(n,"value",e,t,i)}function Ka(n,e,t,i){return ui(n,"child_added",e,t,i)}function Qa(n,e,t,i){return ui(n,"child_changed",e,t,i)}function Ya(n,e,t,i){return ui(n,"child_moved",e,t,i)}function Za(n,e,t,i){return ui(n,"child_removed",e,t,i)}function Xa(n,e,t){let i=null,s=t?new ei(t):null;e==="value"?i=new ti(s):e&&(i=new ws(e,s)),ra(n._repo,n,i)}var le=class{},Es=class extends le{constructor(e,t){super(),this._value=e,this._key=t,this.type="endAt"}_apply(e){We("endAt",this._value,e._path,!0);let t=Mo(e._queryParams,this._value,this._key);if($s(t),lt(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Z(e._repo,e._path,t,e._orderByCalled)}};function Hd(n,e){return li("endAt","key",e,!0),new Es(n,e)}var aa=class extends le{constructor(e,t){super(),this._value=e,this._key=t,this.type="endBefore"}_apply(e){We("endBefore",this._value,e._path,!1);let t=Mp(e._queryParams,this._value,this._key);if($s(t),lt(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Z(e._repo,e._path,t,e._orderByCalled)}};function qd(n,e){return li("endBefore","key",e,!0),new aa(n,e)}var Is=class extends le{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAt"}_apply(e){We("startAt",this._value,e._path,!0);let t=Oo(e._queryParams,this._value,this._key);if($s(t),lt(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Z(e._repo,e._path,t,e._orderByCalled)}};function zd(n=null,e){return li("startAt","key",e,!0),new Is(n,e)}var la=class extends le{constructor(e,t){super(),this._value=e,this._key=t,this.type="startAfter"}_apply(e){We("startAfter",this._value,e._path,!1);let t=Op(e._queryParams,this._value,this._key);if($s(t),lt(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Z(e._repo,e._path,t,e._orderByCalled)}};function Gd(n,e){return li("startAfter","key",e,!0),new la(n,e)}var ca=class extends le{constructor(e){super(),this._limit=e,this.type="limitToFirst"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Z(e._repo,e._path,xp(e._queryParams,this._limit),e._orderByCalled)}};function Kd(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new ca(n)}var ua=class extends le{constructor(e){super(),this._limit=e,this.type="limitToLast"}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Z(e._repo,e._path,Fp(e._queryParams,this._limit),e._orderByCalled)}};function Qd(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new ua(n)}var da=class extends le{constructor(e){super(),this._path=e,this.type="orderByChild"}_apply(e){Ws(e,"orderByChild");let t=new b(this._path);if(w(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");let i=new Hn(t),s=Ts(e._queryParams,i);return lt(s),new Z(e._repo,e._path,s,!0)}};function Yd(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return rn("orderByChild","path",n,!1),new da(n)}var ha=class extends le{constructor(){super(...arguments),this.type="orderByKey"}_apply(e){Ws(e,"orderByKey");let t=Ts(e._queryParams,Oe);return lt(t),new Z(e._repo,e._path,t,!0)}};function Zd(){return new ha}var fa=class extends le{constructor(){super(...arguments),this.type="orderByPriority"}_apply(e){Ws(e,"orderByPriority");let t=Ts(e._queryParams,R);return lt(t),new Z(e._repo,e._path,t,!0)}};function Xd(){return new fa}var pa=class extends le{constructor(){super(...arguments),this.type="orderByValue"}_apply(e){Ws(e,"orderByValue");let t=Ts(e._queryParams,Sa);return lt(t),new Z(e._repo,e._path,t,!0)}};function Jd(){return new pa}var ga=class extends le{constructor(e,t){super(),this._value=e,this._key=t,this.type="equalTo"}_apply(e){if(We("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Es(this._value,this._key)._apply(new Is(this._value,this._key)._apply(e))}};function eh(n,e){return li("equalTo","key",e,!0),new ga(n,e)}function pe(n,...e){let t=U(n);for(let i of e)t=i._apply(t);return t}_g(ae);Eg(ae);var dm="FIREBASE_DATABASE_EMULATOR_HOST",ma={},hm=!1;function fm(n,e,t,i){n.repoInfo_=new Ji(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function Ja(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||Me("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),B("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=oa(r,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[dm]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=oa(r,s),a=o.repoInfo):l=!o.repoInfo.secure;let u=s&&l?new Wn(Wn.OWNER):new Co(n.name,n.options,e);Rd("Invalid Firebase Database URL",o),w(o.path)||Me("Database URL must point to the root of a Firebase Database (not including a child path).");let d=gm(a,n,u,new vo(n.name,t));return new _a(d,n)}function pm(n,e){let t=ma[e];(!t||t[n.key]!==n)&&Me(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Fd(n),delete t[n.key]}function gm(n,e,t,i){let s=ma[e.name];s||(s={},ma[e.name]=s);let r=s[n.toURLString()];return r&&Me("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new sa(n,hm,t,i),s[n.toURLString()]=r,r}var _a=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Kg(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ae(this._repo,I())),this._rootInternal}_delete(){return this._rootInternal!==null&&(pm(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Me("Cannot call "+e+" on a deleted database.")}};function th(){Ju.IS_TRANSPORT_INITIALIZED&&V("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function nh(){th(),jn.forceDisallow()}function ih(){th(),Ht.forceDisallow(),jn.forceAllow()}function sh(n,e,t,i={}){n=U(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&Me("Cannot call useEmulator() after instance has already been initialized.");let s=n._repoInternal,r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&Me('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Wn(Wn.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:ec(i.mockUserToken,n.app.options.projectId);r=new Wn(o)}fm(s,e,t,r)}function rh(n){n=U(n),n._checkNotDeleted("goOffline"),Fd(n._repo)}function oh(n){n=U(n),n._checkNotDeleted("goOnline"),im(n._repo)}function ah(n,e){Ou(n,e)}function mm(n){Ca(uc),mn(new Ce("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return Ja(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),se(eu,tu,n),se(eu,tu,"esm2017")}var _m={".sv":"timestamp"};function lh(){return _m}function ch(n){return{".sv":{increment:n}}}var ya=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function uh(n,e,t){var i;if(n=U(n),re("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";let s=(i=t?.applyLocally)!==null&&i!==void 0?i:!0,r=new $,o=(l,c,u)=>{let d=null;l?r.reject(l):(d=new en(u,new ae(n._repo,n._path),R),r.resolve(new ya(c,d)))},a=Bs(n,()=>{});return sm(n._repo,n._path,e,o,a,s),r.promise}Ta.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Ta.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};mm();var ym="@firebase/database-compat",vm="1.0.5";var Cm=new Lt("@firebase/database-compat"),dh=function(n){let e="FIREBASE WARNING: "+n;Cm.warn(e)};var wm=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error(ne(n,e)+"must be a boolean.")},Em=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(ne(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};var el=class{constructor(e){this._delegate=e}cancel(e){_("OnDisconnect.cancel",0,1,arguments.length),L("OnDisconnect.cancel","onComplete",e,!0);let t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){_("OnDisconnect.remove",0,1,arguments.length),L("OnDisconnect.remove","onComplete",e,!0);let t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){_("OnDisconnect.set",1,2,arguments.length),L("OnDisconnect.set","onComplete",t,!0);let i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){_("OnDisconnect.setWithPriority",2,3,arguments.length),L("OnDisconnect.setWithPriority","onComplete",i,!0);let s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if(_("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,dh("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}L("OnDisconnect.update","onComplete",t,!0);let i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}};var tl=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return _("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}};var Tt=class n{constructor(e,t){this._database=e,this._delegate=t}val(){return _("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return _("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return _("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return _("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return _("DataSnapshot.child",0,1,arguments.length),e=String(e),rn("DataSnapshot.child","path",e,!1),new n(this._database,this._delegate.child(e))}hasChild(e){return _("DataSnapshot.hasChild",1,1,arguments.length),rn("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return _("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return _("DataSnapshot.forEach",1,1,arguments.length),L("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new n(this._database,t)))}hasChildren(){return _("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return _("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return _("DataSnapshot.ref",0,0,arguments.length),new Ve(this._database,this._delegate.ref)}get ref(){return this.getRef()}},js=class n{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;_("Query.on",2,4,arguments.length),L("Query.on","callback",t,!1);let o=n.getCancelAndContextArgs_("Query.on",i,s),a=(c,u)=>{t.call(o.context,new Tt(this.database,c),u)};a.userCallback=t,a.context=o.context;let l=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return Bs(this._delegate,a,l),t;case"child_added":return Ka(this._delegate,a,l),t;case"child_removed":return Za(this._delegate,a,l),t;case"child_changed":return Qa(this._delegate,a,l),t;case"child_moved":return Ya(this._delegate,a,l),t;default:throw new Error(ne("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(_("Query.off",0,3,arguments.length),Em("Query.off",e,!0),L("Query.off","callback",t,!0),lr("Query.off","context",i,!0),t){let s=()=>{};s.userCallback=t,s.context=i,Xa(this._delegate,e,s)}else Xa(this._delegate,e)}get(){return Vd(this._delegate).then(e=>new Tt(this.database,e))}once(e,t,i,s){_("Query.once",1,4,arguments.length),L("Query.once","callback",t,!0);let r=n.getCancelAndContextArgs_("Query.once",i,s),o=new $,a=(c,u)=>{let d=new Tt(this.database,c);t&&t.call(r.context,d,u),o.resolve(d)};a.userCallback=t,a.context=r.context;let l=c=>{r.cancel&&r.cancel.call(r.context,c),o.reject(c)};switch(e){case"value":Bs(this._delegate,a,l,{onlyOnce:!0});break;case"child_added":Ka(this._delegate,a,l,{onlyOnce:!0});break;case"child_removed":Za(this._delegate,a,l,{onlyOnce:!0});break;case"child_changed":Qa(this._delegate,a,l,{onlyOnce:!0});break;case"child_moved":Ya(this._delegate,a,l,{onlyOnce:!0});break;default:throw new Error(ne("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return _("Query.limitToFirst",1,1,arguments.length),new n(this.database,pe(this._delegate,Kd(e)))}limitToLast(e){return _("Query.limitToLast",1,1,arguments.length),new n(this.database,pe(this._delegate,Qd(e)))}orderByChild(e){return _("Query.orderByChild",1,1,arguments.length),new n(this.database,pe(this._delegate,Yd(e)))}orderByKey(){return _("Query.orderByKey",0,0,arguments.length),new n(this.database,pe(this._delegate,Zd()))}orderByPriority(){return _("Query.orderByPriority",0,0,arguments.length),new n(this.database,pe(this._delegate,Xd()))}orderByValue(){return _("Query.orderByValue",0,0,arguments.length),new n(this.database,pe(this._delegate,Jd()))}startAt(e=null,t){return _("Query.startAt",0,2,arguments.length),new n(this.database,pe(this._delegate,zd(e,t)))}startAfter(e=null,t){return _("Query.startAfter",0,2,arguments.length),new n(this.database,pe(this._delegate,Gd(e,t)))}endAt(e=null,t){return _("Query.endAt",0,2,arguments.length),new n(this.database,pe(this._delegate,Hd(e,t)))}endBefore(e=null,t){return _("Query.endBefore",0,2,arguments.length),new n(this.database,pe(this._delegate,qd(e,t)))}equalTo(e,t){return _("Query.equalTo",1,2,arguments.length),new n(this.database,pe(this._delegate,eh(e,t)))}toString(){return _("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return _("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(_("Query.isEqual",1,1,arguments.length),!(e instanceof n)){let t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){let s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,L(e,"cancel",s.cancel,!0),s.context=i,lr(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error(ne(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new Ve(this.database,new ae(this._delegate._repo,this._delegate._path))}},Ve=class n extends js{constructor(e,t){super(e,new Z(t._repo,t._path,new Kn,!1)),this.database=e,this._delegate=t}getKey(){return _("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return _("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new n(this.database,at(this._delegate,e))}getParent(){_("Reference.parent",0,0,arguments.length);let e=this._delegate.parent;return e?new n(this.database,e):null}getRoot(){return _("Reference.root",0,0,arguments.length),new n(this.database,this._delegate.root)}set(e,t){_("Reference.set",1,2,arguments.length),L("Reference.set","onComplete",t,!0);let i=Us(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if(_("Reference.update",1,2,arguments.length),Array.isArray(e)){let s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,dh("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}re("Reference.update",this._delegate._path),L("Reference.update","onComplete",t,!0);let i=jd(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){_("Reference.setWithPriority",2,3,arguments.length),L("Reference.setWithPriority","onComplete",i,!0);let s=Bd(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){_("Reference.remove",0,1,arguments.length),L("Reference.remove","onComplete",e,!0);let t=$d(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){_("Reference.transaction",1,3,arguments.length),L("Reference.transaction","transactionUpdate",e,!1),L("Reference.transaction","onComplete",t,!0),wm("Reference.transaction","applyLocally",i,!0);let s=uh(this._delegate,e,{applyLocally:i}).then(r=>new tl(r.committed,new Tt(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){_("Reference.setPriority",1,2,arguments.length),L("Reference.setPriority","onComplete",t,!0);let i=Ud(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){_("Reference.push",0,2,arguments.length),L("Reference.push","onComplete",t,!0);let i=Wd(this._delegate,e),s=i.then(o=>new n(this.database,o));t&&s.then(()=>t(null),o=>t(o));let r=new n(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return re("Reference.onDisconnect",this._delegate._path),new el(new Cs(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};var At=class{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:nh,forceLongPolling:ih}}useEmulator(e,t,i={}){sh(this._delegate,e,t,i)}ref(e){if(_("database.ref",0,1,arguments.length),e instanceof Ve){let t=Ga(this._delegate,e.toString());return new Ve(this,t)}else{let t=za(this._delegate,e);return new Ve(this,t)}}refFromURL(e){_("database.refFromURL",1,1,arguments.length);let i=Ga(this._delegate,e);return new Ve(this,i)}goOffline(){return _("database.goOffline",0,0,arguments.length),rh(this._delegate)}goOnline(){return _("database.goOnline",0,0,arguments.length),oh(this._delegate)}};At.ServerValue={TIMESTAMP:lh(),increment:n=>ch(n)};function Im({app:n,url:e,version:t,customAuthImpl:i,customAppCheckImpl:s,namespace:r,nodeAdmin:o=!1}){Ca(t);let a=new cr("database-standalone"),l=new Ri("auth-internal",a);l.setComponent(new Ce("auth-internal",()=>i,"PRIVATE"));let c;return s&&(c=new Ri("app-check-internal",a),c.setComponent(new Ce("app-check-internal",()=>s,"PRIVATE"))),{instance:new At(Ja(n,l,c,e,o),n),namespace:r}}var bm=Object.freeze({__proto__:null,initStandalone:Im});var Tm=At.ServerValue;function Am(n){n.INTERNAL.registerComponent(new Ce("database-compat",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new At(s,i)},"PUBLIC").setServiceProps({Reference:Ve,Query:js,Database:At,DataSnapshot:Tt,enableLogging:ah,INTERNAL:bm,ServerValue:Tm}).setMultipleInstances(!0)),n.registerVersion(ym,vm)}Am(W);function di(n,e,t="on",i=Nt){return new Se(s=>{let r=null;return r=n[t](e,(o,a)=>{i.schedule(()=>{s.next({snapshot:o,prevKey:a})}),t==="once"&&i.schedule(()=>s.complete())},o=>{i.schedule(()=>s.error(o))}),t==="on"?{unsubscribe(){r!=null&&n.off(e,r)}}:{unsubscribe(){}}}).pipe(N(s=>{let{snapshot:r,prevKey:o}=s,a=null;return r.exists()&&(a=r.key),{type:e,payload:r,prevKey:o,key:a}}),Il())}function Sm(n){return typeof n=="string"}function km(n){return typeof n.exportVal=="function"}function mh(n){return n==null}function _h(n){return typeof n.set=="function"}function hh(n,e){return _h(e)?e:n.ref(e)}function yh(n,e){if(Sm(n))return e.stringCase();if(_h(n))return e.firebaseCase();if(km(n))return e.snapshotCase();throw new Error(`Expects a string, snapshot, or reference. Got: ${typeof n}`)}function vh(n){return(mh(n)||n.length===0)&&(n=["child_added","child_removed","child_changed","child_moved"]),n}function Ch(n,e,t){e=vh(e);let i=e.map(s=>di(n,s,"on",t));return dt(...i)}function Rm(n,e,t){let i=Ch(n,e).pipe(ht((s,r)=>[...s,r],[]));return Dm(n,i,t)}function Pm(n,e){return di(n,"value","on",e).pipe(N(t=>{let i;return t.payload.forEach(s=>(i=s.key,!1)),{data:t,lastKeyToLoad:i}}))}function Dm(n,e,t){return Pm(n,t).pipe(Al(e),N(([s,r])=>{let o=s.lastKeyToLoad,a=r.map(l=>l.key);return{actions:r,lastKeyToLoad:o,loadedKeys:a}}),bl(s=>s.loadedKeys.indexOf(s.lastKeyToLoad)===-1),N(s=>s.actions))}function fh(n,e){return function(i,s){return yh(i,{stringCase:()=>n.child(i)[e](s),firebaseCase:()=>i[e](s),snapshotCase:()=>i.ref[e](s)})}}function Nm(n){return function(t){return t?yh(t,{stringCase:()=>n.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):n.remove()}}function xm(n,e,t){return di(n,"value","once",t).pipe(Ue(i=>{let s=[ce(i)];return e.forEach(r=>s.push(di(n,r,"on",t))),dt(...s).pipe(ht(Om,[]))}),yi())}function wh(n,e){let t=n.length;for(let i=0;i<t;i++)if(n[i].payload.key===e)return i;return-1}function Fm(n,e){if(mh(e))return 0;{let t=wh(n,e);return t===-1?n.length:t+1}}function Om(n,e){let{payload:t,prevKey:i,key:s}=e,r=wh(n,s),o=Fm(n,i);switch(e.type){case"value":if(e.payload?.exists()){let a=null;e.payload.forEach(l=>{let c={payload:l,type:"value",prevKey:a,key:l.key};return a=l.key,n=[...n,c],!1})}return n;case"child_added":if(r>-1)(n[r-1]?.key||null)!==i&&(n=n.filter(l=>l.payload.key!==t.key),n.splice(o,0,e));else{if(i==null)return[e,...n];n=n.slice(),n.splice(o,0,e)}return n;case"child_removed":return n.filter(a=>a.payload.key!==t.key);case"child_changed":return n.map(a=>a.payload.key===s?e:a);case"child_moved":if(r>-1){let a=n.splice(r,1)[0];return n=n.slice(),n.splice(o,0,a),n}return n;default:return n}}function ph(n,e,t){return e=vh(e),xm(n,e,t)}function Mm(n,e){let t=e.schedulers.outsideAngular,i=e.schedulers.ngZone.run(()=>n.ref);return{query:n,update:fh(i,"update"),set:fh(i,"set"),push:s=>i.push(s),remove:Nm(i),snapshotChanges(s){return ph(n,s,t).pipe(x)},stateChanges(s){return Ch(n,s,t).pipe(x)},auditTrail(s){return Rm(n,s,t).pipe(x)},valueChanges(s,r){return ph(n,s,t).pipe(N(a=>a.map(l=>r&&r.idField?ct(z({},l.payload.val()),{[r.idField]:l.key}):l.payload.val())),x)}}}function gh(n,e){return function(){return di(n,"value","on",e)}}function Lm(n,e){return{query:n,snapshotChanges(){return gh(n,e.schedulers.outsideAngular)().pipe(x)},update(t){return n.ref.update(t)},set(t){return n.ref.set(t)},remove(){return n.ref.remove()},valueChanges(){return gh(n,e.schedulers.outsideAngular)().pipe(x,N(i=>i.payload.exists()?i.payload.val():null))}}}var Wm=new A("angularfire2.realtimeDatabaseURL"),$m=new A("angularfire2.database.use-emulator"),Um=(()=>{class n{schedulers;database;constructor(t,i,s,r,o,a,l,c,u,d,h,p,m,v,S){this.schedulers=a;let H=l,J=mt(t,o,i);c&&Dn(J,o,u,h,p,m,d,v),this.database=jt(`${J.name}.database.${s}`,"AngularFireDatabase",J.name,()=>{let T=o.runOutsideAngular(()=>J.database(s||void 0));return H&&T.useEmulator(...H),T},[H])}list(t,i){let s=this.schedulers.ngZone.runOutsideAngular(()=>hh(this.database,t)),r=s;return i&&(r=i(s)),Mm(r,this)}object(t){let i=this.schedulers.ngZone.runOutsideAngular(()=>hh(this.database,t));return Lm(i,this)}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}static \u0275fac=function(i){return new(i||n)(g(Ze),g(Xe,8),g(Wm,8),g(Pe),g(O),g(Ee),g($m,8),g(Nn,8),g(Tn,8),g(An,8),g(Sn,8),g(kn,8),g(Rn,8),g(Pn,8),g(de,8))};static \u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Eh=(()=>{class n{constructor(){W.registerVersion("angularfire",K.full,"rtdb-compat")}static \u0275fac=function(i){return new(i||n)};static \u0275mod=te({type:n});static \u0275inj=ee({providers:[Um]})}return n})();var Bm="@firebase/firestore-compat",jm="0.3.32";function al(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new Wt("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Ih(){if(typeof Uint8Array>"u")throw new Wt("unimplemented","Uint8Arrays are not available in this environment.")}function bh(){if(!_c())throw new Wt("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Vs=class n{constructor(e){this._delegate=e}static fromBase64String(e){return bh(),new n(Fi.fromBase64String(e))}static fromUint8Array(e){return Ih(),new n(Fi.fromUint8Array(e))}toBase64(){return bh(),this._delegate.toBase64()}toUint8Array(){return Ih(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function nl(n){return Vm(n,["next","error","complete"])}function Vm(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}var il=class{enableIndexedDbPersistence(e,t){return pr(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return gr(e._delegate)}clearIndexedDbPersistence(e){return mr(e._delegate)}},Hs=class{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof yc||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&hc("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){dr(this._delegate,e,t,i)}enableNetwork(){return yr(this._delegate)}disableNetwork(){return vr(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,vc("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return _r(this._delegate)}onSnapshotsInSync(e){return Ur(this._delegate,e)}get app(){if(!this._appCompat)throw new Wt("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new cn(this,Ni(this._delegate,e))}catch(t){throw X(t,"collection()","Firestore.collection()")}}doc(e){try{return new $e(this,yn(this._delegate,e))}catch(t){throw X(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Pt(this,hr(this._delegate,e))}catch(t){throw X(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return Br(this._delegate,t=>e(new qs(this,t)))}batch(){return Ic(this._delegate),new zs(new kc(this._delegate,e=>Sc(this._delegate,e)))}loadBundle(e){return Cr(this._delegate,e)}namedQuery(e){return wr(this._delegate,e).then(t=>t?new Pt(this,t):null)}},an=class extends Tc{constructor(e){super(),this.firestore=e}convertBytes(e){return new Vs(new Fi(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return $e.forKey(t,this.firestore,null)}};function Hm(n){ur(n)}var qs=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new an(e)}get(e){let t=St(e);return this._delegate.get(t).then(i=>new kt(this._firestore,new Oi(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){let s=St(e);return i?(al("Transaction.set",i),this._delegate.set(s,t,i)):this._delegate.set(s,t),this}update(e,t,i,...s){let r=St(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,i,...s),this}delete(e){let t=St(e);return this._delegate.delete(t),this}},zs=class{constructor(e){this._delegate=e}set(e,t,i){let s=St(e);return i?(al("WriteBatch.set",i),this._delegate.set(s,t,i)):this._delegate.set(s,t),this}update(e,t,i,...s){let r=St(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,i,...s),this}delete(e){let t=St(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},ln=class n{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){let i=new Ac(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Rt(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let i=n.INSTANCES,s=i.get(e);s||(s=new WeakMap,i.set(e,s));let r=s.get(t);return r||(r=new n(e,new an(e),t),s.set(t,r)),r}};ln.INSTANCES=new WeakMap;var $e=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new an(e)}static forPath(e,t,i){if(e.length%2!==0)throw new Wt("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new _n(t._delegate,i,new mc(e)))}static forKey(e,t,i){return new n(t,new _n(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new cn(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new cn(this.firestore,Ni(this._delegate,e))}catch(t){throw X(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=U(e),e instanceof _n?xi(this._delegate,e):!1}set(e,t){t=al("DocumentReference.set",t);try{return t?Li(this._delegate,e,t):Li(this._delegate,e)}catch(i){throw X(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?Wi(this._delegate,e):Wi(this._delegate,e,t,...i)}catch(s){throw X(s,"updateDoc()","DocumentReference.update()")}}delete(){return Wr(this._delegate)}onSnapshot(...e){let t=Th(e),i=Ah(e,s=>new kt(this.firestore,new Oi(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return $i(this._delegate,t,i)}get(e){let t;return e?.source==="cache"?t=xr(this._delegate):e?.source==="server"?t=Fr(this._delegate):t=Nr(this._delegate),t.then(i=>new kt(this.firestore,new Oi(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ln.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function X(n,e,t){return n.message=n.message.replace(e,t),n}function Th(n){for(let e of n)if(typeof e=="object"&&!nl(e))return e;return{}}function Ah(n,e){var t,i;let s;return nl(n[0])?s=n[0]:nl(n[1])?s=n[1]:typeof n[0]=="function"?s={next:n[0],error:n[1],complete:n[2]}:s={next:n[1],error:n[2],complete:n[3]},{next:r=>{s.next&&s.next(e(r))},error:(t=s.error)===null||t===void 0?void 0:t.bind(s),complete:(i=s.complete)===null||i===void 0?void 0:i.bind(s)}}var kt=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new $e(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Mi(this._delegate,e._delegate)}},Rt=class extends kt{data(e){let t=this._delegate.data(e);return this._delegate._converter||fc(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Pt=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new an(e)}where(e,t,i){try{return new n(this.firestore,xe(this._delegate,Ir(e,t,i)))}catch(s){throw X(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,xe(this._delegate,br(e,t)))}catch(i){throw X(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,xe(this._delegate,Tr(e)))}catch(t){throw X(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,xe(this._delegate,Ar(e)))}catch(t){throw X(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,xe(this._delegate,Sr(...e)))}catch(t){throw X(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,xe(this._delegate,kr(...e)))}catch(t){throw X(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,xe(this._delegate,Rr(...e)))}catch(t){throw X(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,xe(this._delegate,Pr(...e)))}catch(t){throw X(t,"endAt()","Query.endAt()")}}isEqual(e){return fr(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Mr(this._delegate):e?.source==="server"?t=Lr(this._delegate):t=Or(this._delegate),t.then(i=>new hi(this.firestore,new Dr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){let t=Th(e),i=Ah(e,s=>new hi(this.firestore,new Dr(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return $i(this._delegate,t,i)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ln.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},sl=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Rt(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},hi=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Pt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Rt(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new sl(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new Rt(this._firestore,i))})}isEqual(e){return Mi(this._delegate,e._delegate)}},cn=class n extends Pt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new $e(this.firestore,e):null}doc(e){try{return e===void 0?new $e(this.firestore,yn(this._delegate)):new $e(this.firestore,yn(this._delegate,e))}catch(t){throw X(t,"doc()","CollectionReference.doc()")}}add(e){return $r(this._delegate,e).then(t=>new $e(this.firestore,t))}isEqual(e){return xi(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(ln.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function St(n){return Cc(n,_n)}var rl=class n{constructor(...e){this._delegate=new Er(...e)}static documentId(){return new n(gc.keyField().canonicalString())}isEqual(e){return e=U(e),e instanceof Er?this._delegate._internalPath.isEqual(e._internalPath):!1}};var ol=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=Vr();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=jr();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=Hr(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=qr(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=zr(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var qm={Firestore:Hs,GeoPoint:bc,Timestamp:pc,Blob:Vs,Transaction:qs,WriteBatch:zs,DocumentReference:$e,DocumentSnapshot:kt,Query:Pt,QueryDocumentSnapshot:Rt,QuerySnapshot:hi,CollectionReference:cn,FieldPath:rl,FieldValue:ol,setLogLevel:Hm,CACHE_SIZE_UNLIMITED:wc};function zm(n,e){n.INTERNAL.registerComponent(new Ce("firestore-compat",t=>{let i=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(i,s)},"PUBLIC").setServiceProps(Object.assign({},qm)))}function Gm(n){zm(n,(e,t)=>new Hs(e,t,new il)),n.registerVersion(Bm,jm)}Gm(W);function Km(n,e=Nt){return new Se(t=>{let i;return e!=null?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{i?.()}})}function Sh(n,e){return Km(n,e)}function Qm(n,e){return Sh(n,e).pipe(ze(void 0),vi(),N(t=>{let[i,s]=t;return s.exists?i?.exists?{payload:s,type:"modified"}:{payload:s,type:"added"}:{payload:s,type:"removed"}}))}function ul(n,e){return Sh(n,e).pipe(N(t=>({payload:t,type:"query"})))}var Gs=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let i=this.ref.collection(e),{ref:s,query:r}=Nh(i,t);return new Qs(s,r,this.afs)}snapshotChanges(){return Qm(this.ref,this.afs.schedulers.outsideAngular).pipe(x)}valueChanges(e={}){return this.snapshotChanges().pipe(N(({payload:t})=>e.idField?ct(z({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return qe(this.ref.get(e)).pipe(x)}};function Ks(n,e){return ul(n,e).pipe(ze(void 0),vi(),N(t=>{let[i,s]=t,r=s.payload.docChanges(),o=r.map(a=>({type:a.type,payload:a}));return i&&JSON.stringify(i.payload.metadata)!==JSON.stringify(s.payload.metadata)&&s.payload.docs.forEach((a,l)=>{let c=r.find(d=>d.doc.ref.isEqual(a.ref)),u=i?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function kh(n,e,t){return Ks(n,t).pipe(ht((i,s)=>Ym(i,s.map(r=>r.payload),e),[]),yi(),N(i=>i.map(s=>({type:s.type,payload:s}))))}function Ym(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=Zm(n,i))}),n}function ll(n,e,t,...i){let s=n.slice();return s.splice(e,t,...i),s}function Zm(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return ll(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return ll(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ll(n,e.oldIndex,1);break}return n}function Rh(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Qs=class{ref;query;afs;constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=Ks(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(N(i=>i.filter(s=>e.indexOf(s.type)>-1)))),t.pipe(ze(void 0),vi(),ke(([i,s])=>s.length>0||!i),N(([,i])=>i),x)}auditTrail(e){return this.stateChanges(e).pipe(ht((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=Rh(e);return kh(this.query,t,this.afs.schedulers.outsideAngular).pipe(x)}valueChanges(e={}){return ul(this.query,this.afs.schedulers.outsideAngular).pipe(N(t=>t.payload.docs.map(i=>e.idField?ct(z({},i.data()),{[e.idField]:i.id}):i.data())),x)}get(e){return qe(this.query.get(e)).pipe(x)}add(e){return this.ref.add(e)}doc(e){return new Gs(this.ref.doc(e),this.afs)}},cl=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Ks(this.query,this.afs.schedulers.outsideAngular).pipe(x):Ks(this.query,this.afs.schedulers.outsideAngular).pipe(N(t=>t.filter(i=>e.indexOf(i.type)>-1)),ke(t=>t.length>0),x)}auditTrail(e){return this.stateChanges(e).pipe(ht((t,i)=>[...t,...i],[]))}snapshotChanges(e){let t=Rh(e);return kh(this.query,t,this.afs.schedulers.outsideAngular).pipe(x)}valueChanges(e={}){return ul(this.query,this.afs.schedulers.outsideAngular).pipe(N(i=>i.payload.docs.map(s=>e.idField?z({[e.idField]:s.id},s.data()):s.data())),x)}get(e){return qe(this.query.get(e)).pipe(x)}},Ph=new A("angularfire2.enableFirestorePersistence"),Dh=new A("angularfire2.firestore.persistenceSettings"),Xm=new A("angularfire2.firestore.settings"),Jm=new A("angularfire2.firestore.use-emulator");function Nh(n,e=t=>t){return{query:e(n),ref:n}}var e_=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,i,s,r,o,a,l,c,u,d,h,p,m,v,S,H,J){this.schedulers=l;let T=mt(t,a,i),q=u;d&&Dn(T,a,h,m,v,S,p,H),[this.firestore,this.persistenceEnabled$]=jt(`${T.name}.firestore`,"AngularFirestore",T.name,()=>{let ie=a.runOutsideAngular(()=>T.firestore());if(r&&ie.settings(r),q&&ie.useEmulator(...q),s&&!Ei(o)){let Kh=()=>{try{return qe(ie.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(Qh){return typeof console<"u"&&console.warn(Qh),ce(!1)}};return[ie,a.runOutsideAngular(Kh)]}else return[ie,ce(!1)]},[r,q,s])}collection(t,i){let s;typeof t=="string"?s=this.firestore.collection(t):s=t;let{ref:r,query:o}=Nh(s,i),a=this.schedulers.ngZone.run(()=>r);return new Qs(a,o,this)}collectionGroup(t,i){let s=i||(o=>o),r=this.firestore.collectionGroup(t);return new cl(s(r),this)}doc(t){let i;typeof t=="string"?i=this.firestore.doc(t):i=t;let s=this.schedulers.ngZone.run(()=>i);return new Gs(s,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(i){return new(i||n)(g(Ze),g(Xe,8),g(Ph,8),g(Xm,8),g(Pe),g(O),g(Ee),g(Dh,8),g(Jm,8),g(Nn,8),g(Tn,8),g(An,8),g(Sn,8),g(kn,8),g(Rn,8),g(Pn,8),g(de,8))};static \u0275prov=G({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),xh=(()=>{class n{constructor(){W.registerVersion("angularfire",K.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:Ph,useValue:!0},{provide:Dh,useValue:t}]}}static \u0275fac=function(i){return new(i||n)};static \u0275mod=te({type:n});static \u0275inj=ee({providers:[e_]})}return n})();var Fh=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=me({type:e,selectors:[["app-sidebar-menu-item"]],inputs:{icon:"icon",title:"title",description:"description",path:"path"},standalone:!0,features:[ve],decls:7,vars:6,consts:[["routerLinkActive","bg-gray-800",1,"flex","justify-center","items-center","hover:bg-gray-800","rounded-md","p-2","transition-colors",3,"routerLink"],[1,"flex","flex-col","flex-grow"],[1,"text-white","text-lg","font-semibold"],[1,"text-gray-400","text-sm"]],template:function(s,r){s&1&&(ye(0,"a",0),Ke(1,"i"),ye(2,"div",1)(3,"span",2),pt(4),De(),ye(5,"span",3),pt(6),De()()()),s&2&&(Ft("routerLink",r.path),Be(),Ol("",r.icon," text-2xl mr-4 text-indigo-400"),Be(3),fn(r.title),Be(2),fn(r.description))},dependencies:[Ti,bi,Yl],encapsulation:2,changeDetection:0});let n=e;return n})();function i_(n,e){if(n&1&&(nr(0),Ke(1,"app-sidebar-menu-item",10),ir()),n&2){let t=e.$implicit;Be(),Ft("description",t.data.description)("icon",t.data.icon)("path",t.path)("title",t.data.title)}}function s_(n,e){if(n&1&&(nr(0),ye(1,"span",8),pt(2),sr(3,"titlecase"),De(),ft(4,i_,2,4,"ng-container",4),Ke(5,"div",9),ir()),n&2){let t=e.$implicit;Be(2),fn(rr(3,2,t.key)),Be(2),Ft("ngForOf",t.value)}}var Oh=(()=>{let e=class e{constructor(){this.groupedRoutes={};let i=Ys[0].children?.filter(s=>s.data&&s.path!=="checkListPage");i&&(this.groupedRoutes=i.reduce((s,r)=>{let o=r.data?.section||"default";return s[o]||(s[o]=[]),s[o].push(r),s},{}))}};e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=me({type:e,selectors:[["app-dashboard-layout"]],standalone:!0,features:[ve],decls:12,vars:3,consts:[[1,"flex","flex-row","mt-7"],[1,"hidden","sm:flex","flex-col","ml-5","w-[370px]","min-h-[calc(100vh-3.0rem)]","bg-white","bg-opacity-10","p-5","rounded-3xl"],["routerLink","/checkListPage",1,"font-bold","text-lg","lg:text-3xl","bg-gradient-to-br","from-white","via-white/50","bg-clip-text","text-transparent","hover:cursor-pointer"],[1,"text-indigo-500"],[4,"ngFor","ngForOf"],[1,"mx-3","sm:mx-20","flex","flex-col","w-full","h-[calc(100vh-50px)]","bg-white","bg-opacity-10","p-5","rounded-3xl"],[1,"flex","h-full","flex-row"],[1,"flex","flex-col","flex-auto","p-1"],[1,"text-xl"],[1,"border-gray-700","border","my-3"],[3,"description","icon","path","title"]],template:function(s,r){s&1&&(ye(0,"main",0)(1,"nav",1)(2,"h1",2),pt(3," CheckListWf3"),ye(4,"span",3),pt(5,"."),De()(),ft(6,s_,6,4,"ng-container",4),sr(7,"keyvalue"),De(),ye(8,"section",5)(9,"div",6)(10,"div",7),Ke(11,"router-outlet"),De()()()()),s&2&&(Be(6),Ft("ngForOf",rr(7,1,r.groupedRoutes)))},dependencies:[Gl,Hl,ql,zl,Ti,Ii,bi,Fh],encapsulation:2,changeDetection:0});let n=e;return n})();var Ys=[{path:"",component:Oh,children:[{path:"checkListPage",loadComponent:()=>import("./chunk-YT3AXSOJ.js"),data:{icon:"fa fa-list-alt",title:"Men\xFA",description:"Men\xFA de checklists WF3 y CADI",section:"checklists"}},{path:"checklistActas",loadComponent:()=>import("./chunk-2XK6LYB2.js"),data:{icon:"fa fa-list-alt",title:"WF3/Actas",description:"Checklist para Actas digitales y Wf3",section:"checklists"}},{path:"checklistCadi",loadComponent:()=>import("./chunk-O4WIAKND.js"),data:{icon:"fa fa-list-alt",title:"CADI",description:"Checklist para CADI",section:"checklists"}},{path:"microservicios",loadComponent:()=>import("./chunk-Z5PWTCGP.js"),data:{icon:"fa fa-microchip",title:"Microservicios",description:"Microservicios WF3/CADI",section:"microservicios"}},{path:"usuarios",loadComponent:()=>import("./chunk-KQWE5NBH.js"),data:{icon:"fa fa-user",title:"Usuarios",description:"Usuarios WF3/CADI",section:"usuarios"}},{path:"**",redirectTo:"checkListPage",pathMatch:"full"}]}];var r_="@",o_=(()=>{let e=class e{constructor(i,s,r,o,a){this.doc=i,this.delegate=s,this.zone=r,this.animationType=o,this.moduleImpl=a,this._rendererFactoryPromise=null,this.scheduler=Ge(Nl,{optional:!0})}ngOnDestroy(){this._engine?.flush()}loadImpl(){return(this.moduleImpl??import("./chunk-SA43RBUV.js").then(s=>s)).catch(s=>{throw new Sl(5300,!1)}).then(({\u0275createEngine:s,\u0275AnimationRendererFactory:r})=>{this._engine=s(this.animationType,this.doc);let o=new r(this.delegate,this._engine,this.zone);return this.delegate=o,o})}createRenderer(i,s){let r=this.delegate.createRenderer(i,s);if(r.\u0275type===0)return r;typeof r.throwOnSyntheticProps=="boolean"&&(r.throwOnSyntheticProps=!1);let o=new dl(r);return s?.data?.animation&&!this._rendererFactoryPromise&&(this._rendererFactoryPromise=this.loadImpl()),this._rendererFactoryPromise?.then(a=>{let l=a.createRenderer(i,s);o.use(l),this.scheduler?.notify(9)}).catch(a=>{o.use(r)}),o}begin(){this.delegate.begin?.()}end(){this.delegate.end?.()}whenRenderingDone(){return this.delegate.whenRenderingDone?.()??Promise.resolve()}};e.\u0275fac=function(s){Pl()},e.\u0275prov=G({token:e,factory:e.\u0275fac});let n=e;return n})(),dl=class{constructor(e){this.delegate=e,this.replay=[],this.\u0275type=1}use(e){if(this.delegate=e,this.replay!==null){for(let t of this.replay)t(e);this.replay=null}}get data(){return this.delegate.data}destroy(){this.replay=null,this.delegate.destroy()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}get destroyNode(){return this.delegate.destroyNode}appendChild(e,t){this.delegate.appendChild(e,t)}insertBefore(e,t,i,s){this.delegate.insertBefore(e,t,i,s)}removeChild(e,t,i){this.delegate.removeChild(e,t,i)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,s){this.delegate.setAttribute(e,t,i,s)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,s){this.delegate.setStyle(e,t,i,s)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){this.shouldReplay(t)&&this.replay.push(s=>s.setProperty(e,t,i)),this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.shouldReplay(t)&&this.replay.push(s=>s.listen(e,t,i)),this.delegate.listen(e,t,i)}shouldReplay(e){return this.replay!==null&&e.startsWith(r_)}};function hl(n="animations"){return Fl("NgAsyncAnimations"),xt([{provide:xl,useFactory:(e,t,i)=>new o_(e,t,i,n),deps:[Ot,Kl,O]},{provide:dn,useValue:n==="noop"?"NoopAnimations":"BrowserAnimations"}])}var ay="auth";var Zs=class{constructor(){return wn(ay)}};var fi=class{constructor(e){return e}},Mh="firestore",fl=class{constructor(){return wn(Mh)}};var pl=new A("angularfire2.firestore-instances");function ly(n,e){let t=Zr(Mh,n,e);return t&&new fi(t)}function cy(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new fi(i)}}var uy={provide:fl,deps:[[new Re,pl]]},dy={provide:fi,useFactory:ly,deps:[[new Re,pl],_t]};function Lh(n,...e){return se("angularfire",K.full,"fst"),xt([dy,uy,{provide:pl,useFactory:cy(n),multi:!0,deps:[O,_e,Ee,In,[new Re,Zs],[new Re,de],...e]}])}var Wh=En(Ec,!0);var $h={providers:[Bl({eventCoalescing:!0}),Zl(Ys),hl(),kl([Wc.initializeApp(Rc),Xc,Eh,xh]),$c(()=>Uc({projectId:"checklistwf3",appId:"1:945728064927:web:b7511ac72fe11d745e81aa",storageBucket:"checklistwf3.appspot.com",apiKey:"AIzaSyDAyqanqrMWsn3ZD5S3K3Fw1ncvLm3AW4I",authDomain:"checklistwf3.firebaseapp.com",messagingSenderId:"945728064927",measurementId:"G-QY9BBZ34H5"})),Lh(()=>Wh()),hl()]};var Uh=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=te({type:e}),e.\u0275inj=ee({imports:[Ut,Ut]});let n=e;return n})();function py(n,e){}var Dt=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.closeOnNavigation=!0,this.closeOnDestroy=!0,this.closeOnOverlayDetachments=!0}};var _l=(()=>{let e=class e extends Fc{constructor(i,s,r,o,a,l,c,u){super(),this._elementRef=i,this._focusTrapFactory=s,this._config=o,this._interactivityChecker=a,this._ngZone=l,this._overlayRef=c,this._focusMonitor=u,this._platform=Ge(Dc),this._focusTrap=null,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this._ariaLabelledByQueue=[],this._changeDetectorRef=Ge(jl),this.attachDomPortal=d=>{this._portalOutlet.hasAttached();let h=this._portalOutlet.attachDomPortal(d);return this._contentAttached(),h},this._document=r,this._config.ariaLabelledBy&&this._ariaLabelledByQueue.push(this._config.ariaLabelledBy)}_addAriaLabelledBy(i){this._ariaLabelledByQueue.push(i),this._changeDetectorRef.markForCheck()}_removeAriaLabelledBy(i){let s=this._ariaLabelledByQueue.indexOf(i);s>-1&&(this._ariaLabelledByQueue.splice(s,1),this._changeDetectorRef.markForCheck())}_contentAttached(){this._initializeFocusTrap(),this._handleBackdropClicks(),this._captureInitialFocus()}_captureInitialFocus(){this._trapFocus()}ngOnDestroy(){this._restoreFocus()}attachComponentPortal(i){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachComponentPortal(i);return this._contentAttached(),s}attachTemplatePortal(i){this._portalOutlet.hasAttached();let s=this._portalOutlet.attachTemplatePortal(i);return this._contentAttached(),s}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(i,s){this._interactivityChecker.isFocusable(i)||(i.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{let r=()=>{i.removeEventListener("blur",r),i.removeEventListener("mousedown",r),i.removeAttribute("tabindex")};i.addEventListener("blur",r),i.addEventListener("mousedown",r)})),i.focus(s)}_focusByCssSelector(i,s){let r=this._elementRef.nativeElement.querySelector(i);r&&this._forceFocus(r,s)}_trapFocus(){let i=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||i.focus();break;case!0:case"first-tabbable":this._focusTrap?.focusInitialElementWhenReady().then(s=>{s||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus);break}}_restoreFocus(){let i=this._config.restoreFocus,s=null;if(typeof i=="string"?s=this._document.querySelector(i):typeof i=="boolean"?s=i?this._elementFocusedBeforeDialogWasOpened:null:i&&(s=i),this._config.restoreFocus&&s&&typeof s.focus=="function"){let r=Bi(),o=this._elementRef.nativeElement;(!r||r===this._document.body||r===o||o.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(s,this._closeInteractionType),this._closeInteractionType=null):s.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){let i=this._elementRef.nativeElement,s=Bi();return i===s||i.contains(s)}_initializeFocusTrap(){this._platform.isBrowser&&(this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=Bi()))}_handleBackdropClicks(){this._overlayRef.backdropClick().subscribe(()=>{this._config.disableClose&&this._recaptureFocus()})}};e.\u0275fac=function(s){return new(s||e)(F(un),F(Vi),F(Ot,8),F(Dt),F(ji),F(O),F($t),F(Hi))},e.\u0275cmp=me({type:e,selectors:[["cdk-dialog-container"]],viewQuery:function(s,r){if(s&1&&Ll(vn,7),s&2){let o;Wl(o=$l())&&(r._portalOutlet=o.first)}},hostAttrs:["tabindex","-1",1,"cdk-dialog-container"],hostVars:6,hostBindings:function(s,r){s&2&&hn("id",r._config.id||null)("role",r._config.role)("aria-modal",r._config.ariaModal)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null)},standalone:!0,features:[Ci,ve],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(s,r){s&1&&ft(0,py,0,0,"ng-template",0)},dependencies:[vn],styles:[".cdk-dialog-container{display:block;width:100%;height:100%;min-height:inherit;max-height:inherit}"],encapsulation:2});let n=e;return n})(),pi=class{constructor(e,t){this.overlayRef=e,this.config=t,this.closed=new ge,this.disableClose=t.disableClose,this.backdropClick=e.backdropClick(),this.keydownEvents=e.keydownEvents(),this.outsidePointerEvents=e.outsidePointerEvents(),this.id=t.id,this.keydownEvents.subscribe(i=>{i.keyCode===27&&!this.disableClose&&!Ui(i)&&(i.preventDefault(),this.close(void 0,{focusOrigin:"keyboard"}))}),this.backdropClick.subscribe(()=>{this.disableClose||this.close(void 0,{focusOrigin:"mouse"})}),this._detachSubscription=e.detachments().subscribe(()=>{t.closeOnOverlayDetachments!==!1&&this.close()})}close(e,t){if(this.containerInstance){let i=this.closed;this.containerInstance._closeInteractionType=t?.focusOrigin||"program",this._detachSubscription.unsubscribe(),this.overlayRef.dispose(),i.next(e),i.complete(),this.componentInstance=this.containerInstance=null}}updatePosition(){return this.overlayRef.updatePosition(),this}updateSize(e="",t=""){return this.overlayRef.updateSize({width:e,height:t}),this}addPanelClass(e){return this.overlayRef.addPanelClass(e),this}removePanelClass(e){return this.overlayRef.removePanelClass(e),this}},gy=new A("DialogScrollStrategy",{providedIn:"root",factory:()=>{let n=Ge(Ye);return()=>n.scrollStrategies.block()}}),my=new A("DialogData"),_y=new A("DefaultDialogConfig");var yy=0,yl=(()=>{let e=class e{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}constructor(i,s,r,o,a,l){this._overlay=i,this._injector=s,this._defaultOptions=r,this._parentDialog=o,this._overlayContainer=a,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new ge,this._afterOpenedAtThisLevel=new ge,this._ariaHiddenElements=new Map,this.afterAllClosed=mi(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ze(void 0))),this._scrollStrategy=l}open(i,s){let r=this._defaultOptions||new Dt;s=z(z({},r),s),s.id=s.id||`cdk-dialog-${yy++}`,s.id&&this.getDialogById(s.id);let o=this._getOverlayConfig(s),a=this._overlay.create(o),l=new pi(a,s),c=this._attachContainer(a,l,s);return l.containerInstance=c,this._attachDialogContent(i,l,c,s),this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(l),l.closed.subscribe(()=>this._removeOpenDialog(l,!0)),this.afterOpened.next(l),l}closeAll(){gl(this.openDialogs,i=>i.close())}getDialogById(i){return this.openDialogs.find(s=>s.id===i)}ngOnDestroy(){gl(this._openDialogsAtThisLevel,i=>{i.config.closeOnDestroy===!1&&this._removeOpenDialog(i,!1)}),gl(this._openDialogsAtThisLevel,i=>i.close()),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete(),this._openDialogsAtThisLevel=[]}_getOverlayConfig(i){let s=new Oc({positionStrategy:i.positionStrategy||this._overlay.position().global().centerHorizontally().centerVertically(),scrollStrategy:i.scrollStrategy||this._scrollStrategy(),panelClass:i.panelClass,hasBackdrop:i.hasBackdrop,direction:i.direction,minWidth:i.minWidth,minHeight:i.minHeight,maxWidth:i.maxWidth,maxHeight:i.maxHeight,width:i.width,height:i.height,disposeOnNavigation:i.closeOnNavigation});return i.backdropClass&&(s.backdropClass=i.backdropClass),s}_attachContainer(i,s,r){let o=r.injector||r.viewContainerRef?.injector,a=[{provide:Dt,useValue:r},{provide:pi,useValue:s},{provide:$t,useValue:i}],l;r.container?typeof r.container=="function"?l=r.container:(l=r.container.type,a.push(...r.container.providers(r))):l=_l;let c=new Qr(l,r.viewContainerRef,_e.create({parent:o||this._injector,providers:a}),r.componentFactoryResolver);return i.attach(c).instance}_attachDialogContent(i,s,r,o){if(i instanceof Dl){let a=this._createInjector(o,s,r,void 0),l={$implicit:o.data,dialogRef:s};o.templateContext&&(l=z(z({},l),typeof o.templateContext=="function"?o.templateContext():o.templateContext)),r.attachTemplatePortal(new xc(i,null,l,a))}else{let a=this._createInjector(o,s,r,this._injector),l=r.attachComponentPortal(new Qr(i,o.viewContainerRef,a,o.componentFactoryResolver));s.componentRef=l,s.componentInstance=l.instance}}_createInjector(i,s,r,o){let a=i.injector||i.viewContainerRef?.injector,l=[{provide:my,useValue:i.data},{provide:pi,useValue:s}];return i.providers&&(typeof i.providers=="function"?l.push(...i.providers(s,i,r)):l.push(...i.providers)),i.direction&&(!a||!a.get(Kr,null,{optional:!0}))&&l.push({provide:Kr,useValue:{value:i.direction,change:ce()}}),_e.create({parent:a||o,providers:l})}_removeOpenDialog(i,s){let r=this.openDialogs.indexOf(i);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((o,a)=>{o?a.setAttribute("aria-hidden",o):a.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),s&&this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){let i=this._overlayContainer.getContainerElement();if(i.parentElement){let s=i.parentElement.children;for(let r=s.length-1;r>-1;r--){let o=s[r];o!==i&&o.nodeName!=="SCRIPT"&&o.nodeName!=="STYLE"&&!o.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(o,o.getAttribute("aria-hidden")),o.setAttribute("aria-hidden","true"))}}}_getAfterAllClosed(){let i=this._parentDialog;return i?i._getAfterAllClosed():this._afterAllClosedAtThisLevel}};e.\u0275fac=function(s){return new(s||e)(g(Ye),g(_e),g(_y,8),g(e,12),g(qi),g(gy))},e.\u0275prov=G({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function gl(n,e){let t=n.length;for(;t--;)e(n[t])}var Bh=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=te({type:e}),e.\u0275inj=ee({providers:[yl],imports:[zi,Cn,Nc,Cn]});let n=e;return n})();function vy(n,e){}var gi=class{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.ariaModal=!0,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}},vl="mdc-dialog--open",jh="mdc-dialog--opening",Vh="mdc-dialog--closing",Cy=150,wy=75,Ey=(()=>{let e=class e extends _l{constructor(i,s,r,o,a,l,c,u,d){super(i,s,r,o,a,l,c,d),this._animationMode=u,this._animationStateChanged=new Rl,this._animationsEnabled=this._animationMode!=="NoopAnimations",this._actionSectionCount=0,this._hostElement=this._elementRef.nativeElement,this._enterAnimationDuration=this._animationsEnabled?qh(this._config.enterAnimationDuration)??Cy:0,this._exitAnimationDuration=this._animationsEnabled?qh(this._config.exitAnimationDuration)??wy:0,this._animationTimer=null,this._isDestroyed=!1,this._finishDialogOpen=()=>{this._clearAnimationClasses(),this._openAnimationDone(this._enterAnimationDuration)},this._finishDialogClose=()=>{this._clearAnimationClasses(),this._animationStateChanged.emit({state:"closed",totalTime:this._exitAnimationDuration})}}_contentAttached(){super._contentAttached(),this._startOpenAnimation()}_startOpenAnimation(){this._animationStateChanged.emit({state:"opening",totalTime:this._enterAnimationDuration}),this._animationsEnabled?(this._hostElement.style.setProperty(Hh,`${this._enterAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(jh,vl)),this._waitForAnimationToComplete(this._enterAnimationDuration,this._finishDialogOpen)):(this._hostElement.classList.add(vl),Promise.resolve().then(()=>this._finishDialogOpen()))}_startExitAnimation(){this._animationStateChanged.emit({state:"closing",totalTime:this._exitAnimationDuration}),this._hostElement.classList.remove(vl),this._animationsEnabled?(this._hostElement.style.setProperty(Hh,`${this._exitAnimationDuration}ms`),this._requestAnimationFrame(()=>this._hostElement.classList.add(Vh)),this._waitForAnimationToComplete(this._exitAnimationDuration,this._finishDialogClose)):Promise.resolve().then(()=>this._finishDialogClose())}_updateActionSectionCount(i){this._actionSectionCount+=i,this._changeDetectorRef.markForCheck()}_clearAnimationClasses(){this._hostElement.classList.remove(jh,Vh)}_waitForAnimationToComplete(i,s){this._animationTimer!==null&&clearTimeout(this._animationTimer),this._animationTimer=setTimeout(s,i)}_requestAnimationFrame(i){this._ngZone.runOutsideAngular(()=>{typeof requestAnimationFrame=="function"?requestAnimationFrame(i):i()})}_captureInitialFocus(){this._config.delayFocusTrap||this._trapFocus()}_openAnimationDone(i){this._isDestroyed||(this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i}))}ngOnDestroy(){super.ngOnDestroy(),this._animationTimer!==null&&clearTimeout(this._animationTimer),this._isDestroyed=!0}attachComponentPortal(i){let s=super.attachComponentPortal(i);return s.location.nativeElement.classList.add("mat-mdc-dialog-component-host"),s}};e.\u0275fac=function(s){return new(s||e)(F(un),F(Vi),F(Ot,8),F(gi),F(ji),F(O),F($t),F(dn,8),F(Hi))},e.\u0275cmp=me({type:e,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1",1,"mat-mdc-dialog-container","mdc-dialog"],hostVars:10,hostBindings:function(s,r){s&2&&(Ml("id",r._config.id),hn("aria-modal",r._config.ariaModal)("role",r._config.role)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledByQueue[0])("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null),tr("_mat-animation-noopable",!r._animationsEnabled)("mat-mdc-dialog-container-with-actions",r._actionSectionCount>0))},standalone:!0,features:[Ci,ve],decls:3,vars:0,consts:[[1,"mat-mdc-dialog-inner-container","mdc-dialog__container"],[1,"mat-mdc-dialog-surface","mdc-dialog__surface"],["cdkPortalOutlet",""]],template:function(s,r){s&1&&(ye(0,"div",0)(1,"div",1),ft(2,vy,0,0,"ng-template",2),De()())},dependencies:[vn],styles:['.mat-mdc-dialog-container{width:100%;height:100%;display:block;box-sizing:border-box;max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;outline:0}.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-max-width, 80vw);min-width:var(--mat-dialog-container-min-width, 0)}@media(max-width: 599px){.cdk-overlay-pane.mat-mdc-dialog-panel{max-width:var(--mat-dialog-container-small-max-width, 80vw)}}.mat-mdc-dialog-inner-container{display:flex;flex-direction:row;align-items:center;justify-content:space-around;box-sizing:border-box;height:100%;opacity:0;transition:opacity linear var(--mat-dialog-transition-duration, 0ms);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit}.mdc-dialog--closing .mat-mdc-dialog-inner-container{transition:opacity 75ms linear;transform:none}.mdc-dialog--open .mat-mdc-dialog-inner-container{opacity:1}._mat-animation-noopable .mat-mdc-dialog-inner-container{transition:none}.mat-mdc-dialog-surface{display:flex;flex-direction:column;flex-grow:0;flex-shrink:0;box-sizing:border-box;width:100%;height:100%;position:relative;overflow-y:auto;outline:0;transform:scale(0.8);transition:transform var(--mat-dialog-transition-duration, 0ms) cubic-bezier(0, 0, 0.2, 1);max-height:inherit;min-height:inherit;min-width:inherit;max-width:inherit;box-shadow:var(--mat-dialog-container-elevation-shadow, 0px 11px 15px -7px rgba(0, 0, 0, 0.2), 0px 24px 38px 3px rgba(0, 0, 0, 0.14), 0px 9px 46px 8px rgba(0, 0, 0, 0.12));border-radius:var(--mdc-dialog-container-shape, 4px);background-color:var(--mdc-dialog-container-color, white)}[dir=rtl] .mat-mdc-dialog-surface{text-align:right}.mdc-dialog--open .mat-mdc-dialog-surface,.mdc-dialog--closing .mat-mdc-dialog-surface{transform:none}._mat-animation-noopable .mat-mdc-dialog-surface{transition:none}.mat-mdc-dialog-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:2px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mat-mdc-dialog-title{display:block;margin-top:0;position:relative;flex-shrink:0;box-sizing:border-box;margin:0 0 1px;padding:var(--mat-dialog-headline-padding, 0 24px 9px)}.mat-mdc-dialog-title::before{display:inline-block;width:0;height:40px;content:"";vertical-align:0}[dir=rtl] .mat-mdc-dialog-title{text-align:right}.mat-mdc-dialog-container .mat-mdc-dialog-title{color:var(--mdc-dialog-subhead-color, rgba(0, 0, 0, 0.87));font-family:var(--mdc-dialog-subhead-font, Roboto, sans-serif);line-height:var(--mdc-dialog-subhead-line-height, 1.5rem);font-size:var(--mdc-dialog-subhead-size, 1rem);font-weight:var(--mdc-dialog-subhead-weight, 400);letter-spacing:var(--mdc-dialog-subhead-tracking, 0.03125em)}.mat-mdc-dialog-content{display:block;flex-grow:1;box-sizing:border-box;margin:0;overflow:auto;max-height:65vh}.mat-mdc-dialog-content>:first-child{margin-top:0}.mat-mdc-dialog-content>:last-child{margin-bottom:0}.mat-mdc-dialog-container .mat-mdc-dialog-content{color:var(--mdc-dialog-supporting-text-color, rgba(0, 0, 0, 0.6));font-family:var(--mdc-dialog-supporting-text-font, Roboto, sans-serif);line-height:var(--mdc-dialog-supporting-text-line-height, 1.5rem);font-size:var(--mdc-dialog-supporting-text-size, 1rem);font-weight:var(--mdc-dialog-supporting-text-weight, 400);letter-spacing:var(--mdc-dialog-supporting-text-tracking, 0.03125em)}.mat-mdc-dialog-container .mat-mdc-dialog-content{padding:var(--mat-dialog-content-padding, 20px 24px)}.mat-mdc-dialog-container-with-actions .mat-mdc-dialog-content{padding:var(--mat-dialog-with-actions-content-padding, 20px 24px)}.mat-mdc-dialog-container .mat-mdc-dialog-title+.mat-mdc-dialog-content{padding-top:0}.mat-mdc-dialog-actions{display:flex;position:relative;flex-shrink:0;flex-wrap:wrap;align-items:center;justify-content:flex-end;box-sizing:border-box;min-height:52px;margin:0;padding:8px;border-top:1px solid rgba(0,0,0,0);padding:var(--mat-dialog-actions-padding, 8px);justify-content:var(--mat-dialog-actions-alignment, start)}.cdk-high-contrast-active .mat-mdc-dialog-actions{border-top-color:CanvasText}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-start,.mat-mdc-dialog-actions[align=start]{justify-content:start}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-center,.mat-mdc-dialog-actions[align=center]{justify-content:center}.mat-mdc-dialog-actions.mat-mdc-dialog-actions-align-end,.mat-mdc-dialog-actions[align=end]{justify-content:flex-end}.mat-mdc-dialog-actions .mat-button-base+.mat-button-base,.mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-mdc-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-mdc-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}.mat-mdc-dialog-component-host{display:contents}'],encapsulation:2});let n=e;return n})(),Hh="--mat-dialog-transition-duration";function qh(n){return n==null?null:typeof n=="number"?n:n.endsWith("ms")?Gr(n.substring(0,n.length-2)):n.endsWith("s")?Gr(n.substring(0,n.length-1))*1e3:n==="0"?0:null}var Xs=function(n){return n[n.OPEN=0]="OPEN",n[n.CLOSING=1]="CLOSING",n[n.CLOSED=2]="CLOSED",n}(Xs||{}),Cl=class{constructor(e,t,i){this._ref=e,this._containerInstance=i,this._afterOpened=new ge,this._beforeClosed=new ge,this._state=Xs.OPEN,this.disableClose=t.disableClose,this.id=e.id,e.addPanelClass("mat-mdc-dialog-panel"),i._animationStateChanged.pipe(ke(s=>s.state==="opened"),_i(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),i._animationStateChanged.pipe(ke(s=>s.state==="closed"),_i(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.overlayRef.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._finishDialogClose()}),dt(this.backdropClick(),this.keydownEvents().pipe(ke(s=>s.keyCode===27&&!this.disableClose&&!Ui(s)))).subscribe(s=>{this.disableClose||(s.preventDefault(),Iy(this,s.type==="keydown"?"keyboard":"mouse"))})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe(ke(t=>t.state==="closing"),_i(1)).subscribe(t=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._ref.overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=Xs.CLOSING,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._ref.closed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}updatePosition(e){let t=this._ref.config.positionStrategy;return e&&(e.left||e.right)?e.left?t.left(e.left):t.right(e.right):t.centerHorizontally(),e&&(e.top||e.bottom)?e.top?t.top(e.top):t.bottom(e.bottom):t.centerVertically(),this._ref.updatePosition(),this}updateSize(e="",t=""){return this._ref.updateSize(e,t),this}addPanelClass(e){return this._ref.addPanelClass(e),this}removePanelClass(e){return this._ref.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=Xs.CLOSED,this._ref.close(this._result,{focusOrigin:this._closeInteractionType}),this.componentInstance=null}};function Iy(n,e,t){return n._closeInteractionType=e,n.close(t)}var by=new A("MatMdcDialogData"),Ty=new A("mat-mdc-dialog-default-options"),Ay=new A("mat-mdc-dialog-scroll-strategy",{providedIn:"root",factory:()=>{let n=Ge(Ye);return()=>n.scrollStrategies.block()}});var Sy=0,ky=(()=>{let e=class e{get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){let i=this._parentDialog;return i?i._getAfterAllClosed():this._afterAllClosedAtThisLevel}constructor(i,s,r,o,a,l,c,u){this._overlay=i,this._defaultOptions=o,this._scrollStrategy=a,this._parentDialog=l,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new ge,this._afterOpenedAtThisLevel=new ge,this.dialogConfigClass=gi,this.afterAllClosed=mi(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe(ze(void 0))),this._dialog=s.get(yl),this._dialogRefConstructor=Cl,this._dialogContainerType=Ey,this._dialogDataToken=by}open(i,s){let r;s=z(z({},this._defaultOptions||new gi),s),s.id=s.id||`mat-mdc-dialog-${Sy++}`,s.scrollStrategy=s.scrollStrategy||this._scrollStrategy();let o=this._dialog.open(i,ct(z({},s),{positionStrategy:this._overlay.position().global().centerHorizontally().centerVertically(),disableClose:!0,closeOnDestroy:!1,closeOnOverlayDetachments:!1,container:{type:this._dialogContainerType,providers:()=>[{provide:this.dialogConfigClass,useValue:s},{provide:Dt,useValue:s}]},templateContext:()=>({dialogRef:r}),providers:(a,l,c)=>(r=new this._dialogRefConstructor(a,s,c),r.updatePosition(s?.position),[{provide:this._dialogContainerType,useValue:c},{provide:this._dialogDataToken,useValue:l.data},{provide:this._dialogRefConstructor,useValue:r}])}));return r.componentRef=o.componentRef,r.componentInstance=o.componentInstance,this.openDialogs.push(r),this.afterOpened.next(r),r.afterClosed().subscribe(()=>{let a=this.openDialogs.indexOf(r);a>-1&&(this.openDialogs.splice(a,1),this.openDialogs.length||this._getAfterAllClosed().next())}),r}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(i){return this.openDialogs.find(s=>s.id===i)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_closeDialogs(i){let s=i.length;for(;s--;)i[s].close()}};e.\u0275fac=function(s){return new(s||e)(g(Ye),g(_e),g(Vl,8),g(Ty,8),g(Ay),g(e,12),g(qi),g(dn,8))},e.\u0275prov=G({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var zh=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=te({type:e}),e.\u0275inj=ee({providers:[ky],imports:[Bh,zi,Cn,Ut,Ut]});let n=e;return n})();var Gh=(()=>{let e=class e{constructor(){this.title="checklistwf3"}};e.\u0275fac=function(s){return new(s||e)},e.\u0275cmp=me({type:e,selectors:[["app-root"]],standalone:!0,features:[ve],decls:1,vars:0,template:function(s,r){s&1&&Ke(0,"router-outlet")},dependencies:[Ii,Pc,Uh,zh]});let n=e;return n})();Ql(Gh,$h).catch(n=>console.error(n));
